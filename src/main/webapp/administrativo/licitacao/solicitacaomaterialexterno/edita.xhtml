<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui"
      xmlns:fcc="http://java.sun.com/jsf/composite/components/contabil"
      xmlns:ad="http://java.sun.com/jsf/composite/components/administrativo"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:co="http://java.sun.com/jsf/composite/components/administrativo">
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <script type="text/javascript">

            function desabilitarCampoArquivo(campoOrigem, idCampoDestino) {
                var split = campoOrigem.id.toString().split(':');
                var idOrigem = split[split.length - 1];

                if (campoOrigem.value.toString().trim().length == 0 || campoOrigem.value == '' || campoOrigem.value == 'undefined') {
                    var idPanel = campoOrigem.id.replace(idOrigem, idCampoDestino);
                    var panel = document.getElementById(idPanel);
                    panel.disabled = true;
                    atribuirNullTipoDocumento();
                }
            }

        </script>
        <h:form id="Formulario">

            <p:remoteCommand name="limparDadosAta"
                             actionListener="#{solicitacaoMaterialExternoControlador.limparDadosAta()}"
                             process="@this"
                             update=":Formulario:tab-view-geral:panel-item :form-dialog-adesao-ata :Formulario:tab-view-geral:bt-visualiza-adesao-ata"/>

            <p:remoteCommand name="atribuirNullParaEspecificao"
                             actionListener="#{solicitacaoMaterialExternoControlador.atribuirNullParaEspecificao()}"
                             process="@this"
                             update=":Formulario:tab-view-geral:editorEspecificacao :Formulario:tab-view-geral:bt-especificacoes"/>

            <fc:cabecalhoPretty origem="#{solicitacaoMaterialExternoControlador.caminhoPadrao}listar/"
                                controlador="#{solicitacaoMaterialExternoControlador}"/>

            <p:panel
                header="Solicitação de Adesão à Ata de Registro de Preço - #{solicitacaoMaterialExternoControlador.selecionado.tipoSolicitacaoRegistroPreco.descricao}">

                <p:tabView id="tab-view-geral" styleClass="mtop05">
                    <p:tab title="Dados Gerais">
                        <p:outputPanel id="panel-dados-gerais">
                            <h:panelGrid columns="2">
                                <fc:outputLabelObrigatorio value="Número: "/>
                                <h:outputText id="numero"
                                              value="#{solicitacaoMaterialExternoControlador.selecionado.numero ne null
                                              ? solicitacaoMaterialExternoControlador.selecionado.numero : 'Gerado automaticamente ao salvar'}"
                                              styleClass="negrito"/>

                                <fc:outputLabelObrigatorio value="Exercício:"/>
                                <p:inputText value="#{solicitacaoMaterialExternoControlador.selecionado.exercicio}"
                                             id="exercicio"
                                             maxlength="4"
                                             size="5"
                                             converter="#{exercicioControlador.converterExercicio}">
                                    <p:ajax process="@this" update="@this"/>
                                </p:inputText>

                                <fc:outputLabelObrigatorio value="Data da Solicitação:"/>
                                <p:calendar onkeypress="mascara(this, mdata)"
                                            maxlength="10"
                                            style="text-align: right"
                                            autocomplete="off"
                                            title="Digite a data da solicitação."
                                            value="#{solicitacaoMaterialExternoControlador.selecionado.dataSolicitacao}"
                                            disabled="#{solicitacaoMaterialExternoControlador.isOperacaoEditar()}"
                                            locale="pt_BR" navigator="true" pattern="dd/MM/yyyy"
                                            size="10"/>

                                <fc:outputLabelObrigatorio value="Tipo de Solicitação:"/>
                                <h:panelGrid columns="2"
                                             cellpadding="0"
                                             cellspacing="0">
                                    <h:selectOneMenu id="tipo-solicitacao"
                                                     title="Informe o tipo solicitação."
                                                     value="#{solicitacaoMaterialExternoControlador.selecionado.tipoSolicitacaoRegistroPreco}"
                                                     disabled="true">
                                        <p:ajax event="change"
                                                listener="#{solicitacaoMaterialExternoControlador.processarMudancaDeTipoDeSolicitacao()}"
                                                process="@this"
                                                update=":Formulario:tab-view-geral"
                                                onstart="aguarde.show();"
                                                oncomplete="aguarde.hide();"/>
                                        <f:selectItems
                                            value="#{solicitacaoMaterialExternoControlador.tipoSolicitacaoRegistroPreco}"/>
                                    </h:selectOneMenu>

                                    <p:commandButton id="bt-informacao-solicitacao-interna"
                                                     icon="ui-icon-info"
                                                     process="@none"
                                                     update="@none"
                                                     styleClass="icone-20 mlef05"
                                                     rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}"/>
                                    <p:overlayPanel for="bt-informacao-solicitacao-interna"
                                                    appendToBody="true"
                                                    style="border : solid black 2px;"
                                                    showEvent="mouseover"
                                                    hideEvent="mouseout">
                                        <h:outputText
                                            value="Ao salvar uma nova solicitação do tipo interna: &lt;br/> &lt;br/>
                                                &lt;b>O sistema criará automaticamente uma adesão e irá adiciona-la na ata de registro de preço informada logo abaixo.&lt;b/>"
                                            escape="false"/>
                                    </p:overlayPanel>
                                </h:panelGrid>

                                <fc:outputLabelObrigatorio value="Órgão/Entidade/Fundo Solicitante:"/>
                                <p:autoComplete queryDelay="1000" id="unidade-responsavel"
                                                title="Informe a unidade responsável do processo de compra."
                                                value="#{solicitacaoMaterialExternoControlador.selecionado.hierarquiaOrganizacional}"
                                                completeMethod="#{solicitacaoMaterialExternoControlador.completaUnidadeOrganizacional}"
                                                converter="#{hierarquiaOrganizacionalControlador.converterHierarquiaOrganizacional}"
                                                var="unidade"
                                                disabled="#{solicitacaoMaterialExternoControlador.isOperacaoEditar()}"
                                                maxResults="50"
                                                dropdown="true"
                                                panelStyle="max-width: 750px;max-height: 250px"
                                                itemLabel="#{unidade}"
                                                itemValue="#{unidade}"
                                                forceSelection="true"
                                                size="70">
                                    <p:ajax event="itemSelect"
                                            listener="#{solicitacaoMaterialExternoControlador.carregarItensDaAtaNaSolicitacao()}"
                                            update=":Formulario:tab-view-geral:panel-item :form-dialog-adesao-ata bt-visualiza-adesao-ata"
                                            process="@this"
                                            onstart="aguarde.show();"
                                            oncomplete="aguarde.hide();"/>
                                </p:autoComplete>

                                <fc:outputLabelObrigatorio value="Órgão/Entidade/Fundo Gerenciador:"
                                                           rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}"/>
                                <h:panelGrid id="panel-gerenciador"
                                             columns="2"
                                             rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}"
                                             cellpadding="0"
                                             cellspacing="0">
                                    <p:autoComplete queryDelay="1000" id="autocomplete-pessoa-juridica-gerenciador"
                                                    title="Informe pessoa jurídica gerenciador."
                                                    value="#{solicitacaoMaterialExternoControlador.selecionado.pessoaJuridica}"
                                                    completeMethod="#{solicitacaoMaterialExternoControlador.completarPessoaJuridica}"
                                                    converter="#{pessoaContabilControlador.converterGenerico}"
                                                    maxResults="50"
                                                    dropdown="true"
                                                    panelStyle="max-width: 750px;max-height: 250px"
                                                    var="pj"
                                                    itemLabel="#{pj}"
                                                    itemValue="#{pj.id}"
                                                    size="70"
                                                    styleClass="mrig05">
                                        <p:ajax event="itemSelect" update="@this" process="@this"
                                                onstart="aguarde.show();" oncomplete="aguarde.hide();"/>
                                    </p:autoComplete>

                                    <fc:novoParente id="botao-nova-pessoa-juridica"
                                                    label="PJ"
                                                    title="Cadastrar uma nova pessoa jurídica."
                                                    selecionado="#{solicitacaoMaterialExternoControlador.selecionado}"
                                                    destino="/tributario/configuracoes/pessoa/novapessoajuridica/"
                                                    origem="#{solicitacaoMaterialExternoControlador.urlAtual}"
                                                    disabled="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}"/>
                                </h:panelGrid>

                                <fc:outputLabelObrigatorio value="Número Ata Registro de Preço Externa:"
                                                           rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}"/>
                                <p:inputText id="input-numero-ata-externo"
                                             title="Digite o número da ata do registro de preço externo."
                                             rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}"
                                             value="#{solicitacaoMaterialExternoControlador.selecionado.numeroAtaExterna}"
                                             size="10"/>

                                <fc:outputLabelObrigatorio value="Ata de Registro de Preço Interna:"
                                                           rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}"/>
                                <h:panelGrid id="panel-ata-registro-preco"
                                             columns="4"
                                             cellpadding="0"
                                             cellspacing="0"
                                             rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}">
                                    <p:autoComplete queryDelay="1000" id="autocomplete-ata-registro-praco"
                                                    title="Informe a ata de registro de preço."
                                                    value="#{solicitacaoMaterialExternoControlador.selecionado.ataRegistroPreco}"
                                                    completeMethod="#{ataRegistroPrecoControlador.buscarAtasRegistroPrecoVigentes}"
                                                    converter="#{ataRegistroPrecoControlador.converterGenerico}"
                                                    disabled="#{solicitacaoMaterialExternoControlador.isOperacaoEditar()}"
                                                    onkeyup="if (keyUpCampoVazio(this)){limparDadosAta()}"
                                                    maxResults="50"
                                                    dropdown="true"
                                                    panelStyle="max-width: 750px;max-height: 250px"
                                                    var="ata"
                                                    itemLabel="#{ata}"
                                                    itemValue="#{ata.id}"
                                                    size="70"
                                                    styleClass="mrig05">
                                        <p:ajax event="itemSelect"
                                                listener="#{solicitacaoMaterialExternoControlador.carregarItensDaAtaNaSolicitacao()}"
                                                process="@this"
                                                update=":Formulario:tab-view-geral:panel-item :form-dialog-adesao-ata bt-visualiza-adesao-ata"
                                                onstart="aguarde.show();" oncomplete="aguarde.hide();"/>
                                    </p:autoComplete>

                                    <fcc:botao_informacao id="btn-info-ata"
                                                          descricao="Lista todas as ata vigêntes que são gerenciadoras (possui unidade do processo de licitação/irp gerenciador)."/>

                                    <p:commandButton process="@none"
                                                     id="bt-nova-ata-registro-preco"
                                                     icon="ui-icon-plus"
                                                     styleClass="mlef05 prioritario"
                                                     update="@none"
                                                     onclick="window.open('#{request.contextPath}/ata-registro-preco/novo/','_blank');"
                                                     rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}"
                                                     disabled="#{solicitacaoMaterialExternoControlador.isOperacaoEditar()}"/>

                                    <p:commandButton icon="ui-icon-search"
                                                     id="bt-visualiza-adesao-ata"
                                                     title="Clique para visualizar as adesões da ata selecionada."
                                                     onclick="aguarde.show()"
                                                     oncomplete="aguarde.hide(); dialogAdesaoAta.show()"
                                                     disabled="#{solicitacaoMaterialExternoControlador.selecionado.ataRegistroPreco eq null}"
                                                     process="@this"
                                                     update=":form-dialog-adesao-ata"
                                                     styleClass="mlef05"/>
                                </h:panelGrid>

                                <fc:outputLabelObrigatorio value="Documento de Solicitação:"
                                                           rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}"/>
                                <h:panelGrid columns="2"
                                             cellpadding="0"
                                             cellspacing="0"
                                             rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}">
                                    <p:autoComplete queryDelay="1000" id="documento-adesao"
                                                    title="Informe o ducumento que será vinculado a adesão criada pelo sistema."
                                                    value="#{solicitacaoMaterialExternoControlador.selecionado.documento}"
                                                    completeMethod="#{adesaoControlador.completaDocumento}"
                                                    converter="#{documentoControlador.converterGenerico}"
                                                    disabled="#{solicitacaoMaterialExternoControlador.isOperacaoEditar()}"
                                                    maxResults="50"
                                                    dropdown="true"
                                                    panelStyle="max-width: 750px;max-height: 250px"
                                                    var="doc"
                                                    itemLabel="#{doc}"
                                                    itemValue="#{doc.id}"
                                                    size="70"/>


                                    <p:commandButton id="bt-informacao-documento"
                                                     icon="ui-icon-info"
                                                     process="@none"
                                                     update="@none"
                                                     styleClass="icone-20 mlef05"/>
                                    <p:overlayPanel for="bt-informacao-documento"
                                                    appendToBody="true"
                                                    style="border : solid black 2px;"
                                                    showEvent="mouseover"
                                                    hideEvent="mouseout">
                                        <h:outputText
                                            value="Documento: &lt;br/> &lt;br/>
                                                &lt;b>Ao salvar a solicitação interna, o sistema irá vincular automaticamente este documento na adesão criada.&lt;b/>"
                                            escape="false"/>
                                    </p:overlayPanel>
                                </h:panelGrid>

                                <fc:outputLabelObrigatorio value="Documento de Autorização do Gerenciador:"/>
                                <p:inputText
                                    value="#{solicitacaoMaterialExternoControlador.selecionado.documentoGerenciador}"
                                    size="70"/>

                                <fc:outputLabelObrigatorio value="Documento de Autorização do Fornecedor:"/>
                                <p:inputText
                                    value="#{solicitacaoMaterialExternoControlador.selecionado.documentoAutorizacao}"
                                    size="70"/>
                                <fc:outputLabelObrigatorio value="Objeto:"/>
                                <h:panelGrid columns="2"
                                             cellpadding="0"
                                             cellspacing="0">
                                    <p:inputTextarea id="objeto-da-solicitacao"
                                                     title="Digite o objeto da solicitação."
                                                     value="#{solicitacaoMaterialExternoControlador.selecionado.objeto}"
                                                     cols="70"
                                                     maxlength="3000"
                                                     autoResize="true"
                                                     counterTemplate="{0} Caracteres Restantes."
                                                     counter="counter-objeto-da-solicitacao"/>
                                    <h:outputText id="counter-objeto-da-solicitacao"
                                                  style="color: #497692"
                                                  styleClass="mlef05"/>
                                </h:panelGrid>

                                <fc:outputLabelObrigatorio value="Justificativa:"/>
                                <h:panelGrid columns="2"
                                             cellpadding="0"
                                             cellspacing="0">
                                    <p:inputTextarea id="justificativa-da-solicitacao"
                                                     title="Digite a justificativa da solicitação."
                                                     value="#{solicitacaoMaterialExternoControlador.selecionado.justificativa}"
                                                     cols="70"
                                                     maxlength="3000"
                                                     autoResize="true"
                                                     counterTemplate="{0} Caracteres Restantes."
                                                     counter="counter-justificativa-da-solicitacao"/>
                                    <h:outputText id="counter-justificativa-da-solicitacao"
                                                  style="color: #497692"
                                                  styleClass="mlef05"/>
                                </h:panelGrid>
                            </h:panelGrid>
                        </p:outputPanel>
                    </p:tab>

                    <p:tab title="Itens" id="itens">
                        <p:outputPanel id="panel-item">
                            <p:commandButton value="Novo Material"
                                             icon="ui-icon-circle-plus"
                                             styleClass="padrao"
                                             onclick="aguarde.show()"
                                             oncomplete="aguarde.hide()"
                                             disabled="#{solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                             rendered="#{solicitacaoMaterialExternoControlador.itemSolicitacao eq null and solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}"
                                             actionListener="#{solicitacaoMaterialExternoControlador.novoItem()}"
                                             process="@this"
                                             update=":Formulario:tab-view-geral:panel-item"/>

                            <h:panelGrid columns="2"
                                         styleClass="mbot05"
                                         id="grid-novo-item"
                                         rendered="#{solicitacaoMaterialExternoControlador.itemSolicitacao ne null}">

                                <fc:outputLabelObrigatorio value="Tipo de Controle: "/>
                                <h:selectOneMenu
                                    value="#{solicitacaoMaterialExternoControlador.itemSolicitacao.tipoControle}"
                                    disabled="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}">
                                    <f:selectItems value="#{solicitacaoMaterialExternoControlador.tiposControle}"/>
                                    <p:ajax event="change"
                                            update="grid-novo-item grid-novo-item2"
                                            process="@this"/>
                                </h:selectOneMenu>

                                <fc:outputLabelObrigatorio value="Material: "
                                                           rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}"/>
                                <h:panelGroup
                                    rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}">
                                    <p:autoComplete queryDelay="1000"
                                                    id="autocomplete-material"
                                                    title="Informe o material."
                                                    value="#{solicitacaoMaterialExternoControlador.itemSolicitacao.objetoCompra}"
                                                    completeMethod="#{solicitacaoMaterialExternoControlador.buscarObjetoCompra}"
                                                    converter="#{objetoCompraControlador.converterGenerico}"
                                                    var="objeto"
                                                    dropdown="true"
                                                    panelStyle="max-height: 250px;max-width: 750px"
                                                    itemLabel="#{objeto}"
                                                    itemValue="#{objeto.id}"
                                                    onkeyup="if(keyUpCampoVazio(this)){atribuirNullParaEspecificao()}"
                                                    maxResults="70"
                                                    size="70"
                                                    styleClass="mrig05">
                                        <p:ajax event="itemSelect"
                                                listener="#{solicitacaoMaterialExternoControlador.listenerObjetoCompra()}"
                                                update="editorEspecificacao bt-especificacoes grupoObjetoCompra panelGrupoConta pn-unidade-medida "
                                                process="@this"
                                                onstart="aguarde.show();"
                                                oncomplete="aguarde.hide();"/>
                                    </p:autoComplete>

                                    <fc:novoParente destino="#{objetoCompraControlador.caminhoDestinoNovoCadastro}"
                                                    origem="#{solicitacaoMaterialExternoControlador.caminhoOrigem}"
                                                    selecionado="#{solicitacaoMaterialExternoControlador.selecionado}"/>
                                </h:panelGroup>

                                <h:outputText value="Material: "
                                              rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}"/>
                                <h:outputText
                                    rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}"
                                    value="#{solicitacaoMaterialExternoControlador.itemSolicitacao.objetoCompra}"
                                    styleClass="negrito"/>

                                <h:outputLabel value="Grupo Objeto de Compra: "/>
                                <h:panelGroup id="grupoObjetoCompra">
                                    <co:consultar-grupo-objeto-compra value="#{solicitacaoMaterialExternoControlador.itemSolicitacao.objetoCompra.grupoObjetoCompra}"
                                                                      id="grupoObjetoCompraComp"
                                                                      readonly="true"/>
                                </h:panelGroup>
                            </h:panelGrid>

                            <p:outputPanel id="panelGrupoConta">
                                <ad:grupo-conta-despesa
                                    styleConta="margin-right: 37px"
                                    renderedComponente="#{solicitacaoMaterialExternoControlador.itemSolicitacao.objetoCompra ne null
                                                        and solicitacaoMaterialExternoControlador.itemSolicitacao ne null}"
                                    grupoContaDespesa="#{solicitacaoMaterialExternoControlador.itemSolicitacao.objetoCompra.grupoContaDespesa}"/>
                            </p:outputPanel>

                            <h:panelGrid columns="2"
                                         rendered="#{solicitacaoMaterialExternoControlador.itemSolicitacao ne null}"
                                         id="grid-novo-item2">
                                <h:outputText value="Especificação:" style="margin-right: 50px"/>
                                <h:panelGroup columns="2" style="vertical-align: top">
                                        <p:inputTextarea id="editorEspecificacao"
                                                         title="Digite a descrição da especificação."
                                                         value="#{solicitacaoMaterialExternoControlador.itemSolicitacao.descricaoComplementar}"
                                                         autoResize="false"
                                                         maxlength="3000"
                                                         readonly="true"
                                                         cols="67"
                                                         rows="5"
                                                         scrollHeight="50"/>

                                    <p:outputPanel id="bt-especificacoes">
                                        <ad:tabela-especificacoes-objeto-compra
                                            update=":Formulario:tab-view-geral:panel-item"
                                            limparEspecificacao="#{solicitacaoMaterialExternoControlador.limparEspecificacao()}"
                                            selecionarEspecificacao="#{solicitacaoMaterialExternoControlador.selecionarEspecificacao}"
                                            objetoCompra="#{solicitacaoMaterialExternoControlador.itemSolicitacao.objetoCompra}"/>
                                    </p:outputPanel>
                                </h:panelGroup>

                                <fc:outputLabelObrigatorio value="Unidade de Medida: "/>
                                <p:outputPanel id="pn-unidade-medida">
                                <ad:unidade-medida unidadeMedidaSelecionada="#{solicitacaoMaterialExternoControlador.itemSolicitacao.unidadeMedida}"
                                                   tipoObjetoCompra="#{solicitacaoMaterialExternoControlador.itemSolicitacao.objetoCompra.tipoObjetoCompra}"
                                                   update=":Formulario:tab-view-geral:input-quantidade :Formulario:tab-view-geral:vl-unit-externo"/>
                                </p:outputPanel>

                                <fc:outputLabelObrigatorio value="Quantidade: "
                                                           rendered="#{solicitacaoMaterialExternoControlador.itemSolicitacao.isControleQuantidade()}"/>
                                <p:outputPanel id="input-quantidade">
                                    <fc:input-mascara-unidade-medida
                                        rendered="#{solicitacaoMaterialExternoControlador.itemSolicitacao.isControleQuantidade()}"
                                        value="#{solicitacaoMaterialExternoControlador.itemSolicitacao.quantidade}"
                                        tipoMascara="#{solicitacaoMaterialExternoControlador.itemSolicitacao.unidadeMedida.mascaraQuantidade}"
                                        listener="#{solicitacaoMaterialExternoControlador.calcularValorTotal()}"
                                        update=":Formulario:tab-view-geral:vl-total"/>
                                </p:outputPanel>

                                <fc:outputLabelObrigatorio value="Valor Unitário: "
                                                           rendered="#{solicitacaoMaterialExternoControlador.itemSolicitacao.isControleQuantidade()}"/>
                                <p:outputPanel id="vl-unit-externo">
                                    <fc:input-mascara-unidade-medida
                                        rendered="#{solicitacaoMaterialExternoControlador.itemSolicitacao.isControleQuantidade()}"
                                        readonly="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}"
                                        value="#{solicitacaoMaterialExternoControlador.itemSolicitacao.valorUnitario}"
                                        tipoMascara="#{solicitacaoMaterialExternoControlador.itemSolicitacao.unidadeMedida.mascaraValorUnitario}"
                                        listener="#{solicitacaoMaterialExternoControlador.calcularValorTotal()}"
                                        update=":Formulario:tab-view-geral:vl-total"/>
                                </p:outputPanel>

                                <fc:outputLabelObrigatorio value="Valor Total: "/>
                                <p:outputPanel id="vl-total">
                                    <p:inputText
                                        styleClass="alinhamentoDireita"
                                        readonly="#{solicitacaoMaterialExternoControlador.itemSolicitacao.isControleQuantidade()}"
                                        title="Digite o valor total deste item."
                                        onkeypress="mascara(this, mvalor)"
                                        value="#{solicitacaoMaterialExternoControlador.itemSolicitacao.valorTotal}"
                                        size="20">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </p:inputText>
                                </p:outputPanel>

                                <h:outputText value="Valor Pesq. de Mercado:"
                                              rendered="#{ solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}"/>
                                <p:inputText title="Digite o valor total deste item."
                                             styleClass="alinhamentoDireita"
                                             onkeypress="mascara(this, mvalor)"
                                             rendered="#{ solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}"
                                             value="#{solicitacaoMaterialExternoControlador.itemSolicitacao.valorPesquisaMercado}"
                                             size="20">
                                    <f:convertNumber pattern="###,##0.00"/>
                                </p:inputText>

                                <fc:outputLabelObrigatorio value="Fonte da Pesquisa:"
                                                           rendered="#{ solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}"/>
                                <p:inputText id="input-fonte-pesquisa"
                                             rendered="#{ solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}"
                                             title="Digite a fonte de pesquisa para este item."
                                             value="#{solicitacaoMaterialExternoControlador.itemSolicitacao.fonteDaPesquisa}"
                                             size="70"/>
                            </h:panelGrid>

                            <p:commandButton value="Confirmar"
                                             styleClass="mrig05 prioritario"
                                             onclick="aguarde.show()"
                                             oncomplete="aguarde.hide()"
                                             process=":Formulario:tab-view-geral:panel-item :Formulario:tab-view-geral:panel-dados-gerais"
                                             rendered="#{solicitacaoMaterialExternoControlador.itemSolicitacao ne null}"
                                             title="Clique para confirmar este item material."
                                             update=":Formulario:tab-view-geral:panel-item :Formulario:tab-view-geral:panel-dados-gerais"
                                             actionListener="#{solicitacaoMaterialExternoControlador.confirmarItem()}"
                                             icon="ui-icon-check"/>

                            <p:commandButton value="Cancelar"
                                             styleClass="padrao"
                                             process="@this"
                                             onclick="aguarde.show();"
                                             oncomplete="aguarde.hide()"
                                             title="Clique para cancelar este item."
                                             rendered="#{solicitacaoMaterialExternoControlador.itemSolicitacao ne null}"
                                             actionListener="#{solicitacaoMaterialExternoControlador.cancelarItem()}"
                                             update=":Formulario:tab-view-geral:panel-item"
                                             icon="ui-icon-cancel"/>

                            <p:dataTable paginator="true"
                                         id="tabela-itens-qtde"
                                         rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada trintaAltura' : 'trintaAltura'}"
                                         rowIndexVar="rowIx"
                                         styleClass="mtop05"
                                         emptyMessage="Não foram localizados registros para serem apresentados"
                                         value="#{solicitacaoMaterialExternoControlador.itensControleQuantidade}"
                                         rendered="#{solicitacaoMaterialExternoControlador.hasItensQuantidade()}"
                                         style="overflow: scroll; max-width: 100%"
                                         paginatorPosition="top"
                                         rows="10"
                                         paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>ITENS POR QUANTIDADE&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                         rowsPerPageTemplate="10,25,50,100"
                                         var="itemQtde">
                                <p:column style="width: 30px!important"
                                          rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}">
                                    <f:facet name="header">
                                        <p:commandButton icon="ui-icon-none"
                                                         process="@this"
                                                         disabled="#{solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                                         rendered="#{!solicitacaoMaterialExternoControlador.isTodosItensQuantidadeMarcados()}"
                                                         update="tabela-itens-qtde"
                                                         onclick="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         actionListener="#{solicitacaoMaterialExternoControlador.marcarTodosItensQuantidade()}"
                                                         styleClass="icone-20"/>

                                        <p:commandButton icon="ui-icon-check"
                                                         process="@this"
                                                         onclick="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         disabled="#{solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                                         rendered="#{solicitacaoMaterialExternoControlador.isTodosItensQuantidadeMarcados()}"
                                                         update="tabela-itens-qtde"
                                                         actionListener="#{solicitacaoMaterialExternoControlador.desmarcarTodosItensQuantidade()}"
                                                         styleClass="icone-20"/>
                                    </f:facet>
                                    <p:commandButton icon="ui-icon-none"
                                                     process="@this"
                                                     update="tabela-itens-qtde"
                                                     onclick="aguarde.show()"
                                                     oncomplete="aguarde.hide()"
                                                     disabled="#{solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                                     rendered="#{!itemQtde.selecionado}"
                                                     actionListener="#{solicitacaoMaterialExternoControlador.marcarItemSolicitacaoExterno(itemQtde)}"
                                                     styleClass="icone-20"/>

                                    <p:commandButton icon="ui-icon-check"
                                                     update="tabela-itens-qtde"
                                                     onclick="aguarde.show()"
                                                     oncomplete="aguarde.hide()"
                                                     process="@this"
                                                     disabled="#{solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                                     rendered="#{itemQtde.selecionado}"
                                                     actionListener="#{solicitacaoMaterialExternoControlador.desmarcarItemSolicitacaoExterno(itemQtde)}"
                                                     styleClass="icone-20"/>
                                </p:column>

                                <p:column headerText="Ações" style="text-align: center; width: 10%;">
                                    <p:commandButton icon="ui-icon-pencil"
                                                     title="Clique para alterar este registro."
                                                     onclick="aguarde.show()"
                                                     oncomplete="aguarde.hide();"
                                                     process="@this"
                                                     disabled="#{solicitacaoMaterialExternoControlador.itemSolicitacao ne null
                                                 or solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                                     actionListener="#{solicitacaoMaterialExternoControlador.selecionarItem(itemQtde)}"
                                                     update=":Formulario:tab-view-geral:panel-item"
                                                     styleClass="mrig05 prioritario"/>

                                    <p:commandButton icon="ui-icon-trash"
                                                     process="@this"
                                                     onclick="if (!confirm('Tem certeza que deseja remover este registro?')) {return false; } else {aguarde.show();}"
                                                     oncomplete="aguarde.hide()"
                                                     rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}"
                                                     disabled="#{solicitacaoMaterialExternoControlador.itemSolicitacao ne null
                                                 or solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                                     actionListener="#{solicitacaoMaterialExternoControlador.removerItem(itemQtde)}"
                                                     title="Clique para remover este registro."
                                                     update=":Formulario:tab-view-geral:panel-item :Formulario:tab-view-geral:panel-dados-gerais"/>
                                </p:column>

                                <p:column headerText="Dotação" style="text-align: center"
                                          rendered="#{ solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}">

                                    <p:commandButton icon="ui-icon-circle-plus"
                                                     process="@this"
                                                     onclick="aguarde.show()"
                                                     update=":form-item-solicitacao-ext-dotacao"
                                                     oncomplete="aguarde.hide()"
                                                     actionListener="#{solicitacaoMaterialExternoControlador.definirDependenciasParaCriarItemSolicitacaoExternoDotacao(itemQtde)}"
                                                     title="Clique para realizar as reservas de dotação desse item."/>

                                    <p:commandButton icon="ui-icon-trash"
                                                     styleClass="mlef03"
                                                     process="@this"
                                                     onclick="aguarde.show()"
                                                     update=":form-excluir-item-solicitacao-ext-dotacao"
                                                     oncomplete="dlgExcluirDotacaoItemSolicitacaoExterno.show(); aguarde.hide()"
                                                     actionListener="#{solicitacaoMaterialExternoControlador.selecionarItem(itemQtde)}"
                                                     title="Clique para ver as reservas realizadas e excluir alguma caso seja necessário."
                                                     disabled="#{solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                                     rendered="#{solicitacaoMaterialExternoControlador.hasDotacaoAdiconadaParaItem(itemQtde)}"/>

                                    <p:commandButton icon="ui-icon-search"
                                                     styleClass="mlef03"
                                                     process="@this"
                                                     onclick="aguarde.show()"
                                                     update=":form-vis-dotacoes-item-solicitacao-externa"
                                                     oncomplete="dlgVisDotaceosItemSolicitacaoExterno.show(); aguarde.hide()"
                                                     rendered="#{solicitacaoMaterialExternoControlador.hasDotacaoAdiconadaParaItem(itemQtde)}"
                                                     actionListener="#{solicitacaoMaterialExternoControlador.selecionarItem(itemQtde)}"
                                                     title="Clique para ver as reservas realizadas."/>
                                </p:column>

                                <p:column headerText="Tipo"
                                          styleClass="alinhamentoEsquerda">
                                    <h:outputText value="#{itemQtde.tipoObjetoCompra}"/>
                                </p:column>
                                <p:column headerText="SubTipo"
                                          rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}"
                                          styleClass="alinhamentoEsquerda">
                                    <h:selectOneMenu
                                        disabled="#{solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                        rendered="#{itemQtde.hasMaisDeUmSubTipo()}"
                                        value="#{itemQtde.subTipoObjetoCompra}"
                                        title="Informe o subtipo de objeto de compra"
                                        id="subtipoObjetoCompra">
                                        <f:selectItems
                                            value="#{solicitacaoMaterialExternoControlador.getSubtiposObjetoCompra(itemQtde)}"/>
                                        <p:ajax event="change"
                                                process="@this"/>
                                    </h:selectOneMenu>

                                    <h:outputText value="#{itemQtde.subTipoObjetoCompra.descricao}"
                                                  rendered="#{!itemQtde.hasMaisDeUmSubTipo()}"/>
                                </p:column>

                                <p:column headerText="Item"
                                          styleClass="alinhamentoEsquerda">
                                    <h:outputText value="#{itemQtde.numero}"/>
                                </p:column>
                                <p:column headerText="Objeto de Compra"
                                          styleClass="alinhamentoEsquerda">
                                    <h:outputText value="#{itemQtde.codigoDescricaoObjetoCompra}"/>
                                </p:column>
                                <p:column headerText="Especif." style="text-align: center">
                                    <ad:especificacao-objeto-compra
                                        especificacao="#{itemQtde.descricaoComplementar}"/>
                                </p:column>
                                <p:column
                                    headerText="Grupo"
                                    style="text-align: left; width: 50px; ">
                                    <h:outputText
                                        value="#{itemQtde.objetoCompra.grupoContaDespesa.grupo}"/>
                                </p:column>
                                <p:column
                                    headerText="Conta" styleClass="alinhamentoEsquerda">
                                    <ad:conta-desdobrada-por-grupo
                                        styleClass="default"
                                        grupoContaDespesa="#{itemQtde.objetoCompra.grupoContaDespesa}"/>
                                </p:column>
                                <c:if
                                    test="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}">
                                    <p:column headerText="Fonte da Pesquisa"
                                              styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{itemQtde.fonteDaPesquisa}"/>
                                    </p:column>
                                    <p:column headerText="Qtde"
                                              styleClass="alinhamentoDireita">
                                        <fc:output-mascara-unidade-medida
                                            tipoMascara="#{itemQtde.unidadeMedida.mascaraQuantidade}"
                                            value="#{itemQtde.quantidade}"/>
                                    </p:column>
                                    <p:column headerText="Vl Unit (R$)"
                                              styleClass="alinhamentoDireita">
                                        <fc:output-mascara-unidade-medida
                                            tipoMascara="#{itemQtde.unidadeMedida.mascaraValorUnitario}"
                                            value="#{itemQtde.valorUnitario}"/>
                                    </p:column>
                                    <p:column headerText="Vl Total (R$)"
                                              styleClass="alinhamentoDireita">
                                        <h:outputText value="#{itemQtde.valorTotal}">
                                            <f:convertNumber type="currency" pattern="#,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                </c:if>

                                <c:if
                                    test="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}">
                                    <p:column headerText="Qtde Licitada"
                                              styleClass="alinhamentoDireita">
                                        <fc:output-mascara-unidade-medida
                                            tipoMascara="#{itemQtde.unidadeMedida.mascaraQuantidade}"
                                            value="#{itemQtde.quantidadeLicitada}"/>
                                    </p:column>
                                    <p:column headerText="Saldo Máx. Adesão"
                                              styleClass="alinhamentoDireita">
                                        <fc:output-mascara-unidade-medida
                                            tipoMascara="#{itemQtde.unidadeMedida.mascaraQuantidade}"
                                            value="#{solicitacaoMaterialExternoControlador.getSaldoTotalDisponivelItem(itemQtde)}"/>
                                    </p:column>
                                    <p:column
                                        headerText="Qtde Máx. Adesão"
                                        styleClass="alinhamentoDireita">
                                        <fc:output-mascara-unidade-medida
                                            tipoMascara="#{itemQtde.unidadeMedida.mascaraQuantidade}"
                                            value="#{itemQtde.quantidadeMaximaAdesao}"/>
                                    </p:column>
                                    <p:column
                                        headerText="Qtde Adesão"
                                        styleClass="alinhamentoDireita">
                                        <fc:output-mascara-unidade-medida
                                            tipoMascara="#{itemQtde.unidadeMedida.mascaraQuantidade}"
                                            value="#{itemQtde.quantidade}"/>
                                    </p:column>
                                    <p:column headerText="Vl Unit (R$)"
                                              styleClass="alinhamentoDireita">
                                        <h:outputText value="#{itemQtde.valorUnitario}">
                                            <f:convertNumber type="currency" currencySymbol=""/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Vl Total (R$)"
                                              styleClass="alinhamentoDireita">
                                        <h:outputText value="#{itemQtde.valorTotal}">
                                            <f:convertNumber type="currency" currencySymbol=""/>
                                        </h:outputText>
                                    </p:column>
                                </c:if>
                            </p:dataTable>
                            <div align="right"
                                 style="border: solid 1px; padding: 5px; border-color: lightgrey;display: ${solicitacaoMaterialExternoControlador.hasItensQuantidade() ? 'block' : 'none'}">
                                <h:outputText value="Total por Quantidade: " styleClass="negrito"/>
                                <h:outputText
                                    id="vl-total-contrato-qtde"
                                    value="#{solicitacaoMaterialExternoControlador.valorTotalItensPorQuantidade}"
                                    styleClass="negrito mrig05">
                                    <f:convertNumber type="currency"/>
                                </h:outputText>
                            </div>


                            <p:dataTable paginator="true"
                                         id="tabela-itens-valor"
                                         rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada trintaAltura' : 'trintaAltura'}"
                                         rowIndexVar="rowIx"
                                         styleClass="#{solicitacaoMaterialExternoControlador.hasItensQuantidade() ? 'mtop20' : ''}"
                                         emptyMessage="Não foram localizados registros para serem apresentados"
                                         value="#{solicitacaoMaterialExternoControlador.itensControleValor}"
                                         rendered="#{solicitacaoMaterialExternoControlador.hasItensValor()}"
                                         style="overflow: scroll; max-width: 100%"
                                         paginatorPosition="top"
                                         rows="10"
                                         paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>ITENS POR VALOR&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                         rowsPerPageTemplate="10,25,50,100"
                                         var="itemValor">
                                <p:column style="width: 30px!important"
                                          rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}">
                                    <f:facet name="header">
                                        <p:commandButton icon="ui-icon-none"
                                                         process="@this"
                                                         disabled="#{solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                                         rendered="#{!solicitacaoMaterialExternoControlador.isTodosItensValorMarcados()}"
                                                         update="tabela-itens-valor"
                                                         onclick="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         actionListener="#{solicitacaoMaterialExternoControlador.marcarTodosItensValor()}"
                                                         styleClass="icone-20"/>

                                        <p:commandButton icon="ui-icon-check"
                                                         process="@this"
                                                         onclick="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         disabled="#{solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                                         rendered="#{solicitacaoMaterialExternoControlador.isTodosItensValorMarcados()}"
                                                         update="tabela-itens-valor"
                                                         actionListener="#{solicitacaoMaterialExternoControlador.desmarcarTodosItensValor()}"
                                                         styleClass="icone-20"/>
                                    </f:facet>
                                    <p:commandButton icon="ui-icon-none"
                                                     process="@this"
                                                     update="tabela-itens-valor"
                                                     onclick="aguarde.show()"
                                                     oncomplete="aguarde.hide()"
                                                     disabled="#{solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                                     rendered="#{!itemValor.selecionado}"
                                                     actionListener="#{solicitacaoMaterialExternoControlador.marcarItemSolicitacaoExterno(itemValor)}"
                                                     styleClass="icone-20"/>

                                    <p:commandButton icon="ui-icon-check"
                                                     update="tabela-itens-valor"
                                                     onclick="aguarde.show()"
                                                     oncomplete="aguarde.hide()"
                                                     process="@this"
                                                     disabled="#{solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                                     rendered="#{itemValor.selecionado}"
                                                     actionListener="#{solicitacaoMaterialExternoControlador.desmarcarItemSolicitacaoExterno(itemValor)}"
                                                     styleClass="icone-20"/>
                                </p:column>

                                <p:column headerText="Ações" style="text-align: center; width: 10%;">
                                    <p:commandButton icon="ui-icon-pencil"
                                                     title="Clique para alterar este registro."
                                                     onclick="aguarde.show()"
                                                     oncomplete="aguarde.hide();"
                                                     process="@this"
                                                     disabled="#{solicitacaoMaterialExternoControlador.itemSolicitacao ne null
                                                 or solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                                     actionListener="#{solicitacaoMaterialExternoControlador.selecionarItem(itemValor)}"
                                                     update=":Formulario:tab-view-geral:panel-item"
                                                     styleClass="mrig05 prioritario"/>

                                    <p:commandButton icon="ui-icon-trash"
                                                     process="@this"
                                                     onclick="if (!confirm('Tem certeza que deseja remover este registro?')) {return false; } else {aguarde.show();}"
                                                     oncomplete="aguarde.hide()"
                                                     rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}"
                                                     disabled="#{solicitacaoMaterialExternoControlador.itemSolicitacao ne null
                                                 or solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                                     actionListener="#{solicitacaoMaterialExternoControlador.removerItem(itemValor)}"
                                                     title="Clique para remover este registro."
                                                     update=":Formulario:tab-view-geral:panel-item :Formulario:tab-view-geral:panel-dados-gerais"/>
                                </p:column>

                                <p:column headerText="Dotação" style="text-align: center"
                                          rendered="#{ solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}">

                                    <p:commandButton icon="ui-icon-circle-plus"
                                                     process="@this"
                                                     onclick="aguarde.show()"
                                                     update=":form-item-solicitacao-ext-dotacao"
                                                     oncomplete="aguarde.hide()"
                                                     actionListener="#{solicitacaoMaterialExternoControlador.definirDependenciasParaCriarItemSolicitacaoExternoDotacao(itemValor)}"
                                                     title="Clique para realizar as reservas de dotação desse item."/>

                                    <p:commandButton icon="ui-icon-trash"
                                                     styleClass="mlef03"
                                                     process="@this"
                                                     onclick="aguarde.show()"
                                                     update=":form-excluir-item-solicitacao-ext-dotacao"
                                                     oncomplete="dlgExcluirDotacaoItemSolicitacaoExterno.show(); aguarde.hide()"
                                                     actionListener="#{solicitacaoMaterialExternoControlador.selecionarItem(itemValor)}"
                                                     title="Clique para ver as reservas realizadas e excluir alguma caso seja necessário."
                                                     disabled="#{solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                                     rendered="#{solicitacaoMaterialExternoControlador.hasDotacaoAdiconadaParaItem(itemValor)}"/>

                                    <p:commandButton icon="ui-icon-search"
                                                     styleClass="mlef03"
                                                     process="@this"
                                                     onclick="aguarde.show()"
                                                     update=":form-vis-dotacoes-item-solicitacao-externa"
                                                     oncomplete="dlgVisDotaceosItemSolicitacaoExterno.show(); aguarde.hide()"
                                                     rendered="#{solicitacaoMaterialExternoControlador.hasDotacaoAdiconadaParaItem(itemValor)}"
                                                     actionListener="#{solicitacaoMaterialExternoControlador.selecionarItem(itemValor)}"
                                                     title="Clique para ver as reservas realizadas."/>
                                </p:column>

                                <p:column headerText="Tipo"
                                          styleClass="alinhamentoEsquerda">
                                    <h:outputText value="#{itemValor.tipoObjetoCompra}"/>
                                </p:column>
                                <p:column headerText="SubTipo"
                                          rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}"
                                          styleClass="alinhamentoEsquerda">
                                    <h:selectOneMenu
                                        disabled="#{solicitacaoMaterialExternoControlador.solicitacaoContratada}"
                                        rendered="#{itemValor.hasMaisDeUmSubTipo()}"
                                        value="#{itemValor.subTipoObjetoCompra}"
                                        title="Informe o subtipo de objeto de compra">
                                        <f:selectItems
                                            value="#{solicitacaoMaterialExternoControlador.getSubtiposObjetoCompra(itemValor)}"/>
                                        <p:ajax event="change"
                                                process="@this"/>
                                    </h:selectOneMenu>

                                    <h:outputText value="#{itemValor.subTipoObjetoCompra.descricao}"
                                                  rendered="#{!itemValor.hasMaisDeUmSubTipo()}"/>
                                </p:column>
                                <p:column headerText="Item" styleClass="alinhamentoEsquerda">
                                    <h:outputText value="#{itemValor.numero}"/>
                                </p:column>
                                <p:column headerText="Objeto de Compra" styleClass="alinhamentoEsquerda">
                                    <h:outputText value="#{itemValor.codigoDescricaoObjetoCompra}"/>
                                </p:column>
                                <p:column headerText="Especif." style="text-align: center">
                                    <ad:especificacao-objeto-compra especificacao="#{itemValor.descricaoComplementar}"/>
                                </p:column>
                                <p:column
                                    headerText="Grupo"
                                    style="text-align: left">
                                    <h:outputText
                                        value="#{itemValor.objetoCompra.grupoContaDespesa.grupo}"/>
                                </p:column>
                                <p:column
                                    headerText="Conta" styleClass="alinhamentoEsquerda">
                                    <ad:conta-desdobrada-por-grupo
                                        styleClass="default"
                                        grupoContaDespesa="#{itemValor.objetoCompra.grupoContaDespesa}"/>
                                </p:column>
                                <c:if
                                    test="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoExterna()}">
                                    <p:column headerText="Fonte da Pesquisa"
                                              styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{itemValor.fonteDaPesquisa}"/>
                                    </p:column>
                                    <p:column headerText="Vl Total (R$)"
                                              styleClass="alinhamentoDireita">
                                        <h:outputText value="#{itemValor.valorTotal}">
                                            <f:convertNumber type="currency" pattern="#,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                </c:if>

                                <c:if
                                    test="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}">
                                    <p:column headerText="Vl Licitado (R$)"
                                              styleClass="alinhamentoDireita">
                                        <h:outputText value="#{itemValor.valorLicitado}">
                                            <f:convertNumber type="currency" currencySymbol=""/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Saldo Máx. Adesão (R$)"
                                              styleClass="alinhamentoDireita">
                                        <h:outputText
                                            value="#{solicitacaoMaterialExternoControlador.getSaldoTotalDisponivelItem(itemValor)}">
                                            <f:convertNumber type="currency" currencySymbol=""/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Vl Máx. Adesão (R$)"
                                              styleClass="alinhamentoDireita">
                                        <h:outputText value="#{itemValor.valorMaximoAdesao}">
                                            <f:convertNumber type="currency" currencySymbol=""/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Vl Adesão (R$)"
                                              styleClass="alinhamentoDireita">
                                        <h:outputText value="#{itemValor.valorTotal}">
                                            <f:convertNumber type="currency" currencySymbol=""/>
                                        </h:outputText>
                                    </p:column>
                                </c:if>
                            </p:dataTable>

                            <div align="right"
                                 style="border: solid 1px; padding: 5px; border-color: lightgrey;display: ${solicitacaoMaterialExternoControlador.hasItensValor() ? 'block' : 'none'}">
                                <h:outputText value="Total por Valor: " styleClass="negrito"/>
                                <h:outputText
                                    id="vl-total-contrato-valor"
                                    value="#{solicitacaoMaterialExternoControlador.valorTotalItensPorValor}"
                                    styleClass="negrito mrig05">
                                    <f:convertNumber type="currency"/>
                                </h:outputText>
                            </div>

                            <div align="center" class="alert alert-info"
                                 style="padding: 5px; font-size: 14px; display: #{solicitacaoMaterialExternoControlador.itemSolicitacao eq null ? 'block' : 'none'}">
                                <h:outputText value="Valor Total dos Itens: "/>
                                <h:outputText
                                    id="vl-total-itens"
                                    value="#{solicitacaoMaterialExternoControlador.valorTotalItens}"
                                    styleClass="negrito">
                                    <f:convertNumber type="currency"/>
                                </h:outputText>
                            </div>
                        </p:outputPanel>
                    </p:tab>

                    <p:tab title="Adesão"
                           rendered="#{solicitacaoMaterialExternoControlador.selecionado.isSolicitacaoInterna()}">
                        <p:outputPanel id="panel-adesao">
                            <p:dataTable paginator="true"
                                         id="tabela-adesoes"
                                         rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada trintaAltura' : 'trintaAltura'}"
                                         rowIndexVar="rowIx"
                                         styleClass="mtop05"
                                         emptyMessage="Não foram localizados registros para serem apresentados"
                                         value="#{solicitacaoMaterialExternoControlador.selecionado.adesoes}"
                                         rows="10"
                                         paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>ADESÕES&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                         rowsPerPageTemplate="10,25,50,100"
                                         var="adesao">

                                <p:column headerText="Data" styleClass="alinhamentoCentralizado">
                                    <h:outputText value="#{adesao.data}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Solicitação Registro Preço Interna"
                                          styleClass="alinhamentoEsquerda">
                                    <h:outputText value="#{adesao.solicitacaoMaterialExterno}"/>
                                </p:column>
                                <p:column headerText="Nº Requisição" styleClass="alinhamentoDireita">
                                    <h:outputText value="#{adesao.numeroRequisicao}"/>
                                </p:column>
                                <p:column headerText="Data Requisição" styleClass="alinhamentoCentralizado">
                                    <h:outputText value="#{adesao.dataRequisicao}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Documento" styleClass="alinhamentoEsquerda">
                                    <h:outputText value="#{adesao.documento}"/>
                                </p:column>
                                <p:column headerText="Observação" styleClass="alinhamentoEsquerda">
                                    <h:outputText value="#{adesao.observacao}"/>
                                </p:column>
                                <p:column headerText="Adesão Aceita" styleClass="alinhamentoCentralizado">
                                    <h:outputText value="#{utilBean.converterBooleanSimOuNao(adesao.adesaoAceita)}"/>
                                </p:column>
                            </p:dataTable>
                        </p:outputPanel>
                    </p:tab>

                    <p:tab id="tabAnexo" title="Anexos">
                        <fc:detentorDocumentoLicitacao
                            selecionado="#{solicitacaoMaterialExternoControlador.selecionado}"/>
                    </p:tab>
                </p:tabView>

            </p:panel>

            <fc:rodapePretty controlador="#{solicitacaoMaterialExternoControlador}"/>
        </h:form>

        <p:dialog header="Adesões Cadastradas - Ata de Registro de Preço Selecionada"
                  modal="true"
                  dynamic="true"
                  position="center"
                  style="position: fixed !important;"
                  draggable="false"
                  resizable="false"
                  widgetVar="dialogAdesaoAta"
                  closable="false">
            <h:form id="form-dialog-adesao-ata">
                <div style="text-align: center" class="mtop05">
                    <p:dataTable paginator="true"
                                 id="tabela-adesoes-ata"
                                 rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada trintaAltura' : 'trintaAltura'}"
                                 rowIndexVar="rowIx"
                                 styleClass="mtop05"
                                 emptyMessage="Não foram localizados registros para serem apresentados"
                                 value="#{solicitacaoMaterialExternoControlador.selecionado.ataRegistroPreco.adesoes}"
                                 rows="10"
                                 paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>ADESÕES&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                 rowsPerPageTemplate="10,25,50,100"
                                 var="adesao">

                        <p:column headerText="Data" styleClass="alinhamentoCentralizado">
                            <h:outputText value="#{adesao.data}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Tipo" styleClass="alinhamentoEsquerda">
                            <h:outputText value="#{adesao.tipoAdesao.descricao}"/>
                        </p:column>
                        <p:column headerText="Nº Requisição" styleClass="alinhamentoDireita">
                            <h:outputText value="#{adesao.numeroRequisicao}"/>
                        </p:column>
                        <p:column headerText="Data Requisição" styleClass="alinhamentoCentralizado">
                            <h:outputText value="#{adesao.dataRequisicao}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Solicitação Registro Preço Interna" styleClass="alinhamentoEsquerda">
                            <h:outputText value="#{adesao.solicitacaoMaterialExterno}"/>
                        </p:column>
                        <p:column headerText="Documento" styleClass="alinhamentoEsquerda">
                            <h:outputText value="#{adesao.documento}"/>
                        </p:column>
                        <p:column headerText="Unidade Externa" styleClass="alinhamentoEsquerda">
                            <h:outputText value="#{adesao.unidadeExterna}"/>
                        </p:column>
                        <p:column headerText="Adesão Aceita" styleClass="alinhamentoCentralizado">
                            <h:outputText value="#{utilBean.converterBooleanSimOuNao(adesao.adesaoAceita)}"
                                          style="font-size: 13px;"/>
                        </p:column>
                        <p:column headerText="Observação" styleClass="alinhamentoEsquerda">
                            <h:outputText value="#{adesao.observacao}"/>
                        </p:column>
                    </p:dataTable>

                    <p:commandButton icon="ui-icon-check"
                                     value="Ok"
                                     process="@this"
                                     onclick="aguarde.show()"
                                     oncomplete="aguarde.hide(); dialogAdesaoAta.hide();"
                                     styleClass="padrao mrig05 mtop05"/>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog
            header="Realizar Reserva de Dotação"
            modal="true"
            dynamic="true"
            position="center"
            style="position: fixed !important; max-width: 800px; max-height: 500px; overflow: auto;  "
            resizable="false"
            widgetVar="dlgItemSolicitacaoExternoDotacao"
            closable="false">
            <h:form id="form-item-solicitacao-ext-dotacao">
                <h:outputText value="ITEM: " styleClass="azul mtop05"/>
                <h:outputLabel value="#{solicitacaoMaterialExternoControlador.itemSolicitacao}"
                               styleClass="azulnegrito"/>

                <p:outputPanel id="outputPanel-despesa-orcamentaria">
                    <fcc:consultar-despesa-orcamentaria-na-tela
                        id="consulta-despesa-orc-na-tela"
                        styleElementoDespesa="margin-right:8px"
                        value="#{solicitacaoMaterialExternoControlador.itemSolicitacaoDotacao.despesaORC}"
                        subTipoObjetoCompra="#{solicitacaoMaterialExternoControlador.itemSolicitacao.subTipoObjetoCompra}"
                        tiposObjetoCompra="#{consultarDespesaOrcamentariaNaTelaControlador.tipoObjetoCompraPorDescricao(solicitacaoMaterialExternoControlador.itemSolicitacao.objetoCompra.tipoObjetoCompra.name())}"
                        mostrarArvoreExpandida="true"
                        unidadeAdministrativa="#{solicitacaoMaterialExternoControlador.selecionado.unidadeOrganizacional}"/>
                </p:outputPanel>

                <h:panelGrid columns="2" id="grid-valores-dotacao">
                    <fc:outputLabelObrigatorio value="Fonte de Recurso: "/>
                    <p:autoComplete queryDelay="1000"
                                    id="fonteDespesaORC"
                                    size="70"
                                    title="Informe a Fonte de Recurso."
                                    value="#{solicitacaoMaterialExternoControlador.itemSolicitacaoDotacao.fonteDespesaORC}"
                                    completeMethod="#{solicitacaoMaterialExternoControlador.buscarFonteDespesaORCPorCodigoOrDescricao}"
                                    converter="#{empenhoControlador.converterFonteDespesaORC}"
                                    forceSelection="true"
                                    var="fo"
                                    itemValue="#{fo.id}"
                                    itemLabel="#{fo.provisaoPPAFonte.destinacaoDeRecursos}">
                        <p:ajax event="itemSelect"
                                process="@this"
                                update="saldoOrcamentario"/>
                    </p:autoComplete>

                    <h:outputLabel value="Saldo Orçamentário: "/>
                    <p:outputPanel id="saldoOrcamentario">
                        <h:outputText
                            value="#{solicitacaoMaterialExternoControlador.saldoOrcamentario}"
                            styleClass="negrito">
                            <f:convertNumber type="currency"/>
                        </h:outputText>
                    </p:outputPanel>

                    <h:outputLabel value="Valor Total à Reservar: "/>
                    <h:outputText
                        value="#{solicitacaoMaterialExternoControlador.itemSolicitacao.valorTotal}"
                        styleClass="negrito">
                        <f:convertNumber type="currency"/>
                    </h:outputText>

                    <h:outputLabel value="Valor já Reservado: "/>
                    <h:outputText
                        value="#{solicitacaoMaterialExternoControlador.itemSolicitacao.valorReservado}"
                        styleClass="negrito">
                        <f:convertNumber type="currency"/>
                    </h:outputText>

                    <h:outputLabel value="Valor para Reservar: "/>
                    <h:outputText
                        value="#{solicitacaoMaterialExternoControlador.itemSolicitacao.valorParaReservar}"
                        styleClass="negrito">
                        <f:convertNumber type="currency"/>
                    </h:outputText>

                    <h:outputLabel value="Valor da Reserva: "/>
                    <fc:inputMoeda id="ipt-valor-reserva"
                                   value="#{solicitacaoMaterialExternoControlador.itemSolicitacaoDotacao.valorReservado}"/>
                </h:panelGrid>

                <div class="mtop10 alinhamentoCentralizado">
                    <p:commandButton value="Confirmar"
                                     icon="ui-icon-check"
                                     styleClass="padrao mrig05 prioritario"
                                     process=":form-item-solicitacao-ext-dotacao"
                                     update=":Formulario:tab-view-geral:panel-item"
                                     actionListener="#{solicitacaoMaterialExternoControlador.confirmarItemSolicitacaoExternoDotacao()}"
                                     onstart="aguarde.show(); "
                                     oncomplete="aguarde.hide(); "/>

                    <p:commandButton value="Cancelar"
                                     icon="ui-icon-cancel"
                                     styleClass="padrao mrig05"
                                     process="@this"
                                     update="@none"
                                     actionListener="#{solicitacaoMaterialExternoControlador.cancelarItemSolicitacaoExternoDotacao()}"
                                     onstart="aguarde.show(); " oncomplete="aguarde.hide(); "/>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog header="Excluir Reserva do Item de Solicitação Externa"
                  modal="true"
                  dynamic="true"
                  position="center"
                  style="position: fixed !important;"
                  resizable="false"
                  widgetVar="dlgExcluirDotacaoItemSolicitacaoExterno"
                  closable="false">
            <h:form id="form-excluir-item-solicitacao-ext-dotacao">
                <div class="mtop10">
                    <p:dataTable id="tabela-item-solicitacao-externo-dotacao"
                                 rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                 rowIndexVar="rowIx"
                                 styleClass="mtop05"
                                 emptyMessage="Não foram localizados registros para serem apresentados"
                                 value="#{solicitacaoMaterialExternoControlador.itemSolicitacao.dotacoes}"
                                 var="itemSolicitacaoExternoDotacao">
                        <f:facet name="header">RESERVAS DO ITEM</f:facet>
                        <p:column headerText="Ações" style="text-align: center; width: 20px; ">
                            <p:commandButton icon="ui-icon-trash"
                                             process="@this"
                                             onclick="if (!confirm('Tem certeza que deseja remover este registro?')) {return false; } else {aguarde.show();}"
                                             oncomplete="aguarde.hide()"
                                             actionListener="#{solicitacaoMaterialExternoControlador.removerItemSolicitacaoExternoDotacao(itemSolicitacaoExternoDotacao)}"
                                             title="Clique para remover este registro."
                                             update="tabela-item-solicitacao-externo-dotacao"/>
                        </p:column>
                        <p:column headerText="Fonte de Despesa Orçamentária" styleClass="alinhamentoEsquerda">
                            <h:outputLabel value="#{itemSolicitacaoExternoDotacao.fonteDespesaORC}"/>
                        </p:column>
                        <p:column headerText="Valor Reservado (R$)" style="text-align: right; ">
                            <h:outputLabel value="#{itemSolicitacaoExternoDotacao.valorReservado}">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputLabel>
                        </p:column>
                    </p:dataTable>
                </div>
                <div style="text-align: center; margin: 10px; ">
                    <p:commandButton value="Fechar"
                                     icon="ui-icon-circle-close"
                                     styleClass="padrao mrig05"
                                     onstart="aguarde.show()"
                                     oncomplete="aguarde.hide()"
                                     actionListener="#{solicitacaoMaterialExternoControlador.cancelarItem()}"
                                     process="@this"
                                     update=":Formulario:tab-view-geral:panel-item"
                                     onclick="dlgExcluirDotacaoItemSolicitacaoExterno.hide(); "/>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog header="Visualizar Reservas do Item de Solicitação Externa"
                  modal="true"
                  dynamic="true"
                  position="center"
                  style="position: fixed !important;"
                  resizable="false"
                  widgetVar="dlgVisDotaceosItemSolicitacaoExterno"
                  closable="false">
            <h:form id="form-vis-dotacoes-item-solicitacao-externa">
                <div class="mtop10">
                    <p:dataTable id="tabela-item-solicitacao-externo-dotacao-ver"
                                 rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                 rowIndexVar="rowIx"
                                 styleClass="mtop05"
                                 emptyMessage="Não foram localizados registros para serem apresentados"
                                 value="#{solicitacaoMaterialExternoControlador.itemSolicitacao.dotacoes}"
                                 var="itemDotacao">
                        <f:facet name="header">RESERVAS DO ITEM</f:facet>
                        <p:column headerText="Fonte de Despesa Orçamentária" styleClass="alinhamentoEsquerda">
                            <h:outputLabel value="#{itemDotacao.fonteDespesaORC}"/>
                        </p:column>
                        <p:column headerText="Valor Reservado (R$)" style="text-align: right; ">
                            <h:outputLabel value="#{itemDotacao.valorReservado}">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputLabel>
                        </p:column>
                    </p:dataTable>
                </div>
                <div style="text-align: center; margin: 10px; ">
                    <p:commandButton value="Fechar"
                                     icon="ui-icon-circle-close"
                                     styleClass="padrao mrig05"
                                     onstart="aguarde.show()"
                                     oncomplete="aguarde.hide()"
                                     actionListener="#{solicitacaoMaterialExternoControlador.cancelarItem()}"
                                     process="@this"
                                     update="@none"
                                     onclick="dlgVisDotaceosItemSolicitacaoExterno.hide(); "/>
                </div>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>
</html>
