<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui" xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
>
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <h:form id="formulario">
            <p:panel header="Requerimento de Licenciamento de ETR">
                <p:tabView id="tabViewGeral">
                    <p:tab id="tabDadosCadastrais" title="Dados do Requerimento">
                        <h:panelGrid columns="2">
                            <h:outputLabel value="Exercício: "/>
                            <h:outputText value="#{requerimentoLicenciamentoETRControlador.selecionado.exercicio.ano}"
                                          styleClass="negrito"/>

                            <h:outputLabel value="Código: "/>
                            <h:outputText value="#{requerimentoLicenciamentoETRControlador.selecionado.codigo}"
                                          styleClass="negrito"/>

                            <h:outputLabel value="Data do Requerimento: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.dataRequerimento}"
                                    styleClass="negrito">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>

                            <h:outputLabel value="Protocolo: "/>
                            <p:outputPanel>
                                <fc:protocolo controlador="#{requerimentoLicenciamentoETRControlador}"
                                              numero="#{requerimentoLicenciamentoETRControlador.selecionado.numeroProtocolo}"
                                              ano="#{requerimentoLicenciamentoETRControlador.selecionado.anoProtocolo}"
                                              mostrarLabel="false"
                                              rendered="#{requerimentoLicenciamentoETRControlador.selecionado.numeroProtocolo ne null}"/>

                            </p:outputPanel>
                            <h:outputLabel value="Situação: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.situacao.descricao}"
                                    styleClass="negrito"/>


                            <h:outputLabel value="Data de Aprovação: "
                                           rendered="#{requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'APROVADO'}"/>
                            <h:outputLabel value="Data de Suspenção: "
                                           rendered="#{requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'SUSPENSO'}"/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.dataEfetivacao}"
                                    rendered="#{requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'APROVADO' or
                                    requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'SUSPENSO'}"
                                    styleClass="negrito">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>

                            <h:outputLabel value="Usuário de Aprovação: "
                                           rendered="#{requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'APROVADO'}"/>
                            <h:outputLabel value="Usuário de Suspenção: "
                                           rendered="#{requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'SUSPENSO'}"/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.usuarioEfetivacao}"
                                    rendered="#{requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'APROVADO' or
                                    requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'SUSPENSO'}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="Cadastro Econômico: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.cadastroEconomico}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="Nome Fantasia: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.cadastroEconomico.pessoa.nomeFantasia}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="Classificação de Atividade: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.cadastroEconomico.classificacaoAtividade.descricao}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="Natureza Jurídica: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.cadastroEconomico.naturezaJuridica.descricao}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="CNAE Principal: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.cadastroEconomico.economicoCNAEPrincipal.cnae.getToStringAutoComplete()}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="Endereço: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.cadastroEconomico.pessoa.enderecoPrincipal}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="Responsável: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.responsavel}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="Telefone: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.telefone}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="E-mail: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.email}"
                                    styleClass="negrito"/>
                        </h:panelGrid>
                    </p:tab>
                    <p:tab id="tabEnderecoInstalacao" title="Endereço de Instalação">
                        <h:panelGrid columns="2">
                            <h:outputLabel value="Solicitação: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.solicitacao.descricao}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="Inscrição Imobiliária: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.cadastroImobiliario.inscricaoCadastral}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="CEP: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.enderecoInstalacao.cep}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="UF: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.enderecoInstalacao.uf}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="Cidade: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.enderecoInstalacao.localidade}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="Logradouro: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.enderecoInstalacao.logradouro}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="Bairro: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.enderecoInstalacao.bairro}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="Complemento: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.enderecoInstalacao.complemento}"
                                    styleClass="negrito"/>

                            <h:outputLabel value="Número: "/>
                            <h:outputText
                                    value="#{requerimentoLicenciamentoETRControlador.selecionado.enderecoInstalacao.numero}"
                                    styleClass="negrito"/>
                        </h:panelGrid>
                    </p:tab>
                    <p:tab id="tabPerguntasDocumentos" title="Perguntas/Documentos">
                        <c:forEach
                                var="requerimentoLicenciamentoETRRespostaFormulario"
                                items="#{requerimentoLicenciamentoETRControlador.selecionado.requerimentoLicenciamentoETRRespostaFormularioList}">
                            <fc:respostaFormulario
                                    respostaFormulario="#{requerimentoLicenciamentoETRRespostaFormulario.respostaFormulario}"/>
                        </c:forEach>
                    </p:tab>
                    <p:tab id="tabExigencias" title="Exigências">
                        <c:forEach items="#{requerimentoLicenciamentoETRControlador.selecionado.exigenciaETRList}"
                                   var="exigenciaETR">
                            <c:forEach
                                    var="exigenciaETRFormularioCampo"
                                    items="#{exigenciaETR.exigenciaETRFormularioList}">
                                <fc:respostaFormulario
                                        respostaFormulario="#{exigenciaETRFormularioCampo.respostaFormulario}"/>
                            </c:forEach>

                            <p:commandButton value="Enviar por Email"
                                             actionListener="#{requerimentoLicenciamentoETRControlador.enviarEmailRegistroExigencia(exigenciaETR)}"
                                             styleClass="operacao"
                                             icon="ui-icon-mail-closed"/>
                        </c:forEach>
                    </p:tab>
                    <p:tab id="tabMapa" title="Mapa">
                        <p:panel id="panel-localizacao" header="Localização">
                            <h:panelGrid id="grid-cadastro-imobiliario" columns="2">
                                <h:outputLabel value="Endereço:"/>
                                <h:outputText value="#{requerimentoLicenciamentoETRControlador.montaEnderecoMapa()}"
                                              styleClass="negrito endereco-cadastro-imobiliario"/>
                            </h:panelGrid>

                            <iframe id="frame_mapa" src="#{requerimentoLicenciamentoETRControlador.urlMapa}"
                                    width="100%"
                                    height="350px"></iframe>

                            <p:commandButton value="Centralizar o Lote" styleClass="operacao mtop05"
                                             icon="ui-icon-search"
                                             onclick="document.getElementById('frame_id').src='#{requerimentoLicenciamentoETRControlador.urlMapa}'"/>
                        </p:panel>
                    </p:tab>
                    <p:tab id="tabAceite" title="Aceite">

                        <p:dataTable value="#{requerimentoLicenciamentoETRControlador.unidadeAceiteList}"
                                     var="unidadeAceite"
                                     emptyMessage="Nenhum registro encontrado.">
                            <p:column headerText="Unidade Administrativa" styleClass="alinhamentoEsquerda">
                                <fc:codigo-descricao-hierarquia tipoHierarquia="ADMINISTRATIVA"
                                                                unidadeOrganizacional="#{unidadeAceite}"
                                                                dataMovimento="#{sistemaControlador.dataOperacao}"/>
                            </p:column>
                            <p:column headerText="Usuário de Aceite" styleClass="alinhamentoEsquerda">
                                <h:outputLabel
                                        value="${requerimentoLicenciamentoETRControlador.buscarUsuarioAceite(unidadeAceite)}"/>
                            </p:column>
                            <p:column headerText="Data/Hora de Aceite" styleClass="alinhamentoCentralizado">
                                <h:outputLabel
                                        value="${requerimentoLicenciamentoETRControlador.buscarDataAceite(unidadeAceite)}">
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
                                </h:outputLabel>
                            </p:column>
                            <p:column headerText="Aceitar" styleClass="alinhamentoCentralizado">
                                <p:commandButton icon="ui-icon-check"
                                                 disabled="#{!requerimentoLicenciamentoETRControlador.canAceitarRequerimento(unidadeAceite)}"
                                                 actionListener="#{requerimentoLicenciamentoETRControlador.aceitarRequerimento(unidadeAceite)}"
                                                 onclick="if (!confirm('Tem certeza que deseja aceitar este requerimento?')) {return false; } else {aguarde.show();}"
                                                 oncomplete="aguarde.hide()"
                                                 process="@this" update="@form"/>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab id="historico" title="Histórico">
                        <p:dataTable
                                id="tableHistorico"
                                rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada trintaAltura' : 'trintaAltura'}"
                                rowIndexVar="rowIx"
                                styleClass="mtop05"
                                emptyMessage="Não foram localizados registros para serem apresentados"
                                value="#{requerimentoLicenciamentoETRControlador.selecionado.historicoList}"
                                rows="10"
                                paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>HISTÓRICO&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                rowsPerPageTemplate="10,25,50,100"
                                var="historico">
                            <p:column headerText="Data Registro" styleClass="alinhamentoCentralizado">
                                <h:outputText value="#{historico.dataRegistro}">
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Situação" styleClass="alinhamentoDireita">
                                <h:outputText value="#{historico.situacao.descricao}"/>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                </p:tabView>
            </p:panel>

            <p:commandButton value="Baixar todos arquivos"
                             title="Clique aqui para baixar todos os arquivos em anexo"
                             ajax="false"
                             icon="ui-icon-circle-arrow-s"
                             process="@form"
                             styleClass="mtop10 mrig03 operacao"
                             update="@this"
                             onstart="aguarde.show()"
                             oncomplete="aguarde.hide()">
                <p:fileDownload value="#{requerimentoLicenciamentoETRControlador.baixarTodosAnexos()}"/>
            </p:commandButton>

            <p:commandButton value="Aprovar"
                             rendered="#{requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'EM_ESTUDO' or
                             requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'EM_EXIGENCIA' or
                             requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'RETORNO_EXIGENCIA'}"
                             id="cbAprovar"
                             styleClass="mtop10 mrig03 operacao"
                             onstart="aguarde.show()"
                             oncomplete="aguarde.hide()"
                             style="height: 30px;"
                             icon="ui-icon-check"
                             title="Clique para aprovar o requerimento."
                             actionListener="#{requerimentoLicenciamentoETRControlador.iniciarAprovacao()}"
                             process="@this" update=":formularioAlteracaoSituacao"/>

            <p:commandButton value="Suspender"
                             rendered="#{requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'EM_ESTUDO' or
                             requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'EM_EXIGENCIA' or
                             requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'RETORNO_EXIGENCIA'}"
                             id="cbSuspender"
                             styleClass="mtop10 mrig03 operacao"
                             onstart="aguarde.show()"
                             oncomplete="aguarde.hide();"
                             icon="ui-icon-estornar"
                             title="Clique para suspender o requerimento."
                             actionListener="#{requerimentoLicenciamentoETRControlador.iniciarSuspensao()}"
                             process="@this" update=":formularioAlteracaoSituacao"/>

            <p:commandButton value="Adicionar Exigência"
                             rendered="#{requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'EM_ESTUDO'}"
                             id="cbAdicionarExigencia"
                             styleClass="mtop10 mrig03 operacao"
                             onstart="aguarde.show()"
                             oncomplete="aguarde.hide()"
                             icon="ui-icon-arrowthick-1-s"
                             title="Clique para adicionar exigências ao requerimento."
                             actionListener="#{requerimentoLicenciamentoETRControlador.iniciarExigencia()}"
                             process="@this" update=":formularioExigencia"/>
            <p:commandButton value="Enviar por E-mail"
                             rendered="#{requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'APROVADO'}"
                             actionListener="#{requerimentoLicenciamentoETRControlador.prepararImpressaoParaEnvio()}"
                             id="cbEnviarPorEmail"
                             styleClass="mtop10 mrig03 operacao"
                             process="@form"
                             onclick="aguarde.show()"
                             onsuccess="aguarde.hide()"
                             update=":formulario"
                             icon="ui-icon-mail-closed"
                             title="Clique para enviar por e-mail o requerimento."/>
            <p:commandButton value="Imprimir Dispensa Alvará"
                             rendered="#{requerimentoLicenciamentoETRControlador.selecionado.dispensaAlvara and
                             requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'APROVADO'}"
                             actionListener="#{requerimentoLicenciamentoETRControlador.imprimirAlvara()}"
                             process="@this"
                             update="@this"
                             id="cbImprimirDispensa"
                             styleClass="mtop10 mrig03 operacao"
                             onclick="aguarde.show()"
                             oncomplete="aguarde.hide()"
                             icon="ui-icon-print"
                             title="Clique para imprimir a dispensa de alvará."/>

            <p:commandButton value="Imprimir Alvará"
                             rendered="#{!requerimentoLicenciamentoETRControlador.selecionado.dispensaAlvara and
                             requerimentoLicenciamentoETRControlador.selecionado.situacao eq 'APROVADO'}"
                             actionListener="#{requerimentoLicenciamentoETRControlador.imprimirAlvara()}"
                             id="cbImprimirAlvara"
                             process="@this"
                             update="@this"
                             styleClass="mtop10 mrig03 operacao"
                             onstart="aguarde.show()"
                             oncomplete="aguarde.hide()"
                             icon="ui-icon-print"
                             title="Clique para imprimir o alvará."/>

            <p:commandButton value="Voltar"
                             id="cbCancelar"
                             styleClass="mtop10 mrig03 operacao"
                             onstart="aguarde.show()"
                             oncomplete="aguarde.hide()"
                             icon="ui-icon-cancel"
                             title="Clique para cancelar e retornar a página anterior."
                             actionListener="#{requerimentoLicenciamentoETRControlador.cancelar()}"/>
        </h:form>

        <p:dialog width="500"
                  header="Alteração de Situação"
                  widgetVar="dlgAlteracaoSituacao"
                  modal="true"
                  closable="true"
                  resizable="false"
                  dynamic="true"
                  position="center"
                  style="position: center !important;"
                  draggable="false">
            <h:form id="formularioAlteracaoSituacao">
                <div class="alert alert-info m-b-sm" style="text-align: center">
                        <span>Tem certeza que deseja alterar o requerimento para
                            <strong>#{requerimentoLicenciamentoETRControlador.situacao}</strong>?</span>
                </div>

                <h:panelGrid columns="1"
                             rendered="#{requerimentoLicenciamentoETRControlador.situacao eq 'SUSPENSO'}">
                    <fc:outputLabelObrigatorio value="Justificativa "/>
                    <p:inputTextarea value="#{requerimentoLicenciamentoETRControlador.selecionado.justificativa}"
                                     cols="55"
                                     rows="6"
                                     maxlength="3000"/>
                </h:panelGrid>

                <h:panelGrid columns="1" styleClass="mtop10 mbot10">
                    <fc:protocolo controlador="#{requerimentoLicenciamentoETRControlador}"
                                  ano="#{requerimentoLicenciamentoETRControlador.selecionado.anoProtocolo}"
                                  numero="#{requerimentoLicenciamentoETRControlador.selecionado.numeroProtocolo}"/>
                </h:panelGrid>

                <div style="text-align: center">
                    <p:commandButton value="Sim"
                                     icon="ui-icon-check"
                                     styleClass="operacao mrig03 mtop10 mbot10"
                                     onclick="aguarde.show()"
                                     oncomplete="aguarde.hide()"
                                     process="@form"
                                     actionListener="#{requerimentoLicenciamentoETRControlador.alterarSituacao()}"/>
                    <p:commandButton value="Não"
                                     icon="ui-icon-cancel"
                                     styleClass="operacao mrig03 mtop10 mbot10"
                                     process="@this"
                                     onclick="dlgAlteracaoSituacao.hide();"/>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog width="800"
                  header="Registro de Exigência"
                  widgetVar="dlgExigencia"
                  modal="true"
                  closable="false"
                  resizable="false"
                  dynamic="true"
                  position="center"
                  style="position: center !important;"
                  draggable="false">
            <h:form id="formularioExigencia">
                <div style="max-height: 400px; overflow: auto; ">
                    <p:panel header="Formulário(s)">
                        <h:panelGrid columns="2">
                            <fc:outputLabelObrigatorio value="Ordem:"/>
                            <p:inputText onkeyup="mascara(this, soNumeros)"
                                         value="#{requerimentoLicenciamentoETRControlador.exigenciaETRFormulario.ordem}"/>

                            <fc:outputLabelObrigatorio value="Formulário: "/>
                            <p:selectOneMenu
                                    value="#{requerimentoLicenciamentoETRControlador.exigenciaETRFormulario.formulario}"
                                    converter="#{formularioControlador.converterGenerico}">
                                <f:selectItems
                                        value="#{requerimentoLicenciamentoETRControlador.selectItemsFormulario}"/>
                                <p:ajax event="change" process="@form" update="@form"
                                        listener="#{requerimentoLicenciamentoETRControlador.buscarSelectItemsFormularioCampo()}"/>
                            </p:selectOneMenu>
                        </h:panelGrid>

                        <p:panel header="Campo(s)">
                            <h:panelGrid columns="2">
                                <fc:outputLabelObrigatorio value="Campo: "/>
                                <p:selectOneMenu
                                        value="#{requerimentoLicenciamentoETRControlador.exigenciaETRFormularioCampo.formularioCampo}"
                                        converter="#{formularioCampoControlador.converterGenerico}"
                                        panelStyle="max-height: 250px;max-width: 500px;">
                                    <f:selectItems
                                            value="#{requerimentoLicenciamentoETRControlador.selectItemsFormularioCampo}"/>
                                </p:selectOneMenu>

                                <fc:outputLabelObrigatorio value="Justificativa"/>
                                <p:inputTextarea
                                        value="#{requerimentoLicenciamentoETRControlador.exigenciaETRFormularioCampo.justificativa}"
                                        cols="50"
                                        rows="4"
                                        maxlength="3000"/>
                            </h:panelGrid>

                            <p:commandButton value="Adicionar Campo"
                                             styleClass="mtop10 operacao mbot10"
                                             icon="ui-icon-disk"
                                             onclick="aguarde.show()"
                                             oncomplete="aguarde.hide()"
                                             process="@form"
                                             update="@form"
                                             actionListener="#{requerimentoLicenciamentoETRControlador.adicionarExigenciaFormularioCampo()}"/>

                            <p:dataTable
                                    value="#{requerimentoLicenciamentoETRControlador.exigenciaETRFormulario.formularioCampoList}"
                                    var="exigenciaETRFormularioCampo"
                                    emptyMessage="Nenhum registro encontrado.">
                                <p:column headerText="Ações" style="min-width: 150px; text-align: center;">
                                    <p:commandButton icon="ui-icon-pencil"
                                                     onstart="aguarde.show()"
                                                     oncomplete="aguarde.hide()"
                                                     process="@this"
                                                     title="Clique para editar este registro."
                                                     update="@form"
                                                     actionListener="#{requerimentoLicenciamentoETRControlador.editarExigenciaFormularioCampo(exigenciaETRFormularioCampo)}"/>
                                    <p:commandButton icon="ui-icon-trash"
                                                     onstart="aguarde.show()"
                                                     oncomplete="aguarde.hide()"
                                                     process="@this"
                                                     title="Clique para remover este registro."
                                                     onclick="if (!confirm('Tem certeza que deseja remover este registro?')) {return false; } else {aguarde.show();}"
                                                     update="@form"
                                                     actionListener="#{requerimentoLicenciamentoETRControlador.removerExigenciaFormularioCampo(exigenciaETRFormularioCampo)}"/>
                                </p:column>
                                <p:column headerText="Campo" styleClass="alinhamentoEsquerda">
                                    #{exigenciaETRFormularioCampo.formularioCampo.titulo}
                                </p:column>
                                <p:column headerText="Justificativa" styleClass="alinhamentoEsquerda">
                                    #{exigenciaETRFormularioCampo.justificativa}
                                </p:column>
                            </p:dataTable>
                        </p:panel>

                        <p:commandButton value="Adicionar Formulário"
                                         styleClass="mtop10 operacao mbot10"
                                         icon="ui-icon-disk"
                                         onclick="aguarde.show()"
                                         oncomplete="aguarde.hide()"
                                         process="@form"
                                         update="@form"
                                         actionListener="#{requerimentoLicenciamentoETRControlador.adicionarExigenciaFormulario()}"/>

                        <p:dataTable
                                value="#{requerimentoLicenciamentoETRControlador.exigenciaETR.exigenciaETRFormularioList}"
                                var="exigenciaETRFormulario"
                                emptyMessage="Nenhum registro encontrado.">
                            <p:column headerText="Ações" style="min-width: 150px; text-align: center;">
                                <p:commandButton icon="ui-icon-pencil"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 process="@this"
                                                 title="Clique para editar este registro."
                                                 update="@form"
                                                 actionListener="#{requerimentoLicenciamentoETRControlador.editarExigenciaFormulario(exigenciaETRFormulario)}"/>
                                <p:commandButton icon="ui-icon-trash"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 process="@this"
                                                 title="Clique para remover este registro."
                                                 onclick="if (!confirm('Tem certeza que deseja remover este registro?')) {return false; } else {aguarde.show();}"
                                                 update="@form"
                                                 actionListener="#{requerimentoLicenciamentoETRControlador.removerExigenciaFormulario(exigenciaETRFormulario)}"/>
                            </p:column>
                            <p:column headerText="Ordem" styleClass="alinhamentoEsquerda">
                                #{exigenciaETRFormulario.ordem}
                            </p:column>
                            <p:column headerText="Formulário" styleClass="alinhamentoEsquerda">
                                #{exigenciaETRFormulario.formulario.titulo}
                            </p:column>
                        </p:dataTable>
                    </p:panel>
                </div>
                <p:commandButton value="Salvar Exigência"
                                 icon="ui-icon-check"
                                 styleClass="operacao mrig03 mtop10"
                                 onclick="aguarde.show()"
                                 oncomplete="aguarde.hide()"
                                 process="@form"
                                 actionListener="#{requerimentoLicenciamentoETRControlador.salvarExigencia()}"/>
                <p:commandButton value="Cancelar"
                                 icon="ui-icon-cancel"
                                 styleClass="operacao mrig03 mtop10"
                                 process="@this"
                                 onclick="dlgExigencia.hide()"/>

            </h:form>
        </p:dialog>

        <p:dialog header="Enviar e-mail com o Documento em anexo"
                  modal="true"
                  dynamic="true"
                  position="center"
                  style="position: fixed !important;"
                  resizable="false"
                  widgetVar="listaEmails">
            <h:form id="formEmails">

                <div class="alert warn">
                    Por favor digite os e-mails de envio separados por (",")
                </div>
                <h:panelGrid columns="2" styleClass="mtop10">
                    <fc:outputLabelObrigatorio value="E-mail(s):" for="emails"/>
                    <p:inputTextarea id="emails" value="#{requerimentoLicenciamentoETRControlador.emails}" rows="1"
                                     cols="70"
                                     maxlength="255"/>
                    <fc:outputLabelObrigatorio value="Mensagem:" for="mensagem"/>
                    <h:panelGrid columns="2" cellpadding="0" cellspacing="0">
                        <p:inputTextarea title="Informe a mensagem do e-mail."
                                         value="#{requerimentoLicenciamentoETRControlador.mensagemEmail}"
                                         rows="4"
                                         cols="70"
                                         id="mensagem"
                                         maxlength="255"
                                         counter="counterMensagem"
                                         counterTemplate="{0} Caracteres restantes."
                                         autoResize="true"/>
                        <h:outputText id="counterMensagem"
                                      styleClass="mlef05"/>
                    </h:panelGrid>
                </h:panelGrid>
                <p:separator/>
                <div style="width: 100%; text-align: center">
                    <p:commandButton
                            value="Enviar Documento"
                            icon="ui-icon-arrowreturnthick-1-n"
                            onclick="aguarde.show()"
                            onsuccess="aguarde.hide()"
                            process="@form"
                            update=":formulario"
                            actionListener="#{requerimentoLicenciamentoETRControlador.enviarDocumentoPorEmail()}"
                            styleClass="operacao"/>

                    <p:commandButton
                            value="Cancelar"
                            icon="ui-icon-cancel"
                            onclick="listaEmails.hide()"
                            styleClass="operacao"/>
                </div>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>
