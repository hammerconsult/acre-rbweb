<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui">
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <script type="text/javascript"
                src="http://sit.riobranco.ac.gov.br/mapa.js?key=34KEzpj7iTKK654_qdZ0Bn7mHI807ljqgLoiKAA"
                charset="utf-8">
        </script>

        <h:form id="Formulario">
            <p:poll interval="5"
                    process="@this" update="@this"
                    autoStart="false"
                    widgetVar="pollAlvaraConstrucao"
                    listener="#{solicitacaoAlvaraImediatoControlador.consultarAlvaraConstrucao()}"/>
            <p:poll interval="5"
                    process="@this" update="@this"
                    autoStart="false"
                    widgetVar="pollCalculoAlvaraConstrucao"
                    listener="#{solicitacaoAlvaraImediatoControlador.consultarCalculoAlvaraConstrucao()}"/>

            <p:panel header="Solicitação de Alvará Imediato">
                <p:tabView id="tabViewGeral">
                    <p:ajax event="tabChange" listener="#{solicitacaoAlvaraImediatoControlador.alterarTabs}"
                            onstart="aguarde.show()" oncomplete="aguarde.hide()"/>

                    <p:tab id="tabDadosSolicitacao" title="Dados da Solicitação">
                        <h:panelGrid columns="2">
                            <h:outputLabel value="Exercício: "/>
                            <h:outputText value="#{solicitacaoAlvaraImediatoControlador.selecionado.exercicio.ano}"
                                          styleClass="negrito"/>

                            <h:outputLabel value="Código: "/>
                            <h:outputText value="#{solicitacaoAlvaraImediatoControlador.selecionado.codigo}"
                                          styleClass="negrito"/>

                            <h:outputLabel value="Data da Solicitação: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.dataSolicitacao}"
                                styleClass="negrito">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>

                            <h:outputLabel value="Protocolo: "/>
                            <p:outputPanel>
                                <fc:protocolo controlador="#{solicitacaoAlvaraImediatoControlador}"
                                              numero="#{solicitacaoAlvaraImediatoControlador.selecionado.numeroProtocolo}"
                                              ano="#{solicitacaoAlvaraImediatoControlador.selecionado.anoProtocolo}"
                                              mostrarLabel="false"
                                              readonly="true"
                                              rendered="#{solicitacaoAlvaraImediatoControlador.selecionado.numeroProtocolo ne null}"/>
                            </p:outputPanel>

                            <h:outputLabel value="Processo de Regularização: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.procRegularizaConstrucao.codigo}/
                                    #{solicitacaoAlvaraImediatoControlador.selecionado.procRegularizaConstrucao.exercicio.ano} -
                                    #{solicitacaoAlvaraImediatoControlador.selecionado.procRegularizaConstrucao.situacao.descricao}"
                                styleClass="negrito"/>

                            <h:outputLabel value="Situação: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.situacao.descricao}"
                                styleClass="negrito"/>

                            <h:outputLabel value="Data de Aprovação: "
                                           rendered="#{solicitacaoAlvaraImediatoControlador.selecionado.situacao eq 'APROVADO'}"/>
                            <h:outputLabel value="Data de Rejeição: "
                                           rendered="#{solicitacaoAlvaraImediatoControlador.selecionado.situacao eq 'REJEITADO'}"/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.dataEfetivacao}"
                                rendered="#{solicitacaoAlvaraImediatoControlador.selecionado.situacao eq 'APROVADO' or
                                    solicitacaoAlvaraImediatoControlador.selecionado.situacao eq 'REJEITADO'}"
                                styleClass="negrito">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>

                            <h:outputLabel value="Usuário de Aprovação: "
                                           rendered="#{solicitacaoAlvaraImediatoControlador.selecionado.situacao eq 'APROVADO'}"/>
                            <h:outputLabel value="Usuário de Rejeição: "
                                           rendered="#{solicitacaoAlvaraImediatoControlador.selecionado.situacao eq 'REJEITADO'}"/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.usuarioEfetivacao}"
                                rendered="#{solicitacaoAlvaraImediatoControlador.selecionado.situacao eq 'APROVADO' or
                                    solicitacaoAlvaraImediatoControlador.selecionado.situacao eq 'REJEITADO'}"
                                styleClass="negrito"/>

                            <h:outputLabel value="Cadastro Imobiliário: "/>
                            <h:panelGroup>
                                <h:outputText
                                    value="#{solicitacaoAlvaraImediatoControlador.selecionado.cadastroImobiliario}"
                                    styleClass="negrito mlef03"/>
                                <p:commandButton icon="ui-icon-eye"
                                                 title="Clique aqui para visualizar o cadastro imobiliário"
                                                 styleClass="mlef03"
                                                 process="@this"
                                                 actionListener="#{solicitacaoAlvaraImediatoControlador.verImovel()}"/>
                            </h:panelGroup>

                            <h:outputLabel value="E-mail: "/>
                            <h:outputText value="#{solicitacaoAlvaraImediatoControlador.selecionado.email}"
                                          styleClass="negrito"/>

                            <h:outputLabel value="Analista Responsável: "/>
                            <h:outputText value="#{solicitacaoAlvaraImediatoControlador.selecionado.analistaResponsavel}"
                                          styleClass="negrito"/>

                            <h:outputLabel value="Observação: "/>
                            <h:outputText value="#{solicitacaoAlvaraImediatoControlador.selecionado.observacao}"
                                          styleClass="negrito"/>
                        </h:panelGrid>
                    </p:tab>
                    <p:tab id="tabDadosObra" title="Dados da Obra">
                        <h:panelGrid columns="2">
                            <h:outputLabel value="Tipo de Solicitação: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.tipoSolicitacao.descricao}"
                                styleClass="negrito"/>
                            <h:outputLabel value="Data de Início: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.dataInicio}"
                                styleClass="negrito">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                            <h:outputLabel value="Data de Conclusão: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.dataConclusao}"
                                styleClass="negrito">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                            <h:outputLabel value="CEI (Matrícula no INSS): "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.cei}"
                                styleClass="negrito"/>
                            <h:outputLabel value="Tipo de Obra: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.tipoObra.descricao}"
                                styleClass="negrito"/>
                        </h:panelGrid>
                    </p:tab>
                    <p:tab id="tabAreas" title="Áreas (m²)">
                        <h:panelGrid columns="2">
                            <h:outputLabel value="Área do Terreno: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.areaTerreno}"
                                styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                            <h:outputLabel value="Área Existente: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.areaExistente}"
                                styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                            <h:outputLabel value="Área Total: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.areaTotal}"
                                styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                            <h:outputLabel value="Área à Construir: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.areaConstruir}"
                                styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                            <h:outputLabel value="Área à Demolir: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.areaDemolir}"
                                styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                            <h:outputLabel value="Número de Pavimentos: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.numeroPavimentos}"
                                styleClass="negrito">
                                <f:convertNumber pattern="###,##0"/>
                            </h:outputText>
                            <h:outputLabel value="Descrição da Área: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.descricaoArea}"
                                styleClass="negrito"/>
                            <h:outputLabel value="Tipo de Imóvel: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.tipoImovel}"
                                styleClass="negrito"/>
                            <h:outputLabel value="Utilização do Imóvel: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.tipoImovel}"
                                styleClass="negrito"/>
                        </h:panelGrid>
                    </p:tab>
                    <p:tab id="tabResponsavelTecnico" title="Responsável Técnico">
                        <p:panel header="Autor do Projeto">
                            <h:panelGrid columns="2">
                                <h:outputLabel value="Pessoa: "/>
                                <h:outputText
                                    value="#{solicitacaoAlvaraImediatoControlador.selecionado.autorProjeto.pessoa}"
                                    styleClass="negrito"/>
                                <h:outputLabel value="CREA/CAU: "/>
                                <h:outputText
                                    value="#{solicitacaoAlvaraImediatoControlador.selecionado.autorProjeto.cauCrea}"
                                    styleClass="negrito"/>
                                <h:outputLabel value="ART/RRT do Projeto: "/>
                                <h:outputText
                                    value="#{solicitacaoAlvaraImediatoControlador.selecionado.artRrtAutorProjeto}"
                                    styleClass="negrito"/>
                                <h:outputLabel value="Especialidade: "/>
                                <h:outputText
                                    value="#{solicitacaoAlvaraImediatoControlador.selecionado.autorProjeto.tipoEspecialidadeServico.descricao}"
                                    styleClass="negrito"/>
                            </h:panelGrid>
                        </p:panel>
                        <p:spacer height="30"/>
                        <p:panel header="Responsável pela Execução">
                            <h:panelGrid columns="2">
                                <h:outputLabel value="Pessoa: "/>
                                <h:outputText
                                    value="#{solicitacaoAlvaraImediatoControlador.selecionado.responsavelExecucao.pessoa}"
                                    styleClass="negrito"/>
                                <h:outputLabel value="CREA/CAU: "/>
                                <h:outputText
                                    value="#{solicitacaoAlvaraImediatoControlador.selecionado.responsavelExecucao.cauCrea}"
                                    styleClass="negrito"/>
                                <h:outputLabel value="ART/RRT de Execução: "/>
                                <h:outputText
                                    value="#{solicitacaoAlvaraImediatoControlador.selecionado.artRrtResponsavelExecucao}"
                                    styleClass="negrito"/>
                                <h:outputLabel value="Especialidade: "/>
                                <h:outputText
                                    value="#{solicitacaoAlvaraImediatoControlador.selecionado.responsavelExecucao.tipoEspecialidadeServico.descricao}"
                                    styleClass="negrito"/>
                            </h:panelGrid>
                        </p:panel>
                    </p:tab>
                    <p:tab id="tabUsoZoneamento" title="Uso do Zoneamento">
                        <h:panelGrid columns="2">
                            <h:outputLabel value="Zona: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.zona}"
                                styleClass="negrito"/>
                            <h:outputLabel value="Categoria: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.classificacaoUso}"
                                styleClass="negrito"/>
                            <h:outputLabel value="Classificação de Uso (Item): "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.classificacaoUsoItem}"
                                styleClass="negrito"/>
                            <h:outputLabel value="Hierarquia da Via: "/>
                            <h:outputText
                                value="#{solicitacaoAlvaraImediatoControlador.selecionado.hierarquiaVia}"
                                styleClass="negrito"/>
                        </h:panelGrid>
                    </p:tab>
                    <p:tab id="tabPerguntasDocumentos" title="Perguntas/Documentos">
                        <fc:respostaFormulario
                            respostaFormulario="#{solicitacaoAlvaraImediatoControlador.selecionado.respostaFormulario}"/>
                    </p:tab>
                    <p:tab id="tabExigencias" title="Exigências">
                        <c:if test="#{empty solicitacaoAlvaraImediatoControlador.selecionado.exigenciasAlvaraImediato}">
                            <h:outputText value="Nenhuma exigência foi registrada." styleClass="negrito"/>
                        </c:if>
                        <c:forEach items="#{solicitacaoAlvaraImediatoControlador.selecionado.exigenciasAlvaraImediato}"
                                   var="exigencia">
                            <p:panel header="Registro de Exigência">
                                <h:panelGrid columns="2" styleClass="mbot05">
                                    <h:outputLabel value="Sequencial: "/>
                                    <h:outputText value="#{exigencia.sequencial}" styleClass="negrito"/>
                                    <h:outputLabel value="Data de Registro: "/>
                                    <h:outputText value="#{exigencia.dataRegistro}" styleClass="negrito">
                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
                                    </h:outputText>
                                    <h:outputLabel value="Respondida? "/>
                                    <h:outputText value="#{exigencia.respostaFormulario ne null ? 'Sim' : 'Não'}" styleClass="negrito"/>
                                </h:panelGrid>

                                <p:outputPanel rendered="#{exigencia.respostaFormulario ne null}">
                                    <fc:respostaFormulario
                                        respostaFormulario="#{exigencia.respostaFormulario}"/>
                                </p:outputPanel>

                                <p:outputPanel rendered="#{exigencia.respostaFormulario eq null}">
                                    <c:forEach var="campo" items="#{exigencia.campos}">
                                        <h:panelGrid>
                                            <h:outputText value="#{campo.formularioCampo.titulo}" styleClass="negrito"/>
                                            <h:outputText value="#{campo.justificativa}"/>
                                        </h:panelGrid>

                                    </c:forEach>

                                    <h:panelGrid columns="1">
                                        <p:commandButton value="Reenviar por E-mail"
                                                         onclick="aguarde.show()" oncomplete="aguarde.hide()"
                                                         actionListener="#{solicitacaoAlvaraImediatoControlador.enviarEmailRegistroExigencia(exigencia)}"
                                                         styleClass="operacao mtop05"
                                                         icon="ui-icon-mail-closed"/>
                                    </h:panelGrid>
                                </p:outputPanel>
                            </p:panel>
                        </c:forEach>
                    </p:tab>
                    <p:tab id="tabMapa" title="Mapa">
                        <div id="mapa" style="width: 100%; text-align: center; vertical-align: top; margin-top: 5px;"/>

                        <div style="width: 100%; text-align: center; margin-top: 5px;">
                            <p:commandButton actionListener="#{solicitacaoAlvaraImediatoControlador.verInscricaoMapa}"
                                             value="Centralizar Lote"
                                             icon="ui-icon-search" styleClass="operacao"/>
                        </div>
                    </p:tab>
                    <p:tab id="tabHistorico" title="Histórico">
                        <p:dataTable
                            id="tableHistorico"
                            rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada trintaAltura' : 'trintaAltura'}"
                            rowIndexVar="rowIx"
                            styleClass="mtop05"
                            emptyMessage="Não foram localizados registros para serem apresentados"
                            value="#{solicitacaoAlvaraImediatoControlador.selecionado.historicos}"
                            rows="10"
                            paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>HISTÓRICO&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                            currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                            rowsPerPageTemplate="10,25,50,100"
                            var="historico">
                            <p:column headerText="Data Registro" styleClass="alinhamentoCentralizado">
                                <h:outputText value="#{historico.dataRegistro}">
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Situação" styleClass="alinhamentoDireita">
                                <h:outputText value="#{historico.situacao.descricao}"/>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                </p:tabView>
            </p:panel>

            <p:commandButton value="Baixar todos arquivos"
                             title="Clique aqui para baixar todos os arquivos em anexo"
                             ajax="false"
                             icon="ui-icon-circle-arrow-s"
                             process="@form"
                             styleClass="mtop10 mrig03 operacao"
                             update="@this"
                             onstart="aguarde.show()"
                             oncomplete="aguarde.hide()">
                <p:fileDownload value="#{solicitacaoAlvaraImediatoControlador.baixarTodosAnexos()}"/>
            </p:commandButton>

            <p:commandButton value="Editar Observação"
                             id="cbEditarObservacao"
                             styleClass="mtop10 mrig03 operacao"
                             onstart="aguarde.show()"
                             oncomplete="aguarde.hide(); dlgObservacao.show()"
                             style="height: 30px;"
                             update=":formObservacao"
                             icon="ui-icon-pencil"
                             title="Clique para editar a observação da solicitação."/>

            <p:commandButton value="Aprovar"
                             id="cbAprovar"
                             styleClass="mtop10 mrig03 operacao"
                             onstart="aguarde.show()"
                             oncomplete="aguarde.hide()"
                             style="height: 30px;"
                             icon="ui-icon-check"
                             rendered="${solicitacaoAlvaraImediatoControlador.podeAprovar}"
                             actionListener="#{solicitacaoAlvaraImediatoControlador.iniciarAprovacao()}"
                             title="Clique para aprovar a solicitação."/>

            <p:commandButton value="Deferir"
                             title="Clique aqui para deferir a solicitação"
                             icon="ui-icon-check"
                             styleClass="mtop10 mrig03 operacao"
                             process="@this" update=":FormularioDeferimento"
                             onclick="dlgDeferimento.show()"
                             rendered="#{solicitacaoAlvaraImediatoControlador.podeDeferir}"
                             actionListener="#{solicitacaoAlvaraImediatoControlador.iniciarDeferimento()}"/>

            <p:commandButton value="Rejeitar"
                             id="cbRejeitar"
                             styleClass="mtop10 mrig03 operacao"
                             onclick="aguarde.show()"
                             oncomplete="aguarde.hide(); dlgRejeicao.show()"
                             icon="ui-icon-check"
                             process="@this" update=":FormularioRejeicao"
                             actionListener="#{solicitacaoAlvaraImediatoControlador.iniciarRejeicao()}"
                             rendered="${solicitacaoAlvaraImediatoControlador.podeRejeitar}"
                             title="Clique para rejeitar a solicitação."/>

            <p:commandButton value="Alvará de Construção"
                             id="cbAlvaraConstrucao"
                             styleClass="mtop10 mrig03 operacao"
                             onstart="aguarde.show()"
                             oncomplete="aguarde.hide()"
                             icon="ui-icon-check"
                             rendered="${solicitacaoAlvaraImediatoControlador.podeVerAlvaraConstrucao}"
                             actionListener="#{solicitacaoAlvaraImediatoControlador.verAlvaraConstrucao()}"
                             title="Clique para aprovar a solicitação."/>

            <p:commandButton value="Adicionar Exigência"
                             id="cbAdicionarExigencia"
                             styleClass="mtop10 mrig03 operacao"
                             onstart="aguarde.show()"
                             oncomplete="aguarde.hide()"
                             icon="ui-icon-arrowthick-1-s"
                             rendered="${solicitacaoAlvaraImediatoControlador.podeAdicionarExigencia}"
                             title="Clique para adicionar exigências a solicitação."
                             actionListener="#{solicitacaoAlvaraImediatoControlador.iniciarExigencia()}"
                             process="@this" update=":formExigencia"/>

            <p:commandButton value="Designar"
                             title="Clique aqui para designar você como analista responsável"
                             icon="ui-icon-check"
                             styleClass="mtop10 mrig03 operacao"
                             process="@this"
                             onclick="if (!confirm('Tem certeza que deseja se designar como analista resposável dessa solicitação?')) {return false;} else {aguarde.show()}"
                             oncomplete="aguarde.hide()"
                             rendered="${solicitacaoAlvaraImediatoControlador.podeDesignar}"
                             actionListener="#{solicitacaoAlvaraImediatoControlador.designar()}"/>

            <p:commandButton value="Designar"
                             title="Clique aqui para alterar o analista responsável designado"
                             icon="ui-icon-check"
                             styleClass="mtop10 mrig03 operacao"
                             process="@this" update=":FormularioAlteracaoDesignacao"
                             onclick="dlgAlteracaoDesignacao.show()"
                             rendered="${solicitacaoAlvaraImediatoControlador.podeAlterarDesignacao}"
                             actionListener="#{solicitacaoAlvaraImediatoControlador.iniciarAlteracaoDesignacao()}"/>

            <p:commandButton value="Voltar"
                             id="cbVoltar"
                             styleClass="mtop10 mrig03 operacao"
                             onstart="aguarde.show()"
                             oncomplete="aguarde.hide()"
                             icon="ui-icon-cancel"
                             title="Clique para cancelar e retornar a página anterior."
                             actionListener="#{solicitacaoAlvaraImediatoControlador.cancelar()}"/>

        </h:form>

        <p:dialog width="500"
                  header="Aprovação de Solicitação"
                  widgetVar="dlgAprovacao"
                  modal="true"
                  closable="true"
                  resizable="false"
                  dynamic="true"
                  position="center"
                  style="position: center !important;"
                  draggable="false">
            <h:form id="FormularioAprovacao">
                <div class="alert alert-info m-b-sm" style="text-align: center">
                    <span>Tem certeza que deseja aprovar a solicitação de alvará imediato?</span>
                </div>

                <h:panelGrid columns="1" styleClass="mtop10 mbot10">
                    <fc:protocolo controlador="#{solicitacaoAlvaraImediatoControlador}"
                                  ano="#{solicitacaoAlvaraImediatoControlador.selecionado.anoProtocolo}"
                                  numero="#{solicitacaoAlvaraImediatoControlador.selecionado.numeroProtocolo}"/>
                </h:panelGrid>

                <div style="text-align: center">
                    <p:commandButton value="Sim"
                                     icon="ui-icon-check"
                                     styleClass="operacao mrig03 mtop10 mbot10"
                                     onclick="aguarde.show()"
                                     oncomplete="aguarde.hide()"
                                     process="@form"
                                     actionListener="#{solicitacaoAlvaraImediatoControlador.aprovarSolicitacao()}"/>
                    <p:commandButton value="Não"
                                     icon="ui-icon-cancel"
                                     styleClass="operacao mrig03 mtop10 mbot10"
                                     process="@this"
                                     onclick="dlgAprovacao.hide();"/>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog width="500"
                  header="Deferimento de Solicitação"
                  widgetVar="dlgDeferimento"
                  modal="true"
                  closable="true"
                  resizable="false"
                  dynamic="true"
                  position="center"
                  style="position: center !important;"
                  draggable="false">
            <h:form id="FormularioDeferimento">
                <div class="alert alert-info m-b-sm" style="text-align: center">
                    <span>Tem certeza que deseja deferir a solicitação de alvará imediato?</span>
                </div>

                <h:panelGrid columns="1" styleClass="mtop10 mbot10">
                    <fc:protocolo controlador="#{solicitacaoAlvaraImediatoControlador}"
                                  ano="#{solicitacaoAlvaraImediatoControlador.selecionado.anoProtocoloDeferimento}"
                                  numero="#{solicitacaoAlvaraImediatoControlador.selecionado.numeroProtocoloDeferimento}"/>
                </h:panelGrid>

                <div style="text-align: center">
                    <p:commandButton value="Sim"
                                     icon="ui-icon-check"
                                     styleClass="operacao mrig03 mtop10 mbot10"
                                     onclick="aguarde.show()"
                                     oncomplete="aguarde.hide()"
                                     process="@form"
                                     actionListener="#{solicitacaoAlvaraImediatoControlador.deferir()}"/>
                    <p:commandButton value="Não"
                                     icon="ui-icon-cancel"
                                     styleClass="operacao mrig03 mtop10 mbot10"
                                     process="@this"
                                     onclick="dlgDeferimento.hide();"/>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog width="500"
                  header="Rejeição de Solicitação"
                  widgetVar="dlgRejeicao"
                  modal="true"
                  closable="true"
                  resizable="false"
                  dynamic="true"
                  position="center"
                  style="position: center !important;"
                  draggable="false">
            <h:form id="FormularioRejeicao">
                <div class="alert alert-info m-b-sm" style="text-align: center">
                    <span>Tem certeza que deseja rejeitar a solicitação de alvará imediato?</span>
                </div>

                <h:panelGrid columns="1" styleClass="mtop10 mbot10">
                    <fc:outputLabelObrigatorio value="Justificativa"/>
                    <p:inputTextarea value="#{solicitacaoAlvaraImediatoControlador.selecionado.justificativa}"
                                     cols="55"
                                     rows="6"
                                     maxlength="3000"/>

                    <fc:protocolo controlador="#{solicitacaoAlvaraImediatoControlador}"
                                  ano="#{solicitacaoAlvaraImediatoControlador.selecionado.anoProtocolo}"
                                  numero="#{solicitacaoAlvaraImediatoControlador.selecionado.numeroProtocolo}"/>
                </h:panelGrid>

                <div style="text-align: center">
                    <p:commandButton value="Sim"
                                     icon="ui-icon-check"
                                     styleClass="operacao mrig03 mtop10 mbot10"
                                     onclick="aguarde.show()"
                                     oncomplete="aguarde.hide()"
                                     process="@form"
                                     actionListener="#{solicitacaoAlvaraImediatoControlador.rejeitar()}"/>
                    <p:commandButton value="Não"
                                     icon="ui-icon-cancel"
                                     styleClass="operacao mrig03 mtop10 mbot10"
                                     process="@this"
                                     onclick="dlgRejeicao.hide();"/>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog width="500"
                  header="Efetivando Aprovação de Solicitação"
                  widgetVar="dlgEfetivacaoAprovacao"
                  modal="true"
                  closable="false"
                  resizable="false"
                  dynamic="true"
                  position="center"
                  style="position: center !important;"
                  draggable="false">
            <div class="alert alert-info m-b-sm" style="text-align: center">
                <span>Registrando processo de regularização e alvará de construção, por favor aguarde...</span>
                <div class="centralizado">
                    <h:graphicImage value="/img/ajaxloading.gif" styleClass="mtop05"/>
                </div>
            </div>
        </p:dialog>

        <p:dialog width="800"
                  header="Registro de Exigência"
                  widgetVar="dlgExigencia"
                  modal="true"
                  closable="false"
                  resizable="false"
                  dynamic="true"
                  position="center"
                  style="position: center !important;"
                  draggable="false">
            <h:form id="formExigencia">
                <div style="max-height: 400px; overflow: auto; ">
                    <p:panel header="Campo(s) do Formulário">
                        <h:panelGrid columns="2">
                            <fc:outputLabelObrigatorio value="Campo: "/>
                            <p:selectOneMenu
                                value="#{solicitacaoAlvaraImediatoControlador.exigenciaAlvaraImediatoFormularioCampo.formularioCampo}"
                                converter="#{formularioCampoControlador.converterGenerico}"
                                panelStyle="max-height: 250px;max-width: 500px;">
                                <f:selectItems
                                    value="#{solicitacaoAlvaraImediatoControlador.siFormularioCampo}"/>
                            </p:selectOneMenu>

                            <fc:outputLabelObrigatorio value="Justificativa"/>
                            <p:inputTextarea
                                value="#{solicitacaoAlvaraImediatoControlador.exigenciaAlvaraImediatoFormularioCampo.justificativa}"
                                cols="50"
                                rows="4"
                                maxlength="3000"/>
                        </h:panelGrid>

                        <p:commandButton value="Adicionar"
                                         styleClass="mtop10 operacao mbot10"
                                         icon="ui-icon-disk"
                                         onclick="aguarde.show()"
                                         oncomplete="aguarde.hide()"
                                         process="@form"
                                         update="@form"
                                         actionListener="#{solicitacaoAlvaraImediatoControlador.adicionarExigenciaFormularioCampo()}"/>

                        <p:dataTable
                            value="#{solicitacaoAlvaraImediatoControlador.exigenciaAlvaraImediato.campos}"
                            var="exigenciaAlvaraImediatoFormularioCampo"
                            emptyMessage="Nenhum registro encontrado.">
                            <p:column headerText="Ações" style="min-width: 150px; text-align: center;">
                                <p:commandButton icon="ui-icon-pencil"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 process="@this"
                                                 title="Clique para editar este registro."
                                                 update="@form"
                                                 actionListener="#{solicitacaoAlvaraImediatoControlador.editarExigenciaFormularioCampo(exigenciaAlvaraImediatoFormularioCampo)}"/>
                                <p:commandButton icon="ui-icon-trash"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 process="@this"
                                                 title="Clique para remover este registro."
                                                 onclick="if (!confirm('Tem certeza que deseja remover este registro?')) {return false; } else {aguarde.show();}"
                                                 update="@form"
                                                 actionListener="#{requerimentoLicenciamentoETRControlador.removerExigenciaFormularioCampo(exigenciaAlvaraImediatoFormularioCampo)}"/>
                            </p:column>
                            <p:column headerText="Campo" styleClass="alinhamentoEsquerda">
                                #{exigenciaAlvaraImediatoFormularioCampo.formularioCampo.titulo}
                            </p:column>
                            <p:column headerText="Justificativa" styleClass="alinhamentoEsquerda">
                                #{exigenciaAlvaraImediatoFormularioCampo.justificativa}
                            </p:column>
                        </p:dataTable>
                    </p:panel>
                </div>
                <p:commandButton value="Salvar Exigência"
                                 icon="ui-icon-check"
                                 styleClass="operacao mrig03 mtop10"
                                 onclick="aguarde.show()"
                                 oncomplete="aguarde.hide()"
                                 process="@form"
                                 actionListener="#{solicitacaoAlvaraImediatoControlador.salvarExigencia()}"/>
                <p:commandButton value="Cancelar"
                                 icon="ui-icon-cancel"
                                 styleClass="operacao mrig03 mtop10"
                                 process="@this"
                                 onclick="dlgExigencia.hide()"/>

            </h:form>
        </p:dialog>


        <p:dialog width="800"
                  header="Alteração de Desiginação da Solicitação"
                  widgetVar="dlgAlteracaoDesignacao"
                  modal="true"
                  closable="false"
                  resizable="false"
                  dynamic="true"
                  position="center"
                  style="position: center !important;"
                  draggable="false">
            <h:form id="FormularioAlteracaoDesignacao">
                <h:panelGrid columns="2">
                    <fc:outputLabelObrigatorio value="Analista Responsável: "/>
                    <p:autoComplete id="acAnalistaResponsavel"
                                    title="Informe o novo analista responsável."
                                    value="#{solicitacaoAlvaraImediatoControlador.usuarioSistema}"
                                    completeMethod="#{analistaResponsavelAlvaraImediatoControlador.completarAnalistasAtivos}"
                                    converter="#{usuarioSistemaControlador.converterGenerico}"
                                    var="usuario"
                                    itemLabel="#{usuario}"
                                    itemValue="#{usuario.usuarioSistema}"
                                    size="70"
                                    maxResults="10"/>
                </h:panelGrid>

                <p:commandButton value="Salvar"
                                 icon="ui-icon-check"
                                 styleClass="operacao mrig03 mtop10"
                                 title="Clique para salvar o novo analista responsável"
                                 process="@form" update="@form"
                                 onclick="aguarde.show()" oncomplete="aguarde.hide()"
                                 actionListener="#{solicitacaoAlvaraImediatoControlador.alterarDesignacao()}"/>

                <p:commandButton value="Cancelar"
                                 icon="ui-icon-cancel"
                                 styleClass="operacao mrig03 mtop10"
                                 title="Clique para cancelar a alteração do analista responsável"
                                 process="@this" update="@this"
                                 onclick="dlgAlteracaoDesignacao.hide()"/>
            </h:form>
        </p:dialog>

        <p:dialog header="Edição de Observação"
                  widgetVar="dlgObservacao"
                  modal="true"
                  closable="false"
                  resizable="false"
                  dynamic="true"
                  position="center"
                  style="position: center !important;"
                  draggable="false">
            <h:form id="formObservacao">
                <h:panelGrid columns="2">
                    <h:outputLabel value="Observação: "/>
                    <h:panelGrid colcellpadding="0" cellspacing="0">
                        <p:inputTextarea rows="10" cols="100"
                                         value="#{solicitacaoAlvaraImediatoControlador.selecionado.observacao}"
                                         counter="display" maxlength="3000" counterTemplate="{0} caracteres restantes."
                                         autoResize="false"/>
                        <h:outputText id="display"/>
                    </h:panelGrid>
                </h:panelGrid>

                <p:commandButton value="Salvar"
                                 icon="ui-icon-check"
                                 styleClass="operacao mrig03 mtop10"
                                 title="Clique para salvar a edição da observação da solicitação"
                                 process="@form" update="@form"
                                 onclick="aguarde.show()" oncomplete="aguarde.hide()"
                                 actionListener="#{solicitacaoAlvaraImediatoControlador.salvarObservacao()}"/>

                <p:commandButton value="Cancelar"
                                 icon="ui-icon-cancel"
                                 styleClass="operacao mrig03 mtop10"
                                 title="Clique para cancelar a edição da observação da solicitação"
                                 process="@this" update="@this"
                                 onclick="dlgObservacao.hide()"/>
            </h:form>
        </p:dialog>

        <script type="text/javascript">
            var mapa;

            function verInscricao(inscricao) {
                if (mapa === undefined) {
                    mapa = SITGeo_criarMapa('mapa');
                }
                setTimeout(function () {
                    getLote(inscricao);
                    exibeCentraliza(inscricao);
                }, 1000);
            }

            function getLote(inscricao) {
                setTimeout(function (inscricao) {
                    if (mapa.lotes !== undefined) {
                        mapa.lotes.SITGeo_getLote(inscricao);
                    } else {
                        getLote(inscricao);
                    }
                }, 500, inscricao);
            }

            function exibeCentraliza(iq) {
                setTimeout(function (iq) {
                    if (mapa.lotes[iq] !== undefined) {
                        mapa.lotes.SITGeo_exibirLote(true, mapa.lotes[iq]);
                        mapa.lotes.SITGeo_centralizarLote(iq);
                    } else {
                        exibeCentraliza(iq);
                    }
                }, 500, iq);
            }
        </script>
    </ui:define>
</ui:composition>
</html>
