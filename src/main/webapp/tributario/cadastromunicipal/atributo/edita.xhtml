<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui"
>

<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <h:form id="Formulario">
            <p:panel header="Cadastro de Atributo">
                <h:panelGrid columns="2">
                    <fc:outputLabelObrigatorio value="Grupo de Atributo:"/>
                    <fc:autoComplete id="acGrupo" converter="#{grupoAtributoControlador.converterGenerico}"
                                     value="#{atributoControlador.selecionado.grupoAtributo}"
                                     completeMethod="#{grupoAtributoControlador.completarEstaEntidade}"
                                     process="@this" update="@this"/>

                    <h:outputText value="Sequência de apresentação:"/>
                    <p:inputText title="Digite a sequencia de apresentação do atributo"
                                 value="#{atributoControlador.selecionado.sequenciaapresentacao}"
                                 id="sequencia"/>

                    <h:outputText value="Identificador:"/>
                    <p:inputText
                        title="Digite um identificado para o atributo, deve comecar por uma letra e não deve conter espaços em branco"
                        value="#{atributoControlador.selecionado.identificacao}"
                        validator="#{atributoControlador.validaIdentificador}"
                        style="text-transform: lowercase"
                        id="identificacao">
                    </p:inputText>

                    <h:outputText value="Nome:"/>
                    <p:inputText title="Digite o nome do Atributo"
                                 value="#{atributoControlador.selecionado.nome}"
                                 id="Nome" maxlength="70" size="70"/>

                    <h:outputText value="Classe do Atributo:"/>
                    <h:selectOneMenu title="Informe a classe do Atributo"
                                     value="#{atributoControlador.selecionado.classeDoAtributo}"
                                     id="classeDoAtributo">
                        <f:selectItems value="#{atributoControlador.classeDoAtributo}"/>
                    </h:selectOneMenu>

                    <h:outputText value="Tipo Atributo:"/>
                    <h:selectOneMenu title="Informe o tipo do Atributo"
                                     value="#{atributoControlador.selecionado.tipoAtributo}"
                                     id="tipoAtributo">
                        <f:selectItems value="#{atributoControlador.tipoAtributo}"/>
                        <p:ajax event="valueChange"
                                listener="#{atributoControlador.alterouTipoAtributo()}"
                                onstart="aguarde.show()" oncomplete="aguarde.hide()"
                                process="@form" update="@form"/>
                    </h:selectOneMenu>

                    <h:outputText value="Componente Visual:"
                                  rendered="#{atributoControlador.selecionado.tipoAtributo ne 'DISCRETO'}"/>
                    <h:selectOneMenu title="Digite o componente visual do Atributo"
                                     rendered="#{atributoControlador.selecionado.tipoAtributo ne 'DISCRETO'}"
                                     value="#{atributoControlador.selecionado.componenteVisual}"
                                     id="componenteVisual">
                        <f:selectItems value="#{atributoControlador.tipoComponenteVisual}"/>
                    </h:selectOneMenu>

                    <h:outputText value="Obrigatório:"/>
                    <h:selectBooleanCheckbox title="Marque se for obrigatório"
                                             value="#{atributoControlador.selecionado.obrigatorio}"
                                             id="Obrigatorio"/>

                    <h:outputText value="Ativo:"/>
                    <h:selectBooleanCheckbox title="Marque se for ativo"
                                             value="#{atributoControlador.selecionado.ativo}"
                                             id="ativo"/>

                    <h:outputText value="Somente Leitura:"/>
                    <h:selectBooleanCheckbox title="Marque se for somente leitura"
                                             value="#{atributoControlador.selecionado.somenteLeitura}"
                                             id="somenteleitura"/>
                </h:panelGrid>

                <p:panel header="Adicionar Itens Possíveis" styleClass="mtop05"
                         rendered="#{atributoControlador.selecionado.tipoAtributo eq 'DISCRETO'}">
                    <h:panelGrid columns="2">
                        <fc:outputLabelObrigatorio value="Código:"/>
                        <p:inputText title="Digite o valor do Atributo"
                                     value="#{atributoControlador.valorPossivel.codigo}"
                                     id="codigo" maxlength="2" size="10"/>
                        <fc:outputLabelObrigatorio value="Valor:"/>
                        <p:inputText title="Digite o valor do Atributo"
                                     value="#{atributoControlador.valorPossivel.valor}"
                                     id="Valor" maxlength="70" size="70"/>
                        <h:outputText value="Fator:"/>
                        <fc:inputValorMonetario
                            title="Digite o fator referênte ao valor possível."
                            value="#{atributoControlador.valorPossivel.fator}"/>
                    </h:panelGrid>

                    <p:commandButton value="Adicionar"
                                     icon="ui-icon-circle-plus"
                                     styleClass="operacao mbot05"
                                     process="@form" update="@form"
                                     onclick="aguarde.show()" oncomplete="aguarde.hide()"
                                     actionListener="#{atributoControlador.adicionarValorPossivel}"/>

                    <p:dataTable id="tabelaValores" value="#{atributoControlador.valorPossivels}" var="valorPossivel"
                                 emptyMessage="Nenhum valor adicionado.">
                        <p:column headerText="Código" styleClass="alinhamentoEsquerda"
                                  style="width: 10%">
                            <h:outputText value="#{valorPossivel.codigo}"/>
                        </p:column>
                        <p:column headerText="Valor" styleClass="alinhamentoEsquerda">
                            <h:outputText value="#{valorPossivel.valor}"/>
                        </p:column>
                        <p:column headerText="Fator" styleClass="alinhamentoDireita"
                                  style="width: 10%">
                            <h:outputText value="#{valorPossivel.fator}"
                                          converter="javax.faces.BigDecimal"/>
                        </p:column>
                        <p:column styleClass="alinhamentoCentralizado" headerText="Padrão"
                                  style="width: 10%">
                            <p:selectBooleanCheckbox id="valorPadrao"
                                                     title="Selecione para escolher como valor padrão."
                                                     value="#{valorPossivel.valorPadrao}">
                                <f:ajax execute="@this" render="tabelaValores"
                                        listener="#{atributoControlador.validarUnicoValorPadrao(valorPossivel)}"/>
                            </p:selectBooleanCheckbox>
                        </p:column>
                        <p:column headerText="Ações" style="width: 100px; text-align: center">
                            <p:commandButton icon="ui-icon-pencil" title="Editar"
                                             process="@form" update="@form"
                                             styleClass="wp-botao-tabela mrig03"
                                             onclick="aguarde.show()" oncomplete="aguarde.hide()"
                                             actionListener="#{atributoControlador.alterarValorPossivel(valorPossivel)}"/>

                            <p:commandButton icon="ui-icon-trash" title="Remover"
                                             process="@this" update=":Formulario:tabelaValores"
                                             styleClass="wp-botao-tabela mrig03"
                                             onclick="aguarde.show()" oncomplete="aguarde.hide()"
                                             actionListener="#{atributoControlador.removerValorPossivel(valorPossivel)}"/>
                        </p:column>
                    </p:dataTable>
                </p:panel>
            </p:panel>
            <fc:rodapePretty controlador="#{atributoControlador}"/>
            <p:confirmDialog header="Remover Valor Possivel" message="Confirma a exclusão?" widgetVar="dialogRemover">
                <p:commandButton value="Sim" styleClass="operacao"
                                 actionListener="#{atributoControlador.removerValorPossivel}"
                                 update=":Formulario:tabelaValores" oncomplete="dialogRemover.hide()"/>
                <p:commandButton value="Não" styleClass="operacao" onclick="dialogRemover.hide()"/>
            </p:confirmDialog>
        </h:form>
    </ui:define>
</ui:composition>
</html>
