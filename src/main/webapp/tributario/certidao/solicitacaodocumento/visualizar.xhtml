<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">

<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <h:form id="Formulario">
            <p:outputPanel rendered="#{!solicitacaoDoctoOficialControlador.permiteImpressaoUsuario()}">
                <div class="ui-messages-warn ui-corner-all textomedio">
                    <div class="ui-messages-warn-icon  margem-direita-cinco-pixels"/>
                    <h:outputText value="Atenção! " styleClass="ui-messages-warn-summary"/>
                    <h:outputText value="Este usuário não tem permissão para impressão da Guia e Documento"
                                  styleClass="ui-messages-warn-detail"/>
                </div>
            </p:outputPanel>
            <p:panel header="Detalhes da Solicitação de Documento Oficial ">
                <h:panelGrid columns="2">
                    <h:outputText value="Código: " styleClass="negrito"/>
                    <h:outputText value="#{solicitacaoDoctoOficialControlador.selecionado.codigo}" escape="false"/>

                    <h:outputText value="Data da Solicitação: " styleClass="negrito"/>
                    <h:outputText value="#{solicitacaoDoctoOficialControlador.selecionado.dataSolicitacao}"
                                  escape="false">
                        <f:convertDateTime pattern="dd/MM/yyyy hh:mm"/>
                    </h:outputText>

                    <h:outputText value="Tipo de Documento: " styleClass="negrito"/>
                    <h:outputText value="#{solicitacaoDoctoOficialControlador.selecionado.tipoDoctoOficial.descricao}"
                                  escape="false"/>

                    <c:if test="#{solicitacaoDoctoOficialControlador.selecionado.cadastroEconomico ne null}">
                        <h:outputText value="C.M.C.: " styleClass="negrito"/>
                        <h:outputText
                                value="#{solicitacaoDoctoOficialControlador.selecionado.cadastroEconomico.inscricaoCadastral}"/>
                        <h:outputText value="Nome/Razão Social: " styleClass="negrito"/>
                        <h:outputText
                                value="#{solicitacaoDoctoOficialControlador.selecionado.cadastroEconomico.pessoa.nome}"/>
                        <h:outputText value="CPF/CNPJ: " styleClass="negrito"/>
                        <h:outputText
                                value="#{solicitacaoDoctoOficialControlador.selecionado.cadastroEconomico.pessoa.cpf_Cnpj}"/>
                        <h:outputText value="Situação do C.M.C.: " styleClass="negrito"/>
                        <h:outputText
                                value="#{solicitacaoDoctoOficialControlador.situacaoCadastroEconomico.situacaoCadastral.descricao}"/>
                    </c:if>

                    <c:if test="#{solicitacaoDoctoOficialControlador.selecionado.cadastroImobiliario ne null}">
                        <h:outputText value="Cadastro Imobiliário: " styleClass="negrito"/>
                        <h:outputText
                                value="#{solicitacaoDoctoOficialControlador.selecionado.cadastroImobiliario.inscricaoCadastral}"/>
                        <h:outputText value="Logradouro: " styleClass="negrito"/>
                        <h:outputText
                                value="#{solicitacaoDoctoOficialControlador.testada.face.logradouroBairro.logradouro}, #{solicitacaoDoctoOficialControlador.selecionado.cadastroImobiliario.numero}"/>
                        <h:outputText value="Complemento: " styleClass="negrito"/>
                        <h:outputText
                            value="#{solicitacaoDoctoOficialControlador.selecionado.cadastroImobiliario.complementoEndereco}"/>
                        <h:outputText value="Bairro: " styleClass="negrito"/>
                        <h:outputText
                                value="#{solicitacaoDoctoOficialControlador.testada.face.logradouroBairro.bairro.descricao}"/>
                        <h:outputText value="Loteamento: " styleClass="negrito"/>
                        <h:outputText value="#{solicitacaoDoctoOficialControlador.lote.descricaoLoteamento}"/>
                        <h:outputText value="Quadra: " styleClass="negrito"/>
                        <h:outputText value="#{solicitacaoDoctoOficialControlador.lote.quadra.descricao}"/>
                        <h:outputText value="Lote: " styleClass="negrito"/>
                        <h:outputText value="#{solicitacaoDoctoOficialControlador.lote.codigoLote}"/>
                    </c:if>

                    <c:if test="#{solicitacaoDoctoOficialControlador.selecionado.cadastroRural ne null}">
                        <h:outputText value="Cadastro Rural: " styleClass="negrito"/>
                        <h:outputText
                                value="#{solicitacaoDoctoOficialControlador.selecionado.cadastroRural.nomePropriedade}"/>
                        <h:outputText value="Código do Cadastro Rural: " styleClass="negrito"/>
                        <h:outputText value="#{solicitacaoDoctoOficialControlador.selecionado.cadastroRural.codigo}"/>
                        <h:outputText value="Localização: " styleClass="negrito"/>
                        <h:outputText
                                value="#{solicitacaoDoctoOficialControlador.selecionado.cadastroRural.localizacaoLote}"/>
                        <h:outputText value="Área: " styleClass="negrito"/>
                        <h:outputText value="#{solicitacaoDoctoOficialControlador.selecionado.cadastroRural.areaLote}"/>
                        <h:outputText value="Tipo do Lote: " styleClass="negrito"/>
                        <h:outputText
                                value="#{solicitacaoDoctoOficialControlador.selecionado.cadastroRural.tipoAreaRural}"/>
                        <h:outputText value="INCRA: " styleClass="negrito"/>
                        <h:outputText
                                value="#{solicitacaoDoctoOficialControlador.selecionado.cadastroRural.numeroIncra}"/>
                    </c:if>

                    <c:if test="#{solicitacaoDoctoOficialControlador.selecionado.pessoaFisica ne null}">
                        <h:outputText value="Pessoa Física: " styleClass="negrito"/>
                        <h:outputText value="#{solicitacaoDoctoOficialControlador.selecionado.pessoaFisica.nome}"/>
                        <h:outputText value="CPF: " styleClass="negrito"/>
                        <h:outputText value="#{solicitacaoDoctoOficialControlador.selecionado.pessoaFisica.cpf}"/>
                    </c:if>

                    <c:if test="#{solicitacaoDoctoOficialControlador.selecionado.pessoaJuridica ne null}">
                        <h:outputText value="Pessoa Jurídica: " styleClass="negrito"/>
                        <h:outputText
                                value="#{solicitacaoDoctoOficialControlador.selecionado.pessoaJuridica.nomeFantasia}"/>
                        <h:outputText value="CNPJ: " styleClass="negrito"/>
                        <h:outputText value="#{solicitacaoDoctoOficialControlador.selecionado.pessoaJuridica.cnpj}"/>
                    </c:if>

                    <h:outputText value="Finalidade: " styleClass="negrito"/>
                    <h:outputText value="#{solicitacaoDoctoOficialControlador.selecionado.finalidade.descricao}"
                                  escape="false"/>

                    <h:outputText value="Valor da Taxa de Emissão: " styleClass="negrito"/>
                    <h:outputText value="#{solicitacaoDoctoOficialControlador.selecionado.tipoDoctoOficial.valor}"
                                  escape="false">
                        <f:convertNumber pattern="R$ #,##0.00"/>
                    </h:outputText>

                    <h:outputText value="Situação da Solicitação: " styleClass="negrito" />
                    <h:outputText value="#{solicitacaoDoctoOficialControlador.selecionado.situacaoSolicitacao.descricao}"
                                  escape="false"/>

                    <h:outputText value="Usuário da Emissão: " styleClass="negrito" />
                    <h:outputText value="#{solicitacaoDoctoOficialControlador.selecionado.documentoOficial.usuarioSistema.login}"
                                  escape="false"/>

                    <c:if test="#{solicitacaoDoctoOficialControlador.selecionado.cadastroImobiliario ne null}">
                        <h:outputText value="Proprietário(s): " styleClass="negrito"/>
                        <ui:repeat var="prop" value="#{solicitacaoDoctoOficialControlador.propriedades}">
                            <h:outputText value="#{prop.pessoa.nome} #{prop.pessoa.cpf_Cnpj}"/><br/>
                        </ui:repeat>
                    </c:if>

                    <c:if test="#{solicitacaoDoctoOficialControlador.selecionado.cadastroRural ne null}">
                        <h:outputText value="Proprietário(s): " styleClass="negrito"/>
                        <ui:repeat var="prop" value="#{solicitacaoDoctoOficialControlador.propriedades}">
                            <h:outputText value="#{prop.pessoa.nome} #{prop.pessoa.cpf_Cnpj}"/><br/>
                        </ui:repeat>
                    </c:if>
                </h:panelGrid>
                <br/>
                <p:dataTable id="listAtributos" style="text-align: center;" emptyMessage="Nenhum atributo encontrado"
                             value="#{solicitacaoDoctoOficialControlador.valorAtributoSolicitacoes}" var="att">
                    <f:facet name="header">
                        <h:outputText value="Atributos"/>
                    </f:facet>
                    <p:column headerText="Campo">
                        <h:outputText value="#{att.atributoDoctoOficial.campo}"/>
                    </p:column>
                    <p:column headerText="Conteúdo">
                        <h:outputText value="#{att.valor}"/>
                    </p:column>
                </p:dataTable>
            </p:panel>
            <br/>

            <div align="left">
                <h:commandLink target="_blank" actionListener="#{solicitacaoDoctoOficialControlador.imprimeDam}"
                               disabled="#{!solicitacaoDoctoOficialControlador.habilitaImpressaoDAM() or !solicitacaoDoctoOficialControlador.permiteImpressaoUsuario()}">
                    <p:commandButton ajax="false" styleClass="operacao" id="imprimirDAM" value="Imprimir DAM"
                                     icon="ui-icon-print"
                                     disabled="#{!solicitacaoDoctoOficialControlador.habilitaImpressaoDAM() or !solicitacaoDoctoOficialControlador.permiteImpressaoUsuario()}"/>
                </h:commandLink>
                <fc:botaoTargetBlank actionListener="#{solicitacaoDoctoOficialControlador.gerarDocumento()}"
                                     label="Imprimir Documento"
                                     disabled="#{solicitacaoDoctoOficialControlador.desabilitarImpressaoCertidao()}"
                                     styleClass="prioritario operacao"
                                     imprimeNoDialog="true"/>

                <p:commandButton
                    value="Enviar Documento por e-mail"
                    icon="ui-icon-mail-closed"
                    onclick="aguarde.show(); "
                    update=":formEmails"
                    disabled="#{solicitacaoDoctoOficialControlador.desabilitarImpressaoCertidao()}"
                    actionListener="#{solicitacaoDoctoOficialControlador.prepararImpressaoParaEnvio()}"
                    oncomplete="aguarde.hide()"
                    styleClass="operacao"/>

                <p:commandButton ajax="false" value="Voltar" icon="ui-icon-cancel"
                                 actionListener="#{solicitacaoDoctoOficialControlador.cancelar()}"
                                 styleClass="operacao"/>
            </div>
            <fc:aguarde widgetVar="aguarde" gif="/img/ajaxloadingbar.gif"/>
        </h:form>
        <br/>
        <p:outputPanel rendered="#{!solicitacaoDoctoOficialControlador.permiteImpressaoUsuario()}">
            <div class="ui-messages-warn ui-corner-all textomedio">
                <div class="ui-messages-warn-icon  margem-direita-cinco-pixels"/>
                <h:outputText value="Atenção! " styleClass="ui-messages-warn-summary"/>
                <h:outputText value="Este usuário não tem permissão para impressão da Guia e Documento"
                              styleClass="ui-messages-warn-detail"/>
            </div>
        </p:outputPanel>
        <p:dataTable id="tabelaConsultas"
                     style="width: 100% !important"
                     var="parcela" rendered="#{solicitacaoDoctoOficialControlador.resultadoConsulta.size() > 0}"
                     rowStyleClass="#{parcela.situacaoDescricaoEnum eq 'Em Aberto'? parcela.vencimento lt programacaoCobrancaControlador.dataOperacao? 'vermelho': 'verde': ''}"
                     emptyMessage="Nenhuma parcela encontrada"
                     value="#{solicitacaoDoctoOficialControlador.resultadoConsulta}">
            <f:facet name="header">
                <p:outputPanel>
                    <h:outputText value="Parcelas da Certidão"/>
                </p:outputPanel>
            </f:facet>
            <p:column headerText="Cadastro" style="width: 8%;">
                <h:outputText value="#{parcela.cadastro}"/>
            </p:column>
            <p:column headerText="Dívida" style="width: 12%;">
                <h:outputText value="#{parcela.divida}"/>
            </p:column>
            <p:column headerText="Exercício" style="width: 5%; text-align: center;"
                      sortBy="#{parcela.exercicio}" filterMatchMode="contains">
                <h:outputText value="#{parcela.exercicio}"/>
            </p:column>
            <p:column headerText="Tipo de Débito" style="width: 5%;">
                <h:outputText value="#{parcela.tipoDeDebito}"/>
            </p:column>
            <p:column headerText="Parcela" style="width: 2%; text-align: center;"
                      sortBy="#{parcela.parcela}" filterMatchMode="contains">
                <h:outputText value="#{parcela.parcela}"/>
            </p:column>
            <p:column headerText="SD" style="width: 2%; text-align: center;">
                <h:outputText value="#{parcela.sd}"/>
            </p:column>
            <p:column headerText="Vencimento" style="width: 5%; text-align: center;"
                      sortBy="#{parcela.vencimentoToString}" filterMatchMode="contains">
                <h:outputText value="#{parcela.vencimentoToString}"/>
            </p:column>
            <p:column headerText="Imposto" style="text-align: right">
                <h:outputText value="#{parcela.valorImposto}">
                    <f:convertNumber pattern="###,##0.00"/>
                </h:outputText>

            </p:column>
            <p:column headerText="Taxa" style="text-align: right">
                <h:outputText value="#{parcela.valorTaxa}">
                    <f:convertNumber pattern="###,##0.00"/>
                </h:outputText>

            </p:column>
            <p:column headerText="Desconto" style="text-align: right">
                <h:outputText value="#{parcela.valorDesconto}">
                    <f:convertNumber pattern="###,##0.00"/>
                </h:outputText>

            </p:column>
            <p:column headerText="Juros" style="text-align: right">
                <h:outputText value="#{parcela.valorJuros}">
                    <f:convertNumber pattern="###,##0.00"/>
                </h:outputText>

            </p:column>
            <p:column headerText="Multa" style="text-align: right">
                <h:outputText value="#{parcela.valorMulta}">
                    <f:convertNumber pattern="###,##0.00"/>
                </h:outputText>

            </p:column>
            <p:column headerText="Honorários" style="text-align: right">
                <h:outputText value="#{parcela.valorHonorarios}">
                    <f:convertNumber pattern="###,##0.00"/>
                </h:outputText>

            </p:column>
            <p:column headerText="Total" style="text-align: right">
                <h:outputText value="#{parcela.valorTotal}">
                    <f:convertNumber pattern="###,##0.00"/>
                </h:outputText>

            </p:column>
            <p:column headerText="Situação">
                <h:outputText value="#{parcela.situacaoDescricaoEnum}" title="cod. ${parcela.idParcela}"/>
            </p:column>
        </p:dataTable>

        <p:dialog header="Enviar e-mail com o Documento em anexo"
                  modal="true"
                  dynamic="true"
                  position="center"
                  style="position: fixed !important;"
                  resizable="false"
                  widgetVar="listaEmails">
            <h:form id="formEmails">

                <div class="alert warn">
                    Por favor digite os e-mails de envio separados por (",")
                </div>
                <h:panelGrid columns="2" styleClass="mtop10">
                    <fc:outputLabelObrigatorio value="E-mail(s):" for="emails"/>
                    <p:inputTextarea id="emails" value="#{solicitacaoDoctoOficialControlador.emails}" rows="1" cols="70"
                                     maxlength="255"/>
                    <fc:outputLabelObrigatorio value="Mensagem:" for="mensagem"/>
                    <h:panelGrid columns="2" cellpadding="0" cellspacing="0">
                        <p:inputTextarea title="Informe a mensagem do e-mail."
                                         value="#{solicitacaoDoctoOficialControlador.mensagemEmail}"
                                         rows="4"
                                         cols="70"
                                         id="mensagem"
                                         maxlength="255"
                                         counter="counterMensagem"
                                         counterTemplate="{0} Caracteres restantes."
                                         autoResize="true"/>
                        <h:outputText id="counterMensagem"
                                      styleClass="mlef05"/>
                    </h:panelGrid>
                </h:panelGrid>
                <p:separator/>
                <div style="width: 100%; text-align: center">
                    <p:commandButton
                        value="Enviar Documento"
                        icon="ui-icon-arrowreturnthick-1-n"
                        onclick="aguarde.show()"
                        onsuccess="aguarde.hide()"
                        process="@form"
                        update=":Formulario"
                        actionListener="#{solicitacaoDoctoOficialControlador.enviarDocumentoPorEmail()}"
                        styleClass="operacao"/>

                    <p:commandButton
                        value="Cancelar"
                        icon="ui-icon-cancel"
                        onclick="listaEmails.hide()"
                        styleClass="operacao"/>
                </div>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>
