<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui">
<ui:composition template="/corpo.xhtml">
<ui:define name="body">
<h:form id="Formulario">
<p:panel header="Alterações da Nota Fiscalo Avulsa">
<p:panel header="Dados da Alteração">
    <h:panelGrid columns="2">
        <h:outputLabel value="Data: "/>
        <p:calendar value="#{alteracaoNFSAvulsaControlador.selecionado.dataAlteracao}"
                    styleClass="negrito"
                    pattern="dd/MM/yyyy hh:mm"
                    disabled="true"/>
        <h:outputLabel value="Alterado por: "/>
        <p:inputText value="#{alteracaoNFSAvulsaControlador.notaFiscalAlterada.usuario.login}"
                     size="60"
                     styleClass="negrito"
                     readonly="true"/>
        <h:outputLabel value="Motivo: "/>
        <p:inputTextarea value="#{alteracaoNFSAvulsaControlador.selecionado.motivo}"
                         styleClass="negrito"
                         readonly="true"
                         rows="4"
                         cols="50"/>
    </h:panelGrid>
</p:panel>
<br/>
<h:panelGrid id="gridAlteracoes" columns="2" columnClasses="c1, c1" style="width:100%">
<h:panelGroup id="groupNotaAntiga">
    <p:panel id="painelDadosNFS"
             header="Dados da Nota Fiscal Antiga">
        <p:panel id="panelNFS">
            <h:panelGrid columns="2">
                <h:outputText value="Número: "/>
                <h:outputText
                        value="#{alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.numero}"
                        styleClass="azulnegrito"/>
                <h:outputText value="Exercício: "/>
                <h:outputText
                        value="#{alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.exercicio.ano}"
                        styleClass="azulnegrito"/>
                <h:outputText value="Situação: "/>
                <h:outputText
                        value="#{alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.situacao.descricao}"
                        styleClass="azulnegrito"/>
                <h:outputText value="Usuário da Emissão: "/>
                <h:outputText
                        value="#{alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.usuario.nome}"
                        styleClass="azulnegrito"/>
                <h:outputText value="Alíquota do ISS: "/>
                <h:panelGrid columns="2">
                    <h:outputText
                            value="#{alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.valorIss}"
                            id="valorISS" styleClass="azulnegrito">
                        <f:convertNumber pattern="#,##0.00"/>
                    </h:outputText>
                    <h:outputText
                            value="(%)"
                            styleClass="azulnegrito"/>
                </h:panelGrid>
                <h:outputText value="Data de Emissão: "/>
                <h:outputText styleClass="azulnegrito"
                              value="#{alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.emissao}">
                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                </h:outputText>
                <h:outputText value="Data da Nota Fiscal: "/>
                <h:outputText
                        value="#{alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.dataNota}"
                        styleClass="azulnegrito">
                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                </h:outputText>
            </h:panelGrid>
        </p:panel>
        <br/>
        <p:panel header="Prestador de Serviços" id="panelPrestador">
            <h:panelGrid columns="2">
                <h:outputText value="Nome ou Razão Social:"/>
                <h:outputText id="pessoaprestador"
                              styleClass="azulnegrito"
                              value="#{alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.prestador ne null ? alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.prestador.nome : alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.cmcPrestador.pessoa.nome}"/>
                <h:outputText value="CPF/CNPJ"/>
                <h:outputText id="pessoaprestador_cpfcnpj"
                              value="#{alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.prestador ne null ? alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.prestador.cpf_Cnpj : alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.cmcPrestador.pessoa.nome}"
                              styleClass="azulnegrito"/>
                <h:outputText value="C.M.C.:"/>
                <h:outputText styleClass="azulnegrito"
                              value="#{alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.cmcPrestador}"/>
                <h:outputText value="Endereço:"/>
                <h:outputText
                        value="#{alteracaoNFSAvulsaControlador.enderecoPrestadorNotaAntiga}"
                        styleClass="azulnegrito"/>
            </h:panelGrid>
            <p:messages showDetail="true" showSummary="true" id="testando"/>
        </p:panel>
        <br/>
        <p:panel header="Tomador de Serviços" id="panelTomador">
            <h:panelGrid columns="2">
                <h:outputText value="Nome ou Razão Social:"/>
                <h:outputText styleClass="azulnegrito"
                              value="#{alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.tomador ne null? alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.tomador.nome : alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.cmcTomador.pessoa.nome}"/>
                <h:outputText value="CPF/CNPJ"/>
                <h:outputText styleClass="azulnegrito"
                              value="#{alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.tomador ne null ? alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.tomador.cpf_Cnpj : alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.cmcTomador.pessoa.nome}"/>
                <h:outputText value="C.M.C.:"/>
                <h:outputText styleClass="azulnegrito"
                              value="#{alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.cmcTomador}"/>
                <h:outputText value="Endereço:"/>
                <h:outputText styleClass="azulnegrito"
                              value="#{alteracaoNFSAvulsaControlador.enderecoTomadorNotaAntiga}"/>
            </h:panelGrid>
        </p:panel>
        <br/>
        <p:dataTable id="tabela"
                     value="#{alteracaoNFSAvulsaControlador.selecionado.NFSAvulsa.itens}"
                     var="item"
                     emptyMessage="Nenhum item adicionado a essa nota">
            <f:facet name="header">
                <h:outputText value="Dados dos Serviços Prestados"/>
            </f:facet>

            <p:column headerText="Qtde" style="width: 5%; text-align: right">
                <h:outputText value="#{item.quantidade}"/>
            </p:column>
            <p:column headerText="UND" style="width: 5%; text-align: left">
                <h:outputText value="#{item.unidade}"/>
            </p:column>
            <p:column headerText="Discriminação" style="width: 40%">
                <h:outputText value="#{item.descricao}"/><br/>
                <h:outputText value="Para o veículo placa #{item.placa}"
                              rendered="#{alteracaoNFSAvulsaControlador.liberaPlacaNotaAntiga() and !item.placa.isEmpty()}"/>
            </p:column>
            <p:column headerText="Valor Unitário" style="text-align: right">
                <h:outputText value="#{item.valorUnitario}">
                    <f:convertNumber pattern="#,##0.00"/>
                </h:outputText>
                <f:facet name="footer">
                    <h:outputText value="#{alteracaoNFSAvulsaControlador.totalUnitarioNotaAntiga}">
                        <f:convertNumber pattern="#,##0.00"/>
                    </h:outputText>
                </f:facet>
            </p:column>
            <p:column headerText="Valor Total (R$)" style="text-align: right">
                <h:outputText value="#{item.valorTotal}">
                    <f:convertNumber pattern="#,##0.00"/>
                </h:outputText>
                <f:facet name="footer">
                    <h:outputText value="#{alteracaoNFSAvulsaControlador.totalParcialNotaAntiga}">
                        <f:convertNumber pattern="#,##0.00"/>
                    </h:outputText>
                </f:facet>
            </p:column>
            <p:column headerText="% ISS" style="text-align: right">
                <h:outputText value="#{item.aliquotaIss}">
                    <f:convertNumber pattern="#,##0.00"/>
                </h:outputText>
            </p:column>
            <p:column headerText="Valor do ISS (R$)" style="text-align: right">
                <h:outputText value="#{item.valorIss}">
                    <f:convertNumber pattern="#,##0.00"/>
                </h:outputText>
                <f:facet name="footer">
                    <h:outputText value="#{alteracaoNFSAvulsaControlador.totalIssNotaAntiga}">
                        <f:convertNumber pattern="#,##0.00"/>
                    </h:outputText>
                </f:facet>
            </p:column>
            <f:facet name="footer">
            </f:facet>
        </p:dataTable>
    </p:panel>
</h:panelGroup>
<h:panelGroup id="groupNotaAlterada">
    <p:panel id="painelDadosNFSAlterada"
             style="float: right"
             header="Dados da Nota Fiscal Alterada">
        <p:panel id="panelNFSAlterada">
            <h:panelGrid columns="2">
                <h:outputText value="Número: "/>
                <h:outputText
                        value="#{alteracaoNFSAvulsaControlador.notaFiscalAlterada.numero}"
                        styleClass="azulnegrito"/>
                <h:outputText value="Exercício: "/>
                <h:outputText
                        value="#{alteracaoNFSAvulsaControlador.notaFiscalAlterada.exercicio.ano}"
                        styleClass="azulnegrito"/>
                <h:outputText value="Situação: "/>
                <h:outputText
                        value="#{alteracaoNFSAvulsaControlador.notaFiscalAlterada.situacao.descricao}"
                        styleClass="azulnegrito"/>
                <h:outputText value="Usuário da Emissão: "/>
                <h:outputText
                        value="#{alteracaoNFSAvulsaControlador.notaFiscalAlterada.usuario.nome}"
                        styleClass="azulnegrito"/>
                <h:outputText value="Alíquota do ISS: "/>
                <h:panelGrid columns="2">
                    <h:outputText
                            value="#{alteracaoNFSAvulsaControlador.notaFiscalAlterada.valorIss}"
                            styleClass="azulnegrito">
                        <f:convertNumber pattern="#,##0.00"/>
                    </h:outputText>
                    <h:outputText
                            value="(%)"
                            styleClass="azulnegrito"/>
                </h:panelGrid>
                <h:outputText value="Data de Emissão: "/>
                <h:outputText styleClass="azulnegrito"
                              value="#{alteracaoNFSAvulsaControlador.notaFiscalAlterada.emissao}">
                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                </h:outputText>
                <h:outputText value="Data da Nota Fiscal: "/>
                <h:outputText
                        value="#{alteracaoNFSAvulsaControlador.notaFiscalAlterada.dataNota}"
                        styleClass="azulnegrito">
                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                </h:outputText>
            </h:panelGrid>
        </p:panel>
        <br/>
        <p:panel header="Prestador de Serviços" id="panelPrestadorNotaAlterada">
            <h:panelGrid columns="2">
                <h:outputText value="Nome ou Razão Social:"/>
                <h:outputText styleClass="azulnegrito"
                              value="#{alteracaoNFSAvulsaControlador.notaFiscalAlterada.prestador ne null ? alteracaoNFSAvulsaControlador.notaFiscalAlterada.prestador.nome : alteracaoNFSAvulsaControlador.notaFiscalAlterada.cmcPrestador.pessoa.nome}"/>
                <h:outputText value="CPF/CNPJ"/>
                <h:outputText value="#{alteracaoNFSAvulsaControlador.notaFiscalAlterada.prestador ne null ? alteracaoNFSAvulsaControlador.notaFiscalAlterada.prestador.cpf_Cnpj : alteracaoNFSAvulsaControlador.notaFiscalAlterada.cmcPrestador.pessoa.cpf_Cnpj}"
                              styleClass="azulnegrito"/>
                <h:outputText value="C.M.C.:"/>
                <h:outputText styleClass="azulnegrito"
                              value="#{alteracaoNFSAvulsaControlador.notaFiscalAlterada.cmcPrestador}"/>
                <h:outputText value="Endereço:"/>
                <h:outputText
                        value="#{alteracaoNFSAvulsaControlador.enderecoPrestadorNotaAlterada}"
                        styleClass="azulnegrito"/>
            </h:panelGrid>
        </p:panel>
        <br/>
        <p:panel header="Tomador de Serviços" id="panelTomadorNotaAlterada">
            <h:panelGrid columns="2">
                <h:outputText value="Nome ou Razão Social:"/>
                <h:outputText styleClass="azulnegrito"
                              value="#{alteracaoNFSAvulsaControlador.notaFiscalAlterada.tomador ne null ? alteracaoNFSAvulsaControlador.notaFiscalAlterada.tomador.nome : alteracaoNFSAvulsaControlador.notaFiscalAlterada.cmcTomador.pessoa.nome}"/>
                <h:outputText value="CPF/CNPJ"/>
                <h:outputText styleClass="azulnegrito"
                              value="#{alteracaoNFSAvulsaControlador.notaFiscalAlterada.tomador ne null ? alteracaoNFSAvulsaControlador.notaFiscalAlterada.tomador.cpf_Cnpj : alteracaoNFSAvulsaControlador.notaFiscalAlterada.cmcTomador.pessoa.nome}"/>
                <h:outputText value="C.M.C.:"/>
                <h:outputText styleClass="azulnegrito"
                              value="#{alteracaoNFSAvulsaControlador.notaFiscalAlterada.cmcTomador}"/>
                <h:outputText value="Endereço:"/>
                <h:outputText styleClass="azulnegrito"
                              value="#{alteracaoNFSAvulsaControlador.enderecoTomadorNotaAlterada}"/>
            </h:panelGrid>
        </p:panel>
        <br/>
        <p:dataTable id="tabelaNotaAlterada"
                     value="#{alteracaoNFSAvulsaControlador.notaFiscalAlterada.itens}"
                     var="item"
                     emptyMessage="Nenhum item adicionado a essa nota">
            <f:facet name="header">
                <h:outputText value="Dados dos Serviços Prestados"/>
            </f:facet>

            <p:column headerText="Qtde" style="width: 5%; text-align: right">
                <h:outputText value="#{item.quantidade}"/>
            </p:column>
            <p:column headerText="UND" style="width: 5%; text-align: left">
                <h:outputText value="#{item.unidade}"/>
            </p:column>
            <p:column headerText="Discriminação" style="width: 40%">
                <h:outputText value="#{item.descricao}"/><br/>
                <h:outputText value="Para o veículo placa #{item.placa}"
                              rendered="#{alteracaoNFSAvulsaControlador.liberaPlacaNotaAlterada() and !item.placa.isEmpty()}"/>
            </p:column>
            <p:column headerText="Valor Unitário" style="text-align: right">
                <h:outputText value="#{item.valorUnitario}">
                    <f:convertNumber pattern="#,##0.00"/>
                </h:outputText>
                <f:facet name="footer">
                    <h:outputText value="#{alteracaoNFSAvulsaControlador.totalUnitarioNotaAlterada}">
                        <f:convertNumber pattern="#,##0.00"/>
                    </h:outputText>
                </f:facet>
            </p:column>
            <p:column headerText="Valor Total (R$)" style="text-align: right">
                <h:outputText value="#{item.valorTotal}">
                    <f:convertNumber pattern="#,##0.00"/>
                </h:outputText>
                <f:facet name="footer">
                    <h:outputText value="#{alteracaoNFSAvulsaControlador.totalParcialNotaAlterada}">
                        <f:convertNumber pattern="#,##0.00"/>
                    </h:outputText>
                </f:facet>
            </p:column>
            <p:column headerText="% ISS" style="text-align: right">
                <h:outputText value="#{item.aliquotaIss}">
                    <f:convertNumber pattern="#,##0.00"/>
                </h:outputText>
            </p:column>
            <p:column headerText="Valor do ISS (R$)" style="text-align: right">
                <h:outputText value="#{item.valorIss}">
                    <f:convertNumber pattern="#,##0.00"/>
                </h:outputText>
                <f:facet name="footer">
                    <h:outputText value="#{alteracaoNFSAvulsaControlador.totalIssNotaAlterada}">
                        <f:convertNumber pattern="#,##0.00"/>
                    </h:outputText>
                </f:facet>
            </p:column>
            <f:facet name="footer">
            </f:facet>
        </p:dataTable>
    </p:panel>
</h:panelGroup>
</h:panelGrid>
</p:panel>
<h:panelGrid columns="2">
    <p:commandButton value="Fechar"
                     id="cbCancelar"
                     styleClass="mtop10"
                     style="width: 100px; height: 40px"
                     icon="ui-icon-cancel"
                     title="Clique para cancelar e retornar a página anterior"
                     actionListener="#{alteracaoNFSAvulsaControlador.cancelar()}"/>
    <fc:botaoTargetBlank actionListener="#{alteracaoNFSAvulsaControlador.emitirNota()}"
                         disabled="#{!alteracaoNFSAvulsaControlador.liberaImpressao()}"
                         styleClass="mtop10 mrig05 prioritario"
                         style="width: 100px; height: 40px"
                         icon="ui-icon-print"   imprimeNoDialog="true"
                         label="Emitir Nota Alterada"/>

</h:panelGrid>
</h:form>
</ui:define>
</ui:composition>

</html>
