<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui">
    <ui:composition template="/corpo.xhtml">
        <ui:define name="body">
            <h:form id="fomularioVisualizar">
                <fc:cabecalhoPretty origem="#{vistoriaControlador.caminhoPadrao}listar/"
                                    mostrarBotaoNovo="${false}"
                                    auditavel="${true}"
                                    controlador="#{vistoriaControlador}"/>
                <p:panel header="Detalhes da Vistoria">
                    <div style="position: relative; left: 85%; width: 200px;">
                        <h:outputText value="Sistuação da Vistoria: "/>
                        <h:outputText value="#{vistoriaControlador.selecionado.statusVistoria}" styleClass="negrito"/>
                    </div>
                    <br/>
                    <p:panel header="Alvará">
                        <h:panelGrid columns="6">
                            <h:outputText value="Exercício: "/>
                            <h:outputText value="#{vistoriaControlador.selecionado.alvara.exercicio}" styleClass="negrito"/>

                            <h:outputText value="Início de Vigência: " style="margin-left: 10px;"/>
                            <h:outputText value="#{vistoriaControlador.selecionado.alvara.inicioVigencia}"
                                          styleClass="negrito">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>

                            <h:outputText value="Vencimento: " style="margin-left: 10px;"/>
                            <h:outputText value="#{vistoriaControlador.selecionado.alvara.vencimento}" styleClass="negrito">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </h:panelGrid>
                        <p:separator/>
                        <p:outputPanel id="panelJuridica" style="border: 0"
                                       rendered="#{vistoriaControlador.pessoaJuridica eq true}">
                            <h:panelGrid columns="2">
                                <h:outputText value="Razão Social: "/>
                                <h:outputText id="razaosocial"
                                              value="#{vistoriaControlador.cadastroEconomico.pessoa.razaoSocial}"
                                              styleClass="negrito"/>
                                <h:outputText value="Nome Reduzido: "/>
                                <h:outputText id="nomereduzido"
                                              value="#{vistoriaControlador.cadastroEconomico.pessoa.nomeReduzido}"
                                              styleClass="negrito"/>
                                <h:outputText value="Nome Fantasia: "/>
                                <h:outputText id="nomefantasia"
                                              value="#{vistoriaControlador.cadastroEconomico.pessoa.nomeFantasia}"
                                              styleClass="negrito"/>
                                <h:outputText value="CNPJ: "/>
                                <h:outputText id="cnpj" value="#{vistoriaControlador.cadastroEconomico.pessoa.cpf_Cnpj}"
                                              styleClass="negrito"/>
                                <h:outputText value="Inscrição Estadual: "/>
                                <h:outputText id="inscestadual"
                                              value="#{vistoriaControlador.cadastroEconomico.pessoa.inscricaoEstadual}"
                                              styleClass="negrito"/>
                                <h:outputText value="E-mail: "/>
                                <h:outputText id="email" value="#{vistoriaControlador.cadastroEconomico.pessoa.email}"
                                              styleClass="negrito"/>
                                <h:outputText value="Classificação da Atividade: "/>
                                <h:outputText id="classificacao"
                                              value="#{vistoriaControlador.cadastroEconomico.classificacaoAtividade.descricao}"
                                              styleClass="negrito"/>
                                <h:outputText value="Área de Utilização: "/>
                                <h:outputText id="utilizacao"
                                              value="#{vistoriaControlador.cadastroEconomico.areaUtilizacao}"
                                              styleClass="negrito">
                                    <f:convertNumber pattern="#,##0.00 m²"/>
                                </h:outputText>
                                <h:outputText value="Data de Abertura: "/>
                                <h:outputText id="abertura" value="#{vistoriaControlador.cadastroEconomico.abertura}"
                                              styleClass="negrito">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </h:panelGrid>
                        </p:outputPanel>
                        <p:outputPanel id="panelFisica" style="border: 0" rendered="#{vistoriaControlador.pessoaFisica eq true}">
                            <h:panelGrid columns="2">
                                <h:outputText value="Nome: "/>
                                <h:outputText id="nome" value="#{vistoriaControlador.cadastroEconomico.pessoa.nome}"
                                              styleClass="negrito"/>
                                <h:outputText value="CPF: "/>
                                <h:outputText id="cpf" value="#{vistoriaControlador.cadastroEconomico.pessoa.cpf_Cnpj}"
                                              styleClass="negrito"/>
                                <h:outputText value="RG: "/>
                                <h:outputText id="rg" value="#{vistoriaControlador.cadastroEconomico.pessoa.cpf}"
                                              styleClass="negrito"/>
                                <h:outputText value="E-mail: "/>
                                <h:outputText id="emailf" value="#{vistoriaControlador.cadastroEconomico.pessoa.email}"
                                              styleClass="negrito"/>
                                <h:outputText value="Classificação da Atividade: "/>
                                <h:outputText id="classificacaof"
                                              value="#{vistoriaControlador.cadastroEconomico.classificacaoAtividade.descricao}"
                                              styleClass="negrito"/>
                                <h:outputText value="Área de Utilização: "/>
                                <h:outputText id="utilizacaof"
                                              value="#{vistoriaControlador.cadastroEconomico.areaUtilizacao}"
                                              styleClass="negrito">
                                    <f:convertNumber pattern="#,##0.00 m²"/>
                                </h:outputText>
                                <h:outputText value="Data de Abertura: "/>
                                <h:outputText id="aberturaf" value="#{vistoriaControlador.cadastroEconomico.abertura}"
                                              styleClass="negrito">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </h:panelGrid>
                        </p:outputPanel>
                    </p:panel>
                    <br/>
                    <p:dataTable value="#{vistoriaControlador.selecionado.cnaes}"
                                 var="cnae"
                                 id="tabelaCNAEs"
                                 emptyMessage="Nenhum CNAE encontrado para o C.M.C. selecionado">
                        <f:facet name="header">
                            <h:outputText value="CNAE's do Alvará"/>
                        </f:facet>
                        <p:column headerText="Código CNAE">
                            <h:outputText value="#{cnae.cnae.codigoCnae}"/>
                        </p:column>
                        <p:column headerText="Descrição Detalhada">
                            <h:outputText value="#{cnae.cnae.descricaoDetalhada}"/>
                        </p:column>
                        <p:column headerText="Embargado" style="text-align: center; width: 100px">
                            <h:outputText value="#{cnae.cnae.grauDeRisco eq 'ALTO' ? 'Sim' : 'Não'}"/>
                        </p:column>
                    </p:dataTable>
                    <br/>
                    <h:panelGrid columns="2">
                        <h:outputText value="Tipo de Alvará: "/>
                        <h:outputText value="#{vistoriaControlador.selecionado.tipoAlvara.descricao}" styleClass="negrito"/>

                        <h:outputText value="Sequência: "/>
                        <h:outputText value="#{vistoriaControlador.selecionado.sequencia}" styleClass="negrito"/>

                        <h:outputText value="Data: "/>
                        <h:outputText value="#{vistoriaControlador.selecionado.data}" styleClass="negrito">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>

                        <h:outputText value="Nº do Protocolo: "/>
                        <h:outputText value="#{vistoriaControlador.selecionado.numeroProtocolo}" styleClass="negrito"/>
                    </h:panelGrid>
                    <br/>
                    <p:dataTable id="tabelaIrregularidade" value="#{vistoriaControlador.selecionado.listaIrregularidade}"
                                 var="item">
                        <f:facet name="header">
                            <h:outputText value="Lista de Irregularidades"/>
                        </f:facet>
                        <p:column headerText="Irregularidade" style="width: 50%;">
                            <h:outputText value="#{item.irregularidade.descricao}"/>
                        </p:column>
                        <p:column headerText="Observação" style="text-align: center; width: 50%;">
                            <p:inputTextarea value="#{item.observacao}"
                                             style="width: 600px; height: 50px; overflow-y: scroll;"
                                             readonly="true"/>
                        </p:column>
                    </p:dataTable>
                    <br/>
                    <p:dataTable id="tabelaParecer"
                                 value="#{vistoriaControlador.selecionado.pareceres}" var="parecer"
                                 emptyMessage="Nenhum parecer informado.">
                        <f:facet name="header">
                            <h:outputLabel value="Pareceres Informados"/>
                        </f:facet>
                        <p:column headerText="Data" style="width: 10%; text-align: center;">
                            <h:outputText value="#{parecer.data}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Usuário" style="width: 10%;">
                            <div style="text-align: left;">
                                <h:outputText value="#{parecer.usuarioSistema.toString()}"/>
                            </div>
                        </p:column>
                        <p:column headerText="Status" style="width: 10%;">
                            <div style="text-align: left;">
                                <h:outputText value="#{parecer.status.descricao}"/>
                            </div>
                        </p:column>
                        <p:column headerText="Motivo" style="width: 70%; text-align: center;">
                            <p:inputTextarea value="#{parecer.motivo}"
                                             style="width: 600px; height: 50px; overflow-y: scroll;"
                                             readonly="true"/>
                        </p:column>
                    </p:dataTable>
                    <br/>
                    <p:dataTable id="tabelaItem"
                                 value="#{vistoriaControlador.selecionado.arquivos}" var="av"
                                 emptyMessage="Nenhum arquivo cadastrado.">
                        <f:facet name="header">
                            <h:outputLabel value="Documentos Anexados"/>
                        </f:facet>
                        <p:column headerText="Descrição" style="width: 80%;">
                            <div style="text-align: left;">
                                <h:outputText value="#{av.arquivo.descricao}"/>
                            </div>
                        </p:column>
                        <p:column headerText="Download" style="width: 20%; text-align: center">
                            <a title="Download"
                               href="${facesContext.externalContext.requestContextPath}/arquivos/#{av.arquivo.nome}?id=#{av.arquivo.id}" target="_blank">#{av.arquivo.nome}</a>
                        </p:column>
                    </p:dataTable>
                </p:panel>
                <br/>
                <p:panel rendered="#{vistoriaControlador.selecionado.statusVistoria eq 'FINALIZADA'}">
                    <div class="ui-messages-warn ui-corner-all textomedio">
                        <div class="ui-messages-warn-icon  margem-direita-cinco-pixels"/>
                        <h:outputText value="Atenção! " styleClass="ui-messages-warn-summary"/>
                        <h:outputText value="Esta vistoria já está finalizada." styleClass="ui-messages-warn-detail"/>
                    </div>
                </p:panel>
                <fc:rodapeVisualizarPretty controlador="#{vistoriaControlador}" mostrarExcluir="false"
                                           mostrarEditar="#{vistoriaControlador.selecionado.statusVistoria ne 'FINALIZADA'}"/>
                <p:spacer width="4"/>
                <p:button value="Finalizar Vistoria"
                          styleClass="operacao mtop10 mrig05"
                          icon="ui-icon-refresh"
                          rendered="#{vistoriaControlador.selecionado.statusVistoria ne 'FINALIZADA'}"
                          href="../../finalizar/#{vistoriaControlador.urlKeyValue}/"/>
            </h:form>
        </ui:define>
    </ui:composition>
</html>
