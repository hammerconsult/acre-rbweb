<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:f="http://java.sun.com/jsf/core"
>
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">

        <script type="application/javascript">
            function efetivarProcessoCalc() {
                efetivarProcesso();
            }

            function redimensionarAlturaDialog(id) {
                var info = document.getElementById(id);
                var style = info.style;
                style.overflow = 'auto';
            }
        </script>

        <style type="text/css">
            .tamanho-grid {
                width: 25%;
            }
        </style>

        <h:form id="Formulario">
            <f:event type="preRenderComponent" listener="#{calculoAlvaraControlador.atribuirEstilosCalculo}"/>

            <p:remoteCommand name="efetivarProcesso" onstart="aguarde.show();"
                             oncomplete="aguarde.hide();"
                             actionListener="#{calculoAlvaraControlador.efetivarCalculo()}"/>

            <p:remoteCommand name="finalizarEfetivacao" onstart="aguarde.show();"
                             oncomplete="aguarde.hide();"
                             actionListener="#{calculoAlvaraControlador.finalizarEfetivacao()}"/>

            <fc:cabecalhoPretty auditavel="#{true}" origem="#{calculoAlvaraControlador.caminhoPadrao}listar/"
                                controlador="#{calculoAlvaraControlador}"/>

            <p:panel id="panelPrincipal" header="Detalhes do Cálculo de Alvará de Localização e Funcionamento">

                <p:poll interval="2" widgetVar="pollEfetivar"
                        listener="#{calculoAlvaraControlador.acompanharEfetivacao()}"
                        autoStart="false" update=":formEfetivar:panelBarraEfetivar"/>

                <p:poll interval="2" widgetVar="pollAposEfetivar"
                        listener="#{calculoAlvaraControlador.acompanharAposEfetivacao()}"
                        autoStart="false" update=":formEfetivar:panelBarraEfetivar"/>

                <h:panelGrid columns="5">
                    <h:outputText value="Código"/>
                    <h:outputText value="Data"/>
                    <h:outputText value="Protocolo"/>
                    <h:outputText value="Situação"/>
                    <h:outputText value="Usuário"/>

                    <p:inputText value="#{calculoAlvaraControlador.operacaoNovo ? 'Gerado automaticamente ao salvar' :
                     calculoAlvaraControlador.selecionado.codigo}"
                                 size="#{calculoAlvaraControlador.operacaoNovo ? '28' : '12'}"
                                 readonly="true" styleClass="negrito campo-bloqueado mtop05"/>
                    <p:inputText value="#{calculoAlvaraControlador.selecionado.dataLancamento}" size="12"
                                 readonly="true" styleClass="negrito campo-bloqueado mtop05">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </p:inputText>
                    <h:panelGrid columns="1" styleClass="mtop05">
                        <fc:protocolo numero="#{calculoAlvaraControlador.selecionado.numeroProtocolo}"
                                      ano="#{calculoAlvaraControlador.selecionado.anoProtocolo}"
                                      controlador="#{calculoAlvaraControlador}" mostrarLabel="false"/>
                    </h:panelGrid>
                    <p:inputText value="#{calculoAlvaraControlador.selecionado.situacaoCalculoAlvara.descricao}"
                                 size="20"
                                 readonly="true" styleClass="negrito campo-bloqueado mtop05"/>
                    <p:inputText value="#{calculoAlvaraControlador.selecionado.usuario.nome}" size="20"
                                 readonly="true" styleClass="negrito campo-bloqueado mtop05"/>
                </h:panelGrid>

                <h:panelGrid columns="2" styleClass="mtop05">
                    <h:outputText value="Cadastro Econômico: " styleClass="negrito"/>
                    <h:outputText value="#{calculoAlvaraControlador.selecionado.cadastroEconomico}"/>

                    <p:spacer/>
                    <p:outputPanel id="panelJuridica">
                        <h:panelGrid columns="2" styleClass="mtop05 mbot05"
                                     rendered="#{calculoAlvaraControlador.pessoaJuridica}">
                            <h:outputText value="Razão Social: "/>
                            <h:outputText id="razaosocial"
                                          value="#{calculoAlvaraControlador.selecionado.cadastroEconomico.pessoa.razaoSocial}"
                                          styleClass="negrito"/>
                            <h:outputText value="Nome Reduzido: "/>
                            <h:outputText id="nomereduzido"
                                          value="#{calculoAlvaraControlador.selecionado.cadastroEconomico.pessoa.nomeReduzido}"
                                          styleClass="negrito"/>
                            <h:outputText value="Nome Fantasia: "/>
                            <h:outputText id="nomefantasia"
                                          value="#{calculoAlvaraControlador.selecionado.cadastroEconomico.pessoa.nomeFantasia}"
                                          styleClass="negrito"/>
                            <h:outputText value="Inscrição Estadual: "/>
                            <h:outputText id="inscestadual"
                                          value="#{calculoAlvaraControlador.selecionado.cadastroEconomico.pessoa.inscricaoEstadual}"
                                          styleClass="negrito"/>
                            <h:outputText value="E-mail: "/>
                            <h:outputText id="email"
                                          value="#{calculoAlvaraControlador.selecionado.cadastroEconomico.pessoa.email}"
                                          styleClass="negrito"/>
                            <h:outputText value="Protocolo Rede SIM: "/>
                            <h:outputText id="protocoloRedeSim"
                                          value="#{calculoAlvaraControlador.buscarProtocoloRedeSIM()}"
                                          styleClass="negrito"/>
                            <h:outputText value="Classificação da Atividade: "/>
                            <h:outputText id="classificacao"
                                          value="#{calculoAlvaraControlador.selecionado.cadastroEconomico.classificacaoAtividade.descricao}"
                                          styleClass="negrito"/>
                            <h:outputText value="Área de Utilização: "/>
                            <h:outputText id="utilizacao"
                                          value="#{calculoAlvaraControlador.selecionado.cadastroEconomico.areaUtilizacao}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="#,##0.00 m²"/>
                            </h:outputText>
                            <h:outputText value="Data de Abertura: "/>
                            <h:outputText id="abertura"
                                          value="#{calculoAlvaraControlador.selecionado.cadastroEconomico.abertura}"
                                          styleClass="negrito">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                            <h:outputText value="MEI - Microempreendedor Individual:"/>
                            <h:outputText
                                value="#{calculoAlvaraControlador.enquadramentoFiscal.mei ? 'Sim' : 'Não'}"
                                styleClass="negrito"/>
                        </h:panelGrid>
                    </p:outputPanel>

                    <p:spacer/>
                    <p:outputPanel id="panelFisica">
                        <h:panelGrid columns="2" styleClass="mtop05 mbot05"
                                     rendered="#{calculoAlvaraControlador.pessoaFisica}">
                            <h:outputText value="CPF: "/>
                            <h:outputText id="rg"
                                          value="#{calculoAlvaraControlador.selecionado.cadastroEconomico.pessoa.nome}"
                                          styleClass="negrito"/>
                            <h:outputText value="E-mail: "/>
                            <h:outputText id="emailf"
                                          value="#{calculoAlvaraControlador.selecionado.cadastroEconomico.pessoa.email}"
                                          styleClass="negrito"/>
                            <h:outputText value="Classificação da Atividade: "/>
                            <h:outputText id="classificacaof"
                                          value="#{calculoAlvaraControlador.selecionado.cadastroEconomico.classificacaoAtividade.descricao}"
                                          styleClass="negrito"/>
                            <h:outputText value="Área de Utilização: "/>
                            <h:outputText id="utilizacaof"
                                          value="#{calculoAlvaraControlador.selecionado.cadastroEconomico.areaUtilizacao}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="#,##0.00 m²"/>
                            </h:outputText>
                            <h:outputText value="Data de Abertura: "/>
                            <h:outputText id="aberturaf"
                                          value="#{calculoAlvaraControlador.selecionado.cadastroEconomico.abertura}"
                                          styleClass="negrito">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                            <h:outputText value="MEI - Microempreendedor Individual:"/>
                            <h:outputText
                                value="#{calculoAlvaraControlador.enquadramentoFiscal.mei ? 'Sim' : 'Não'}"
                                styleClass="negrito"/>
                        </h:panelGrid>
                    </p:outputPanel>

                    <h:outputText value="Exercício: " styleClass="negrito"/>
                    <h:outputText value="#{calculoAlvaraControlador.selecionado.exercicio}"/>

                    <h:outputText value="Renovação: " styleClass="negrito"
                                  rendered="#{calculoAlvaraControlador.selecionado.situacaoCalculoAlvara ne 'EM_ABERTO'}"/>
                    <h:outputText value="#{calculoAlvaraControlador.selecionado.renovacao ? 'Sim' : 'Não'}"
                                  rendered="#{calculoAlvaraControlador.selecionado.situacaoCalculoAlvara ne 'EM_ABERTO'}"/>

                </h:panelGrid>

                <p:tabView styleClass="mtop10"
                           rendered="#{calculoAlvaraControlador.selecionado.situacaoCalculoAlvara eq 'ESTORNADO'}">
                    <p:tab title="Dados do Estorno">
                        <h:panelGrid columns="2">
                            <h:outputText value="Data Estorno: " styleClass="negrito"/>
                            <h:outputText value="#{calculoAlvaraControlador.selecionado.dataEstorno}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                            <p:spacer/>
                            <p:spacer/>
                            <h:outputText value="Usuário Estorno: " styleClass="negrito"/>
                            <h:outputText value="#{calculoAlvaraControlador.selecionado.usuarioEstorno.login}"/>

                            <h:outputText value="Motivo Estorno: " styleClass="negrito"/>
                            <p:inputTextarea value="#{calculoAlvaraControlador.selecionado.motivoEstorno}"
                                             styleClass="mtop05" readonly="true"
                                             autoResize="true" rows="5"/>
                        </h:panelGrid>
                    </p:tab>
                </p:tabView>

                <p:tabView id="tabViewGeral" styleClass="mtop10">

                    <p:tab title="CNAE(s)">
                        <p:dataTable id="tabelaCnae"
                                     emptyMessage="Nenhum registro foi adicionado"
                                     var="cnae"
                                     value="#{calculoAlvaraControlador.selecionado.cnaes}"
                                     rowKey="#{cnae.id}"
                                     rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                     paginator="true"
                                     rows="10"
                                     paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>CNAE(s)&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                     rowIndexVar="rowlx"
                                     rowsPerPageTemplate="10,25,50,100">

                            <p:column headerText="CNAE" styleClass="alinhamentoEsquerda">
                                <h:outputText
                                    value="#{cnae.cnae.codigoCnae} - #{cnae.cnae.descricaoDetalhada}"/>
                            </p:column>
                            <p:column headerText="Interesse do Estado" styleClass="alinhamentoCentralizado">
                                <h:outputText
                                    value="#{cnae.cnae.interesseDoEstado ? 'Sim' : 'Não'}"/>
                            </p:column>
                            <p:column headerText="Tipo" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{cnae.tipoCnae.descricao}"/>
                            </p:column>
                            <p:column headerText="Grau de Risco" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{cnae.cnae.grauDeRisco.descricao}"/>
                            </p:column>
                            <p:column headerText="Dispensado" styleClass="alinhamentoCentralizado">
                                <h:outputText value="#{cnae.cnae.dispensado ? 'Sim' : 'Não'}"/>
                            </p:column>
                            <p:column headerText="Infraestrutura" styleClass="alinhamentoCentralizado">
                                <h:outputText value="#{cnae.cnae.seinfra ? 'Sim' : 'Não'}"/>
                            </p:column>
                            <p:column headerText="Sanitário" styleClass="alinhamentoCentralizado">
                                <h:outputText value="#{cnae.cnae.fiscalizacaoSanitaria ? 'Sim' : 'Não'}"/>
                            </p:column>
                            <p:column headerText="Ambiental" styleClass="alinhamentoCentralizado">
                                <h:outputText value="#{cnae.cnae.meioAmbiente ? 'Sim' : 'Não'}"/>
                            </p:column>
                            <p:column headerText="Exercida no Local" styleClass="alinhamentoCentralizado">
                                <h:outputText value="#{cnae.exercidaNoLocal ? 'Sim' : 'Não'}"/>
                            </p:column>
                            <p:column headerText="Início de Atividade" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{cnae.inicioAtividade}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Situação" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{cnae.cnae.situacao.descricao}"/>
                            </p:column>

                        </p:dataTable>
                    </p:tab>

                    <p:tab title="Endereço(s)">
                        <p:dataTable id="tabelaEnderecos"
                                     emptyMessage="Nenhum registro foi adicionado"
                                     var="endereco"
                                     value="#{calculoAlvaraControlador.selecionado.enderecosAlvara}"
                                     rowKey="#{endereco.id}"
                                     rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                     paginator="true"
                                     rows="10"
                                     paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>Endereço(s)&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                     rowIndexVar="rowlx"
                                     rowsPerPageTemplate="10,25,50,100">
                            <p:column headerText="Principal/Secundário" styleClass="alinhamentoDireita">
                                <h:outputText value="#{endereco.tipoEndereco.principalOuSecundario}"/>
                            </p:column>
                            <p:column headerText="Sequêncial" styleClass="alinhamentoDireita">
                                <h:outputText value="#{endereco.sequencial}"/>
                            </p:column>
                            <p:column headerText="Logradouro" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{endereco.logradouro}"/>
                            </p:column>
                            <p:column headerText="Número" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{endereco.numero}"/>
                            </p:column>
                            <p:column headerText="Complemento" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{endereco.complemento}"/>
                            </p:column>
                            <p:column headerText="Bairro" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{endereco.bairro}"/>
                            </p:column>
                            <p:column headerText="CEP" styleClass="alinhamentoCentralizado">
                                <h:outputText value="#{endereco.cep}"/>
                            </p:column>
                            <p:column headerText="Área de Utilização" styleClass="alinhamentoDireita">
                                <h:outputText value="#{endereco.areaUtilizacao}">
                                    <f:convertNumber pattern="###,##0.00"/>
                                </h:outputText>
                            </p:column>
                        </p:dataTable>
                    </p:tab>

                    <p:tab title="Telefone(s)">
                        <p:dataTable id="tabelaTelefones"
                                     emptyMessage="Nenhum registro foi adicionado"
                                     var="telefone"
                                     value="#{calculoAlvaraControlador.telefones}"
                                     rowKey="#{endereco.id}"
                                     rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                     paginator="true"
                                     rows="10"
                                     paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>Telefone(s)&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                     rowIndexVar="rowlx"
                                     rowsPerPageTemplate="10,25,50,100">

                            <p:column headerText="Tipo" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{telefone.tipoFone.tipoFone}"/>
                            </p:column>
                            <p:column headerText="Telefone" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{telefone.telefone}"/>
                            </p:column>
                            <p:column headerText="Principal" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{telefone.principal ? 'Principal' : ''}"/>
                            </p:column>

                        </p:dataTable>
                    </p:tab>

                    <p:tab title="Horário(s) de Funcionamento">
                        <p:dataTable id="tabelaHorarioFuncionamento"
                                     emptyMessage="Nenhum registro foi adicionado"
                                     var="horario"
                                     value="#{calculoAlvaraControlador.selecionado.horariosAlvara}"
                                     rowKey="#{horario.id}"
                                     rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                     paginator="true"
                                     rows="10"
                                     paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>Horário(s) de Funcionamento&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                     rowIndexVar="rowlx"
                                     rowsPerPageTemplate="10,25,50,100">

                            <p:column headerText="Código" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{horario.horarioFuncionamento.codigo}"/>
                            </p:column>
                            <p:column headerText="Descrição" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{horario.horarioFuncionamento.descricao}"/>
                            </p:column>

                        </p:dataTable>
                    </p:tab>

                    <p:tab title="Características de Funcionamento">
                        <p:dataTable id="tabelaCaracFuncionamento"
                                     emptyMessage="Nenhum registro foi adicionado"
                                     var="caracteristica"
                                     value="#{calculoAlvaraControlador.selecionado.caracteristicasAlvara}"
                                     rowKey="#{caracteristica.id}"
                                     rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                     paginator="true"
                                     rows="10"
                                     paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>Característica(s) de Funcionamento&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                     rowIndexVar="rowlx"
                                     rowsPerPageTemplate="10,25,50,100">

                            <p:column headerText="Código" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{caracteristica.caracFuncionamento.codigo}"/>
                            </p:column>
                            <p:column headerText="Descrição" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{caracteristica.caracFuncionamento.descricao}"/>
                            </p:column>
                            <p:column headerText="Quantidade" styleClass="alinhamentoCentralizado">
                                <h:outputText value="#{caracteristica.quantidade}"/>
                            </p:column>
                            <p:column headerText="Forma de Pagamento" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{caracteristica.formaPagamento.descricao}"/>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                </p:tabView>

                <p:panel id="dadosCalculo" styleClass="mtop10"
                         visible="#{calculoAlvaraControlador.selecionado.cadastroEconomico.id ne null}">

                    <h:outputText value="Área de Utilização: "/>
                    <h:outputText
                        value="#{calculoAlvaraControlador.selecionado.cadastroEconomico.areaUtilizacao}"
                        styleClass="negrito">
                        <f:convertNumber pattern="#,##0.00 m²"/>
                    </h:outputText>

                    <p:tabView id="tabViewCalc" styleClass="mtop05">
                        <p:tab title="Cálculos">
                            <h:panelGrid columns="2"
                                         rendered="#{calculoAlvaraControlador.selecionado.situacaoCalculoAlvara ne 'EM_ABERTO'}">
                                <h:outputText value="Valor Total Calculado: "/>
                                <h:outputText
                                    value="#{calculoAlvaraControlador.selecionado.valorTotalCalculado}"
                                    styleClass="negrito">
                                    <f:convertNumber pattern="R$ #,##0.00"/>
                                </h:outputText>
                            </h:panelGrid>
                            <p:dataTable id="tabelaDadosCalculo" emptyMessage="Nenhum registro encontrado"
                                         styleClass="mtop05"
                                         style="text-align: center;"
                                         value="#{calculoAlvaraControlador.calculosAtuais}"
                                         var="dadosCalculo">
                                <f:facet name="header">
                                    <h:outputText value="Cálculos"/>
                                </f:facet>
                                <p:column
                                    style="width: 1%; #{calculoAlvaraControlador.getEstiloCalculo(dadosCalculo)}"
                                    headerText="Itens">
                                    <p:rowToggler id="teste"/>
                                </p:column>
                                <p:column headerText="Dívida"
                                          style="width: 25%; #{calculoAlvaraControlador.getEstiloCalculo(dadosCalculo)}"
                                          styleClass="alinhamentoEsquerda">
                                    <h:outputText
                                        value="#{dadosCalculo.divida.codigo} - #{dadosCalculo.divida.descricao}"/>
                                </p:column>
                                <p:column headerText="Tipo Alvará"
                                          style="width: 25%; #{calculoAlvaraControlador.getEstiloCalculo(dadosCalculo)}"
                                          styleClass="alinhamentoEsquerda">
                                    <h:outputText value="#{dadosCalculo.tipoAlvara.descricao}"/>
                                </p:column>
                                <p:column headerText="Tipo de Cálculo"
                                          style="width: 25%; #{calculoAlvaraControlador.getEstiloCalculo(dadosCalculo)}"
                                          styleClass="alinhamentoEsquerda">
                                    <h:outputText value="#{dadosCalculo.tipoCalculoAlvara.descricao}"/>
                                </p:column>
                                <p:column headerText="Vencimento" styleClass="alinhamentoEsquerda"
                                          style="width: 25%; #{calculoAlvaraControlador.getEstiloCalculo(dadosCalculo)}">
                                    <h:outputText value="#{dadosCalculo.vencimento}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Valor Calculado (UFM)" styleClass="alinhamentoEsquerda"
                                          style="width: 25%; #{calculoAlvaraControlador.getEstiloCalculo(dadosCalculo)}">
                                    <h:outputText
                                        value="#{calculoAlvaraControlador.buscarValorUFMCalculo(dadosCalculo.id, dadosCalculo.valorEfetivo)}"
                                        styleClass="azulnegrito">
                                        <f:convertNumber pattern="#,##0.0000"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Valor Calculado (R$)"
                                          style="width: 25%; #{calculoAlvaraControlador.getEstiloCalculo(dadosCalculo)}"
                                          styleClass="alinhamentoDireita">
                                    <h:outputText value="#{dadosCalculo.valorEfetivo}">
                                        <f:convertNumber pattern="R$ #,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Valor Sem Difereça (R$)"
                                          style="width: 25%; #{calculoAlvaraControlador.getEstiloCalculo(dadosCalculo)}"
                                          styleClass="alinhamentoDireita">
                                    <h:outputText value="#{dadosCalculo.valorReal}">
                                        <f:convertNumber pattern="R$ #,##0.00"/>
                                    </h:outputText>
                                    <h:outputText value="#{dadosCalculo.isento ? ' (Isento)' : ''}"
                                                  styleClass="vermelhonegrito"/>
                                </p:column>
                                <p:rowExpansion>
                                    <p:panel style="border: none" styleClass="mtop05 mbot05">
                                        <p:dataTable emptyMessage="Nenhum registro encontrado"
                                                     style="text-align: center;"
                                                     id="tableItens"
                                                     value="#{dadosCalculo.itensAlvara}" var="itens">
                                            <f:facet name="header">
                                                <h:outputText value="Detalhes do Cálculo"/>
                                            </f:facet>
                                            <p:column headerText="Tributo" styleClass="alinhamentoEsquerda"
                                                      style="width: 50%; vertical-align: top;">
                                                <h:outputText
                                                    title="#{itens.caracFuncionamento.codigo} - #{itens.caracFuncionamento.descricao}"
                                                    value="#{itens.tributo.codigo} - #{itens.tributo.descricao}"/>
                                            </p:column>
                                            <p:column headerText="Valor (UFM)" styleClass="alinhamentoEsquerda"
                                                      style="width: 20%; vertical-align: top;">
                                                <h:outputText
                                                    value="#{converterRealUfm.converterToUFMParaExercicio(itens.valorEfetivo, calculoAlvaraControlador.selecionado.exercicio)}"
                                                    styleClass="azulnegrito"
                                                    style="vertical-align: top; horiz-align: right">
                                                    <f:convertNumber pattern="#,##0.0000"/>
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Valor Calculado(R$)" styleClass="alinhamentoDireita"
                                                      style="width: 20%; vertical-align: top;">
                                                <h:outputText value="#{itens.valorEfetivo}">
                                                    <f:convertNumber pattern="R$ #,##0.00"/>
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Valor Sem Diferença (R$)"
                                                      styleClass="alinhamentoDireita"
                                                      style="width: 20%; vertical-align: top;">
                                                <h:outputText value="#{itens.valorReal}">
                                                    <f:convertNumber pattern="R$ #,##0.00"/>
                                                </h:outputText>
                                            </p:column>
                                        </p:dataTable>
                                        <p:dataTable emptyMessage="Nenhum registro encontrado"
                                                     id="tableItensAmbientais" styleClass="mtop05"
                                                     style="text-align: center;"
                                                     rendered="#{dadosCalculo.tipoAlvara eq 'AMBIENTAL'}"
                                                     value="#{itens.itensAmbientais}" var="itemAmbiental">

                                            <p:column headerText="CNAE" styleClass="alinhamentoEsquerda"
                                                      style="width: 50%; vertical-align: top;">
                                                <h:outputText
                                                    value="#{itemAmbiental.cnaeAmbiental.codigoCnae} - #{itemAmbiental.cnaeAmbiental.descricaoDetalhada}"/>
                                            </p:column>
                                            <p:column headerText="Licença" styleClass="alinhamentoEsquerda"
                                                      style="width: 15%; vertical-align: top;">
                                                <h:outputText
                                                    value="#{itemAmbiental.licencaAmbiental.descricao}"/>
                                            </p:column>
                                            <p:column headerText="Classe (UFM)" styleClass="alinhamentoEsquerda"
                                                      style="width: 15%; vertical-align: top;">
                                                <h:outputText value="#{itemAmbiental.classeValorUFM}"/>
                                            </p:column>
                                            <p:column headerText="Valor(R$)" styleClass="alinhamentoDireita"
                                                      style="width: 10%; vertical-align: top;">
                                                <h:outputText value="#{itemAmbiental.valor}">
                                                    <f:convertNumber pattern="R$ #,##0.00"/>
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Variação" styleClass="alinhamentoEsquerda"
                                                      style="width: 10%; vertical-align: top;">
                                                <h:outputText value="#{itemAmbiental.variacaoClasse}">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Dispensa Licença" styleClass="alinhamentoEsquerda">
                                                <h:outputText
                                                    value="#{itemAmbiental.dispensaLicenca ? 'Sim' : 'Não'}"/>
                                            </p:column>
                                        </p:dataTable>

                                        <p:commandButton styleClass="operacao mtop10 mbot10" style="float: left"
                                                         rendered="#{dadosCalculo.tipoAlvara.localizacao}"
                                                         value="Ver Alterações" icon="ui-icon-search"
                                                         process="@this" update=":FormularioAlteracao"
                                                         onclick="aguarde.show()" onstart="alteracoes.show();"
                                                         oncomplete="aguarde.hide()"
                                                         actionListener="#{calculoAlvaraControlador.atribuirAlteracaoDoCalculo(dadosCalculo.id)}"/>
                                    </p:panel>
                                </p:rowExpansion>
                            </p:dataTable>

                            <p:scrollPanel id="panelParcelas" mode="native"
                                           style="max-height: 100%; margin-top: 12px"
                                           rendered="#{calculoAlvaraControlador.canRenderizarTableParcelas()}">
                                <p:dataTable id="tabelaParcelas"
                                             emptyMessage="Nenhuma parcela encontrada"
                                             var="parcela"
                                             value="#{calculoAlvaraControlador.buscarParcelasAtuais()}"
                                             rowKey="#{parcela.id}"
                                             rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                             rowIndexVar="rowlx">
                                    <f:facet name="header">
                                        <h:outputText value="Parcela(s)"/>
                                    </f:facet>
                                    <p:column headerText="DAM" style="width: 8%;">
                                        <h:outputText value="#{parcela.dam.numeroDAM}"/>
                                    </p:column>
                                    <p:column headerText="Dívida" style="width: 12%; text-align: left">
                                        <h:outputText value="#{parcela.resultadoParcela.divida}"/>
                                    </p:column>
                                    <p:column headerText="Exercício" style="width: 5%; text-align: center;">
                                        <h:outputText value="#{parcela.resultadoParcela.exercicio}"/>
                                    </p:column>
                                    <p:column headerText="Tipo de Débito" style="width: 5%;">
                                        <h:outputText value="#{parcela.resultadoParcela.tipoDeDebito}"/>
                                    </p:column>
                                    <p:column headerText="Parcela" style="width: 2%; text-align: center;">
                                        <h:outputText value="#{parcela.resultadoParcela.parcela}"/>
                                    </p:column>
                                    <p:column headerText="SD" style="width: 2%; text-align: center;">
                                        <h:outputText value="#{parcela.resultadoParcela.sd}"/>
                                    </p:column>
                                    <p:column headerText="Vencimento"
                                              style="width: 5%; text-align: center;">
                                        <h:outputText
                                            value="#{parcela.resultadoParcela.vencimentoToString}"/>
                                    </p:column>
                                    <p:column headerText="Imposto" style="text-align: right">
                                        <h:outputText value="#{parcela.resultadoParcela.valorImposto}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Taxa" style="text-align: right">
                                        <h:outputText value="#{parcela.resultadoParcela.valorTaxa}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Desconto" style="text-align: right">
                                        <h:outputText value="#{parcela.resultadoParcela.valorDesconto}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Juros" style="text-align: right">
                                        <h:outputText value="#{parcela.resultadoParcela.valorJuros}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Multa" style="text-align: right">
                                        <h:outputText value="#{parcela.resultadoParcela.valorMulta}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Correcao" style="text-align: right">
                                        <h:outputText value="#{parcela.resultadoParcela.valorCorrecao}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Honorários" style="text-align: right">
                                        <h:outputText value="#{parcela.resultadoParcela.valorHonorarios}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Total" style="text-align: right">
                                        <h:outputText value="#{parcela.resultadoParcela.valorTotal}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Situação" style="text-align: center">
                                        <h:outputText
                                            value="#{parcela.resultadoParcela.situacaoDescricaoEnum}"
                                            title="cod. ${parcela.resultadoParcela.idParcela}"/>
                                    </p:column>
                                </p:dataTable>
                            </p:scrollPanel>

                        </p:tab>
                        <p:tab title="Cálculos Anteriores"
                               rendered="#{!empty calculoAlvaraControlador.calculosAnteriores}">
                            <p:dataTable id="tabelaDadosCalculoCanc" emptyMessage="Nenhum registro encontrado"
                                         styleClass="mtop05"
                                         style="text-align: center;"
                                         value="#{calculoAlvaraControlador.calculosAnteriores}"
                                         var="dadosCalculoCanc">
                                <f:facet name="header">
                                    <h:outputText value="Cálculo"/>
                                </f:facet>
                                <p:column style="width: 1%" headerText="Itens">
                                    <p:rowToggler/>
                                </p:column>
                                <p:column headerText="Dívida" style="width: 25%"
                                          styleClass="alinhamentoEsquerda">
                                    <h:outputText
                                        value="#{dadosCalculoCanc.divida.codigo} - #{dadosCalculoCanc.divida.descricao}"/>
                                </p:column>
                                <p:column headerText="Tipo Alvará" style="width: 25%"
                                          styleClass="alinhamentoEsquerda">
                                    <h:outputText value="#{dadosCalculoCanc.tipoAlvara.descricao}"/>
                                </p:column>
                                <p:column headerText="Vencimento" style="width: 25%">
                                    <h:outputText value="#{dadosCalculoCanc.vencimento}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Valor Calculado (UFM)" style="width: 25%">
                                    <h:outputText
                                        value="#{converterRealUfm.converterToUFMParaExercicio(dadosCalculoCanc.valorReal, calculoAlvaraControlador.selecionado.exercicio)}"
                                        styleClass="azulnegrito">
                                        <f:convertNumber pattern="#,##0.0000"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Valor Calculado (R$)" style="width: 25%"
                                          styleClass="alinhamentoDireita">
                                    <h:outputText value="#{dadosCalculoCanc.valorReal}">
                                        <f:convertNumber pattern="R$ #,##0.00"/>
                                    </h:outputText>
                                    <h:outputText value="#{dadosCalculoCanc.isento ? ' (Isento)' : ''}"
                                                  styleClass="vermelhonegrito"/>
                                </p:column>
                                <p:rowExpansion>
                                    <p:panel style="border: none" styleClass="mtop05 mbot05">
                                        <p:dataTable emptyMessage="Nenhum registro encontrado"
                                                     id="tableItensCanc"
                                                     style="text-align: center;"
                                                     value="#{dadosCalculoCanc.itensAlvara}" var="itensCanc">
                                            <f:facet name="header">
                                                <h:outputText value="Detalhes do Cálculo"/>
                                            </f:facet>
                                            <p:column headerText="Tributo"
                                                      style="width: 50%; vertical-align: top;">
                                                <h:outputText
                                                    title="#{itensCanc.caracFuncionamento.codigo} - #{itensCanc.caracFuncionamento.descricao}"
                                                    value="#{itensCanc.tributo.codigo} - #{itensCanc.tributo.descricao}"/>
                                            </p:column>
                                            <p:column headerText="Valor (UFM)"
                                                      style="width: 20%; vertical-align: top;">
                                                <h:outputText
                                                    value="#{converterRealUfm.converterToUFMParaExercicio(itensCanc.valorEfetivo, calculoAlvaraControlador.selecionado.exercicio)}"
                                                    styleClass="azulnegrito"
                                                    style="vertical-align: top; horiz-align: right">
                                                    <f:convertNumber pattern="#,##0.0000"/>
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Valor (R$)"
                                                      style="width: 20%; vertical-align: top;">
                                                <h:outputText value="#{itensCanc.valorEfetivo}">
                                                    <f:convertNumber pattern="R$ #,##0.00"/>
                                                </h:outputText>
                                            </p:column>
                                        </p:dataTable>
                                        <p:dataTable emptyMessage="Nenhum registro encontrado"
                                                     id="tableItensAmbientaisCanc"
                                                     rendered="#{dadosCalculoCanc.tipoAlvara eq 'AMBIENTAL'}"
                                                     style="text-align: center;"
                                                     value="#{itensCanc.itensAmbientais}"
                                                     var="itemAmbientalCanc">

                                            <p:column headerText="CNAE">
                                                <h:outputText
                                                    value="#{itemAmbientalCanc.cnae.codigoCnae} - #{itemAmbientalCanc.cnae.descricaoDetalhada}"/>
                                            </p:column>
                                            <p:column headerText="Licença">
                                                <h:outputText
                                                    value="#{itemAmbientalCanc.licencaAmbiental.descricao}"/>
                                            </p:column>
                                            <p:column headerText="Classe (UFM)">
                                                <h:outputText value="#{itemAmbientalCanc.classeValorUFM}"/>
                                            </p:column>
                                            <p:column headerText="Valor(R$)">
                                                <h:outputText value="#{itemAmbientalCanc.valor}">
                                                    <f:convertNumber pattern="R$ #,##0.00"/>
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Variação">
                                                <h:outputText value="#{itemAmbientalCanc.variacaoClasse}">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Dispensa Licença">
                                                <h:outputText
                                                    value="#{itemAmbientalCanc.dispensaLicenca ? 'Sim' : 'Não'}"/>
                                            </p:column>

                                        </p:dataTable>
                                    </p:panel>
                                </p:rowExpansion>
                            </p:dataTable>

                            <p:scrollPanel mode="native" id="panelParcelasCanceladas" style="max-height: 100%;"
                                           styleClass="mtop10"
                                           rendered="#{calculoAlvaraControlador.canRenderizarTableParcelas()}">
                                <p:dataTable id="tabelaParcelasCanceladas"
                                             emptyMessage="Nenhuma parcela encontrada"
                                             var="parcelaCanc"
                                             value="#{calculoAlvaraControlador.buscarParcelasAnteriores()}"
                                             rowKey="#{parcelaCanc.id}"
                                             rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                             paginator="true"
                                             rows="10"
                                             paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>PARCELA(s)&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                             rowIndexVar="rowlx"
                                             rowsPerPageTemplate="10,25,50,100">
                                    <p:column headerText="Dívida" style="width: 12%; text-align: left">
                                        <h:outputText value="#{parcelaCanc.resultadoParcela.divida}"/>
                                    </p:column>
                                    <p:column headerText="Exercício" style="width: 5%; text-align: center;">
                                        <h:outputText value="#{parcelaCanc.resultadoParcela.exercicio}"/>
                                    </p:column>
                                    <p:column headerText="Tipo de Débito" style="width: 5%;">
                                        <h:outputText value="#{parcelaCanc.resultadoParcela.tipoDeDebito}"/>
                                    </p:column>
                                    <p:column headerText="Parcela" style="width: 2%; text-align: center;">
                                        <h:outputText value="#{parcelaCanc.resultadoParcela.parcela}"/>
                                    </p:column>
                                    <p:column headerText="SD" style="width: 2%; text-align: center;">
                                        <h:outputText value="#{parcelaCanc.resultadoParcela.sd}"/>
                                    </p:column>
                                    <p:column headerText="Vencimento"
                                              style="width: 5%; text-align: center;">
                                        <h:outputText
                                            value="#{parcela.resultadoParcela.vencimentoToString}"/>
                                    </p:column>
                                    <p:column headerText="Valor" style="text-align: right">
                                        <h:outputText value="#{parcelaCanc.resultadoParcela.valorOriginal}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Imposto" style="text-align: right">
                                        <h:outputText value="#{parcelaCanc.resultadoParcela.valorImposto}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Taxa" style="text-align: right">
                                        <h:outputText value="#{parcelaCanc.resultadoParcela.valorTaxa}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Desconto" style="text-align: right">
                                        <h:outputText value="#{parcelaCanc.resultadoParcela.valorDesconto}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Juros" style="text-align: right">
                                        <h:outputText value="#{parcela.resultadoParcela.valorJuros}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Multa" style="text-align: right">
                                        <h:outputText value="#{parcelaCanc.resultadoParcela.valorMulta}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Correcao" style="text-align: right">
                                        <h:outputText value="#{parcelaCanc.resultadoParcela.valorCorrecao}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Honorários" style="text-align: right">
                                        <h:outputText
                                            value="#{parcelaCanc.resultadoParcela.valorHonorarios}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Total" style="text-align: right">
                                        <h:outputText value="#{parcelaCanc.resultadoParcela.valorTotal}">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Situação" style="text-align: center">
                                        <h:outputText
                                            value="#{parcelaCanc.resultadoParcela.situacaoDescricaoEnum}"
                                            title="cod. ${parcelaCanc.resultadoParcela.idParcela}"/>
                                    </p:column>
                                </p:dataTable>
                            </p:scrollPanel>

                        </p:tab>
                    </p:tabView>
                </p:panel>

                <p:scrollPanel id="panelLogs" mode="native"
                               style="max-height: 100%; margin-top: 12px">
                    <p:dataTable id="tabelaLogs"
                                 emptyMessage="Nenhum log encontrado."
                                 var="log"
                                 value="#{calculoAlvaraControlador.selecionado.logsRedeSim}"
                                 rowKey="#{log.id}">

                        <f:facet name="header">
                            <h:outputText value="Log(s) de Envio de DAM/Alvará para RedeSim"/>
                        </f:facet>

                        <p:column headerText="Data/Hora" styleClass="centralizado">
                            <h:outputText value="#{log.data}">
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
                            </h:outputText>
                        </p:column>

                        <p:column headerText="IP" styleClass="centralizado">
                            <h:outputText value="#{log.ipMaquina}"/>
                        </p:column>

                        <p:column headerText="Usuário" styleClass="centralizado">
                            <h:outputText
                                value="#{log.usuarioSistema ne null ? (log.usuarioSistema.login.concat(' - ').concat(log.usuarioSistema.pessoaFisica.nomeCpfCnpj)) : 'Portal do Contribuinte'}"/>
                        </p:column>

                        <p:column headerText="Arquivo" styleClass="centralizado">
                            <fc:botaoTargetBlank
                                rendered="#{calculoAlvaraControlador.isArquivoBcmOrDispensaLicenciamento(log.arquivo.tipoArquivo)}"
                                actionListener="#{calculoAlvaraControlador.imprimirArquivoRedeSim(log.arquivo.detentorArquivoComposicao.arquivoComposicao)}"
                                label="Imprimir #{calculoAlvaraControlador.isArquivoBcm(log.arquivo.tipoArquivo) ? 'BCM' : 'Dispensa de Licenciamento'}"
                                styleClass="operacao mtop10 mrig05"
                                imprimeNoDialog="true"/>

                            <p:commandButton
                                rendered="#{calculoAlvaraControlador.isArquivoAlvara(log.arquivo.tipoArquivo)}"
                                value="Imprimir Alvará"
                                icon="ui-icon-print"
                                styleClass="operacao mtop10 mrig05"
                                onstart="aguarde.show();"
                                update="@this" process="@this"
                                oncomplete="aguarde.hide();"
                                actionListener="#{calculoAlvaraControlador.imprimirAlvaraRedeSim(log)}"/>

                            <p:commandButton styleClass="wp-botao-tabela mtop10 mrig05" icon="ui-icon-tag"
                                             rendered="#{calculoAlvaraControlador.isArquivoAlvara(log.arquivo.tipoArquivo)}"
                                             actionListener="#{calculoAlvaraControlador.atribuirAlvaraRedeSim(log)}"
                                             process="@this"
                                             update=":FormularioRecibo" title="Recibos de impressão do alvará"
                                             onstart="aguarde.show()"
                                             oncomplete="aguarde.hide(); recibos.show()">
                                <p:ajax event="change" process="@this" update="@this"/>
                            </p:commandButton>

                            <fc:botaoTargetBlank
                                rendered="#{calculoAlvaraControlador.isArquivoDAM(log.arquivo.tipoArquivo)}"
                                actionListener="#{calculoAlvaraControlador.imprimirArquivoRedeSim(log.arquivo.detentorArquivoComposicao.arquivoComposicao)}"
                                label="Imprimir DAM"
                                styleClass="operacao mtop10 mrig05"
                                imprimeNoDialog="true"
                                disabled="#{!calculoAlvaraControlador.hasImprimirDamRedeSim(log)}"/>

                        </p:column>

                    </p:dataTable>
                </p:scrollPanel>
            </p:panel>

            <fc:rodapeVisualizarPretty controlador="#{calculoAlvaraControlador}" mostrarEditar="false"
                                       mostrarCancelar="false"
                                       mostrarExcluir="#{calculoAlvaraControlador.canMostrarExcluir()}"/>

            <p:commandButton
                value="#{calculoAlvaraControlador.selecionado.situacaoCalculoAlvara eq 'EM_ABERTO' ? 'Calcular' : 'Recalcular'}"
                disabled="#{!calculoAlvaraControlador.canHabilitarBtnRecalculo()}"
                rendered="#{calculoAlvaraControlador.canRenderizarBtnRecalculo()}"
                styleClass="operacao prioritario mtop10 mrig05" icon="ui-icon-calculator"
                update=":Formulario :formConfirmCalculo" process="@this" onclick="confirmCalculo.show()"/>

            <p:commandButton
                value="Atualizar Cálculo"
                rendered="#{calculoAlvaraControlador.canRenderizarBtnAtualizarCalculo()}"
                styleClass="operacao prioritario mtop10 mrig05" icon="ui-icon-refresh"
                actionListener="#{calculoAlvaraControlador.verificarTaxaDeLocalizacaoAntesDeAtualizar()}"
                onclick="aguarde.show()" oncomplete="aguarde.hide()"
                update=":Formulario" process="@this"/>

            <p:commandButton value="Efetivar Cálculo"
                             disabled="#{!calculoAlvaraControlador.canHabilitarBotaoEfetivarCalculo()}"
                             styleClass="operacao mtop10 mrig05" icon="ui-icon-check" oncomplete="aguarde.hide()"
                             actionListener="#{calculoAlvaraControlador.efetivarCalculo}" update="@form"
                             onclick="if(!confirm('Deseja realmente efetivar o cálculo?')) {return false; } else {aguarde.show();}"/>

            <p:commandButton value="Estornar"
                             disabled="#{!calculoAlvaraControlador.canEstornarProcesso(calculoAlvaraControlador.selecionado)}"
                             styleClass="operacao mtop10 mrig05" icon="ui-icon-estornar" update=":FormularioEstorno"
                             process="@this"
                             onstart="aguarde.show();" oncomplete="aguarde.hide(); estorno.show();"/>

            <fc:botaoTargetBlank actionListener="#{calculoAlvaraControlador.imprimirDAM(null)}"
                                 label="Imprimir DAM"
                                 styleClass="operacao mtop10 mrig05"
                                 imprimeNoDialog="true"
                                 disabled="#{!calculoAlvaraControlador.hasImprimirDam()}"/>

            <p:commandButton value="Enviar DAM por email"
                             styleClass="operacao mtop10 mrig05" icon="ui-icon-mail-closed"
                             onstart="aguarde.show();" oncomplete="aguarde.hide();"
                             disabled="#{!calculoAlvaraControlador.hasImprimirDam()}"
                             actionListener="#{calculoAlvaraControlador.prepararEnvioEmail()}"/>

            <p:commandButton value="Enviar para Rede SIM" styleClass="operacao mtop10 mrig05"
                             icon="ui-icon-arrowreturnthick-1-n"
                             onstart="aguarde.show()" oncomplete="aguarde.hide()"
                             disabled="#{!calculoAlvaraControlador.hasImprimirDam()}"
                             actionListener="#{calculoAlvaraControlador.enviarDAMParaRedeSim()}"/>

            <p:commandButton value="Dispensa de Licenciamento"
                             styleClass="operacao mtop10 mrig05"
                             icon="ui-icon-print"
                             onclick="aguarde.show()" oncomplete="aguarde.hide()"
                             rendered="#{calculoAlvaraControlador.canImprimirDispensaLicenciamento()}"
                             actionListener="#{calculoAlvaraControlador.imprimirDeclaracaoDispensaLicenciamento()}"/>

            <fc:rodapeVisualizarPretty controlador="#{calculoAlvaraControlador}" mostrarEditar="false"
                                       mostrarExcluir="false" labelCancelar="Fechar"/>
        </h:form>

        <p:dialog header="Estornar Cálculo de Alvará" modal="true" widgetVar="estorno" width="700"
                  dynamic="true"
                  position="center"
                  style="position: fixed !important;"
                  id="dlgEstorno" draggable="false" resizable="false">
            <h:form id="FormularioEstorno">
                <p:tabView styleClass="mbot05 mtop05">
                    <p:tab title="Dados do Estorno">
                        <h:panelGrid columns="2">
                            <h:outputText value="Usuário: "/>
                            <h:outputText
                                value="#{calculoAlvaraControlador.usuarioEstorno.nome}"
                                styleClass="negrito"/>

                            <h:outputText value="Data/Hora: "/>
                            <h:outputText value="#{calculoAlvaraControlador.dataEstorno}"
                                          styleClass="negrito">
                                <f:convertDateTime pattern="dd/MM/yyyy hh:mm"/>
                            </h:outputText>

                            <fc:outputLabelObrigatorio value="Motivo: "/>
                            <p:inputTextarea value="#{calculoAlvaraControlador.motivoEstorno}"
                                             styleClass="mtop05"
                                             autoResize="true" rows="5" maxlength="3000"
                                             counterTemplate="{0} Caracteres Restantes."
                                             counter="counterObsEstorno" cols="50">
                            </p:inputTextarea>
                            <p:spacer/>
                            <h:outputText id="counterObsEstorno" styleClass="azul"/>
                        </h:panelGrid>
                    </p:tab>
                </p:tabView>

                <div style="width: 100%;">
                    <p:commandButton styleClass="operacao mtop05" value="OK" icon="ui-icon-check"
                                     actionListener="#{calculoAlvaraControlador.estornarCalculosAlvara()}"
                                     onclick="aguarde.show()" oncomplete="aguarde.hide();"
                                     update=":Formulario:tabViewCalc:panelParcelas"/>
                    <p:commandButton styleClass="operacao mlef05 mtop05" value="Fechar" icon="ui-icon-close"
                                     onstart="aguarde.show()"
                                     oncomplete="aguarde.hide(); estorno.hide()"/>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dialogProgresEfetivar"
                  width="800" closable="false" showHeader="false" modal="true"
                  hideEffect="clip" resizable="false" position="center" dynamic="true">
            <h:form id="formEfetivar">
                <p:panel style="text-align: center; width: 100%; border: 0px;"
                         id="panelBarraEfetivar">
                    <h:outputText
                        value="#{calculoAlvaraControlador.assistenteEfetivarProcesso.barraProgressoItens.mensagens}"
                        escape="false"/>
                    <br/>

                    <div class="progress progress-striped active" id="barraProgresso">
                        <div class="bar"
                             style="width: #{calculoAlvaraControlador.assistenteEfetivarProcesso.barraProgressoItens.porcentagemDoCalculo}%;">
                            <h:outputText
                                value="#{calculoAlvaraControlador.assistenteEfetivarProcesso.barraProgressoItens.porcentagemDoCalculo}"
                                styleClass="negrito">
                                <f:convertNumber type="number" maxFractionDigits="2"/>
                            </h:outputText>
                            <h:outputText value="%"/>
                        </div>
                    </div>
                    <br/>
                    <h:outputText
                        value="Tempo Decorrido: #{calculoAlvaraControlador.assistenteEfetivarProcesso.barraProgressoItens.tempoDecorrido}"
                        styleClass="negrito"/>
                    <br/>
                    <h:outputText
                        value="Tempo Estimado: #{calculoAlvaraControlador.assistenteEfetivarProcesso.barraProgressoItens.tempoEstimado}"
                        styleClass="negrito"/>
                    <br/>
                </p:panel>
            </h:form>
        </p:dialog>

        <p:dialog header="Enviar e-mail com o(s) DAM(s) em anexo"
                  modal="true"
                  dynamic="true"
                  position="center"
                  style="position: fixed !important;"
                  resizable="false"
                  widgetVar="listaEmails">
            <h:form id="formEmails">
                <h:panelGrid columns="2">
                    <h:outputText value="Valor: R$"/>
                    <h:outputText value="#{calculoAlvaraControlador.valor}" styleClass="negrito">
                        <f:convertNumber pattern="#,##0.00"/>
                    </h:outputText>
                </h:panelGrid>
                <br/>
                <div class="alert warn">
                    Por favor digite os e-mails de envio separados por (",")
                </div>
                <h:panelGrid columns="2" styleClass="mtop10">
                    <fc:outputLabelObrigatorio value="E-mail(s):" for="emails"/>
                    <p:inputTextarea id="emails" value="#{calculoAlvaraControlador.emails}" rows="1" cols="70"
                                     maxlength="255"/>
                    <fc:outputLabelObrigatorio value="Mensagem:" for="mensagem"/>
                    <h:panelGrid columns="2" cellpadding="0" cellspacing="0">
                        <p:inputTextarea title="Informe a mensagem do e-mail."
                                         value="#{calculoAlvaraControlador.msgEmail}"
                                         rows="4" cols="70" id="mensagem"
                                         maxlength="255" counter="counterMensagem"
                                         counterTemplate="{0} Caracteres restantes." autoResize="true"/>
                        <h:outputText id="counterMensagem" styleClass="mlef05"/>
                    </h:panelGrid>
                </h:panelGrid>
                <p:separator/>
                <h:panelGrid columns="2" style="width: 100%" styleClass="centralizado">

                    <p:commandButton value="Enviar DAM"
                                     icon="ui-icon-arrowreturnthick-1-n"
                                     onclick="aguarde.show()" oncomplete="aguarde.hide()"
                                     styleClass="operacao"
                                     actionListener="#{calculoAlvaraControlador.enviarDAMPorEmail()}"/>
                </h:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog header="Recibos do Alvará" modal="true" widgetVar="recibos"
                  position="center" width="950" closable="false"
                  id="dlgRecibos" draggable="false" resizable="false">
            <h:form id="FormularioRecibo" style="width: 100%;">
                <p:dataTable value="#{calculoAlvaraControlador.montarRecibos()}" var="rec"
                             emptyMessage="Nenhum recibo gerado para esse Alvará." styleClass="mbot10">
                    <p:column headerText="Número" style="text-align: center; width: 10%">
                        <h:outputText value="#{rec.sequencia}/#{rec.alvara.exercicio.ano}"/>
                    </p:column>
                    <p:column headerText="Data/Hora" style="text-align: center; width: 20%">
                        <h:outputText value="#{rec.dataImpressao}">
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Responsável" style="text-align: left; width: 30%">
                        <h:outputText value="#{rec.nomeResposavel}"/>
                    </p:column>
                    <p:column headerText="Usuário" style="text-align: left; width: 15%">
                        <h:outputText value="#{rec.usuarioSistema.login}"/>
                    </p:column>
                    <p:column headerText="Motivo" style="text-align: left; width: 25%">
                        <h:outputText value="#{rec.motivo}"/>
                    </p:column>
                </p:dataTable>

                <div style="text-align: center; width: 100%">
                    <p:commandButton styleClass="operacao" onstart="aguarde.show()"
                                     oncomplete="aguarde.hide(); recibos.hide()" value="OK"
                                     process="@this" update="@this"
                                     icon="ui-icon-check"/>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog header="CNAE(s)" modal="true" dynamic="true" showEffect="fade"
                  hideEffect="fade" position="center" style="position: fixed !important;"
                  draggable="false" resizable="false" widgetVar="dialogCnaesEscolhaVer"
                  closable="false">
            <h:form id="formDialogCnaesEscolhaVer">
                <div class="alert centralizado ">
                    Atenção! Existem CNAE(s) com mesmo código e grau de riscos diferentes. <br/>
                    Escolha quais CNAE(s) serão selecionados para o cálculo.
                </div>
                <p:dataTable id="tabelaCnaeMesmoCodigo"
                             emptyMessage="Nenhum registro foi adicionado"
                             var="cnaeMesmoCodigo"
                             value="#{calculoAlvaraControlador.cnaesMesmoCodigo}"
                             rowKey="#{cnaeMesmoCodigo.id}"
                             rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                             paginator="true"
                             rows="10"
                             paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>CNAE(s)&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                             rowIndexVar="rowlx"
                             rowsPerPageTemplate="10,25,50,100">
                    <p:column>
                        <p:commandButton icon="ui-icon-check"
                                         styleClass="vinteLarguraVinteAltura"
                                         rendered="#{calculoAlvaraControlador.hasCnaeTabela(cnaeMesmoCodigo)}"
                                         actionListener="#{calculoAlvaraControlador.removerCnaeEsolha(cnaeMesmoCodigo)}"
                                         update="tabelaCnaeMesmoCodigo"
                                         onstart="aguarde.show()"
                                         oncomplete="aguarde.hide()"/>
                        <p:commandButton value=" "
                                         styleClass="vinteLarguraVinteAltura"
                                         rendered="#{!calculoAlvaraControlador.hasCnaeTabela(cnaeMesmoCodigo)}"
                                         actionListener="#{calculoAlvaraControlador.adicionarCnaeEsolha(cnaeMesmoCodigo)}"
                                         update="tabelaCnaeMesmoCodigo"
                                         onstart="aguarde.show()"
                                         oncomplete="aguarde.hide()"/>
                    </p:column>
                    <p:column headerText="Código">
                        <h:outputText value="#{cnaeMesmoCodigo.cnae.codigoCnae}"/>
                    </p:column>
                    <p:column headerText="CNAE">
                        <h:outputText value="#{cnaeMesmoCodigo.cnae.descricaoDetalhada}"/>
                    </p:column>
                    <p:column headerText="Tipo">
                        <h:outputText value="#{cnaeMesmoCodigo.tipo.descricao}"/>
                    </p:column>
                    <p:column headerText="Grau de Risco">
                        <h:outputText value="#{cnaeMesmoCodigo.cnae.grauDeRisco.descricao}"/>
                    </p:column>
                </p:dataTable>

                <p:commandButton value="Confirmar" icon="ui-icon-check" onstart="aguarde.show()"
                                 styleClass="mtop05 operacao"
                                 update="@this :Formulario:tabViewGeral:tabelaCnae"
                                 process="@this"
                                 actionListener="#{calculoAlvaraControlador.confirmarCnaesMesmoCodigo()}"/>

            </h:form>

        </p:dialog>

        <p:confirmDialog widgetVar="confirmCalculo" header="Calcular alvará"
                         width="500" closable="false" appendToBody="true"
                         message="Deseja realmente realizar o
                         #{calculoAlvaraControlador.isAlvaraEmAberto(calculoAlvaraControlador.selecionado) ? 'calculo?' : 'recalculo?'}">
            <h:form id="formConfirmCalculo" styleClass="centralizado">
                <p:commandButton value="Sim"
                                 actionListener="#{calculoAlvaraControlador.verificarTaxaDeLocalizacaoAntesDeCalcular()}"
                                 styleClass="operacao" icon="ui-icon-check"
                                 onclick="aguarde.show(); confirmCalculo.hide()"
                                 oncomplete="aguarde.hide()"/>
                <p:commandButton value="Não" styleClass="operacao" onclick="confirmCalculo.hide();"
                                 icon="ui-icon-cancel"/>
            </h:form>
        </p:confirmDialog>

        <ui:include src="confirmacaoTaxaLocalizacao.xhtml"/>

        <p:dialog header="Alterações" widgetVar="alteracoes"
                  modal="true" position="center" dynamic="true"
                  style="position: fixed !important; overflow: hidden"
                  resizable="false" id="dlgAlteracoes"
                  height="#{calculoAlvaraControlador.canExibirMensagemAberturaExercicioCorrente() ? '180' : '420'}"
                  width="980"
                  closable="false">
            <div class="modal-body" style="max-height: 300px !important;">
                <h:form id="FormularioAlteracao">

                    <table width="100%">
                        <tr>
                            <td width="50%" style="vertical-align: top">
                                <p:panel header="Cnaes"
                                         rendered="#{!calculoAlvaraControlador.canExibirMensagemAberturaExercicioCorrente()}">

                                    <ui:repeat value="#{calculoAlvaraControlador.alteracaoSelecionada.alteracoesCnae}"
                                               var="alteracaoCnae" varStatus="indexCnae">
                                        <h:panelGrid columns="2"
                                                     rendered="#{calculoAlvaraControlador.alteracaoSelecionada.alteracoesCnae.size() > 1 and alteracaoCnae.cnae}"
                                                     styleClass="mtop10">
                                            <h:outputText value="Revisão: "
                                                          style="color: #{calculoAlvaraControlador.isAlteracaoCnae(indexCnae.index) ? '' : '#e33927'}"
                                                          styleClass="negrito"/>
                                            <h:outputText value="#{alteracaoCnae.revisao_id}"
                                                          style="color: #{calculoAlvaraControlador.isAlteracaoCnae(indexCnae.index) ? '' : '#e33927'}"
                                                          styleClass="negrito"/>

                                            <h:outputText
                                                value="Data #{calculoAlvaraControlador.isAlteracaoCnae(indexCnae.index) ? ': ' : 'Alteração: ' }"
                                                style="color: #{calculoAlvaraControlador.isAlteracaoCnae(indexCnae.index) ? '' : '#e33927'}"
                                                styleClass="negrito"/>
                                            <h:outputText value="#{alteracaoCnae.dataRevisao}"
                                                          style="color: #{calculoAlvaraControlador.isAlteracaoCnae(indexCnae.index) ? '' : '#e33927'}"
                                                          styleClass="negrito">
                                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
                                            </h:outputText>
                                        </h:panelGrid>

                                        <p:dataTable id="tabelaAlteracoesCnaes"
                                                     emptyMessage="Nenhum registro encontrado"
                                                     rendered="#{calculoAlvaraControlador.alteracaoSelecionada.alteracoesCnae.size() > 1}"
                                                     styleClass="mtop10" value="#{alteracaoCnae.alteracoesCnae}"
                                                     var="cnaeAlterado">
                                            <p:column headerText="Código CNAE" styleClass="alinhamentoEsquerda"
                                                      style="color: #{calculoAlvaraControlador.isAlteracaoCnae(indexCnae.index) ? '' : '#e33927'}">
                                                <h:outputText value="#{cnaeAlterado.codigoCnae}"/>
                                            </p:column>
                                            <p:column headerText="Grau de Risco" styleClass="alinhamentoEsquerda"
                                                      style="color: #{calculoAlvaraControlador.isAlteracaoCnae(indexCnae.index) ? '' : '#e33927'}">
                                                <h:outputText value="#{cnaeAlterado.grauDeRisco.descricao}"/>
                                            </p:column>
                                            <p:column headerText="Tipo CNAE" styleClass="alinhamentoEsquerda"
                                                      style="color: #{calculoAlvaraControlador.isAlteracaoCnae(indexCnae.index) ? '' : '#e33927'}">
                                                <h:outputText value="#{cnaeAlterado.tipoCnae.descricao}"/>
                                            </p:column>
                                        </p:dataTable>

                                    </ui:repeat>

                                </p:panel>
                            </td>
                            <td width="50%" style="vertical-align: top">
                                <p:panel header="Endereços"
                                         rendered="#{!calculoAlvaraControlador.canExibirMensagemAberturaExercicioCorrente()}">
                                    <ui:repeat
                                        value="#{calculoAlvaraControlador.alteracaoSelecionada.alteracoesEndereco}"
                                        var="alteracaoEndereco" varStatus="indexEndereco">
                                        <h:panelGrid columns="2"
                                                     rendered="#{calculoAlvaraControlador.alteracaoSelecionada.alteracoesEndereco.size() > 1 and !alteracaoEndereco.cnae}"
                                                     styleClass="mtop10" columnClasses="tamanho-grid">
                                            <h:outputText value="Revisão: "
                                                          style="color: #{calculoAlvaraControlador.isAlteracaoEndereco(indexEndereco.index) ? '' : '#e33927'}"
                                                          styleClass="negrito"/>
                                            <h:outputText value="#{alteracaoEndereco.revisao_id}"
                                                          style="color: #{calculoAlvaraControlador.isAlteracaoEndereco(indexEndereco.index) ? '' : '#e33927'}"
                                                          styleClass="negrito"/>

                                            <h:outputText
                                                value="Data #{calculoAlvaraControlador.isAlteracaoEndereco(indexEndereco.index) ? ': ' : 'Alteração: ' }"
                                                style="color: #{calculoAlvaraControlador.isAlteracaoEndereco(indexEndereco.index) ? '' : '#e33927'}"
                                                styleClass="negrito"/>
                                            <h:outputText value="#{alteracaoEndereco.dataRevisao}" styleClass="negrito"
                                                          style="color: #{calculoAlvaraControlador.isAlteracaoEndereco(indexEndereco.index) ? '' : '#e33927'}">
                                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
                                            </h:outputText>

                                            <h:outputText value="Endereço :"
                                                          style="color: #{calculoAlvaraControlador.isAlteracaoEndereco(indexEndereco.index) ? '' : '#e33927'}"
                                                          styleClass="negrito"/>
                                            <h:outputText
                                                style="color: #{calculoAlvaraControlador.isAlteracaoEndereco(indexEndereco.index) ? '' : '#e33927'}"
                                                value="#{calculoAlvaraControlador.montarEnderecoVo(alteracaoEndereco.endereco)}"
                                                styleClass="negrito"/>
                                        </h:panelGrid>
                                    </ui:repeat>
                                </p:panel>
                            </td>
                        </tr>
                    </table>
                </h:form>
            </div>

            <c:if test="#{calculoAlvaraControlador.canExibirMensagemAberturaExercicioCorrente()}">
                <div class="alert centralizado modal-body" style="color: black; font-weight: bold">
                    Taxa gerada devido a abertura no exercício corrente<br/>
                    ou por não haver alvará de localização lançado em exercícios anteriores.<br/>
                </div>
            </c:if>

            <div class="modal-footer alinhamentoDireita" style="width: 98%; height: 15px; margin-top: 04px !important;">
                <p:commandButton styleClass="operacao" onstart="aguarde.show()"
                                 oncomplete="aguarde.hide(); alteracoes.hide()" value="Fechar"
                                 process="@this" update="@this"
                                 icon="ui-icon-close"/>
            </div>
        </p:dialog>

    </ui:define>
</ui:composition>
</html>
