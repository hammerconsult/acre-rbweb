<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui"
>
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <p:messages id="msgs" showDetail="true"/>
        <h:form id="Formulario">
            <fc:cabecalhoPretty auditavel="#{true}" controlador="#{lancamentoDescontoControlador}"
                                origem="#{lancamentoDescontoControlador.caminhoPadrao}ver/#{lancamentoDescontoControlador.selecionado.id}/"/>
            <p:panel header="Processo de Desconto">
                <h:panelGrid columns="2">
                    <h:outputText value="Exercício: "/>
                    <h:outputText value="#{lancamentoDescontoControlador.selecionado.exercicio.ano}" styleClass="negrito"/>

                    <h:outputText value="Número: "/>
                    <h:outputText value="#{lancamentoDescontoControlador.selecionado.codigo}" styleClass="negrito"/>

                    <h:outputText value="Protocolo: "/>
                    <h:outputText value="#{lancamentoDescontoControlador.selecionado.numeroProtocolo}" styleClass="negrito"/>

                    <h:outputText value="Data: "/>
                    <h:outputText value="#{lancamentoDescontoControlador.selecionado.dataLancamento}" styleClass="negrito">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </h:outputText>

                    <h:outputText value="Usuário: "/>
                    <h:outputText
                        value="#{lancamentoDescontoControlador.selecionado.usuario ne null? lancamentoDescontoControlador.selecionado.usuario.nome : ''}" styleClass="negrito"/>

                    <h:outputText value="Situação: "/>
                    <h:outputText value="#{lancamentoDescontoControlador.selecionado.situacao.descricao}" styleClass="negrito"/>

                    <h:outputText value="Ato Legal: "/>
                    <h:outputText value="#{lancamentoDescontoControlador.selecionado.atoLegal}" styleClass="negrito"/>

                    <h:outputText value="Motivo: "/>
                    <h:outputText value="#{lancamentoDescontoControlador.selecionado.motivo}" styleClass="negrito"/>
                </h:panelGrid>

                <p:tabView id="tabView" styleClass="mtop10">
                    <p:tab title="Configurações de Desconto">
                        <p:outputPanel id="panelConfiguracaoDesconto">
                            <table style="width: 100%">
                                <tr>
                                    <td>
                                        <h:panelGrid columns="2">
                                            <h:outputText value="Data Inicial: "/>
                                            <h:outputText value="#{lancamentoDescontoControlador.selecionado.inicio}" styleClass="negrito">
                                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                                            </h:outputText>

                                            <h:outputText value="Data Final: "/>
                                            <h:outputText value="#{lancamentoDescontoControlador.selecionado.fim}" styleClass="negrito">
                                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                                            </h:outputText>

                                            <h:outputText value="Tipo de Desconto: "/>
                                            <h:outputText value="#{lancamentoDescontoControlador.selecionado.tipoDesconto.descricao}" styleClass="negrito"/>
                                        </h:panelGrid>
                                    </td><td>
                                    <p:panel rendered="#{lancamentoDescontoControlador.selecionado.tipoDesconto ne null}">
                                        <h:panelGrid columns="6">
                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          value="Desconto Imposto(R$): "/>
                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          value="Desconto Imposto(%): "/>
                                            <h:outputText value="#{lancamentoDescontoControlador.selecionado.valorDescontoImposto}"
                                                          rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          styleClass="negrito">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                            <h:outputText value="#{lancamentoDescontoControlador.selecionado.percentualDescontoImposto}"
                                                          rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          styleClass="negrito">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>

                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          value="Desconto Taxa(R$): " styleClass="mlef10"/>
                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          value="Desconto Taxa(%): " styleClass="mlef10"/>
                                            <h:outputText value="#{lancamentoDescontoControlador.selecionado.valorDescontoTaxa}"
                                                          rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          styleClass="negrito">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                            <h:outputText value="#{lancamentoDescontoControlador.selecionado.percentualDescontoTaxa}"
                                                          rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          styleClass="negrito">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>

                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          value="Desconto Juros(R$): " styleClass="mlef10"/>
                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          value="Desconto Juros(%): " styleClass="mlef10"/>
                                            <h:outputText value="#{lancamentoDescontoControlador.selecionado.valorDescontoJuros}"
                                                          rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          styleClass="negrito">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                            <h:outputText value="#{lancamentoDescontoControlador.selecionado.percentualDescontoJuros}"
                                                          rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          styleClass="negrito">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>

                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          value="Desconto Multa(R$): "/>
                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          value="Desconto Multa(%): "/>
                                            <h:outputText value="#{lancamentoDescontoControlador.selecionado.valorDescontoMulta}"
                                                          rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          styleClass="negrito">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                            <h:outputText value="#{lancamentoDescontoControlador.selecionado.percentualDescontoMulta}"
                                                          rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          styleClass="negrito">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>

                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          value="Desconto Correção(R$): " styleClass="mlef10"/>
                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          value="Desconto Correção(%): " styleClass="mlef10"/>
                                            <h:outputText value="#{lancamentoDescontoControlador.selecionado.valorDescontoCorrecao}"
                                                          rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          styleClass="negrito">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                            <h:outputText value="#{lancamentoDescontoControlador.selecionado.percentualDescontoCorrecao}"
                                                          rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          styleClass="negrito">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>

                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          value="Desconto Honorários(R$): " styleClass="mlef10"/>
                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          value="Desconto Honorários(%): " styleClass="mlef10"/>
                                            <h:outputText value="#{lancamentoDescontoControlador.selecionado.valorDescontoHonorarios}"
                                                          rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          styleClass="negrito">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                            <h:outputText value="#{lancamentoDescontoControlador.selecionado.percentualDescontoHonorarios}"
                                                          rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          styleClass="negrito">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                        </h:panelGrid>
                                    </p:panel>
                                </td>
                                </tr>
                            </table>
                        </p:outputPanel>
                    </p:tab>
                </p:tabView>

                <p:tabView id="tabDivida" styleClass="mtop10">
                    <p:tab title="Dívidas" id="divida">
                        <p:outputPanel id="panelDivida">
                            <p:dataTable id="tabelaItens" emptyMessage="Nenhum registro foi adicionado" var="item"
                                         value="#{lancamentoDescontoControlador.selecionado.parcelas}">
                                <f:facet name="header">
                                    <h:outputText value="Débitos do Processo" styleClass="negrito"/>
                                </f:facet>
                                <p:column headerText="Cadastro">
                                    <h:outputText
                                        value="#{lancamentoDescontoControlador.buscarInscricaoDoCadastro(item.parcela)}"/>
                                </p:column>
                                <p:column headerText="Dívida">
                                    <h:outputText value="#{item.parcela.valorDivida.divida.descricao}"/>
                                </p:column>
                                <p:column headerText="Referência">
                                    <h:outputText
                                        value="#{item.parcela.situacaoAtual.referencia}"/>
                                </p:column>
                                <p:column headerText="Exercício" style="text-align: center">
                                    <h:outputText value="#{item.parcela.valorDivida.exercicio.ano}"/>
                                </p:column>
                                <p:column headerText="Parcela" style="text-align: right">
                                    <h:outputText value="#{lancamentoDescontoControlador.montarNumeroParcela(item.parcela)}"
                                                  title="#{item.parcela.id}"/>
                                </p:column>
                                <p:column headerText="Vencimento" style="text-align: center">
                                    <h:outputText value="#{item.parcela.vencimento}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Tipo de Dívida">
                                    <h:outputText
                                        value="#{lancamentoDescontoControlador.retornarSituacaoDaDivida(item.parcela)}"/>
                                </p:column>
                                <p:column headerText="Situação">
                                    <h:outputText
                                        value="#{item.parcela.situacaoAtual.situacaoParcela.descricao}"/>
                                </p:column>
                                <p:column headerText="Imposto (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.imposto}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Taxa (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.taxa}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Juros (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.juros}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Multa (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.multa}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Correção (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.correcao}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Honorários (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.honorarios}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Desconto (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.desconto}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Total (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.total}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                            </p:dataTable>
                        </p:outputPanel>
                    </p:tab>
                </p:tabView>

                <p:tabView id="tabDividaComDesconto" styleClass="mtop10">
                    <p:tab title="Dívidas com Descontos" id="dividaComDesconto">
                        <p:outputPanel id="panelDividasComDesconto">
                            <p:dataTable id="tabelaDividasDesconto" emptyMessage="Nenhum registro foi adicionado" var="item"
                                         value="#{lancamentoDescontoControlador.selecionado.parcelasComDescontos}">
                                <f:facet name="header">
                                    <h:outputText value="Débitos do Processo com Aplicação dos Descontos"
                                                  styleClass="negrito"/>
                                </f:facet>
                                <p:column headerText="Cadastro">
                                    <h:outputText
                                        value="#{lancamentoDescontoControlador.buscarInscricaoDoCadastro(item.parcela)}"/>
                                </p:column>
                                <p:column headerText="Dívida">
                                    <h:outputText value="#{item.parcela.valorDivida.divida.descricao}"/>
                                </p:column>
                                <p:column headerText="Referência">
                                    <h:outputText
                                        value="#{item.parcela.situacaoAtual.referencia}"/>
                                </p:column>
                                <p:column headerText="Exercício" style="text-align: center">
                                    <h:outputText value="#{item.parcela.valorDivida.exercicio.ano}"/>
                                </p:column>
                                <p:column headerText="Parcela" style="text-align: right">
                                    <h:outputText value="#{lancamentoDescontoControlador.montarNumeroParcela(item.parcela)}"
                                                  title="#{item.parcela.id}"/>
                                </p:column>
                                <p:column headerText="Vencimento" style="text-align: center">
                                    <h:outputText value="#{item.parcela.vencimento}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Tipo de Dívida">
                                    <h:outputText
                                        value="#{lancamentoDescontoControlador.retornarSituacaoDaDivida(item.parcela)}"/>
                                </p:column>
                                <p:column headerText="Situação">
                                    <h:outputText
                                        value="#{item.parcela.situacaoAtual.situacaoParcela.descricao}"/>
                                </p:column>
                                <p:column headerText="Imposto (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.imposto}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Taxa (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.taxa}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Juros (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.juros}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Multa (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.multa}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Correção (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.correcao}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Honorários (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.honorariosAtualizados}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Desconto (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.totalDescontoComOriginal}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Total (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.totalComDescontos}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                            </p:dataTable>
                        </p:outputPanel>
                    </p:tab>
                </p:tabView>
            </p:panel>

            <p:commandButton value="Processar"
                             styleClass="operacao prioritario mtop10 mrig05"
                             icon="ui-icon-check"
                             onclick="confirmEfetivar.show()"
                             disabled="#{!lancamentoDescontoControlador.isPossivelEfetivar()}"/>

            <p:commandButton value="Estornar"
                             styleClass="operacao mtop10 mrig03"
                             icon="ui-icon-close"
                             onclick="dialogEstorno.show()"
                             disabled="#{!lancamentoDescontoControlador.isPossivelEstornar()}"/>

            <p:commandButton value="Voltar"
                             id="cbCancelar"
                             styleClass="operacao mtop10"
                             onclick="aguarde.show()"
                             oncomplete="aguarde.hide()"
                             style="height: 30px;"
                             icon="ui-icon-cancel"
                             title="Clique para cancelar e retornar a página anterior."
                             actionListener="#{lancamentoDescontoControlador.cancelar()}"/>
        </h:form>


        <p:confirmDialog id="dialogConfirmEfetivar" header="Efetivar Lançamento de Desconto"
                         message="Tem certeza que deseja efetivar esse Lançamento de Desconto?" severity="alert"
                         widgetVar="confirmEfetivar" closable="false">
            <h:form id="formDialogEfetivar">
                <div style="text-align: center">
                    <p:commandButton id="confirm" value="Sim" oncomplete="confirmEfetivar.hide(); aguarde.hide()"
                                     ajax="false" action="lista" onclick="aguarde.show()"
                                     styleClass="operacao prioritario" icon="ui-icon-check"
                                     actionListener="#{lancamentoDescontoControlador.efetivarLancamento()}"/>
                    <p:commandButton id="decline" value="Cancelar" oncomplete="confirmEfetivar.hide()" immediate="true"
                                     styleClass="operacao" icon="ui-icon-cancel"/>
                </div>
            </h:form>
        </p:confirmDialog>

        <p:dialog id="idEstorno" width="1000"
                  modal="true" widgetVar="dialogEstorno" header="Estorno" resizable="false">
            <h:form>
                <p:panel>
                    <h:panelGrid columns="1" id="gridEstorno" style="width: 100%!important">
                        <h:outputText value="Motivo ou Fundamentação Legal para o Estorno"/>
                        <p:inputTextarea value="#{lancamentoDescontoControlador.selecionado.motivoCancelamento}"
                                         style="width: 100%"
                                         id="motivoEstorno" rows="10"/>
                        <h:outputText value="Data do Estorno"/>
                        <h:outputText value="#{lancamentoDescontoControlador.selecionado.dataCancelamento}" styleClass="negrito">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </h:panelGrid>
                    <p:panel>
                        <p:commandButton value="Confirmar" styleClass="operacao prioritario"
                                         onclick="if (!confirm('Tem certeza que deseja estornar esse processo de Desconto?'))
                                     return false;"
                                         onstart="aguarde.show(); dialogEstorno.hide()"
                                         oncomplete="aguarde.hide()"
                                         update="@form"
                                         icon="ui-icon-disk"
                                         actionListener="#{lancamentoDescontoControlador.estornarLancamento()}"
                            />
                        <p:commandButton value="Cancelar" styleClass="operacao" icon="ui-icon-cancel"
                                         actionListener="#{lancamentoDescontoControlador.limparEstorno()}"
                                         update="gridEstorno motivoEstorno" oncomplete="dialogEstorno.hide()"/>
                    </p:panel>
                    <p:focus for="motivoEstorno"/>
                </p:panel>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>
