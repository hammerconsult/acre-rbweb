<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">

        <h:form id="Formulario">
            <fc:cabecalhoPretty origem="#{lancamentoDescontoControlador.caminhoPadrao}/listar/"
                                controlador="#{lancamentoDescontoControlador}"/>
            <p:panel header="Processo de Desconto">
                <h:panelGrid columns="6" style="width: 50%">
                    <h:outputText value="Exercício"/>
                    <h:outputText value="Código"/>
                    <h:outputText value="Data"/>
                    <h:outputText value="Protocolo"/>
                    <h:outputText value="Situação"/>
                    <h:outputText value="Usuário"/>
                    <p:inputText size="4" value="#{lancamentoDescontoControlador.selecionado.exercicio}"
                                 styleClass="campo-bloqueado" readonly="true"/>
                    <p:inputText id="codigo" size="10"
                                 value="#{lancamentoDescontoControlador.selecionado.codigo}"
                                 title="Código do Processo de Débitos"
                                 styleClass="campo-bloqueado"
                                 readonly="true"/>

                    <p:inputText id="data" size="10"
                                 readonly="true"
                                 styleClass="campo-bloqueado"
                                 value="#{lancamentoDescontoControlador.selecionado.dataLancamento}"
                                 title="Data do Processo de Débitos">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </p:inputText>

                    <p:inputText id="protocolo"
                                 value="#{lancamentoDescontoControlador.selecionado.numeroProtocolo}"
                                 title="Digite o número do protocolo">
                        <p:ajax event="blur" process="@this"/>
                    </p:inputText>

                    <p:inputText title="Situação do Processo de Débitos"
                                 value="#{lancamentoDescontoControlador.selecionado.situacao.descricao}"
                                 styleClass="azulnegrito"
                                 readonly="true"/>
                    <p:inputText title="Usuário responsável pelo Processo de Débitos"
                                 value="#{lancamentoDescontoControlador.selecionado.usuario.login}"
                                 styleClass="amarelonegrito" readonly="true"/>
                </h:panelGrid>

                <p:tabView id="tabView" styleClass="mtop10">
                    <p:tab title="Processo" id="processo">
                        <p:outputPanel id="panelDadosGerais">
                            <h:panelGrid columns="1">
                                <h:outputText value="Ato Legal: "/>
                                <p:autoComplete queryDelay="1000" id="atoLegal" title="Digite o Ato Legal"
                                                value="#{lancamentoDescontoControlador.selecionado.atoLegal}"
                                                completeMethod="#{lancamentoDescontoControlador.completaAtoLegal}"
                                                var="ato"
                                                itemLabel="#{ato.nome}"
                                                itemValue="#{ato.id}"
                                                forceSelection="false"
                                                converter="#{lancamentoDescontoControlador.converterAtoLegal}"
                                                size="105"
                                                maxResults="10">
                                    <p:ajax event="blur" process="@this"/>
                                </p:autoComplete>

                                <h:panelGrid columns="1">
                                    <fc:outputLabelObrigatorio value="Motivo ou Fundamentação Legal"/>
                                    <p:inputTextarea value="#{lancamentoDescontoControlador.selecionado.motivo}"
                                                     cols="105">
                                        <p:ajax event="blur" process="@this"/>
                                    </p:inputTextarea>
                                </h:panelGrid>
                            </h:panelGrid>
                        </p:outputPanel>
                    </p:tab>
                    <p:tab title="Configurações de Desconto" id="configuracao">
                        <p:outputPanel id="panelConfiguracaoDesconto">
                            <table style="width: 100%">
                                <tr>
                                    <td>
                                        <h:panelGrid columns="2">
                                            <fc:outputLabelObrigatorio value="Data Inicial: "/>
                                            <fc:calendar id="dataInicial"
                                                         value="#{lancamentoDescontoControlador.selecionado.inicio}"
                                                         title="Informe a data de inicio da contagem do desconto"
                                                         showOn="button"
                                                         disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}"/>
                                            <fc:outputLabelObrigatorio value="Data Final: "/>
                                            <fc:calendar id="dataFinal"
                                                         value="#{lancamentoDescontoControlador.selecionado.fim}"
                                                         title="Informe a data de final da contagem do desconto"
                                                         showOn="button"
                                                         disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}"/>
                                            <fc:outputLabelObrigatorio id="tipoDesconto" value="Tipo de Desconto: "/>
                                            <h:selectOneMenu value="#{lancamentoDescontoControlador.selecionado.tipoDesconto}"
                                                             disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}">
                                                <f:selectItems value="#{lancamentoDescontoControlador.tiposDesconto}"/>
                                                <p:ajax event="valueChange" process="panelConfiguracaoDesconto"
                                                        update="panelConfiguracaoDesconto"
                                                        listener="#{lancamentoDescontoControlador.processarAlteracaoTipoDesconto()}"/>
                                            </h:selectOneMenu>
                                        </h:panelGrid>
                                    </td><td>
                                    <p:panel rendered="#{lancamentoDescontoControlador.selecionado.tipoDesconto ne null}">
                                        <h:panelGrid columns="6">
                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          value="Desconto Imposto(R$): "/>
                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          value="Desconto Imposto(%): "/>
                                            <p:inputText size="12" id="valorDescontoImposto"
                                                         value="#{lancamentoDescontoControlador.selecionado.valorDescontoImposto}"
                                                         rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                         converter="#{lancamentoDescontoControlador.superMoneyConverter}"
                                                         disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}"
                                                         onkeydown="mascaraMonetaria(this, false);">
                                                <p:ajax event="blur" process="@this"/>
                                            </p:inputText>
                                            <p:inputText size="12" id="percentualDescontoImposto"
                                                         value="#{lancamentoDescontoControlador.selecionado.percentualDescontoImposto}"
                                                         rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                         onkeypress="mascara(this, porcentagem)"
                                                         converter="#{lancamentoDescontoControlador.superPercentualConverter}"
                                                         disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}">
                                                <p:ajax event="blur" process="@this"/>
                                            </p:inputText>

                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          value="Desconto Taxa(R$): " styleClass="mlef05"/>
                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          value="Desconto Taxa(%): " styleClass="mlef05"/>
                                            <p:inputText size="12" id="valorDescontoTaxa"
                                                         value="#{lancamentoDescontoControlador.selecionado.valorDescontoTaxa}"
                                                         rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                         converter="#{lancamentoDescontoControlador.superMoneyConverter}"
                                                         disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}"
                                                         onkeydown="mascaraMonetaria(this, false);">
                                                <p:ajax event="blur" process="@this"/>
                                            </p:inputText>
                                            <p:inputText size="12" id="percentualDescontoTaxa"
                                                         value="#{lancamentoDescontoControlador.selecionado.percentualDescontoTaxa}"
                                                         rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                         onkeypress="mascara(this, porcentagem)"
                                                         converter="#{lancamentoDescontoControlador.superPercentualConverter}"
                                                         disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}">
                                                <p:ajax event="blur" process="@this"/>
                                            </p:inputText>

                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          value="Desconto Juros(R$): " styleClass="mlef05"/>
                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          value="Desconto Juros(%): " styleClass="mlef05"/>
                                            <p:inputText size="12" id="valorDescontoJuros"
                                                         value="#{lancamentoDescontoControlador.selecionado.valorDescontoJuros}"
                                                         rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                         converter="#{lancamentoDescontoControlador.superMoneyConverter}"
                                                         disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}"
                                                         onkeydown="mascaraMonetaria(this, false);">
                                                <p:ajax event="blur" process="@this"/>
                                            </p:inputText>
                                            <p:inputText size="12" id="percentualDescontoJuros"
                                                         value="#{lancamentoDescontoControlador.selecionado.percentualDescontoJuros}"
                                                         rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                         onkeypress="mascara(this, porcentagem)"
                                                         converter="#{lancamentoDescontoControlador.superPercentualConverter}"
                                                         disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}">
                                                <p:ajax event="blur" process="@this"/>
                                            </p:inputText>

                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          value="Desconto Multa(R$): "/>
                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          value="Desconto Multa(%): "/>
                                            <p:inputText size="12" id="valorDescontoMulta"
                                                         value="#{lancamentoDescontoControlador.selecionado.valorDescontoMulta}"
                                                         rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                         converter="#{lancamentoDescontoControlador.superMoneyConverter}"
                                                         disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}"
                                                         onkeydown="mascaraMonetaria(this, false);">
                                                <p:ajax event="blur" process="@this"/>
                                            </p:inputText>
                                            <p:inputText size="12" id="percentualDescontoMulta"
                                                         value="#{lancamentoDescontoControlador.selecionado.percentualDescontoMulta}"
                                                         rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                         onkeypress="mascara(this, porcentagem)"
                                                         converter="#{lancamentoDescontoControlador.superPercentualConverter}"
                                                         disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}">
                                                <p:ajax event="blur" process="@this"/>
                                            </p:inputText>

                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          value="Desconto Correção(R$): " styleClass="mlef05"/>
                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          value="Desconto Correção(%): " styleClass="mlef05"/>
                                            <p:inputText size="12" id="valorDescontoCorrecao"
                                                         value="#{lancamentoDescontoControlador.selecionado.valorDescontoCorrecao}"
                                                         rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                         converter="#{lancamentoDescontoControlador.superMoneyConverter}"
                                                         disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}"
                                                         onkeydown="mascaraMonetaria(this, false);">
                                                <p:ajax event="blur" process="@this"/>
                                            </p:inputText>
                                            <p:inputText size="12" id="percentualDescontoCorrecao"
                                                         value="#{lancamentoDescontoControlador.selecionado.percentualDescontoCorrecao}"
                                                         rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                         onkeypress="mascara(this, porcentagem)"
                                                         converter="#{lancamentoDescontoControlador.superPercentualConverter}"
                                                         disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}">
                                                <p:ajax event="blur" process="@this"/>
                                            </p:inputText>

                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                          value="Desconto Honorários(R$): " styleClass="mlef05"/>
                                            <h:outputText rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                          value="Desconto Honorários(%): " styleClass="mlef05"/>
                                            <p:inputText size="12" id="valorDescontoHonorarios"
                                                         value="#{lancamentoDescontoControlador.selecionado.valorDescontoHonorarios}"
                                                         rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoFixo}"
                                                         converter="#{lancamentoDescontoControlador.superMoneyConverter}"
                                                         disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}"
                                                         onkeydown="mascaraMonetaria(this, false);">
                                                <p:ajax event="blur" process="@this"/>
                                            </p:inputText>
                                            <p:inputText size="12" id="percentualDescontoHonorarios"
                                                         value="#{lancamentoDescontoControlador.selecionado.percentualDescontoHonorarios}"
                                                         rendered="#{lancamentoDescontoControlador.selecionado.tipoDescontoPercentual}"
                                                         onkeypress="mascara(this, porcentagem)"
                                                         converter="#{lancamentoDescontoControlador.superPercentualConverter}"
                                                         disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}">
                                                <p:ajax event="blur" process="@this"/>
                                            </p:inputText>
                                        </h:panelGrid>
                                    </p:panel>
                                </td>
                                </tr>
                            </table>
                        </p:outputPanel>
                    </p:tab>
                </p:tabView>

                <p:tabView id="tabDivida" styleClass="mtop10">
                    <p:tab title="Dívidas" id="divida">
                        <h:panelGrid columns="4" styleClass="mtop05" id="panelCadastro">
                            <h:outputText value="Tipo de Cadastro: "/>
                            <h:selectOneMenu value="#{lancamentoDescontoControlador.tipoCadastroTributario}"
                                             disabled="#{lancamentoDescontoControlador.desabilitarAlteracaoCadastro()}">
                                <f:selectItems value="#{lancamentoDescontoControlador.tiposCadastro}"/>
                                <p:ajax update="@form" event="change"
                                        listener="#{lancamentoDescontoControlador.limparCadastro()}"/>
                            </h:selectOneMenu>

                            <h:outputText value="Cadastro Econômico"
                                          rendered="#{lancamentoDescontoControlador.tipoCadastroTributario eq 'ECONOMICO'}"/>
                            <fc:novoAutocompleteCadastroEconomico
                                value="#{lancamentoDescontoControlador.cadastro}"
                                id="cad"
                                mostraBotaoEdita="false"
                                mostraBotaoNovo="false"
                                rendered="#{lancamentoDescontoControlador.tipoCadastroTributario eq 'ECONOMICO'}"
                                disabled="#{lancamentoDescontoControlador.desabilitarAlteracaoCadastro()}"
                                mostraSituacoes="false"
                                updateItemSelect="@form"
                                caminhoAtual="/tributario/lancamento-de-desconto/novo/"/>

                            <h:outputText value="Cadastro Imobiliário: "
                                          rendered="#{lancamentoDescontoControlador.tipoCadastroTributario eq 'IMOBILIARIO'}"/>
                            <fc:pesquisaCadastroImobiliario id="pesquisaCadastroImobiliario"
                                                            cadastro="#{lancamentoDescontoControlador.cadastro}"
                                                            mostrarDetalhesCadastro="false"
                                                            mostrarLabelAutoComplete="false"
                                                            updateItemSelect="@form"
                                                            size="70"
                                                            rendered="#{lancamentoDescontoControlador.tipoCadastroTributario eq 'IMOBILIARIO'}"
                                                            autoCompleteDisabled="#{lancamentoDescontoControlador.desabilitarAlteracaoCadastro()}"/>

                            <h:outputText value="Cadastro Rural: "
                                          rendered="#{lancamentoDescontoControlador.tipoCadastroTributario eq 'RURAL'}"/>
                            <fc:pesquisaCadastroRural mostrarLabelAutoComplete="false"
                                                      cadastro="#{lancamentoDescontoControlador.cadastro}"
                                                      id="componente" size="70"
                                                      updateItemSelect="@form"
                                                      mostrapesquisa="false"
                                                      rendered="#{lancamentoDescontoControlador.tipoCadastroTributario eq 'RURAL'}"
                                                      disabled="#{lancamentoDescontoControlador.desabilitarAlteracaoCadastro()}"/>

                            <h:outputText value="Contribuinte: "
                                          rendered="#{lancamentoDescontoControlador.tipoCadastroTributario eq 'PESSOA'}"/>
                            <fc:novoAutocompletePessoa id="contribuinte"
                                                       value="#{lancamentoDescontoControlador.filtroContribuinte}"
                                                       caminhoAtual="#{lancamentoDescontoControlador.urlAtual}"
                                                       update="@form"
                                                       mostraBotaoNovo="false"
                                                       mostraBotaoEdita="false"
                                                       mostraSituacoes="false"
                                                       permiteAlterarSituacoes="false"
                                                       situacoesPossiveis="#{lancamentoDescontoControlador.situacoesPesquisaPessoa}"
                                                       rendered="#{lancamentoDescontoControlador.tipoCadastroTributario eq 'PESSOA'}"
                                                       disabled="#{lancamentoDescontoControlador.desabilitarAlteracaoCadastro()}"
                                                       size="70"/>
                        </h:panelGrid>

                        <p:commandButton value="Consulta de Débitos"
                                         icon="ui-icon-search"
                                         styleClass="operacao mtop05 mbot05"
                                         disabled="#{lancamentoDescontoControlador.desabilitarConsultaDebitos()}"
                                         onclick="aguarde.show()"
                                         oncomplete="aguarde.hide();"
                                         actionListener="#{lancamentoDescontoControlador.iniciarConsultaDebitos()}"
                                         process="@form"
                                         update=":FormDialog"/>

                        <p:outputPanel id="panelDivida">

                            <p:dataTable id="tabelaItens" emptyMessage="Nenhum registro foi adicionado" var="item"
                                         value="#{lancamentoDescontoControlador.selecionado.parcelas}">
                                <f:facet name="header">
                                    <h:outputText value="Débitos do Processo" styleClass="negrito"/>
                                </f:facet>
                                <p:column headerText="Cadastro">
                                    <h:outputText
                                        value="#{lancamentoDescontoControlador.buscarInscricaoDoCadastro(item.parcela)}"/>
                                </p:column>
                                <p:column headerText="Dívida">
                                    <h:outputText value="#{item.parcela.valorDivida.divida.descricao}"/>
                                </p:column>
                                <p:column headerText="Referência">
                                    <h:outputText
                                        value="#{item.parcela.situacaoAtual.referencia}"/>
                                </p:column>
                                <p:column headerText="Exercício" style="text-align: center">
                                    <h:outputText value="#{item.parcela.valorDivida.exercicio.ano}"/>
                                </p:column>
                                <p:column headerText="Parcela" style="text-align: right">
                                    <h:outputText value="#{lancamentoDescontoControlador.montarNumeroParcela(item.parcela)}"
                                                  title="#{item.parcela.id}"/>
                                </p:column>
                                <p:column headerText="Vencimento" style="text-align: center">
                                    <h:outputText value="#{item.parcela.vencimento}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Tipo de Dívida">
                                    <h:outputText
                                        value="#{lancamentoDescontoControlador.retornarSituacaoDaDivida(item.parcela)}"/>
                                </p:column>
                                <p:column headerText="Situação">
                                    <h:outputText
                                        value="#{item.parcela.situacaoAtual.situacaoParcela.descricao}"/>
                                </p:column>
                                <p:column headerText="Imposto (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.imposto}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Taxa (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.taxa}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Juros (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.juros}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Multa (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.multa}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Correção (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.correcao}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Honorários (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.honorarios}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Desconto (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.desconto}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Total (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.total}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Remover" style="text-align: center">
                                    <p:commandButton
                                        actionListener="#{lancamentoDescontoControlador.removerParcela(item)}"
                                        disabled="#{lancamentoDescontoControlador.selecionado.lancouDescontos}"
                                        onclick="aguarde.show()" oncomplete="aguarde.hide()"
                                        icon="ui-icon-trash"
                                        styleClass="icone_vermelho"
                                        update=":Formulario:tabDivida:panelDivida">
                                    </p:commandButton>
                                </p:column>
                            </p:dataTable>

                            <p:commandButton value="Confirmar Dívidas Selecionadas"
                                             icon="ui-icon-arrowthick-1-s"
                                             styleClass="operacao mtop10"
                                             disabled="#{lancamentoDescontoControlador.desabilitarConfirmacaoDividasSelecionadas()}"
                                             onclick="aguarde.show()"
                                             oncomplete="aguarde.hide();"
                                             actionListener="#{lancamentoDescontoControlador.lancarDescontosDebitosSelecionados()}"/>
                        </p:outputPanel>
                    </p:tab>
                </p:tabView>

                <p:tabView id="tabDividaComDesconto" styleClass="mtop10">
                    <p:tab title="Dívidas com Descontos" id="dividaComDesconto">
                        <p:outputPanel id="panelDividasComDesconto">
                            <p:commandButton value="Limpar Dívidas com Descontos"
                                             icon="ui-icon-clear"
                                             styleClass="operacao mbot10"
                                             disabled="#{lancamentoDescontoControlador.desabilitarLimparDividasComDesconto()}"
                                             onclick="aguarde.show()"
                                             oncomplete="aguarde.hide();"
                                             actionListener="#{lancamentoDescontoControlador.limparDividasComDescontos()}"/>

                            <p:dataTable id="tabelaDividasDesconto" emptyMessage="Nenhum registro foi adicionado" var="item"
                                         value="#{lancamentoDescontoControlador.selecionado.parcelasComDescontos}">
                                <f:facet name="header">
                                    <h:outputText value="Débitos do Processo com Aplicação dos Descontos"
                                                  styleClass="negrito"/>
                                </f:facet>
                                <p:column headerText="Cadastro">
                                    <h:outputText
                                        value="#{lancamentoDescontoControlador.buscarInscricaoDoCadastro(item.parcela)}"/>
                                </p:column>
                                <p:column headerText="Dívida">
                                    <h:outputText value="#{item.parcela.valorDivida.divida.descricao}"/>
                                </p:column>
                                <p:column headerText="Referência">
                                    <h:outputText
                                        value="#{item.parcela.situacaoAtual.referencia}"/>
                                </p:column>
                                <p:column headerText="Exercício" style="text-align: center">
                                    <h:outputText value="#{item.parcela.valorDivida.exercicio.ano}"/>
                                </p:column>
                                <p:column headerText="Parcela" style="text-align: right">
                                    <h:outputText value="#{lancamentoDescontoControlador.montarNumeroParcela(item.parcela)}"
                                                  title="#{item.parcela.id}"/>
                                </p:column>
                                <p:column headerText="Vencimento" style="text-align: center">
                                    <h:outputText value="#{item.parcela.vencimento}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Tipo de Dívida">
                                    <h:outputText
                                        value="#{lancamentoDescontoControlador.retornarSituacaoDaDivida(item.parcela)}"/>
                                </p:column>
                                <p:column headerText="Situação">
                                    <h:outputText
                                        value="#{item.parcela.situacaoAtual.situacaoParcela.descricao}"/>
                                </p:column>
                                <p:column headerText="Imposto (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.imposto}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Taxa (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.taxa}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Juros (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.juros}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Multa (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.multa}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Correção (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.correcao}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Honorários (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.honorariosAtualizados}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Desconto (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.totalDescontoComOriginal}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Total (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.totalComDescontos}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                            </p:dataTable>
                        </p:outputPanel>
                    </p:tab>
                </p:tabView>
            </p:panel>

            <p:commandButton value="Salvar"
                             id="cbSalvar"
                             styleClass="operacao prioritario mtop10"
                             icon="ui-icon-disk"
                             title="Clique para salvar o registro"
                             actionListener="#{lancamentoDescontoControlador.salvar()}"
                             onstart="statusDialog.show()"
                             oncomplete="statusDialog.hide()"/>
            <p:commandButton value="Cancelar"
                             id="cbCancelar"
                             styleClass="operacao mtop10"
                             icon="ui-icon-cancel"
                             title="clique para cancelar e retornar a página anterior"
                             actionListener="#{lancamentoDescontoControlador.cancelar()}"
                             immediate="true"/>
        </h:form>


        <p:dialog id="idCadastros" widgetVar="cadastros" modal="true" width="1000" header="Detalhes do Cadastro">
            <h:form id="formCadastros">
                <c:if test="#{lancamentoDescontoControlador.tipoCadastroTributario eq 'ECONOMICO'}">
                    <h:panelGrid style="width: 100%">
                        <h:outputText value="CADASTRO ECONÔMICO" styleClass="azulnegrito"/>
                        <p:separator/>
                        <h:panelGrid columns="2">
                            <h:outputText value="C.M.C.: " styleClass="negrito"/>
                            <h:outputText
                                value="#{lancamentoDescontoControlador.informacoesCadastro.inscricaoCadastral}"/>
                            <h:outputText value="Nome/Razão Social: " styleClass="negrito"/>
                            <h:outputText value="#{lancamentoDescontoControlador.informacoesCadastro.pessoa.nome}"/>
                            <h:outputText value="CPF/CNPJ: " styleClass="negrito"/>
                            <h:outputText value="#{lancamentoDescontoControlador.informacoesCadastro.pessoa.cpf_Cnpj}"/>
                            <h:outputText value="Situação: " styleClass="negrito"/>
                            <h:outputText
                                value="#{lancamentoDescontoControlador.situacaoCadastroEconomico.situacaoCadastral}"/>
                        </h:panelGrid>

                    </h:panelGrid>
                </c:if>
                <c:if test="#{lancamentoDescontoControlador.tipoCadastroTributario eq 'IMOBILIARIO'}">
                    <h:panelGrid style="width: 100%">
                        <h:outputText value="CADASTRO IMOBILIÁRIO" styleClass="azulnegrito"/>
                        <p:separator/>
                        <h:panelGrid columns="2">
                            <h:outputText value="Inscrição Cadastral: " styleClass="negrito"/>
                            <h:outputText
                                value="#{lancamentoDescontoControlador.informacoesCadastro.inscricaoCadastral}"/>
                            <h:outputText value="Logradouro: " styleClass="negrito"/>
                            <h:outputText value="#{lancamentoDescontoControlador.testadaPrincipal.face.logradouro}"/>
                            <h:outputText value="Complemento: " styleClass="negrito"/>
                            <h:outputText
                                value="#{lancamentoDescontoControlador.informacoesCadastro.lote.complemento}"/>
                            <h:outputText value="Bairro: " styleClass="negrito"/>
                            <h:outputText
                                value="#{lancamentoDescontoControlador.testadaPrincipal.face.logradouro.bairro.descricao}"/>
                            <h:outputText value="Loteamento: " styleClass="negrito"/>
                            <h:outputText
                                value="#{lancamentoDescontoControlador.informacoesCadastro.lote.descricaoLoteamento}"/>
                            <h:outputText value="Quadra: " styleClass="negrito"/>
                            <h:outputText
                                value="#{lancamentoDescontoControlador.informacoesCadastro.lote.quadra.descricao}"/>
                            <h:outputText value="Lote: " styleClass="negrito"/>
                            <h:outputText value="#{lancamentoDescontoControlador.informacoesCadastro.lote.codigoLote}"/>
                        </h:panelGrid>
                    </h:panelGrid>

                </c:if>
                <c:if test="#{lancamentoDescontoControlador.tipoCadastroTributario eq 'RURAL'}">
                    <h:panelGrid style="width: 100%">
                        <h:outputText value="CADASTRO RURAL" styleClass="azulnegrito"/>
                        <p:separator/>
                        <h:panelGrid columns="2">
                            <h:outputText value="Código: " styleClass="negrito"/>
                            <h:outputText value="#{lancamentoDescontoControlador.informacoesCadastro.codigo}"/>
                            <h:outputText value="Nome da Propriedade: " styleClass="negrito"/>
                            <h:outputText value="#{lancamentoDescontoControlador.informacoesCadastro.nomePropriedade}"/>
                            <h:outputText value="Localização: " styleClass="negrito"/>
                            <h:outputText value="#{lancamentoDescontoControlador.informacoesCadastro.localizacaoLote}"/>
                            <h:outputText value="Área: " styleClass="negrito"/>
                            <h:outputText value="#{lancamentoDescontoControlador.informacoesCadastro.areaLote}"/>
                            <h:outputText value="Tipo de Área: " styleClass="negrito"/>
                            <h:outputText value="#{lancamentoDescontoControlador.informacoesCadastro.tipoAreaRural}"/>
                            <h:outputText value="INCRA: " styleClass="negrito"/>
                            <h:outputText value="#{lancamentoDescontoControlador.informacoesCadastro.numeroIncra}"/>
                        </h:panelGrid>
                    </h:panelGrid>
                </c:if>
                <p:dataTable
                    value="#{lancamentoDescontoControlador.recuperaPessoasCadastro()}"
                    var="pessoaCad"
                    emptyMessage="Nenhuma pessoa encontrada no cadastro selecionado!">
                    <f:facet name="header">
                        <h:outputText
                            value="#{lancamentoDescontoControlador.tipoCadastroTributario eq 'ECONOMICO' ? 'Sócios' : 'Proprietários'}"/>
                    </f:facet>
                    <p:column headerText="Nome">
                        <h:outputText value="#{pessoaCad.nome}"/>
                    </p:column>
                    <p:column headerText="CPF/CNPJ">
                        <h:outputText value="#{pessoaCad.cpf_Cnpj}"/>
                    </p:column>
                    <p:column headerText="Tipo de Pessoa">
                        <h:outputText value="#{pessoaCad.tipoPessoa}"/>
                    </p:column>
                </p:dataTable>
            </h:form>
        </p:dialog>

        <p:dialog draggable="false"
                  id="dialog" width="1100" height="550"
                  dynamic="true"
                  position="center"
                  style="position: fixed !important;"
                  widgetVar="dialogo" header="Consultar Débitos" resizable="true" closable="false">
            <h:form id="FormDialog">
                <p:panel header="Filtros" id="panelDialog">
                    <h:panelGrid columns="2" id="gridFiltros">
                        <h:outputText value="Descrição da Dívida: "/>
                        <p:autoComplete queryDelay="1000" value="#{lancamentoDescontoControlador.filtroDivida}"
                                        completeMethod="#{lancamentoDescontoControlador.completaDivida}"
                                        converter="#{consultaDebitoControlador.converterDivida}"
                                        var="divida"
                                        maxResults="10"
                                        itemLabel="#{divida.descricao}"
                                        itemValue="#{divida}"
                                        size="60">
                            <p:ajax event="itemSelect" update="gridFiltros"/>
                        </p:autoComplete>
                        <h:outputText value="Situação da Dívida: "/>
                        <h:panelGrid columns="9">
                            <h:outputText value="Do Exercício: "/>
                            <p:selectBooleanCheckbox value="#{lancamentoDescontoControlador.dividaDoExercicio}">
                                <p:ajax update="gridFiltros"/>
                            </p:selectBooleanCheckbox>
                            <h:outputText value="Dívida Ativa: "/>
                            <p:selectBooleanCheckbox value="#{lancamentoDescontoControlador.dividaAtiva}">
                                <p:ajax update="gridFiltros"/>
                            </p:selectBooleanCheckbox>
                            <h:outputText value="Dívida Ativa Ajuizada: "/>
                            <p:selectBooleanCheckbox value="#{lancamentoDescontoControlador.dividaAtivaAzuijada}">
                                <p:ajax update="gridFiltros"/>
                            </p:selectBooleanCheckbox>
                        </h:panelGrid>
                        <h:outputText value="Exercício: "/>
                        <h:panelGrid columns="6">
                            <fc:exercicioInicialFinal
                                exercicioInicial="#{lancamentoDescontoControlador.filtroExercicioInicio}"
                                exercicioFinal="#{lancamentoDescontoControlador.filtroExercicioFinal}"/>
                        </h:panelGrid>

                        <h:outputText value="Date de Vencimento Inicial:"/>
                        <p:calendar value="#{lancamentoDescontoControlador.vencimentoInicial}" pattern="dd/MM/yyyy"
                                    onkeyup="mascara(this, Data)" maxlength="10" showOn="button" size="12">
                            <p:ajax event="blur" process="@this"/>
                        </p:calendar>
                        <h:outputText value="Date de Vencimento Final:"/>
                        <p:calendar value="#{lancamentoDescontoControlador.vencimentoFinal}" pattern="dd/MM/yyyy"
                                    onkeyup="mascara(this, Data)" maxlength="10" showOn="button" size="12">
                            <p:ajax event="blur" process="@this"/>
                        </p:calendar>

                    </h:panelGrid>
                    <p:separator styleClass="mtop10 mbot10"/>
                    <h:panelGrid columns="4">
                        <p:commandButton
                            onstart="statusDialog.show()"
                            onsuccess="statusDialog.hide()"
                            value="Pesquisar" icon="ui-icon-search" styleClass="operacao prioritario"
                            actionListener="#{lancamentoDescontoControlador.pesquisar()}"
                            update="@form"/>
                        <p:commandButton value="Limpar Campos/Tabela" style="width: 200px;" icon="ui-icon-document"
                                         styleClass="operacao" onclick="aguarde.show()" oncomplete="aguarde.hide()"
                                         actionListener="#{lancamentoDescontoControlador.limparCampos()}"
                                         update="@form"/>
                        <p:commandButton value="Adicionar"
                                         icon="ui-icon-circle-plus"
                                         actionListener="#{lancamentoDescontoControlador.adicionarDebitosSelecionados()}"
                                         onstart="aguarde.show()"
                                         title="Clique para adicionar as parcelas selecionadas no processo de desconto"
                                         update="tabelaConsultas"
                                         styleClass="operacao mrig05 icone_verde"
                                         onsuccess="aguarde.hide()"/>
                        <p:commandButton value="Fechar" icon="ui-icon-closethick" styleClass="operacao"
                                         onclick="dialogo.hide(); aguarde.show()" oncomplete="aguarde.hide()"
                                         process="@this"
                                         update=":Formulario:tabDivida:panelDivida :Formulario:tabDivida:panelCadastro"/>
                    </h:panelGrid>
                </p:panel>
                <p:dataTable id="tabelaConsultas" rows="10" var="parcela"
                             rowKey="#{parcela.idParcela}"
                             widgetVar="tabela"
                             selection="#{lancamentoDescontoControlador.parcelasTable}"
                             styleClass="mtop10"
                             emptyMessage="Nenhuma parcela encontrada" paginator="true"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink}
                                 {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="10,50,100" value="#{lancamentoDescontoControlador.resultadoParcelas}">
                    <f:facet name="header">
                        <p:outputPanel>
                            <h:outputText value="Busca: "/>
                            <h:inputText id="globalFilter" onkeyup="tabela.filter()" size="70"/>
                        </p:outputPanel>
                    </f:facet>
                    <p:column selectionMode="multiple" style="width: 5%; text-align: center;"/>
                    <p:column headerText="Referência">
                        <h:outputText value="#{parcela.referencia}"/>
                    </p:column>
                    <p:column headerText="Dívida">
                        <h:outputText value="#{parcela.divida}"/>
                    </p:column>
                    <p:column headerText="Exercício">
                        <h:outputText value="#{parcela.exercicio}"/>
                    </p:column>
                    <p:column headerText="Parcela">
                        <h:outputText value="#{parcela.parcela}"/>
                    </p:column>
                    <p:column headerText="Vencimento">
                        <h:outputText value="#{parcela.vencimento}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Imposto">
                        <h:outputText value="#{parcela.valorImposto}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Taxa">
                        <h:outputText value="#{parcela.valorTaxa}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Desconto">
                        <h:outputText value="#{parcela.valorDesconto}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Juros">
                        <h:outputText value="#{parcela.valorJuros}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Multa">
                        <h:outputText value="#{parcela.valorMulta}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Correção">
                        <h:outputText value="#{parcela.valorCorrecao}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Honorários">
                        <h:outputText value="#{parcela.valorHonorarios}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Total">
                        <h:outputText value="#{parcela.valorTotal}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Tipo">
                        <h:outputText value="#{parcela.tipoDeDebito}"/>
                    </p:column>
                    <p:column headerText="Última Situação">
                        <h:outputText value="#{parcela.situacaoDescricaoEnum}"/>
                    </p:column>
                </p:dataTable>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>
