<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core"
>
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <script type="text/javascript">
            var timer;

            function acompanharConsultaDebitos() {
                console.log('acompanharConsultaDebitos');
                timer = setInterval(function () {
                    rcAcompanharConsultaDebitos();
                }, 1500);
                openDialog(dlgAcompanhamento);
            }

            function finalizarConsultaDebitos() {
                clearInterval(timer);
                rcFinalizarConsultaDebitos();
            }

            function acompanharGeracaoItens() {
                console.log('acompanharGeracaoItens');
                timer = setInterval(function () {
                    rcAcompanharGeracaoItens();
                }, 1500);
                openDialog(dlgAcompanhamento);
            }

            function finalizarGeracaoItens() {
                clearInterval(timer);
                rcFinalizarGeracaoItens();
            }

            function iniciarProcessamento() {
                console.log('iniciarProcessamento');
                timer = setInterval(function () {
                    rcAcompanharProcessamento();
                }, 1500);
                openDialog(dlgAcompanhamento);
            }

            function abortarProcessamento() {
                clearInterval(timer);
                closeDialog(dlgAcompanhamento);
            }

            function finalizarProcessamento() {
                clearInterval(timer);
                rcFinalizarProcessamento();
            }
        </script>

        <h:form id="Formulario">
            <fc:cabecalhoPretty controlador="#{parcelamentoJudicialControlador}"
                                origem="#{parcelamentoJudicialControlador.caminhoPadrao}listar/"/>

            <p:remoteCommand name="rcAcompanharConsultaDebitos"
                             update=":FormularioAcompanhamento"
                             actionListener="#{parcelamentoJudicialControlador.acompanharConsultaDebitos()}"/>
            <p:remoteCommand name="rcFinalizarConsultaDebitos"
                             update=":Formulario"
                             actionListener="#{parcelamentoJudicialControlador.finalizarConsultaDebitos()}"/>
            <p:remoteCommand name="rcAcompanharGeracaoItens"
                             update=":FormularioAcompanhamento"
                             actionListener="#{parcelamentoJudicialControlador.acompanharGeracaoItens()}"/>
            <p:remoteCommand name="rcFinalizarGeracaoItens"
                             update=":Formulario"
                             actionListener="#{parcelamentoJudicialControlador.finalizarGeracaoItens()}"/>
            <p:remoteCommand name="rcAcompanharProcessamento"
                             update=":FormularioAcompanhamento"
                             actionListener="#{parcelamentoJudicialControlador.acompanharProcessamento()}"/>
            <p:remoteCommand name="rcFinalizarProcessamento"
                             actionListener="#{parcelamentoJudicialControlador.finalizarProcessamento()}"/>

            <p:panel header="Solicitação de Parcelamento Judícial">
                <h:panelGrid columns="6" style="width: 50%">
                    <h:outputText value="Exercício"/>
                    <h:outputText value="Código"/>
                    <h:outputText value="Data"/>
                    <h:outputText value="Protocolo"/>
                    <h:outputText value="Situação"/>
                    <h:outputText value="Usuário"/>
                    <p:inputText size="4" value="#{parcelamentoJudicialControlador.selecionado.exercicio}"
                                 styleClass="campo-bloqueado" readonly="true"/>
                    <p:inputText id="codigo" size="10"
                                 value="#{parcelamentoJudicialControlador.selecionado.codigo}"
                                 title="Código do Processo de Débitos"
                                 styleClass="campo-bloqueado"
                                 readonly="true"/>
                    <p:inputText id="data" size="10"
                                 readonly="true"
                                 styleClass="campo-bloqueado"
                                 value="#{parcelamentoJudicialControlador.selecionado.dataSolicitacao}">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </p:inputText>
                    <p:inputText id="protocolo"
                                 value="#{parcelamentoJudicialControlador.selecionado.numeroProtocolo}"
                                 title="Digite o número do protocolo">
                        <p:ajax event="blur" process="@this"/>
                    </p:inputText>
                    <p:inputText value="#{parcelamentoJudicialControlador.selecionado.situacao.descricao}"
                                 styleClass="azulnegrito"
                                 readonly="true"/>
                    <p:inputText value="#{parcelamentoJudicialControlador.selecionado.usuarioSolicitacao.login}"
                                 styleClass="amarelonegrito" readonly="true"/>
                </h:panelGrid>

                <p:panel header="Dados da Solicitação">
                    <h:panelGrid columns="2">
                        <fc:outputLabelObrigatorio value="Contato: "/>
                        <p:inputText id="contato"
                                     title="Informe o número do telefone de contato do solicitante."
                                     onkeydown="mascara(this, mtel)"
                                     maxlength="15"
                                     onblur="validarTelefone(this)"
                                     value="#{parcelamentoJudicialControlador.selecionado.contato}"/>

                        <h:outputLabel value="Observação: "/>
                        <h:panelGrid columns="2">
                            <p:inputTextarea value="#{parcelamentoJudicialControlador.selecionado.observacao}"
                                             rows="6" cols="100"
                                             maxlength="3000"
                                             counter="counter"
                                             counterTemplate="{0} Caracteres Restantes.">
                                <p:ajax event="blur" process="@this"/>
                            </p:inputTextarea>
                            <h:outputText id="counter" styleClass="azulnegrito"/>
                        </h:panelGrid>

                        <h:outputText value="Procurador:"/>
                        <h:panelGrid>
                            <fc:novoAutocompletePessoa value="#{parcelamentoJudicialControlador.selecionado.procurador}"
                                                       id="procurador"
                                                       situacoesPossiveis="#{novoComponentePesquisaPessoaControlador.situacaoPorDescricao('ATIVO')}"
                                                       mostraSituacoes="false"
                                                       mostraBotaoInfo="false"
                                                       listenerNavegacao="#{parcelamentoJudicialControlador.poeNaSessao()}"
                                                       caminhoAtual="#{parcelamentoJudicialControlador.urlAtual}"/>
                        </h:panelGrid>
                    </h:panelGrid>

                    <h:panelGrid columns="4">
                        <fc:outputLabelObrigatorio value="N° Processo Fórum: "/>
                        <p:inputText value="#{parcelamentoJudicialControlador.selecionado.numeroProcessoForum}"
                                     maxlength="70" size="30"/>
                        <p:commandButton icon="ui-icon-search"
                                         actionListener="#{parcelamentoJudicialControlador.buscarProcessoJudicial()}"
                                         title="Clique aqui para buscar o processo judicial."
                                         onclick="aguarde.show()" onsuccess="aguarde.hide()"
                                         process="@form" update="@form"/>
                    </h:panelGrid>

                    <p:outputPanel id="opDebitos">
                        <br/>
                        <p:outputPanel>
                            <div class="alert">
                                <strong>Atenção</strong>
                                Nenhum débito adicionado ao parcelamento judicial.
                            </div>
                        </p:outputPanel>
                        <ui:repeat value="#{parcelamentoJudicialControlador.selecionado.itens}" var="item"
                                   varStatus="status">
                            <br/>
                            <p:panel header="#{parcelamentoJudicialControlador.getTituloAgrupamento(item)}">
                                <h:panelGrid columns="2">
                                    <h:outputLabel value="Parâmetro de Parcelamento: "/>
                                    <p:selectOneMenu value="#{item.processoParcelamento.paramParcelamento}"
                                                     converter="#{parametroParcelamentoControlador.converterGenerico}"
                                                     style="width: 600px;">
                                        <f:selectItems value="#{parcelamentoJudicialControlador.getSelectItensParametros(item.parametros)}"/>
                                        <p:ajax process="@form"
                                                update="@form"
                                                onstart="aguarde.show()"
                                                oncomplete="aguarde.hide()"
                                                listener="#{parcelamentoJudicialControlador.recalcularParcelamento(item)}"/>
                                    </p:selectOneMenu>

                                    <h:outputText value="Valor da Entrada (R$):"
                                                  rendered="#{item.processoParcelamento.paramParcelamento ne null and item.processoParcelamento.paramParcelamento.exigePercentualEntrada}"/>
                                    <h:panelGroup
                                        rendered="#{item.processoParcelamento.paramParcelamento ne null and item.processoParcelamento.paramParcelamento.exigePercentualEntrada}">

                                        <table cellspacing="0" cellpadding="0">
                                            <tr>
                                                <td>
                                                    <p:inputText value="#{item.processoParcelamento.valorEntrada}"
                                                                 size="15" maxlength="10"
                                                                 disabled="#{item.assistenteSimulacaoParcelamento.parcelas eq null or item.assistenteSimulacaoParcelamento.parcelas.isEmpty()}"
                                                                 rendered="#{item.processoParcelamento.paramParcelamento ne null and item.processoParcelamento.paramParcelamento.exigePercentualEntrada}"
                                                                 converter="converterBigDecimal2Casas">
                                                        <p:ajax event="blur"
                                                                process="@form" update="@form"
                                                                onstart="aguarde.show()"
                                                                oncomplete="aguarde.hide()"
                                                                listener="#{item.assistenteSimulacaoParcelamento.validarValorDeEntrada()}"/>
                                                    </p:inputText>
                                                </td>
                                                <td valign="middle">
                                                    <div class="mlef05 amarelonegrito"
                                                         style="display: #{item.processoParcelamento.valorEntrada eq item.assistenteSimulacaoParcelamento.valorMinimoParcela ? 'block' : 'none'}">
                                                        * Valor referente à #{item.assistenteSimulacaoParcelamento.montarDescricaoValorParametroEntrada()} UFM
                                                    </div>
                                                    &nbsp;
                                                    <h:outputText
                                                        rendered="#{item.assistenteSimulacaoParcelamento.valorMenorQueEntrada}"
                                                        value="* Usuário com permissão para lançar entrada menor que o percentual configurado"
                                                        styleClass="amarelonegrito"/>
                                                </td>
                                            </tr>
                                        </table>

                                    </h:panelGroup>

                                    <fc:outputLabelObrigatorio value="Qtde de Parcelas: "
                                                               rendered="#{item.processoParcelamento.paramParcelamento ne null}"/>
                                    <h:panelGroup rendered="#{item.processoParcelamento.paramParcelamento ne null}">
                                        <p:spinner value="#{item.processoParcelamento.numeroParcelas}"
                                                   size="12"
                                                   min="1">
                                            <p:ajax process="@form"
                                                    update="@form"
                                                    onstart="aguarde.show()"
                                                    oncomplete="aguarde.hide()"
                                                    listener="#{parcelamentoJudicialControlador.calcularValoresAposAlteracaoQuantidadeParcelas(item)}"/>
                                        </p:spinner>
                                        &nbsp;
                                        <h:outputText value="Qtde Máxima Permitida: "/>
                                        &nbsp;
                                        <h:outputText value="#{item.processoParcelamento.quantidadeMaximaParcelas}"
                                                      styleClass="vermelhonegrito"/>

                                    </h:panelGroup>
                                </h:panelGrid>

                                <p:panel header="Débitos Originais">
                                    <table class="table table-striped mtop10" id="tabelaConsultaParcelas" style="font-size: 10px;">
                                        <thead>
                                        <tr>
                                            <th title="CDA">CDA</th>
                                            <th class="column-referencia" title="Referência">Referência</th>
                                            <th class="column-valores" style="text-align: left !important;"
                                                title="Exercício">Exercício</th>
                                            <th class="column-valores" style="min-width: 30px; text-align: left !important;"
                                                title="Tipo de Débito²">Tipo de Débito²</th>
                                            <th class="column-valores" style="text-align: left !important;"
                                                title="Parcela">Parcela</th>
                                            <th class="column-valores" style="text-align: left !important;" title="SD">SD</th>
                                            <th class="column-valores" style="text-align: left !important;"
                                                title="Vencimento">Vencimento</th>
                                            <th class="column-valores" style="text-align: right !important;"
                                                title="Imposto">Imposto</th>
                                            <th class="column-valores" style="text-align: right !important;; min-width: 70px"
                                                title="Taxa / M.P.¹">Taxa / M.P.¹</th>
                                            <th class="column-valores" style="text-align: right !important;"
                                                title="Desconto">Desconto</th>
                                            <th class="column-valores" style="text-align: right !important;" title="Juros">Juros</th>
                                            <th class="column-valores" style="text-align: right !important;" title="Multa">Multa</th>
                                            <th class="column-valores" style="text-align: right !important;"
                                                title="Correção">Correção</th>
                                            <th class="column-valores" style="text-align: right !important;"
                                                title="Honorários">Honorários</th>
                                            <th class="column-valores" style="text-align: right !important;" title="Total">Total</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <ui:repeat value="#{item.debitos}" var="parcela">
                                            <tr id="parcela#{parcela.resultadoParcela.idParcela}">
                                                <td>
                                                    <h:outputText value="#{parcela.certidaoDividaAtiva}" title="#{parcela.certidaoDividaAtiva}"/>
                                                </td>
                                                <td class="column-referencia">
                                                    <h:outputText value="#{parcela.resultadoParcela.referencia}" title="#{parcela.resultadoParcela.referencia}"/>
                                                </td>
                                                <td>
                                                    <h:outputText value="#{parcela.resultadoParcela.exercicio}"/>
                                                </td>
                                                <td>
                                                    <h:outputText value="#{parcela.resultadoParcela.siglaTipoDeDebito}"/>
                                                </td>
                                                <td>
                                                    <h:outputText value="#{parcela.resultadoParcela.parcela}" title="cod. ${parcela.resultadoParcela.idParcela}"/>
                                                </td>
                                                <td>
                                                    <h:outputText value="#{parcela.resultadoParcela.sd}"/>
                                                </td>
                                                <td>
                                                    <h:outputText value="#{parcela.resultadoParcela.vencimentoToString}"/>
                                                </td>
                                                <td style="text-align: right !important;">
                                                    <h:outputText value="#{parcela.resultadoParcela.valorImposto}" title="Imposto">
                                                        <f:convertNumber pattern="###,##0.00"/>
                                                    </h:outputText>
                                                </td>
                                                <td style="text-align: right !important;">
                                                    <h:outputText value="#{parcela.resultadoParcela.valorTaxa}" title="Taxa">
                                                        <f:convertNumber pattern="###,##0.00"/>
                                                    </h:outputText>
                                                </td>
                                                <td style="text-align: right !important;">
                                                    <h:outputText value="#{parcela.resultadoParcela.valorDesconto}" title="Desconto">
                                                        <f:convertNumber pattern="###,##0.00"/>
                                                    </h:outputText>
                                                </td>
                                                <td style="text-align: right !important;">
                                                    <h:outputText value="#{parcela.resultadoParcela.valorJuros}" title="Juros">
                                                        <f:convertNumber pattern="###,##0.00"/>
                                                    </h:outputText>
                                                </td>
                                                <td style="text-align: right !important;">
                                                    <h:outputText value="#{parcela.resultadoParcela.valorMulta}" title="Multa">
                                                        <f:convertNumber pattern="###,##0.00"/>
                                                    </h:outputText>
                                                </td>
                                                <td style="text-align: right !important;">
                                                    <h:outputText value="#{parcela.resultadoParcela.valorCorrecao}" title="Correção">
                                                        <f:convertNumber pattern="###,##0.00"/>
                                                    </h:outputText>
                                                </td>
                                                <td style="text-align: right !important;">
                                                    <h:outputText value="#{parcela.resultadoParcela.valorHonorarios}" title="Honorários">
                                                        <f:convertNumber pattern="###,##0.00"/>
                                                    </h:outputText>
                                                </td>
                                                <td style="text-align: right !important;">
                                                    <h:outputText value="#{parcela.resultadoParcela.valorTotal}" title="Total">
                                                        <f:convertNumber pattern="###,##0.00"/>
                                                    </h:outputText>
                                                </td>
                                            </tr>
                                        </ui:repeat>
                                        <tr class="negrito">
                                            <td colspan="7" style="text-align: right;">
                                                <h:outputText value="Total do Parcelamento: " styleClass="negrito"/>
                                            </td>
                                            <td style="text-align: right !important;">
                                                <h:outputText value="#{item.valorImposto}" title="Imposto">
                                                    <f:convertNumber pattern="###,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td style="text-align: right !important;">
                                                <h:outputText value="#{item.valorTaxa}" title="Taxa">
                                                    <f:convertNumber pattern="###,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td style="text-align: right !important;">
                                                <h:outputText value="#{item.valorDesconto}" title="Desconto">
                                                    <f:convertNumber pattern="###,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td style="text-align: right !important;">
                                                <h:outputText value="#{item.valorJuros}" title="Juros">
                                                    <f:convertNumber pattern="###,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td style="text-align: right !important;">
                                                <h:outputText value="#{item.valorMulta}" title="Multa">
                                                    <f:convertNumber pattern="###,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td style="text-align: right !important;">
                                                <h:outputText value="#{item.valorCorrecao}" title="Correção">
                                                    <f:convertNumber pattern="###,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td style="text-align: right !important;">
                                                <h:outputText value="#{item.valorHonorarios}" title="Honorários">
                                                    <f:convertNumber pattern="###,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td style="text-align: right !important;">
                                                <h:outputText value="#{item.valorTotal}" title="Total">
                                                    <f:convertNumber pattern="###,##0.00"/>
                                                </h:outputText>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </p:panel>

                                <p:panel header="Valores Finais" id="panelValoresFinais"
                                             visible="#{item.assistenteSimulacaoParcelamento.parcelas ne null and !item.assistenteSimulacaoParcelamento.parcelas.isEmpty()}">
                                    <table class="table">
                                        <tr>
                                            <th class="alinhamentoDireita" style="width: 20%">#</th>
                                            <th class="alinhamentoDireita" style="width: 10%">Imposto</th>
                                            <th class="alinhamentoDireita" style="width: 10%">Taxa/M.P.¹</th>
                                            <th class="alinhamentoDireita" style="width: 10%">Juros</th>
                                            <th class="alinhamentoDireita" style="width: 10%">Multa</th>
                                            <th class="alinhamentoDireita" style="width: 10%">Correção</th>
                                            <th class="alinhamentoDireita" style="width: 10%">Honorários</th>
                                            <th class="alinhamentoDireita" style="width: 10%">Total</th>
                                            <th class="alinhamentoDireita" style="width: 10%">&nbsp;</th>
                                        </tr>
                                        <tr style="color: tomato">
                                            <td class="alinhamentoDireita">(+) Total:</td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valores.imposto}" styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valores.taxa}" styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valores.juros}" styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valores.multa}" styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valores.correcao}" styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valores.honorarios}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valores.total}" styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td style="width: 10%">&nbsp;</td>
                                        </tr>
                                        <tr style="color: royalblue">
                                            <td class="alinhamentoDireita">(-) Desconto:</td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.processoParcelamento.valorDescontoImposto}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.processoParcelamento.valorDescontoTaxa}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.processoParcelamento.valorDescontoJuros}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.processoParcelamento.valorDescontoMulta}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.processoParcelamento.valorDescontoCorrecao}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.processoParcelamento.valorDescontoHonorarios}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.processoParcelamento.valorTotalDesconto}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td style="width: 10%">&nbsp;</td>
                                        </tr>
                                        <tr>
                                            <td class="alinhamentoDireita">(=) Final:</td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valores.imposto - item.processoParcelamento.valorDescontoImposto}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valores.taxa - item.processoParcelamento.valorDescontoTaxa}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valores.juros - item.processoParcelamento.valorDescontoJuros}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valores.multa - item.processoParcelamento.valorDescontoMulta}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valores.correcao - item.processoParcelamento.valorDescontoCorrecao}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText
                                                    value="#{item.assistenteSimulacaoParcelamento.valorTotalHonorariosOriginada}"
                                                    styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td class="alinhamentoDireita">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valorTotalOriginada}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </td>
                                            <td style="width: 10%">&nbsp;</td>
                                        </tr>
                                    </table>
                                    <br/>
                                    <p:dataTable value="#{item.assistenteSimulacaoParcelamento.parcelasGeradas}" var="originada">
                                        <f:facet name="header">Parcelas Originadas</f:facet>
                                        <p:column headerText="Parcela" style="text-align: center; width: 10%">
                                            <h:outputText value="#{originada.parcela}"/>
                                        </p:column>
                                        <p:column headerText="Vencimento" style="text-align: center; width: 10%">
                                            <h:outputText value="#{originada.vencimento}">
                                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                                            </h:outputText>
                                            <f:facet name="footer">
                                                <h:outputText styleClass="negrito" value="Total"/>
                                            </f:facet>
                                        </p:column>
                                        <p:column headerText="Imposto" style="text-align: right; width: 10%">
                                            <h:outputText value="#{originada.valorImposto}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputText>
                                            <f:facet name="footer">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valorTotalImpostoOriginada}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </f:facet>
                                        </p:column>
                                        <p:column headerText="Taxa / M.P.¹" style="text-align: right; width: 10%">
                                            <h:outputText value="#{originada.valorTaxa}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputText>
                                            <f:facet name="footer">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valorTotalTaxaOriginada}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </f:facet>
                                        </p:column>
                                        <p:column headerText="Juros" style="text-align: right; width: 10%">
                                            <h:outputText value="#{originada.valorJuros}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputText>
                                            <f:facet name="footer">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valorTotalJurosOriginada}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </f:facet>
                                        </p:column>
                                        <p:column headerText="Multa" style="text-align: right; width: 10%">
                                            <h:outputText value="#{originada.valorMulta}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputText>
                                            <f:facet name="footer">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valorTotalMultaOriginada}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </f:facet>
                                        </p:column>
                                        <p:column headerText="Correção" style="text-align: right; width: 10%">
                                            <h:outputText value="#{originada.valorCorrecao}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputText>
                                            <f:facet name="footer">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valorTotalCorrecaoOriginada}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </f:facet>
                                        </p:column>
                                        <p:column headerText="Honorários" style="text-align: right; width: 10%">
                                            <h:outputText value="#{originada.valorHonorarios}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputText>
                                            <f:facet name="footer">
                                                <h:outputText
                                                    value="#{item.assistenteSimulacaoParcelamento.valorTotalHonorariosOriginada}"
                                                    styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </f:facet>
                                        </p:column>

                                        <p:column headerText="Total" style="text-align: right; width: 10%">
                                            <h:outputText value="#{originada.valorTotalSemDesconto}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputText>
                                            <f:facet name="footer">
                                                <h:outputText value="#{item.assistenteSimulacaoParcelamento.valorTotalSemDescontoOriginada}"
                                                              styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </f:facet>
                                        </p:column>
                                        <p:column headerText="Desconto" style="text-align: right; width: 10%">
                                            <h:outputText value="#{originada.valorDesconto}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputText>
                                            <f:facet name="footer">
                                                <h:outputText
                                                    value="#{item.assistenteSimulacaoParcelamento.valorTotalDescontoOriginada}"
                                                    styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </f:facet>
                                        </p:column>
                                        <p:column headerText="Total com Desconto" style="text-align: right; width: 10%">
                                            <h:outputText value="#{originada.valorTotal}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputText>
                                            <f:facet name="footer">
                                                <h:outputText
                                                    value="#{processoParcelamentoControlador.assistenteSimulacaoParcelamento.valorTotalOriginada}"
                                                    styleClass="negrito">
                                                    <f:convertNumber pattern="#,##0.00"/>
                                                </h:outputText>
                                            </f:facet>
                                        </p:column>
                                    </p:dataTable>
                                </p:panel>
                            </p:panel>
                        </ui:repeat>
                    </p:outputPanel>
                </p:panel>
            </p:panel>

            <p:commandButton value="Processar" id="cbProcessar"
                             actionListener="#{parcelamentoJudicialControlador.processar()}"
                             style="height: 30px;" styleClass="mrig05 mtop10 operacao prioritario"
                             icon="ui-icon-gear" onstart="aguarde.show()"
                             oncomplete="aguarde.hide()" title="Clique para processar este registro."
                             disabled="#{parcelamentoJudicialControlador.selecionado.situacao ne 'ABERTO'}"
                             onclick="if (!confirm('Deseja processar a solicitação de parcelamento judicial?'))
                                     return false;"
            />

            <p:commandButton value="Cancelar"
                             id="cbCancelar"
                             style="height: 30px;"
                             styleClass="mtop10"
                             icon="ui-icon-cancel"
                             onclick="aguarde.show()"
                             oncomplete="aguarde.hide()"
                             title="Clique para cancelar e retornar a página anterior"
                             actionListener="#{parcelamentoJudicialControlador.cancelar()}"
                             immediate="true"
            />
        </h:form>

        <div id="dlgAcompanhamento" class="modal hide fade">
            <h:form id="FormularioAcompanhamento">
                <div class="modal-body mtop20">
                    <fc:acompanhamentoBarraProgresso
                        assistenteBarraProgresso="#{parcelamentoJudicialControlador.assistente}"/>
                </div>
            </h:form>
        </div>

        <div id="dlgDebitos" class="modal hide fade">
            <h:form id="FormularioDebitos">
                <div class="modal-header" style="text-align: center">
                    <div class="centralizado">
                        Débitos do Processo Judicial
                    </div>
                </div>
                <div class="modal-body mtop20">
                    <c:forEach items="#{parcelamentoJudicialControlador.debitos}"
                               var="debito" varStatus="status">
                        <p:panel id="cadastro#{status.index}" header="#{debito.cadastro}">
                            <table class="table table-striped mtop10" style="font-size: 10px;">
                                <thead>
                                <tr>
                                    <th style="width: 50px; text-align: center;"></th>
                                    <th title="CDA">CDA</th>
                                    <th class="column-referencia" title="Referência">Referência</th>
                                    <th class="column-divida" title="Dívida">Dívida</th>
                                    <th class="column-valores" style="text-align: left !important;"
                                        title="Exercício">Exercício</th>
                                    <th class="column-valores" style="min-width: 30px; text-align: left !important;"
                                        title="Tipo de Débito²">Tipo de Débito²</th>
                                    <th class="column-valores" style="text-align: left !important;"
                                        title="Parcela">Parcela</th>
                                    <th class="column-valores" style="text-align: left !important;" title="SD">SD</th>
                                    <th class="column-valores" style="text-align: left !important;"
                                        title="Vencimento">Vencimento</th>
                                    <th class="column-valores" style="text-align: right !important;"
                                        title="Imposto">Imposto</th>
                                    <th class="column-valores" style="text-align: right !important;; min-width: 70px"
                                        title="Taxa / M.P.¹">Taxa / M.P.¹</th>
                                    <th class="column-valores" style="text-align: right !important;"
                                        title="Desconto">Desconto</th>
                                    <th class="column-valores" style="text-align: right !important;" title="Juros">Juros</th>
                                    <th class="column-valores" style="text-align: right !important;" title="Multa">Multa</th>
                                    <th class="column-valores" style="text-align: right !important;"
                                        title="Correção">Correção</th>
                                    <th class="column-valores" style="text-align: right !important;"
                                        title="Honorários">Honorários</th>
                                    <th class="column-valores" style="text-align: right !important;" title="Total">Total</th>
                                </tr>
                                </thead>
                                <tbody>
                                <ui:repeat value="#{debito.debitos}" var="parcela">
                                    <tr id="parcela#{parcela.resultadoParcela.idParcela}">
                                        <td style="width: 50px; text-align: center;">
                                            <p:selectBooleanCheckbox value="#{parcela.selecionado}">
                                                <p:ajax event="change" onstart="aguarde.show()" onsuccess="aguarde.hide()"
                                                        process="@this" update=":FormularioDebitos:cadastro#{status.index}"/>
                                            </p:selectBooleanCheckbox>
                                        </td>
                                        <td>
                                            <h:outputText value="#{parcela.certidaoDividaAtiva}" title="#{parcela.certidaoDividaAtiva}"/>
                                        </td>
                                        <td class="column-referencia">
                                            <h:outputText value="#{parcela.resultadoParcela.referencia}" title="#{parcela.resultadoParcela.referencia}"/>
                                        </td>
                                        <td>
                                            <h:outputText value="#{parcela.resultadoParcela.divida}"/>
                                        </td>
                                        <td>
                                            <h:outputText value="#{parcela.resultadoParcela.exercicio}"/>
                                        </td>
                                        <td>
                                            <h:outputText value="#{parcela.resultadoParcela.siglaTipoDeDebito}"/>
                                        </td>
                                        <td>
                                            <h:outputText value="#{parcela.resultadoParcela.parcela}" title="cod. ${parcela.resultadoParcela.idParcela}"/>
                                        </td>
                                        <td>
                                            <h:outputText value="#{parcela.resultadoParcela.sd}"/>
                                        </td>
                                        <td>
                                            <h:outputText value="#{parcela.resultadoParcela.vencimentoToString}"/>
                                        </td>
                                        <td style="text-align: right !important;">
                                            <h:outputText value="#{parcela.resultadoParcela.valorImposto}" title="Imposto">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                        </td>
                                        <td style="text-align: right !important;">
                                            <h:outputText value="#{parcela.resultadoParcela.valorTaxa}" title="Taxa">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                        </td>
                                        <td style="text-align: right !important;">
                                            <h:outputText value="#{parcela.resultadoParcela.valorDesconto}" title="Desconto">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                        </td>
                                        <td style="text-align: right !important;">
                                            <h:outputText value="#{parcela.resultadoParcela.valorJuros}" title="Juros">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                        </td>
                                        <td style="text-align: right !important;">
                                            <h:outputText value="#{parcela.resultadoParcela.valorMulta}" title="Multa">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                        </td>
                                        <td style="text-align: right !important;">
                                            <h:outputText value="#{parcela.resultadoParcela.valorCorrecao}" title="Correção">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                        </td>
                                        <td style="text-align: right !important;">
                                            <h:outputText value="#{parcela.resultadoParcela.valorHonorarios}" title="Honorários">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                        </td>
                                        <td style="text-align: right !important;">
                                            <h:outputText value="#{parcela.resultadoParcela.valorTotal}" title="Total">
                                                <f:convertNumber pattern="###,##0.00"/>
                                            </h:outputText>
                                        </td>
                                    </tr>
                                </ui:repeat>
                                <tr class="negrito">
                                    <td colspan="9" style="text-align: right;">
                                        <h:outputText value="Total do Parcelamento"/>
                                    </td>
                                    <td style="text-align: right !important;">
                                        <h:outputText value="#{debito.valorImpostoSelecionado}" title="Imposto">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </td>
                                    <td style="text-align: right !important;">
                                        <h:outputText value="#{debito.valorTaxaSelecionado}" title="Taxa">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </td>
                                    <td style="text-align: right !important;">
                                        <h:outputText value="#{debito.valorDescontoSelecionado}" title="Desconto">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </td>
                                    <td style="text-align: right !important;">
                                        <h:outputText value="#{debito.valorJurosSelecionado}" title="Juros">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </td>
                                    <td style="text-align: right !important;">
                                        <h:outputText value="#{debito.valorMultaSelecionado}" title="Multa">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </td>
                                    <td style="text-align: right !important;">
                                        <h:outputText value="#{debito.valorCorrecaoSelecionado}" title="Correção">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </td>
                                    <td style="text-align: right !important;">
                                        <h:outputText value="#{debito.valorHonorariosSelecionado}" title="Honorários">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </td>
                                    <td style="text-align: right !important;">
                                        <h:outputText value="#{debito.valorTotalSelecionado}" title="Total">
                                            <f:convertNumber pattern="###,##0.00"/>
                                        </h:outputText>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </p:panel>
                    </c:forEach>
                </div>

                <div class="modal-footer">
                    <p:commandButton icon="ui-icon-check"
                                     onclick="aguarde.show();"
                                     oncomplete="aguarde.hide();"
                                     value="Adicionar Débitos"
                                     actionListener="#{parcelamentoJudicialControlador.adicionarDebitos()}"
                                     styleClass="operacao prioritario"
                                     process="@form"
                    />
                    <p:commandButton icon="ui-icon-cancel"
                                     onclick="aguarde.show(); closeDialog(dlgDebitos)"
                                     oncomplete="aguarde.hide();"
                                     value="Fechar"
                                     styleClass="operacao"
                                     process=":Formulario"
                                     update=":Formulario"
                    />
                </div>
            </h:form>
        </div>
    </ui:define>
</ui:composition>
</html>
