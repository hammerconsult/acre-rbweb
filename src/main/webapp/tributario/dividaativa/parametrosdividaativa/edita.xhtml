<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui" xmlns:c="http://java.sun.com/jsp/jstl/core"
    >
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <h:form id="Formulario">
            <fc:cabecalhoPretty origem="#{parametrosDividaAtivaControlador.caminhoPadrao}/listar/"
                                controlador="#{parametrosDividaAtivaControlador}"/>
            <p:panel header="Parâmetros de Dívida Ativa">
                <h:panelGrid columns="2">

                    <fc:outputLabelObrigatorio value="Exercício: "/>
                    <p:inputText value="#{parametrosDividaAtivaControlador.selecionado.exercicio}"
                                 disabled="#{parametrosDividaAtivaControlador.selecionado.id ne null}"
                                 converter="#{parametrosDividaAtivaControlador.converteExercicio()}">
                        <p:ajax event="blur" process="@this"/>
                    </p:inputText>

                </h:panelGrid>
                <br/>
                <p:panel header="Documentos Oficiais de Termo de Inscrição em Dívida Ativa" id="tabDocumentosInscricao">
                    <h:panelGrid columns="2">
                        <fc:outputLabelObrigatorio value="Cadastro Imobiliário: "/>
                        <p:autoComplete queryDelay="1000"
                                        title="Selecione o Tipo de Documento Oficial do Termo de Inscrição em Dívida Ativa de Cadastro Imobiliário"
                                        id="tpDocOficialImobiliario"
                                        size="120"
                                        var="tpDocOficialImobiliario"
                                        completeMethod="#{parametrosDividaAtivaControlador.completaTipoDoctoOficialDoParametroImobiliario}"
                                        itemValue="#{tpDocOficialImobiliario.id}"
                                        itemLabel="#{tpDocOficialImobiliario.descricao}"
                                        value="#{parametrosDividaAtivaControlador.selecionado.tipoDoctoOficialImobiliario}"
                                        converter="#{parametrosDividaAtivaControlador.converterTipoDoctoFical}">
                        </p:autoComplete>
                        <fc:outputLabelObrigatorio value="Cadastro Mobiliário: "/>
                        <p:autoComplete queryDelay="1000"
                                        title="Selecione o Tipo de Documento Oficial do Termo de Inscrição em Dívida Ativa de Cadastro Econômico"
                                        id="tpDocOficialMobiliario"
                                        size="120"
                                        var="tpDocOficialMobiliario"
                                        completeMethod="#{parametrosDividaAtivaControlador.completaTipoDoctoOficialDoParametroEconomico}"
                                        itemValue="#{tpDocOficialMobiliario.id}"
                                        itemLabel="#{tpDocOficialMobiliario.descricao}"
                                        value="#{parametrosDividaAtivaControlador.selecionado.tipoDoctoOficialMobiliario}"
                                        converter="#{parametrosDividaAtivaControlador.converterTipoDoctoFical}">
                        </p:autoComplete>
                        <fc:outputLabelObrigatorio value="Cadastro Rural: "/>
                        <p:autoComplete queryDelay="1000"
                                        title="Selecione o Tipo de Documento Oficial do Termo de Inscrição em Dívida Ativa de Cadastro Rural"
                                        id="tpDocOficialRural"
                                        size="120"
                                        var="tpDocOficialRural"
                                        completeMethod="#{parametrosDividaAtivaControlador.completaTipoDoctoOficialDoParametroRural}"
                                        itemValue="#{tpDocOficialRural.id}"
                                        itemLabel="#{tpDocOficialRural.descricao}"
                                        value="#{parametrosDividaAtivaControlador.selecionado.tipoDoctoOficialRural}"
                                        converter="#{parametrosDividaAtivaControlador.converterTipoDoctoFical}">
                        </p:autoComplete>
                        <fc:outputLabelObrigatorio
                            value="Contribuinte Geral (Pessoa Física): "/>
                        <p:autoComplete queryDelay="1000"
                                        title="Selecione o Tipo de Documento Oficial do Termo de Inscrição em Dívida Ativa de Contribuinte Geral Pessoa Física"
                                        id="tpDocOficialContribPF"
                                        size="120"
                                        var="tpDocOficialContribPF"
                                        completeMethod="#{parametrosDividaAtivaControlador.completaTipoDoctoOficialDoParametroPessoaFisica}"
                                        itemValue="#{tpDocOficialContribPF.id}"
                                        itemLabel="#{tpDocOficialContribPF.descricao}"
                                        value="#{parametrosDividaAtivaControlador.selecionado.tipoDoctoOficialContribPF}"
                                        converter="#{parametrosDividaAtivaControlador.converterTipoDoctoFical}">
                        </p:autoComplete>
                        <fc:outputLabelObrigatorio
                            value="Contribuinte Geral (Pessoa Jurídica): "/>
                        <p:autoComplete queryDelay="1000"
                                        title="Selecione o Tipo de Documento Oficial do Termo de Inscrição em Dívida Ativa de Contribuinte Geral Pessoa Jurídica"
                                        id="tpDocOficialContribPJ"
                                        size="120"
                                        var="tpDocOficialContribPJ"
                                        completeMethod="#{parametrosDividaAtivaControlador.completaTipoDoctoOficialDoParametroPessoaJuridica}"
                                        itemValue="#{tpDocOficialContribPJ.id}"
                                        itemLabel="#{tpDocOficialContribPJ.descricao}"
                                        value="#{parametrosDividaAtivaControlador.selecionado.tipoDoctoOficialContribPJ}"
                                        converter="#{parametrosDividaAtivaControlador.converterTipoDoctoFical}">
                        </p:autoComplete>
                    </h:panelGrid>
                </p:panel>
                <br/>
                <p:panel header="Documentos Oficiais de Certidão de Dívida Ativa" id="tabDocumentosCertidao">

                    <h:panelGrid columns="2">
                        <fc:outputLabelObrigatorio
                            value="Cadastro Imobiliário: "/>
                        <p:autoComplete queryDelay="1000"
                                        title="Selecione o Tipo de Documento Oficial da Certidão de Cadastro Imobiliário"
                                        id="tpDocOficialcertidaoImobiliario"
                                        size="120"
                                        var="tipo"
                                        completeMethod="#{parametrosDividaAtivaControlador.completaTipoDoctoOficialDoParametroCertidaoImobiliario}"
                                        itemValue="#{tipo.id}" itemLabel="#{tipo.descricao}"
                                        value="#{parametrosDividaAtivaControlador.selecionado.tipoDoctoCertidaoImob}"
                                        converter="#{parametrosDividaAtivaControlador.converterTipoDoctoFical}">
                        </p:autoComplete>
                        <fc:outputLabelObrigatorio
                            value="Cadastro Mobiliário: "/>
                        <p:autoComplete queryDelay="1000"
                                        title="Selecione o Tipo de Documento Oficial da Certidão de Cadastro Mobiliário"
                                        id="tpDocOficialcertidaoMobiliario"
                                        size="120"
                                        var="tipo"
                                        completeMethod="#{parametrosDividaAtivaControlador.completaTipoDoctoOficialDoParametroCertidaoMobiliario}"
                                        itemValue="#{tipo.id}" itemLabel="#{tipo.descricao}"
                                        value="#{parametrosDividaAtivaControlador.selecionado.tipoDoctoCertidaoMob}"
                                        converter="#{parametrosDividaAtivaControlador.converterTipoDoctoFical}">
                        </p:autoComplete>
                        <fc:outputLabelObrigatorio
                            value="Cadastro Rural: "/>
                        <p:autoComplete queryDelay="1000"
                                        title="Selecione o Tipo de Documento Oficial da Certidão de Cadastro Rural"
                                        id="tpDocOficialcertidaoRural"
                                        size="120"
                                        var="tipo"
                                        completeMethod="#{parametrosDividaAtivaControlador.completaTipoDoctoOficialDoParametroCertidaoRural}"
                                        itemValue="#{tipo.id}" itemLabel="#{tipo.descricao}"
                                        value="#{parametrosDividaAtivaControlador.selecionado.tipoDoctoCertidaoRural}"
                                        converter="#{parametrosDividaAtivaControlador.converterTipoDoctoFical}">
                        </p:autoComplete>
                        <fc:outputLabelObrigatorio
                            value="Contribuinte Geral (Pessoa Física): "/>
                        <p:autoComplete queryDelay="1000"
                                        title="Selecione o Tipo de Documento Oficial da Certidão de Contribuinte Geral (Pessoa Física)"
                                        id="tpDocOficialcertidaoPF"
                                        size="120"
                                        var="tipo"
                                        completeMethod="#{parametrosDividaAtivaControlador.completaTipoDoctoOficialDoParametroCertidaoPF}"
                                        itemValue="#{tipo.id}" itemLabel="#{tipo.descricao}"
                                        value="#{parametrosDividaAtivaControlador.selecionado.tipoDoctoCertidaoContribPF}"
                                        converter="#{parametrosDividaAtivaControlador.converterTipoDoctoFical}">
                        </p:autoComplete>
                        <fc:outputLabelObrigatorio
                            value="Contribuinte Geral (Pessoa Jurídica): "/>
                        <p:autoComplete queryDelay="1000"
                                        title="Selecione o Tipo de Documento Oficial da Certidão de Contribuinte Geral (Pessoa Jurídica)"
                                        id="tpDocOficialcertidaoPJ"
                                        size="120"
                                        var="tipo"
                                        completeMethod="#{parametrosDividaAtivaControlador.completaTipoDoctoOficialDoParametroCertidaoPJ}"
                                        itemValue="#{tipo.id}" itemLabel="#{tipo.descricao}"
                                        value="#{parametrosDividaAtivaControlador.selecionado.tipoDoctoCertidaoContribPJ}"
                                        converter="#{parametrosDividaAtivaControlador.converterTipoDoctoFical}">
                        </p:autoComplete>
                    </h:panelGrid>
                </p:panel>
                <br/>
                <p:panel header="Comunicação com a Procuradoria" id="tabProcuradoria">
                    <h:panelGrid columns="2">
                        <h:outputText value="Ato Legal: "/>
                        <p:autoComplete queryDelay="1000" id="atolegal" size="60"
                                        value="#{parametrosDividaAtivaControlador.selecionado.atoLegal}"
                                        completeMethod="#{parametrosDividaAtivaControlador.completaAtoLegal}"
                                        converter="#{parametrosDividaAtivaControlador.converterAtoLegal}"
                                        var="ato"
                                        itemValue="#{ato.id}"
                                        itemLabel="#{ato.nome}"/>

                        <h:outputText value="Dívidas de Envio: "/>
                        <h:panelGroup>
                            <table class="table">
                                <ui:repeat value="#{parametrosDividaAtivaControlador.selecionado.dividasEnvioCDA}"
                                           var="divida">
                                    <tr>
                                        <td>
                                            <h:outputText value="#{divida.divida.descricao}" styleClass="negrito"/>
                                        </td>
                                        <td>
                                            <p:commandButton icon="ui-icon-trash"
                                                             actionListener="#{parametrosDividaAtivaControlador.removeDivida(divida)}"
                                                             update="@form"/>
                                        </td>
                                    </tr>
                                </ui:repeat>
                                <tr>
                                    <td colspan="2">
                                        <h:selectOneMenu value="#{parametrosDividaAtivaControlador.divida.divida}"
                                                         id="divida"
                                                         style="max-width: 400px"
                                                         converter="#{consultaDebitoControlador.converterDivida}">
                                            <f:selectItem itemValue="#{null}" itemLabel=" "/>
                                            <f:selectItems value="#{parametrosDividaAtivaControlador.dividas}"/>
                                            <p:ajax
                                                onstart="aguarde.show()"
                                                oncomplete="aguarde.hide()"
                                                listener="#{parametrosDividaAtivaControlador.addDivida}"
                                                update="@form"/>
                                        </h:selectOneMenu>
                                    </td>
                                </tr>
                            </table>
                        </h:panelGroup>
                    </h:panelGrid>
                </p:panel>

                <br/>
                <p:panel header="Agrupadores de CDA" id="agrupadores">

                    <div class="centralizado">
                        <p:commandButton value="Novo Agrupador"
                                         icon="ui-icon-plus"
                                         styleClass="operacao"
                                         onclick="aguarde.show()"
                                         oncomplete="aguarde.hide()"
                                         style="margin-bottom: 20px"
                                         actionListener="#{parametrosDividaAtivaControlador.novoAgrupador}"
                                         rendered="#{parametrosDividaAtivaControlador.agrupador eq null}"
                                         update="agrupadores"/>
                    </div>

                    <h:panelGrid columns="2" id="gridAgrupadores"
                                 style="margin-bottom: 20px"
                                 rendered="#{parametrosDividaAtivaControlador.agrupador ne null}">

                        <fc:outputLabelObrigatorio value="Nome do agrupador: "/>
                        <p:inputText size="70" value="#{parametrosDividaAtivaControlador.agrupador.titulo}"
                                     maxlength="255" title="Descrição do Agrupador"/>

                        <fc:outputLabelObrigatorio value="Dívidas à agrupar: "/>
                        <h:panelGroup>
                            <table class="table">
                                <ui:repeat value="#{parametrosDividaAtivaControlador.agrupador.dividas}"
                                           var="divida">
                                    <tr>
                                        <td>
                                            <h:outputText value="#{divida.divida.descricao}"
                                                          styleClass="negrito"/>
                                        </td>
                                        <td>
                                            <p:commandButton icon="ui-icon-trash"
                                                             onstart="aguarde.show()"
                                                             oncomplete="aguarde.hide()"
                                                             actionListener="#{parametrosDividaAtivaControlador.removerDividaAgrupadorCDA(divida)}"
                                                             update="@form"/>
                                        </td>
                                    </tr>
                                </ui:repeat>
                                <tr>
                                    <td colspan="2">
                                        <h:selectOneMenu
                                            value="#{parametrosDividaAtivaControlador.agrupadorDivida.divida}"
                                            id="dividaAgrupavel"
                                            style="max-width: 400px"
                                            converter="#{dividaControlador.converterGenerico}">
                                            <f:selectItems value="#{parametrosDividaAtivaControlador.dividas}"/>
                                            <p:ajax event="change" process="@form"
                                                    update="@form"
                                                    onstart="aguarde.show()"
                                                    oncomplete="aguarde.hide()"
                                                    listener="#{parametrosDividaAtivaControlador.adicionarDividaAgrupador}"/>
                                        </h:selectOneMenu>
                                    </td>
                                </tr>
                            </table>
                        </h:panelGroup>
                        <p:commandButton value="Cancelar"
                                         icon="ui-icon-cancel"
                                         styleClass="operacao"
                                         update="@form"
                                         onstart="aguarde.show()"
                                         oncomplete="aguarde.hide()"
                                         actionListener="#{parametrosDividaAtivaControlador.cancelarAgrupador}"/>


                        <p:commandButton value="Salvar Agrupador"
                                         icon="ui-icon-plus"
                                         styleClass="operacao"
                                         update="@form"
                                         onstart="aguarde.show()"
                                         oncomplete="aguarde.hide()"
                                         actionListener="#{parametrosDividaAtivaControlador.adicionarAgrupador}"/>
                    </h:panelGrid>
                    <br/>

                    <p:outputPanel id="tabelaAgrupadores">
                        <c:forEach var="agrupador"
                                   items="#{parametrosDividaAtivaControlador.selecionado.agrupadoresCDA}">

                            <p:dataTable var="dividaAgrupador" value="#{agrupador.dividas}">
                                <f:facet name="header">
                                    #{agrupador.titulo}
                                </f:facet>

                                <p:column headerText="Dívidas">
                                    #{dividaAgrupador.divida}
                                </p:column>
                                <f:facet name="footer">
                                    <p:commandButton value="Editar"
                                                     icon="ui-icon-pencil"
                                                     styleClass="padrao"
                                                     update="@form"
                                                     onclick="aguarde.show();"
                                                     oncomplete="aguarde.hide();"
                                                     actionListener="#{parametrosDividaAtivaControlador.editarAgrupador(agrupador)}"/>
                                </f:facet>
                            </p:dataTable>
                            <br/>
                        </c:forEach>
                    </p:outputPanel>
                </p:panel>


            </p:panel>
            <fc:rodapePretty id="rpRodapePretty" controlador="#{parametrosDividaAtivaControlador}"/>
        </h:form>
    </ui:define>
</ui:composition>
</html>
