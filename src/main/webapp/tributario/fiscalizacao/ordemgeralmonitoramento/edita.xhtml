<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui" xmlns:c="http://java.sun.com/jsp/jstl/core">
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <h:form id="Formulario">
            <fc:cabecalhoPretty origem="#{ordemGeralMonitoramentoControlador.caminhoPadrao}listar/"
                                controlador="#{ordemGeralMonitoramentoControlador}"/>
            <p:tabView id="dadosOrdemGeral">
                <p:tab title="Ordem Geral de Monitoramento" id="tabOrdemGeral">
                    <p:outputPanel id="panelOrdemGeral">
                        <table style="width: 100%">
                            <tr>
                                <td>
                                    <h:panelGrid columns="2">
                                        <h:outputText value="Número: "/>
                                        <h:outputText
                                            value="#{ordemGeralMonitoramentoControlador.selecionado.numero eq null ? 'Gerado automaticamente ao salvar.' : ordemGeralMonitoramentoControlador.selecionado.numero}"
                                            styleClass="azulnegrito"/>
                                        <h:outputText value="Situação: "/>
                                        <h:selectOneMenu id="situacaoordemgeral"
                                                         value="#{ordemGeralMonitoramentoControlador.selecionado.situacaoOGM}"
                                                         disabled="true">
                                            <f:selectItems
                                                value="#{ordemGeralMonitoramentoControlador.situacoesOrdemGeralMonitoramento}"/>
                                        </h:selectOneMenu>
                                        <h:outputText value="Protocolo: "/>
                                        <fc:protocolo
                                            numero="#{ordemGeralMonitoramentoControlador.selecionado.numeroProtocolo}"
                                            ano="#{ordemGeralMonitoramentoControlador.selecionado.anoProtocolo}"
                                            controlador="#{ordemGeralMonitoramentoControlador}" mostrarLabel="false"/>
                                        <fc:outputLabelObrigatorio value="Data Programada: "/>
                                        <h:panelGrid columns="4" id="panelPeriodo" cellpadding="0" cellspacing="0">
                                            <p:calendar id="calendarDataProgDe" pattern="dd/MM/yyyy"
                                                        disabled="#{ordemGeralMonitoramentoControlador.id ne null}"
                                                        onkeypress="mascara(this, mdata)"
                                                        maxlength="10"
                                                        value="#{ordemGeralMonitoramentoControlador.selecionado.dataInicial}"/>
                                            <p:spacer width="5px"/>
                                            <h:outputText value=" Até: "/>
                                            <p:calendar id="calendarDataProgAte" pattern="dd/MM/yyyy"
                                                        disabled="#{ordemGeralMonitoramentoControlador.id ne null}"
                                                        onkeypress="mascara(this, mdata)"
                                                        maxlength="10"
                                                        value="#{ordemGeralMonitoramentoControlador.selecionado.dataFinal}"/>
                                        </h:panelGrid>
                                        <h:outputText value="Data Criação: "/>
                                        <p:calendar id="dataCriacao" pattern="dd/MM/yyyy"
                                                    onkeypress="mascara(this, mdata)"
                                                    maxlength="10"
                                                    value="#{ordemGeralMonitoramentoControlador.selecionado.dataCriacao}"
                                                    disabled="true"/>
                                        <h:outputText value="Usuário Logado: "/>
                                        <h:outputText
                                            value="#{ordemGeralMonitoramentoControlador.selecionado.usuarioLogado}"/>
                                        <fc:outputLabelObrigatorio value="Auditor Fiscal:"/>
                                        <p:autoComplete
                                            value="#{ordemGeralMonitoramentoControlador.selecionado.auditorFiscal}"
                                            dropdown="true"
                                            completeMethod="#{ordemGeralMonitoramentoControlador.completarAuditorFiscal}"
                                            converter="#{usuarioSistemaControlador.converterGenerico}"
                                            disabled="#{ordemGeralMonitoramentoControlador.selecionado.situacaoOGM ne 'INICIADO'}"
                                            var="auditor"
                                            itemLabel="#{auditor.pessoaFisica.nome}"
                                            itemValue="#{auditor.id}"
                                            id="auditorOGM"
                                            size="40"/>
                                        <fc:outputLabelObrigatorio value="Descrição: "/>
                                        <p:inputTextarea title="Digite a descrição do monitoramento fiscal"
                                                         disabled="#{ordemGeralMonitoramentoControlador.selecionado.situacaoOGM eq 'CONCLUIDO'}"
                                                         value="#{ordemGeralMonitoramentoControlador.selecionado.descricao}"
                                                         id="descricao" cols="70" rows="3"
                                                         maxlength="255"/>
                                    </h:panelGrid>
                                </td>
                                <td>
                                    <div style="text-align: left">
                                        <h:panelGrid id="botoes"
                                                     style="float : right; text-align: left;"
                                                     columns="1">
                                            <p:commandButton id="inicioMon" value="Iniciar Monitoramento"
                                                             style="width: 160px"
                                                             icon="ui-icon-check"
                                                             onstart="aguarde.show()"
                                                             oncomplete="aguarde.hide()"
                                                             onclick="if(!confirm('Deseja iniciar o processo de monitoramento da ordem?')) return false;"
                                                             styleClass="#{ordemGeralMonitoramentoControlador.selecionado.id ne null and
                                                                           ordemGeralMonitoramentoControlador.selecionado.situacaoOGM eq 'DESIGNADO' ? 'prioritario': ''}"
                                                             disabled="#{ordemGeralMonitoramentoControlador.selecionado.situacaoOGM eq 'FINALIZADO' or
                                                                         ordemGeralMonitoramentoControlador.isLiberarInicioMonitoramento() or
                                                                         ordemGeralMonitoramentoControlador.isLiberadoMonitoramento()}"
                                                             actionListener="#{ordemGeralMonitoramentoControlador.iniciarMonitoramentoFiscal()}"
                                                             update="@form"
                                                             process="@form"
                                            />
                                            <p:commandButton id="finalizacaoMon" value="Finalizar Monitoramento"
                                                             style="width: 160px"
                                                             icon="ui-icon-check"
                                                             onstart="aguarde.show()"
                                                             oncomplete="aguarde.hide()"
                                                             onclick="if(!confirm('Deseja finalizar o processo de monitoramento da ordem?')) return false;"
                                                             styleClass="#{(!ordemGeralMonitoramentoControlador.isLiberarFimMonitoramento()) and ordemGeralMonitoramentoControlador.selecionado.id
                                                             ne null and ordemGeralMonitoramentoControlador.selecionado.situacaoOGM eq 'EXECUTANDO' ? 'prioritario': ''}"
                                                             actionListener="#{ordemGeralMonitoramentoControlador.finalizarMonitoramento()}"
                                                             disabled="#{ordemGeralMonitoramentoControlador.isLiberarFimMonitoramento() or
                                                             ordemGeralMonitoramentoControlador.selecionado.situacaoOGM eq 'FINALIZADO' or
                                                             ordemGeralMonitoramentoControlador.operacaoNovo}"
                                                             update="@form"
                                                             process="@form"
                                            />
                                            <p:commandButton id="relatorio" value="Relatório Final"
                                                             icon="ui-icon-document"
                                                             style="width: 160px"
                                                             onclick="if(!confirm('Deseja gerar o relatório final do processo de monitoramento da ordem?')) return false;"
                                                             styleClass="#{ordemGeralMonitoramentoControlador.selecionado.id
                                                             ne null and ordemGeralMonitoramentoControlador.selecionado.situacaoOGM eq 'FINALIZADO' ? 'prioritario': ''}"
                                                             disabled="#{!ordemGeralMonitoramentoControlador.libearRelatorioFinal}"
                                                             actionListener="#{ordemGeralMonitoramentoControlador.gerarRelatorioFinal}"
                                                             onstart="statusDialog.show()"
                                                             oncomplete="statusDialog.hide()"
                                                             update=":Formulario"
                                                             process=":Formulario"
                                            />
                                        </h:panelGrid>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </p:outputPanel>
                </p:tab>
                <p:tab title="Anexos">
                    <p:outputPanel id="panelAnexo">
                        <p:panel id="arquivo" header="Anexos">
                            <fc:filesUploadWP selecionado="#{ordemGeralMonitoramentoControlador.selecionado}"/>
                        </p:panel>
                    </p:outputPanel>
                </p:tab>
            </p:tabView>
            <br/>
            <p:panel header="Empresas Monitoradas" id="panelMonitoramentoFiscal">
                <h:panelGrid columns="3" styleClass="verticalAlignTop">
                    <h:panelGrid columns="1" style="height: 30px; vertical-align: middle !important;">
                        <fc:outputLabelObrigatorio value="Cadastro Econômico:"/>
                    </h:panelGrid>
                    <fc:novoAutocompleteCadastroEconomico caminhoAtual="#{ordemGeralMonitoramentoControlador.urlAtual}"
                                                          disabled="#{ordemGeralMonitoramentoControlador.selecionado.situacaoOGM eq 'CONCLUIDO'}"
                                                          mostraBotaoNovo="false"
                                                          size="100"
                                                          mostraBotaoEdita="false"
                                                          value="#{ordemGeralMonitoramentoControlador.cadastroEconomico}"
                                                          id="cad"
                                                          mostraSituacoes="false"
                                                          listenerItemSelect="#{ordemGeralMonitoramentoControlador.atualizaForm()}"
                                                          permiteAlterarSituacoes="false"/>
                    <p:commandButton value="Selecionar mais de um Cadastro Econômico"
                                     disabled="#{ordemGeralMonitoramentoControlador.selecionado.situacaoOGM eq 'CONCLUIDO'}"
                                     update="@form :Formulario_dialog"
                                     process="@form"
                                     onclick="dialog.show()"
                                     styleClass="padrao"
                                     icon="ui-icon-search"/>
                </h:panelGrid>
                <p:commandButton id="cbAdicionarCMC" value="Adicionar"
                                 onstart="aguarde.show()" styleClass="operacao"
                                 oncomplete="aguarde.hide()"
                                 disabled="#{ordemGeralMonitoramentoControlador.selecionado.situacaoOGM eq 'CONCLUIDO'}"
                                 actionListener="#{ordemGeralMonitoramentoControlador.adicionarCadastroEconomico}"
                                 update="panelMonitoramentoFiscal cad"
                                 process="panelMonitoramentoFiscal"
                                 icon="ui-icon-circle-plus"/>
                <p:dataTable id="empresasmonitoradas" style="text-align: center;"
                             paginator="true"
                             rows="10"
                             paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>Cadastros Econômicos&lt;/span> {FirstPageLink}
                                 {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="10,50,100"
                             emptyMessage="Nenhum registro encontrado"
                             styleClass="mtop05"
                             value="#{ordemGeralMonitoramentoControlador.selecionado.monitoramentosFiscais}"
                             var="monitoramento">
                    <p:column headerText="Cadastro Econômico" style="width: 120px">
                        <h:outputText
                            value="#{monitoramento.cadastroEconomico.inscricaoCadastral}"/>
                    </p:column>
                    <p:column headerText="Nome" style="text-align: left">
                        <h:outputText
                            value="#{monitoramento.cadastroEconomico.pessoa.nome}"/>
                    </p:column>
                    <p:column headerText="Período de Monitoramento - De" style="width: 150px">
                        <h:outputText value="#{monitoramento.dataLevantamentoInicial}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Período de Monitoramento - Até" style="width: 150px">
                        <h:outputText value="#{monitoramento.dataLevantamentoFinal}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Situação" style="width: 100px">
                        <h:outputText value="#{monitoramento.situacaoMF.descricao}"/>
                    </p:column>
                    <p:column headerText="Designar" style="width: 70px">
                        <p:commandButton icon="ui-icon-pencil" onstart="statusDialog.show()"
                                         oncomplete="statusDialog.hide(); dialogDesignar.show()"
                                         update="@form :formDesignar"
                                         process="@form"
                                         actionListener="#{ordemGeralMonitoramentoControlador.selecionarMonitoramentoFiscal(monitoramento)}"
                                         disabled="#{monitoramento.id eq null or monitoramento.situacaoMF ne 'ADICIONADO'
                                         or monitoramento.dataInicialMonitoramento ne null}"
                                         rendered="#{monitoramento.dataInicialMonitoramento eq null}"
                                         styleClass="#{monitoramento.id ne null and monitoramento.situacaoMF eq 'ADICIONADO'
                                         and monitoramento.dataInicialMonitoramento eq null ? 'prioritario': ''}"/>
                        <p:commandButton icon="ui-icon-search" onstart="statusDialog.show()"
                                         oncomplete="statusDialog.hide(); dialogDesignados.show()"
                                         update=":formDesignados"
                                         actionListener="#{ordemGeralMonitoramentoControlador.selecionarMonitoramentoFiscal(monitoramento)}"
                                         rendered="#{monitoramento.dataInicialMonitoramento ne null}"/>
                    </p:column>
                    <p:column headerText="Cancelar" style="width: 70px">
                        <p:commandButton icon="ui-icon-cancel"
                                         actionListener="#{ordemGeralMonitoramentoControlador.selecionarMonitoramentoFiscal(monitoramento)}"
                                         onstart="statusDialog.show()"
                                         oncomplete="statusDialog.hide(); dlgCancelamento.show()"
                                         disabled="#{!ordemGeralMonitoramentoControlador.isPermitirCancelamentoMonitoramento(monitoramento)}"
                                         process="empresasmonitoradas"
                                         update="empresasmonitoradas">
                            <f:attribute name="monitoramentoFiscal" value="#{monitoramento}"/>
                        </p:commandButton>
                    </p:column>
                    <p:column headerText="Excluir" style="text-align: center; width:100px">
                        <p:commandButton
                            actionListener="#{ordemGeralMonitoramentoControlador.excluirCadastrosEconomicos(monitoramento)}"
                            onstart="aguarde.show()"
                            oncomplete="aguarde.hide()"
                            icon="ui-icon-trash"
                            disabled="#{!ordemGeralMonitoramentoControlador.isPermitirExclusaoMonitoramento(monitoramento)}"
                            onclick="if(!confirm('Deseja excluir este C.M.C?')) return false;"
                            process="empresasmonitoradas"
                            update="empresasmonitoradas"/>
                    </p:column>
                    <p:column headerText="Ver" style="text-align: center; width:100px">
                        <p:commandButton
                            actionListener="#{ordemGeralMonitoramentoControlador.irParaMonitoramentoGeral(monitoramento)}"
                            disabled="#{monitoramento.id eq null}"
                            icon="ui-icon-search"/>
                    </p:column>
                </p:dataTable>
            </p:panel>
            <div align="left" class="mtop05">
                <c:if test="#{ordemGeralMonitoramentoControlador.operacaoNovo}">
                    <p:commandButton id="salvarNovo"
                                     value="Salvar"
                                     icon="ui-icon-disk"
                                     styleClass="operacao prioritario"
                                     onstart="statusDialog.show()"
                                     oncomplete="statusDialog.hide(); dlgSalvarConfirm.show()"
                                     update=":Formulario :formSalvarConfirmarData"
                                     process="@form"
                                     disabled="#{ordemGeralMonitoramentoControlador.selecionado.situacaoOGM eq 'CONCLUIDO'}"/>

                </c:if>
                <c:if test="#{ordemGeralMonitoramentoControlador.operacaoEditar}">
                    <p:commandButton id="salvar"
                                     value="Salvar"
                                     icon="ui-icon-disk"
                                     styleClass="operacao prioritario"
                                     onstart="statusDialog.show()"
                                     oncomplete="statusDialog.hide();"
                                     actionListener="#{ordemGeralMonitoramentoControlador.salvar}"
                                     update=":Formulario :formSalvarConfirmarData"
                                     process="@form"
                                     disabled="#{ordemGeralMonitoramentoControlador.selecionado.situacaoOGM eq 'CONCLUIDO'}"/>
                </c:if>
                <p:commandButton ajax="false"
                                 id="cancelar"
                                 icon="ui-icon-cancel"
                                 value="Fechar"
                                 styleClass="operacao"
                                 action="lista"/>
            </div>
        </h:form>
        <p:dialog widgetVar="dialog"
                  id="dialogCMCs"
                  position="center"
                  dynamic="false"
                  style="position: fixed !important;"
                  modal="true"
                  closable="false"
                  width="900"
                  header="Selecionar Cadastros Econômicos">
            <h:form id="Formulario_dialog">
                <p:panel id="panelDialog" styleClass="mbot05" style="overflow: scroll; width: 100%; max-height: 400px">
                    <h:panelGrid columns="3" rendered="#{ordemGeralMonitoramentoControlador.selecionado.situacaoOGM ne 'FINALIZADO'}">
                        <h:outputLabel value="Serviço:"/>
                        <p:autoComplete queryDelay="1000" id="servicos"
                                        value="#{ordemGeralMonitoramentoControlador.servico}"
                                        size="95"
                                        dropdown="true"
                                        forceSelection="true"
                                        style="white-space: pre-wrap !important;"
                                        converter="#{ordemGeralMonitoramentoControlador.converterServico}"
                                        completeMethod="#{ordemGeralMonitoramentoControlador.completarServicos}"
                                        var="servico"
                                        maxResults="10"
                                        itemLabel="#{servico.toStringAutoComplete}"
                                        itemValue="#{servico.id}"/>
                        <p:commandButton actionListener="#{ordemGeralMonitoramentoControlador.adicionarListaServicos}"
                                         value="Adicionar"
                                         ajax="true"
                                         icon="ui-icon-circle-plus"
                                         title="Adicionar"
                                         update="@form"
                                         process="@form"
                                         styleClass="operacao"/>
                    </h:panelGrid>
                    <p:dataTable id="tabelaServicos"
                                 styleClass="mtop05 mbot05"
                                 rendered="#{ordemGeralMonitoramentoControlador.mostrarListaServicos}"
                                 value="#{ordemGeralMonitoramentoControlador.servicosSelecionados}"
                                 var="serv">
                        <p:column headerText="Código" style="width: 10%; text-align: center">
                            <h:outputLabel value="#{serv.codigo}"/>
                        </p:column>
                        <p:column headerText="Descrição">
                            <h:outputLabel value="#{serv.nome}"/>
                        </p:column>
                        <p:column headerText="Operação" style="width: 5%; text-align: center">
                            <p:commandButton icon="ui-icon-trash"
                                             actionListener="#{ordemGeralMonitoramentoControlador.removerItemListaServicosSelecionados}"
                                             title="Remover"
                                             process="@form"
                                             update="@form">
                                <f:attribute name="removeItem" value="#{serv}" id="removeItem"/>
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                    <h:panelGrid columns="2">
                        <h:outputText value="Classificação da Atividade:"/>
                        <h:selectOneMenu title="Selecione a Classificação da Atividade"
                                         value="#{ordemGeralMonitoramentoControlador.classificacaoAtividade}"
                                         id="classificacaoatividade">
                            <f:selectItems value="#{ordemGeralMonitoramentoControlador.classificacaoDaAtividade}"/>
                        </h:selectOneMenu>
                        <h:outputText value="Endereco:"/>
                        <p:autoComplete queryDelay="1000" id="endereco"
                                        value="#{ordemGeralMonitoramentoControlador.endereco}"
                                        completeMethod="#{ordemGeralMonitoramentoControlador.completarEndereco}"
                                        forceSelection="true"
                                        var="endereco"
                                        itemLabel="#{endereco}"
                                        itemValue="#{endereco}" size="70">
                        </p:autoComplete>
                        <h:outputText value="Bairro:"/>
                        <p:autoComplete queryDelay="1000" id="bairro"
                                        value="#{ordemGeralMonitoramentoControlador.bairro}"
                                        completeMethod="#{ordemGeralMonitoramentoControlador.completarBairro}"
                                        forceSelection="true"
                                        var="bairro"
                                        itemLabel="#{bairro}"
                                        itemValue="#{bairro}" size="50">
                        </p:autoComplete>
                        <h:outputText value="Situacao"/>
                        <h:selectOneMenu id="situacao" value="#{ordemGeralMonitoramentoControlador.situacaoCadastral}">
                            <f:selectItems value="#{ordemGeralMonitoramentoControlador.situacoes}"/>
                        </h:selectOneMenu>
                        <h:outputText value="Faturamento:"/>
                        <h:panelGroup id="groupFaturamento">
                            <h:panelGrid columns="4">
                                <h:outputText value="Data Inicial:"/>
                                <p:calendar value="#{ordemGeralMonitoramentoControlador.dataInicial}"
                                            pattern="dd/MM/yyyy"
                                            onkeypress="mascara(this, mdata)"
                                            maxlength="10"/>
                                <h:outputText value="Data Final:"/>
                                <p:calendar value="#{ordemGeralMonitoramentoControlador.dataFinal}"
                                            pattern="dd/MM/yyyy"
                                            onkeypress="mascara(this, mdata)"
                                            maxlength="10"/>
                                <h:outputText value="Valor Inicial:"/>
                                <p:inputText value="#{ordemGeralMonitoramentoControlador.valorInicial}"/>
                                <h:outputText value="Valor Final:"/>
                                <p:inputText value="#{ordemGeralMonitoramentoControlador.valorFinal}"/>
                            </h:panelGrid>
                        </h:panelGroup>
                    </h:panelGrid>
                    <h:panelGrid columns="3">
                        <p:commandButton value="Filtrar"
                                         actionListener="#{ordemGeralMonitoramentoControlador.selecionarCMCs}"
                                         process="cmc panelDialog"
                                         update="cmc panelDialog" icon="ui-icon-search"
                                         onstart="aguarde.show()" oncomplete="aguarde.hide()"
                                         styleClass="padrao prioritario"/>
                        <p:commandButton value="Limpar Filtros"
                                         actionListener="#{ordemGeralMonitoramentoControlador.limparFiltros}"
                                         styleClass="padrao" icon="ui-icon-clear"
                                         process="cmc panelDialog"
                                         update="cmc panelDialog"/>
                    </h:panelGrid>
                    <p:dataTable id="cmc"
                                 style="text-align: center;"
                                 styleClass="mtop05"
                                 emptyMessage="Nenhum registro encontrado"
                                 value="#{ordemGeralMonitoramentoControlador.cadastrosEconomicos}"
                                 var="cmc"
                                 rowKey="#{cmc}"
                                 selection="#{ordemGeralMonitoramentoControlador.cmcs}"
                                 paginator="true"
                                 rows="10"
                                 paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>Cadastros Econômicos&lt;/span> {FirstPageLink}
                                 {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 rowsPerPageTemplate="10,50,100">
                        <p:column selectionMode="multiple"/>
                        <p:column headerText="Cadastro Econômico">
                            <h:outputText value="#{cmc.inscricaoCadastral}"/>
                        </p:column>
                        <p:column headerText="Situação">
                            <h:outputText
                                value="#{ordemGeralMonitoramentoControlador.situacaoCadastral}"/>
                        </p:column>
                        <p:column headerText="Nome/Razão Social">
                            <h:outputText value="#{cmc.pessoa.nome}"/>
                        </p:column>
                        <p:column headerText="CPF/CNPJ">
                            <h:outputText value="#{cmc.pessoa.cpf_Cnpj}"/>
                        </p:column>
                        <p:column headerText="Nome Fantasia">
                            <h:outputText value="#{cmc.pessoa.nomeFantasia}"
                                          rendered="#{ordemGeralMonitoramentoControlador.instanciaPJ(cmc.pessoa)}"/>
                        </p:column>
                        <p:column headerText="Endereços">
                            <ui:repeat value="#{ordemGeralMonitoramentoControlador.enderecosDaPessoa(cmc.pessoa)}"
                                       var="endereco">
                                <h:outputText value="#{endereco}"/><br/>
                            </ui:repeat>
                        </p:column>
                    </p:dataTable>
                </p:panel>
                <p:commandButton value="Confirmar" styleClass="operacao prioritario" icon="ui-icon-check"
                                 onclick="dialog.hide()"
                                 update="@form :Formulario:panelMonitoramentoFiscal"
                                 process="@form"
                                 actionListener="#{ordemGeralMonitoramentoControlador.adicionarCadastrosEconomicos}"/>
                <p:commandButton value="Fechar" icon="ui-icon-close" onclick="dialog.hide()"
                                 update=":Formulario_dialog"
                                 process=":Formulario_dialog"
                                 actionListener="#{ordemGeralMonitoramentoControlador.limparFiltros}"
                                 styleClass="operacao"/>
            </h:form>
        </p:dialog>
        <p:dialog id="dialogDlg" width="800" modal="true" widgetVar="dialogDesignar" header="Designar Fiscais"
                  position="center"
                  closable="false"
                  style="position: fixed !important; max-height: 400px !important; overflow: auto !important;"
                  resizable="false">
            <h:form id="formDesignar">
                <p:panel styleClass="mbot05">
                    <p:dataTable id="auditoresfiscais" style="text-align: center;"
                                 paginator="true"
                                 rows="10"
                                 paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>Fiscais&lt;/span> {FirstPageLink}
                                     {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 rowsPerPageTemplate="10,50,100"
                                 emptyMessage="Nenhum registro encontrado"
                                 styleClass="mbot05"
                                 selection="#{ordemGeralMonitoramentoControlador.arrayListaUsuarios}"
                                 value="#{ordemGeralMonitoramentoControlador.usuariosSistema}"
                                 var="fis"
                                 rowKey="#{fis}">
                        <p:column selectionMode="multiple" style="width: 30px"/>
                        <p:column headerText="Nome" filterBy="#{fis.pessoaFisica.nome}">
                            <h:outputText value="#{fis.pessoaFisica.nome}"/>
                        </p:column>
                        <p:column headerText="Login" filterBy="#{fis.login}">
                            <h:outputText value="#{fis.login}"/>
                        </p:column>
                    </p:dataTable>
                    <table border="0" width="100%" cellspacing="0" cellpadding="0">
                        <tr>
                            <td width="5px">
                            </td>
                            <td>
                                <div style="display:flex;justify-content:left;align-items:center;">
                                    <p:panel header="Período de Monitoramento" id="panelPeriodoFiscal">
                                        <h:panelGrid columns="3">
                                            <h:outputText value="De: "/>
                                            <p:calendar
                                                value="#{ordemGeralMonitoramentoControlador.monitoramentoFiscalSelecionado.dataLevantamentoInicial}"
                                                id="dataInicialPer"
                                                pattern="dd/MM/yyyy"
                                                onkeypress="mascara(this, mdata)"
                                                maxlength="10"/>
                                            <p:spacer/>
                                            <h:outputText value="Até: "/>
                                            <p:calendar
                                                value="#{ordemGeralMonitoramentoControlador.monitoramentoFiscalSelecionado.dataLevantamentoFinal}"
                                                id="dataFinalPer"
                                                pattern="dd/MM/yyyy"
                                                onkeypress="mascara(this, mdata)"
                                                maxlength="10"/>
                                            <p:spacer/>
                                        </h:panelGrid>
                                    </p:panel>
                                </div>
                            </td>
                        </tr>
                    </table>
                </p:panel>
                <div style="display:flex;justify-content:center;align-items:center;">
                    <p:commandButton value="Confirmar" styleClass="operacao prioritario" icon="ui-icon-check"
                                     onstart="aguarde.show()"
                                     oncomplete="aguarde.hide()"
                                     actionListener="#{ordemGeralMonitoramentoControlador.designarMonitoramentoFiscal}"
                                     update="@form :Formulario"
                                     process="@form :Formulario"
                    />
                    <p:commandButton value="Fechar" icon="ui-icon-close" onclick="dialogDesignar.hide()"
                                     actionListener="#{ordemGeralMonitoramentoControlador.limparCamposDesignarFiscais}"
                                     styleClass="operacao"/>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog id="dialogDesig" width="800" modal="true" widgetVar="dialogDesignados" header="Fiscais Designados"
                  position="center"
                  closable="false"
                  style="position: fixed !important; max-height: 400px !important; overflow: auto !important;"
                  resizable="false">
            <h:form id="formDesignados">
                <p:panel styleClass="mbot05">
                    <h2>#{ordemGeralMonitoramentoControlador.monitoramentoFiscalSelecionado.cadastroEconomico.descricao}</h2>
                    <p:dataTable id="desigandos" style="text-align: center;"
                                 emptyMessage="Nenhum registro encontrado"
                                 styleClass="mbot05"
                                 value="#{ordemGeralMonitoramentoControlador.monitoramentoFiscalSelecionado.fiscaisMonitoramento}"
                                 var="fis"
                                 rowKey="#{fis}">
                        <p:column headerText="Nome">
                            <h:outputText value="#{fis.auditorFiscal.pessoaFisica.nome}"/>
                        </p:column>
                        <p:column headerText="Login">
                            <h:outputText value="#{fis.auditorFiscal.login}"/>
                        </p:column>
                    </p:dataTable>
                </p:panel>
                <div style="display:flex;justify-content:center;align-items:center;">
                    <p:commandButton value="Fechar" icon="ui-icon-close"
                                     onclick="dialogDesignados.hide()"
                                     styleClass="operacao"/>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog id="dlgCancelamentoDlg" width="630" modal="true" widgetVar="dlgCancelamento" header="Cancelamento"
                  position="center"
                  style="position: fixed !important;"
                  resizable="false">
            <h:form id="formCancelamento">
                <p:panel styleClass="mbot05">
                    <h:panelGrid columns="2">
                        <fc:outputLabelObrigatorio value="Motivo:"/>
                        <p:inputTextarea id="motivo"
                                         value="#{ordemGeralMonitoramentoControlador.monitoramentoFiscalSelecionado.motivoCancelamento}"
                                         rows="4" cols="70" maxHeight="50"/>
                    </h:panelGrid>
                </p:panel>
                <div style="display:flex;justify-content:center;align-items:center;">
                    <p:commandButton value="Confirmar" styleClass="padrao prioritario" icon="ui-icon-check"
                                     update="@form :Formulario"
                                     process="@form :Formulario"
                                     onstart="aguarde.show()"
                                     oncomplete="aguarde.hide()"
                                     actionListener="#{ordemGeralMonitoramentoControlador.cancelarMonitoramentoFiscal}"/>
                    <p:commandButton value="Fechar" styleClass="padrao" icon="ui-icon-close"
                                     onclick="dlgCancelamento.hide()"/>
                </div>
            </h:form>
        </p:dialog>
        <p:dialog id="dialogRelatorio" width="1000" height="500" modal="true"
                  widgetVar="dialogRelatorioFinal"
                  position="center"
                  style="position: fixed !important;"
                  header="Impressão do Relatório Final" resizable="false">
            <h:form id="formImprimirRelatorioFinal">
                <p:panel style="overflow-y: auto;
                        overflow-x: hidden;
                        max-height: 500px !important;"
                         styleClass="mbot05">
                    <p:editor value="#{ordemGeralMonitoramentoControlador.selecionado.doctorelatoriofinalogm.conteudo}"
                              id="modelo" width="940"
                              height="430" widgetVar="conteudos"/>
                </p:panel>
                <div style="width: 100%; text-align: center">
                    <p:commandButton value="Gerar"
                                     actionListener="#{ordemGeralMonitoramentoControlador.emitirRelatorioFinal()}"
                                     label="Gerar"
                                     update="@form :Formulario"
                                     process="@form :Formulario"
                                     icon="ui-icon-close"
                                     styleClass="operacao prioritario" imprimeNoDialog="true"/>
                    <p:commandButton value="Fechar" icon="ui-icon-close" onclick="dialogRelatorioFinal.hide()"
                                     styleClass="operacao mlef05"/>
                </div>
            </h:form>
        </p:dialog>
        <p:dialog id="dlgSalvarConfirmarData"
                  width="630" modal="true"
                  widgetVar="dlgSalvarConfirm"
                  header="Salvar"
                  position="center"
                  style="position: center !important;"
                  resizable="false">
            <h:form id="formSalvarConfirmarData">
                <div class="alinhamentoCentralizado alert alert-warn">
                    <h:outputText
                        value="A data programada não pode ser alterada depois de salva a Ordem Geral de Monitoramento. Deseja Salvar?"/>
                </div>
                <br/>
                <div style="display:flex;justify-content:center;align-items:center;">
                    <p:commandButton value="Confirmar" styleClass="padrao prioritario" icon="ui-icon-check"
                                     onstart="aguarde.show()"
                                     oncomplete="aguarde.hide()"
                                     update="@form"
                                     process="@form"
                                     actionListener="#{ordemGeralMonitoramentoControlador.salvar}"/>
                    <p:commandButton value="Cancelar" styleClass="padrao" icon="ui-icon-close"
                                     onclick="dlgSalvarConfirm.hide()"/>
                </div>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>
