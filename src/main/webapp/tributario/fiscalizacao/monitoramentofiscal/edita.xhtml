<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui">
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <h:form id="Formulario">
            <p:tabView id="dadosMonitoramentoFiscal">
                <p:tab title="Monitoramento Fiscal" id="tabMonitoramentoFiscal">
                    <p:outputPanel id="panelMonitoramentoFiscal">
                        <table style="width: 100%">
                            <tr>
                                <td>
                                    <h:panelGrid columns="4">
                                        <h:outputText value="Período - De: "/>
                                        <p:calendar onkeypress="mascara(this, mdata)" maxlength="10" id="dataInicial"
                                                    pattern="dd/MM/yyyy"
                                                    disabled="true"
                                                    size="10"
                                                    value="#{monitoramentoFiscalControlador.selecionado.dataInicialMonitoramento}"
                                                    navigator="true"/>
                                        <h:outputText value="Até: "/>
                                        <p:calendar onkeypress="mascara(this, mdata)" maxlength="10" id="dataFinal"
                                                    pattern="dd/MM/yyyy"
                                                    disabled="true"
                                                    size="10"
                                                    value="#{monitoramentoFiscalControlador.selecionado.dataFinalMonitoramento}"
                                                    navigator="true"/>
                                    </h:panelGrid>
                                    <h:panelGrid columns="2">
                                        <h:outputText value="Situação: "/>
                                        <p:selectOneMenu id="situacaomonitoramento"
                                                         value="#{monitoramentoFiscalControlador.selecionado.situacaoMF}"
                                                         disabled="true">
                                            <f:selectItems
                                                value="#{monitoramentoFiscalControlador.situacoesMonitoramentoFiscal}"/>
                                        </p:selectOneMenu>
                                        <h:outputText value="C.M.C: "/>
                                        <p:inputText
                                            value="#{monitoramentoFiscalControlador.selecionado.cadastroEconomico}"
                                            disabled="true"/>
                                        <h:outputText value="Razão Social: "/>
                                        <p:inputText
                                            value="#{monitoramentoFiscalControlador.selecionado.cadastroEconomico.pessoa.nome}"
                                            size="70"
                                            disabled="true"/>
                                        <h:outputText value="Nome Fantasia: "/>
                                        <p:inputText
                                            value="#{monitoramentoFiscalControlador.selecionado.cadastroEconomico.pessoa.nomeFantasia}"
                                            size="70"
                                            disabled="true"/>
                                        <h:outputText value="CNPJ: "/>
                                        <p:inputText
                                            value="#{monitoramentoFiscalControlador.selecionado.cadastroEconomico.pessoa.cpf_Cnpj}"
                                            disabled="true"/>
                                        <h:outputText value="Endereço: "/>
                                        <p:inputText
                                            value="#{monitoramentoFiscalControlador.selecionado.cadastroEconomico.pessoa.enderecoPrincipal.enderecoCompleto}"
                                            size="70"
                                            disabled="true"/>
                                        <h:outputText value="Abertura da empresa: "/>
                                        <p:calendar onkeypress="mascara(this, mdata)" maxlength="10" id="abertura"
                                                    pattern="dd/MM/yyyy"
                                                    disabled="true"
                                                    size="10"
                                                    value="#{monitoramentoFiscalControlador.selecionado.dataFinalMonitoramento}"
                                                    navigator="true"/>
                                        <h:outputText value="Contador: "/>
                                        <p:inputText
                                            value="#{monitoramentoFiscalControlador.selecionado.cadastroEconomico.escritorioContabil}"
                                            size="70"
                                            disabled="true"/>
                                        <h:outputText value="E-mail: "/>
                                        <p:inputText
                                            value="#{monitoramentoFiscalControlador.selecionado.cadastroEconomico.pessoa.email}"
                                            size="70"
                                            disabled="true"/>
                                    </h:panelGrid>
                                    <h:panelGrid columns="3">
                                        <h:outputText value="Observação: "/>
                                        <p:inputTextarea
                                            value="#{monitoramentoFiscalControlador.selecionado.observacao}"
                                            maxlength="3000"
                                            cols="80"
                                            counter="counterObs"
                                            disabled="#{monitoramentoFiscalControlador.selecionado.situacaoMF eq 'FINALIZADO'}"
                                            counterTemplate="{0} Caracteres Restantes."/>
                                        <h:outputText id="counterObs" styleClass="mlef05"/>
                                    </h:panelGrid>
                                </td>
                                <td style="text-align: right;" valign="top">
                                    <h:panelGrid id="panelBotoes" style="float: right; text-align: left;"
                                                 columns="1">
                                        <p:commandButton id="inicioMon" value="Iniciar Monitoramento"
                                                         style="width: 160px"
                                                         icon="ui-icon-check"
                                                         onstart="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         disabled="#{monitoramentoFiscalControlador.selecionado.situacaoMF ne 'DESIGNADO'}"
                                                         actionListener="#{monitoramentoFiscalControlador.iniciarMonitoramentoFiscal}"
                                                         update="@form"
                                                         process="@form"/>
                                        <p:commandButton id="finalizacaoMon" value="Finalizar Monitoramento"
                                                         style="width: 160px"
                                                         icon="ui-icon-check"
                                                         onstart="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         disabled="#{monitoramentoFiscalControlador.selecionado.dataInicialMonitoramento eq null ||
                                                                     (monitoramentoFiscalControlador.selecionado.situacaoMF ne 'INICIADO' and
                                                                      monitoramentoFiscalControlador.selecionado.situacaoMF ne 'COMUNICADO')}"
                                                         actionListener="#{monitoramentoFiscalControlador.finalizarMonitoramentoFiscal}"
                                                         update="@form"
                                                         process="@form"/>
                                    </h:panelGrid>
                                </td>
                            </tr>
                        </table>
                        <p:tabView id="dadosVerificacaoDebitos" styleClass="mtop10">
                            <p:tab title="Verificação de Débitos" id="tabVerificacaoDebitos">
                                <p:outputPanel id="panelVerificacao">
                                    <h:panelGrid columns="2">
                                        <h:outputText value="Alvará de Localização: "/>
                                        <h:outputText
                                            value="#{monitoramentoFiscalControlador.alvaraLocalizacao != null ?
                                            monitoramentoFiscalControlador.alvaraLocalizacao : 'Não existe alvará de localização para este C.M.C.'}"
                                            styleClass="negrito"/>

                                        <h:outputText value="Alvará de Funcionamento: "/>
                                        <h:outputText
                                            value="#{monitoramentoFiscalControlador.alvaraFuncionamento != null ?
                                            monitoramentoFiscalControlador.alvaraFuncionamento : 'Não existe alvará de funcionamento para este C.M.C.'}"
                                            styleClass="negrito"/>

                                        <h:outputText value="Alvará de Vigilância Sanitária: "/>
                                        <h:outputText
                                            value="#{monitoramentoFiscalControlador.alvaraVigilanciaSanitaria != null ?
                                            monitoramentoFiscalControlador.alvaraVigilanciaSanitaria : 'Não existe alvará de vigilância sanitária para este C.M.C.'}"
                                            styleClass="negrito"/>

                                        <h:outputText value="IPTU: "/>
                                        <h:outputText
                                            value="#{monitoramentoFiscalControlador.iptuCadastroImobiliarioDoCadastroEconomico != null ?
                                            monitoramentoFiscalControlador.iptuCadastroImobiliarioDoCadastroEconomico : 'Não existe IPTU vinculado a este C.M.C.'}"
                                            styleClass="negrito"/>
                                    </h:panelGrid>
                                </p:outputPanel>
                            </p:tab>
                            <p:tab title="Histórico de Situações" id="tabHistoricoSituacoes">
                                <p:outputPanel id="panelHistorico">
                                    <p:dataTable id="historico" style="text-align: left;"
                                                 emptyMessage="Nenhum registro encontrado"
                                                 paginator="true"
                                                 rows="10"
                                                 value="#{monitoramentoFiscalControlador.selecionado.historicoSituacoesMonitoramentoFiscal}"
                                                 var="historico"
                                                 paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>HISTÓRICO DE SITUAÇÕES&lt;/span> {FirstPageLink}
                                                 {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                 rowsPerPageTemplate="10,50,100">
                                        <p:column headerText="Data" style="width: 120px">
                                            <h:outputText
                                                value="#{historico.data}">
                                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Situação" style="width: 120px">
                                            <h:outputText
                                                value="#{historico.situacaoMonitoramentoFiscal.descricao}"/>
                                        </p:column>
                                    </p:dataTable>
                                </p:outputPanel>
                            </p:tab>
                            <p:tab title="Fiscais Designados" id="tabFiscaisDesignados">
                                <p:outputPanel id="panelFiscais">
                                    <p:dataTable id="fiscais" style="text-align: left;"
                                                 emptyMessage="Nenhum registro encontrado"
                                                 paginator="true"
                                                 rows="10"
                                                 value="#{monitoramentoFiscalControlador.selecionado.fiscaisMonitoramento}"
                                                 var="fiscais"
                                                 paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>FISCAIS DESIGNADOS&lt;/span> {FirstPageLink}
                                                 {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                 rowsPerPageTemplate="10,50,100">
                                        <p:column headerText="Nome do Fiscal" style="width: 120px">
                                            <h:outputText
                                                value="#{fiscais.auditorFiscal.nome}">
                                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Login" style="width: 120px">
                                            <h:outputText
                                                value="#{fiscais.auditorFiscal.login}"/>
                                        </p:column>
                                    </p:dataTable>
                                </p:outputPanel>
                            </p:tab>
                            <p:tab title="Levantamento de UFM" id="tabLevantamentoUFM">
                                <p:outputPanel id="panelUFM">
                                    <h:panelGrid columns="2">
                                        <h:outputText value="Data do Arbitramento:" styleClass="mlef10"/>
                                        <h:outputText
                                            value="#{monitoramentoFiscalControlador.selecionado.dataArbitramento}"
                                            styleClass="negrito">
                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                        </h:outputText>
                                        <h:outputText value="UFM do Arbitramento:" styleClass="mlef10"/>
                                        <h:outputText
                                            value="#{monitoramentoFiscalControlador.selecionado.ufmArbitramento}"
                                            converter="moneyConverter"
                                            styleClass="negrito"/>
                                    </h:panelGrid>
                                    <p:panel style="border:none;" styleClass="mtop10">
                                        <p:dataTable id="tableLevantamentoUFM" style="text-align: left;"
                                                     emptyMessage="Nenhum registro encontrado"
                                                     paginator="true"
                                                     rows="10"
                                                     value="#{monitoramentoFiscalControlador.selecionado.levantamentosUFM}"
                                                     var="levantamentosUFM"
                                                     rowKey="#{levantamentosUFM}"
                                                     selection="#{monitoramentoFiscalControlador.levantamentosUFMSelecionados}"
                                                     paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>LEVANTAMENTOS&lt;/span> {FirstPageLink}
                                                 {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                     rowsPerPageTemplate="10,50,100">
                                            <p:column headerText="Mês">
                                                <h:outputText value="#{levantamentosUFM.mes.descricao}"/>
                                            </p:column>
                                            <p:column headerText="Ano">
                                                <h:outputText value="#{levantamentosUFM.ano}"/>
                                            </p:column>
                                            <p:column headerText="Valor da UFM (R$)" style="text-align: right">
                                                <h:outputText value="#{levantamentosUFM.valorIndice}"
                                                              converter="moneyConverter">
                                                </h:outputText>
                                            </p:column>
                                        </p:dataTable>
                                    </p:panel>
                                    <p:panel style="border:none;" styleClass="mtop10">
                                        <h:panelGrid columns="3">
                                            <h:outputText value="Conclusão: "/>
                                            <p:inputTextarea
                                                value="#{monitoramentoFiscalControlador.selecionado.conclusao}"
                                                maxlength="3000"
                                                cols="80"
                                                counter="counter"
                                                disabled="#{monitoramentoFiscalControlador.selecionado.situacaoMF eq 'FINALIZADO'}"
                                                counterTemplate="{0} Caracteres Restantes."/>
                                            <h:outputText id="counter" styleClass="mlef05"/>
                                        </h:panelGrid>
                                    </p:panel>
                                </p:outputPanel>
                            </p:tab>
                            <p:tab title="Levantamento Contábil" id="tabLevantamentoContabil">
                                <h:panelGroup id="painelLancamentoContabil">
                                    <div style="width: 100%; text-align: center">
                                        <p:commandButton id="botaoNovoReg"
                                                         value="Novo Registro"
                                                         icon="ui-icon-circle-plus"
                                                         title="Novo Levantamento"
                                                         style="height: 30px;"
                                                         styleClass="icone_verde"
                                                         update=":formLevantamentoContabil"
                                                         process="@form"
                                                         onclick="aguarde.show()"
                                                         oncomplete="aguarde.hide();"
                                                         disabled="#{(monitoramentoFiscalControlador.selecionado.situacaoMF ne 'DESIGNADO' and
                                                                      monitoramentoFiscalControlador.selecionado.situacaoMF ne 'INICIADO')}"
                                                         actionListener="#{monitoramentoFiscalControlador.novoRegistro()}"/>

                                        <p:commandButton id="botaoNotificar"
                                                         value="Notificar Empresa"
                                                         icon="ui-icon-circle-plus"
                                                         title="Notificar empresa"
                                                         style="height: 30px;"
                                                         styleClass="icone_verde"
                                                         update=":formLevantamentoContabil"
                                                         process="@form"
                                                         onclick="aguarde.show()"
                                                         oncomplete="aguarde.hide();"
                                                         disabled="#{monitoramentoFiscalControlador.desabilitarNotificacao}"
                                                         actionListener="#{monitoramentoFiscalControlador.criarNotificacaoMalaDireta}"/>
                                    </div>
                                    <c:forEach
                                        items="#{monitoramentoFiscalControlador.selecionado.registrosLancamentoContabilMonitoramentoFiscal}"
                                        var="registroLancamento" varStatus="var">
                                        <p:panel styleClass="mtop10"
                                                 header="Registro #{registroLancamento.numeroRegistro}/#{registroLancamento.ano}"
                                                 id="panelRegistro#{registroLancamento.numeroRegistro}#{registroLancamento.ano}">
                                            <table style="width: 100%">
                                                <tr>
                                                    <td>
                                                        <h:panelGrid columns="2" styleClass="negrito">
                                                            <h:outputText value="Tipo: "/>
                                                            <h:outputText
                                                                value="#{registroLancamento.tipo.descricao}"/>
                                                        </h:panelGrid>
                                                        <h:panelGrid columns="3">
                                                            <p:commandButton value="Remover Lançamento"
                                                                             icon="ui-icon-trash"
                                                                             styleClass="botaoCinza"
                                                                             actionListener="#{monitoramentoFiscalControlador.removeRegistro(registroLancamento)}"
                                                                             update="@form"
                                                                             style="height: 30px;color: black"
                                                                             onclick="if(!confirm('Você está removendo um registro e seus lançamentos contábeis. Ao confirmar, essa operação não poderá ser revertida. Deseja continuar?')) return false;"
                                                                             onstart="aguarde.show()"
                                                                             disabled="#{monitoramentoFiscalControlador.selecionado.situacaoMF eq 'FINALIZADO'}"
                                                                             oncomplete="aguarde.hide()"/>
                                                            <fc:botaoTargetBlank
                                                                actionListener="#{monitoramentoFiscalControlador.imprimeDemonstrativo(registroLancamento)}"
                                                                label="Imprimir Demonstrativo"
                                                                style="height: 30px"
                                                                imprimeNoDialog="true"/>
                                                        </h:panelGrid>
                                                    </td>
                                                </tr>
                                            </table>
                                            <c:forEach
                                                items="#{registroLancamento.lancamentosPorAno.keySet()}"
                                                var="lancamento" varStatus="var2">
                                                <p:dataTable
                                                    id="tableLevantamentoContabil${registroLancamento.numeroRegistro}${var2.index}"
                                                    style="font-size: 10px !important; overflow: auto"
                                                    rowIndexVar="linhaRegistro"
                                                    styleClass="lancamentoContabeis"
                                                    value="#{registroLancamento.lancamentosPorAno.get(lancamento)}"
                                                    var="lancamentoContabil"
                                                    tableStyle="max-width:1300px"
                                                    emptyMessage="Nenhum registro encontrado.">
                                                    <f:facet name="header">
                                                        <h:outputText
                                                            value="Lançamentos contábeis do exercício de ${lancamento}"/>
                                                    </f:facet>
                                                    <f:facet name="footer">
                                                        <h:outputText
                                                            value="Lançamentos contábeis do exercício de ${lancamento}"/>
                                                    </f:facet>
                                                    <p:column headerText="Seq." style="width: 30px">
                                                        <h:outputText
                                                            value="#{lancamentoContabil.sequencia}"/>
                                                    </p:column>
                                                    <p:column headerText="Mês" style="width: 50px">
                                                        <h:outputText
                                                            value="#{lancamentoContabil.mes.descricao}"/>
                                                    </p:column>
                                                    <p:column headerText="Ano" style="width: 40px">
                                                        <h:outputText value="#{lancamentoContabil.ano}"/>
                                                        <f:facet name="footer">
                                                            <h:outputText value="TOTAL:"
                                                                          styleClass="negrito"/>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column headerText="Vlr Declarado"
                                                              style="text-align: right">
                                                        <p:inputText
                                                            value="#{lancamentoContabil.valorDeclarado}"
                                                            styleClass="valor"
                                                            onkeydown="mascaraPonto(this)"
                                                            size="9" id="colValorDeclarado"
                                                            label="Valor Declarado"
                                                            disabled="#{monitoramentoFiscalControlador.selecionado.situacaoMF eq 'FINALIZADO'}"
                                                            style="border: 2px solid #6E95A6 !important;">
                                                            <f:convertNumber pattern="#,##0.00"/>
                                                            <p:ajax event="blur"
                                                                    process=":Formulario"
                                                                    listener="#{monitoramentoFiscalControlador.atualizarValoresTabelaLancamentoContabilComUpdate(lancamentoContabil, registroLancamento.numeroRegistro, var2.index, linhaRegistro)}"
                                                                    update="colIssPago colIssApurado colIssDevido colBaseCalculo juros multa correcao corrigido total"/>
                                                        </p:inputText>
                                                        <f:facet name="footer">
                                                            <h:outputText value="Vlr Declarado"/><br/>
                                                            <h:outputText id="valorTotalDeclarado"
                                                                          value="#{monitoramentoFiscalControlador.retornarValorTotalDeclaradoLancamento(lancamento, registroLancamento)}"
                                                                          styleClass="negrito">
                                                                <f:convertNumber pattern="#,##0.00"/>
                                                            </h:outputText>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column headerText="Vlr Apurado "
                                                              style="text-align: right">
                                                        <p:inputText
                                                            value="#{lancamentoContabil.valorApurado}"
                                                            style="border: 2px solid #6E95A6 !important"
                                                            size="9" id="colValorApurado"
                                                            label="Valor Apurado"
                                                            styleClass="valor"
                                                            disabled="#{monitoramentoFiscalControlador.selecionado.situacaoMF eq 'FINALIZADO'}"
                                                            onkeydown="mascaraPonto(this)">
                                                            <f:convertNumber pattern="#,##0.00"/>
                                                            <p:ajax event="blur"
                                                                    process=":Formulario"
                                                                    listener="#{monitoramentoFiscalControlador.atualizarValoresTabelaLancamentoContabilComUpdate(lancamentoContabil, registroLancamento.numeroRegistro, var2.index, linhaRegistro)}"
                                                                    update="colIssPago colIssApurado colIssDevido colBaseCalculo juros multa correcao corrigido total "/>
                                                        </p:inputText>
                                                        <f:facet name="footer">
                                                            <h:outputText value="Vlr Apurado"/><br/>
                                                            <h:outputText id="valorTotalApurado"
                                                                          value="#{monitoramentoFiscalControlador.retornarValorTotalApuradoLancamento(lancamento, registroLancamento)}"
                                                                          styleClass="negrito">
                                                                <f:convertNumber pattern="#,##0.00"/>
                                                            </h:outputText>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column headerText="Base Cálculo"
                                                              style="text-align: right">
                                                        <h:outputText
                                                            value="#{lancamentoContabil.baseCalculo}"
                                                            id="colBaseCalculo">
                                                            <f:convertNumber pattern="#,##0.00"/>
                                                        </h:outputText>
                                                        <f:facet name="footer">
                                                            <h:outputText value="Base Cálculo"/><br/>
                                                            <h:outputText id="valorTotalBase"
                                                                          value="#{monitoramentoFiscalControlador.retornarValorTotalBaseCalculoLancamento(lancamento, registroLancamento)}"
                                                                          styleClass="negrito">
                                                                <f:convertNumber pattern="#,##0.00"/>
                                                            </h:outputText>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column headerText="% ISS" style="text-align: right">
                                                        <p:inputText
                                                            value="#{lancamentoContabil.aliquotaISS}"
                                                            size="5" id="colAliquotaISS" label="% ISS"
                                                            style="border: 2px solid #6E95A6 !important"
                                                            styleClass="valor"
                                                            disabled="#{monitoramentoFiscalControlador.selecionado.situacaoMF eq 'FINALIZADO'}"
                                                            onkeydown="mascaraPonto(this)">
                                                            <f:convertNumber pattern="#,##0.00"/>
                                                            <p:ajax event="blur"
                                                                    listener="#{monitoramentoFiscalControlador.atualizarValoresTabelaLancamentoContabilComUpdate(lancamentoContabil, registroLancamento.numeroRegistro, var2.index, linhaRegistro)}"
                                                                    update="colIssPago colIssApurado colIssDevido colBaseCalculo juros multa correcao corrigido total "/>
                                                        </p:inputText>
                                                    </p:column>
                                                    <p:column headerText="ISS Lançado"
                                                              style="text-align: right">
                                                        <h:outputText value="#{lancamentoContabil.issPago}"
                                                                      id="colIssPago">
                                                            <f:convertNumber pattern="#,##0.00"/>
                                                        </h:outputText>
                                                        <f:facet name="footer">
                                                            <h:outputText value="ISS Lançado"/><br/>
                                                            <h:outputText id="valorTotalIssPago"
                                                                          value="#{monitoramentoFiscalControlador.retornarValorTotalIssPagoLancamento(lancamento, registroLancamento)}"
                                                                          styleClass="negrito">
                                                                <f:convertNumber pattern="#,##0.00"/>
                                                            </h:outputText>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column headerText="ISS Apurado"
                                                              style="text-align: right">
                                                        <h:outputText
                                                            value="#{lancamentoContabil.issApurado}"
                                                            id="colIssApurado">
                                                            <f:convertNumber pattern="#,##0.00"/>
                                                        </h:outputText>
                                                        <f:facet name="footer">
                                                            <h:outputText value="ISS Apurado"/><br/>
                                                            <h:outputText id="valorTotalIssApurado"
                                                                          value="#{monitoramentoFiscalControlador.retornarValorTotalIssApuradoLancamento(lancamento, registroLancamento)}"
                                                                          styleClass="negrito">
                                                                <f:convertNumber pattern="#,##0.00"/>
                                                            </h:outputText>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column headerText="Saldo do ISS"
                                                              style="text-align: right">
                                                        <h:outputText
                                                            value="#{lancamentoContabil.issDevido}"
                                                            id="colIssDevido">
                                                            <f:convertNumber pattern="#,##0.00"/>
                                                        </h:outputText>
                                                        <f:facet name="footer">
                                                            <h:outputText value="Saldo ISS"/><br/>
                                                            <h:outputText id="valorTotalSaldo"
                                                                          value="#{monitoramentoFiscalControlador.retornarValorTotalIssDevidoLancamento(lancamento, registroLancamento)}"
                                                                          styleClass="negrito">
                                                                <f:convertNumber pattern="#,##0.00"/>
                                                            </h:outputText>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column headerText="Correção Mon."
                                                              style="text-align: right">
                                                        <h:outputText
                                                            value="#{lancamentoContabil.correcao}"
                                                            id="correcao">
                                                            <f:convertNumber pattern="#,##0.00"/>
                                                        </h:outputText>
                                                        <f:facet name="footer">
                                                            <h:outputText value="Correção Mon."/><br/>
                                                            <h:outputText id="valorTotalCorrecao"
                                                                          value="#{monitoramentoFiscalControlador.retornarValorTotalCorrecaoMonetariaLancamento(lancamento, registroLancamento)}"
                                                                          styleClass="negrito">
                                                                <f:convertNumber pattern="#,##0.00"/>
                                                            </h:outputText>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column headerText="Valor Corrigido"
                                                              style="text-align: right">
                                                        <h:outputText
                                                            value="#{lancamentoContabil.valorCorrigido}"
                                                            id="corrigido">
                                                            <f:convertNumber pattern="#,##0.00"/>
                                                        </h:outputText>
                                                        <f:facet name="footer">
                                                            <h:outputText value="Valor Corrigido"/><br/>
                                                            <h:outputText id="valorTotalCorrigido"
                                                                          value="#{monitoramentoFiscalControlador.retornarValorTotalCorrigidoLancamento(lancamento, registroLancamento)}"
                                                                          styleClass="negrito">
                                                                <f:convertNumber pattern="#,##0.00"/>
                                                            </h:outputText>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column headerText="Juros Mora"
                                                              style="text-align: right">
                                                        <h:outputText
                                                            value="#{lancamentoContabil.juros}"
                                                            id="juros">
                                                            <f:convertNumber pattern="#,##0.00"/>
                                                        </h:outputText>
                                                        <f:facet name="footer">
                                                            <h:outputText value="Juros Mora"/><br/>
                                                            <h:outputText id="valorTotalJuros"
                                                                          value="#{monitoramentoFiscalControlador.retornarValorTotalJurosMoraLancamento(lancamento, registroLancamento)}"
                                                                          styleClass="negrito">
                                                                <f:convertNumber pattern="#,##0.00"/>
                                                            </h:outputText>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column headerText="Multa Mora"
                                                              style="text-align: right">
                                                        <h:outputText
                                                            value="#{lancamentoContabil.multa}"
                                                            id="multa">
                                                            <f:convertNumber pattern="#,##0.00"/>
                                                        </h:outputText>
                                                        <f:facet name="footer">
                                                            <h:outputText value="Multa Mora"/><br/>
                                                            <h:outputText id="valorTotalMulta"
                                                                          value="#{monitoramentoFiscalControlador.retornarValorTotalMultaMoraLancamento(lancamento, registroLancamento)}"
                                                                          styleClass="negrito">
                                                                <f:convertNumber pattern="#,##0.00"/>
                                                            </h:outputText>
                                                        </f:facet>
                                                    </p:column>
                                                    <p:column headerText="Valor Total"
                                                              style="text-align: right">
                                                        <h:outputText
                                                            value="#{monitoramentoFiscalControlador.calculaTotalLancamento(lancamentoContabil)}"
                                                            id="total">
                                                            <f:convertNumber pattern="#,##0.00"/>
                                                        </h:outputText>
                                                        <f:facet name="footer">
                                                            <h:outputText value="Valor Total"/><br/>
                                                            <h:outputText id="valorTotal"
                                                                          value="#{monitoramentoFiscalControlador.retornarValorTotalTotalLancamento(lancamento, registroLancamento)}"
                                                                          styleClass="negrito">
                                                                <f:convertNumber pattern="#,##0.00"/>
                                                            </h:outputText>
                                                        </f:facet>
                                                    </p:column>

                                                    <p:column headerText="Operações"
                                                              style="width: 85px; text-align: center">
                                                        <h:panelGrid columns="3" cellpadding="0"
                                                                     cellspacing="0">
                                                            <p:commandButton
                                                                icon="ui-icon-arrowthickstop-1-s"
                                                                title="Duplicar lançamento"
                                                                onclick="if(!confirm('Deseja duplicar este lançamento?')) return false;"
                                                                styleClass="botao-transparente icone_azul"
                                                                actionListener="#{monitoramentoFiscalControlador.duplicaLancamentoContabil(lancamentoContabil, registroLancamento)}"
                                                                disabled="#{monitoramentoFiscalControlador.selecionado.situacaoMF eq 'FINALIZADO'}"
                                                                process="@form"
                                                                update="@form"/>
                                                            <p:commandButton icon="ui-icon-trash"
                                                                             title="Remover lançamento"
                                                                             onclick="if(!confirm('Deseja remover este lançamento?')) return false;"
                                                                             styleClass="botao-transparente icone_vermelho"
                                                                             actionListener="#{monitoramentoFiscalControlador.removerLancamentoContabil(lancamentoContabil, registroLancamento)}"
                                                                             disabled="#{monitoramentoFiscalControlador.selecionado.situacaoMF eq 'FINALIZADO'}"
                                                                             process="@form"
                                                                             update="@form"/>
                                                        </h:panelGrid>
                                                    </p:column>
                                                </p:dataTable>
                                            </c:forEach>
                                        </p:panel>
                                    </c:forEach>

                                </h:panelGroup>
                            </p:tab>
                            <p:tab title="Anexos">
                                <p:outputPanel id="panelAnexo">
                                    <p:panel id="arquivo" header="Anexos">
                                        <fc:filesUploadWP selecionado="#{monitoramentoFiscalControlador.selecionado}"
                                                          isTelaEditar="#{!monitoramentoFiscalControlador.desabilitarAnexos}"/>
                                    </p:panel>
                                </p:outputPanel>
                            </p:tab>
                            <p:tab title="Notificação" id="tabNotificacao">
                                <p:outputPanel id="panelNotificacao">
                                    <p:panel>
                                        <table style="width: 100%">
                                            <c:forEach
                                                items="#{monitoramentoFiscalControlador.selecionado.malasDiretasMonitoramentoFiscal}"
                                                var="malaDireta">
                                                <h:panelGrid columns="3">
                                                    <h:outputText value="Mala Direta: "/>
                                                    <h:outputText
                                                        value="#{malaDireta.itemMalaDiretaGeral.malaDiretaGeral.toString()}"/>
                                                    <p:commandButton
                                                        icon="ui-icon-lupa"
                                                        value="Visualizar"
                                                        title="Clique para visualizar este registro em nova aba."
                                                        styleClass="azulnegrito"
                                                        actionListener="#{monitoramentoFiscalControlador.redirecionarParaMalaDireta}"/>
                                                </h:panelGrid>
                                                <h:panelGrid columns="2">
                                                    <h:outputText value="Data: "/>
                                                    <h:outputText
                                                        value="#{malaDireta.itemMalaDiretaGeral.malaDiretaGeral.geradoEm}">
                                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                    </h:outputText>
                                                    <h:outputText value="Tipo: "/>
                                                    <h:outputText
                                                        value="#{malaDireta.itemMalaDiretaGeral.malaDiretaGeral.tipoMalaDireta.descricao}"/>
                                                    <h:outputText value="Data para Resposta: "/>
                                                    <h:outputText
                                                        value="#{malaDireta.dataResposta}">
                                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                    </h:outputText>
                                                    <h:outputText value="Data para Regularizacao: "/>
                                                    <h:outputText
                                                        value="#{malaDireta.dataRegularizacao}">
                                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                    </h:outputText>
                                                </h:panelGrid>
                                            </c:forEach>
                                            <h:panelGrid columns="2">
                                                <h:outputText value="Empresa Irregular: "/>
                                                <p:selectBooleanCheckbox
                                                    id="checkEmpresaIrregular"
                                                    value="#{monitoramentoFiscalControlador.selecionado.empresaIrregular}"
                                                    disabled="#{monitoramentoFiscalControlador.selecionado.situacaoMF eq 'FINALIZADO'}">
                                                    <p:ajax event="change"
                                                            listener="#{monitoramentoFiscalControlador.mudouEmpresaIrregular}"
                                                            onstart="aguarde.show()"
                                                            oncomplete="aguarde.hide()"
                                                            process="@this" update=":Formulario:dadosMonitoramentoFiscal:dadosVerificacaoDebitos:checkEmpresaIrregular"/>
                                                </p:selectBooleanCheckbox>
                                            </h:panelGrid>
                                        </table>
                                    </p:panel>

                                </p:outputPanel>
                            </p:tab>
                        </p:tabView>
                    </p:outputPanel>
                </p:tab>
            </p:tabView>
            <p:commandButton id="salvar"
                             value="Salvar"
                             icon="ui-icon-disk"
                             styleClass="operacao prioritario mtop10"
                             onstart="statusDialog.show()"
                             oncomplete="statusDialog.hide();"
                             actionListener="#{monitoramentoFiscalControlador.salvar}"
                             update=":Formulario :formLevantamentoContabil :Formulario-EmpresaIrregular"
                             process="@form"/>
            <p:commandButton ajax="false"
                             id="cancelar"
                             icon="ui-icon-close"
                             value="Fechar"
                             styleClass="operacao mtop10 mlef05"
                             action="lista"/>
        </h:form>
        <p:dialog id="dialogLevantamentoContabil"
                  width="400" modal="true"
                  widgetVar="dlgLevantamentoContabil"
                  dynamic="true"
                  position="center"
                  closable="false"
                  showHeader="false"
                  style="position: center !important;"
                  resizable="false">
            <h:form id="formLevantamentoContabil">
                <p:panel header="Levantamento Contábil" id="panelDlgLevantamento" style="border: none;">
                    <h:panelGrid columns="2">
                        <h:outputText value="Levantamento contábil: "/>
                        <p:selectOneMenu id="levantamentos"
                                         value="#{monitoramentoFiscalControlador.tipoLevantamentoContabilMonitoramentoFiscal}"
                                         title="Selecione o tipo de levantamento contábil">
                            <f:selectItems value="#{monitoramentoFiscalControlador.tiposLevantamentoContabil}"/>
                        </p:selectOneMenu>
                        <p:commandButton value="Continuar" icon="ui-icon-triangle-1-e"
                                         title="Carregar lançamentos contábeis"
                                         id="botaoCarregarMeses"
                                         actionListener="#{monitoramentoFiscalControlador.carregarMesesLancamentoContabil()}"
                                         onstart="aguarde.show()"
                                         styleClass="operacao mtop10"
                                         oncomplete="dlgLevantamentoContabil.hide(); aguarde.hide();"
                                         update=":Formulario"/>
                        <p:commandButton value="Fechar"
                                         styleClass="operacao mtop10"
                                         icon="ui-icon-close"
                                         actionListener="#{monitoramentoFiscalControlador.limparItensLevantamentoContabil}"
                                         onclick="dlgLevantamentoContabil.hide()"/>
                    </h:panelGrid>
                </p:panel>
            </h:form>
        </p:dialog>
        <p:dialog id="idDialogEmpresaIrregular"
                  widgetVar="dialogEmpresaIrregular"
                  modal="true"
                  header="Irregularidade para o ROL de Empresas Irregulares"
                  closable="false"
                  resizable="false">
            <h:form id="Formulario-EmpresaIrregular">
                <h:panelGrid columns="2">
                    <fc:outputLabelObrigatorio value="Irregularidade:"/>
                    <p:autoComplete queryDelay="1000"
                                    value="#{monitoramentoFiscalControlador.selecionado.irregularidade}"
                                    completeMethod="#{monitoramentoFiscalControlador.completarIrregularidade}"
                                    var="irregularidade"
                                    size="70" dropdown="true"
                                    forceSelection="true"
                                    scrollHeight="150" itemLabel="#{irregularidade}"
                                    itemValue="#{irregularidade.id}"
                                    converter="#{irregularidadeControlador.converterGenerico}">
                        <p:ajax event="itemSelect" process="@form" update="@form"/>
                    </p:autoComplete>
                    <h:outputLabel value="Observação:"/>
                    <p:inputTextarea maxlength="3000"
                                     title="Digite uma observação"
                                     value="#{monitoramentoFiscalControlador.selecionado.observacaoIrregularidade}"
                                     style="width: 500px; height: 80px; overflow-y: scroll;"
                                     counterTemplate="{0} Caracteres Restantes." counter="counter2"/>
                    <p:spacer/>
                    <h:outputText id="counter2" styleClass="azul"/>
                </h:panelGrid>
                <p:commandButton
                    actionListener="#{monitoramentoFiscalControlador.confirmarDialogEmpresaIrregular}"
                    process=":Formulario-EmpresaIrregular"
                    update=":Formulario-EmpresaIrregular"
                    styleClass="prioritario padrao mrig05"
                    icon="ui-icon-check"
                    value="OK"/>
                <p:commandButton
                    process=":Formulario-EmpresaIrregular"
                    update=":Formulario:dadosMonitoramentoFiscal:dadosVerificacaoDebitos:panelNotificacao :Formulario-EmpresaIrregular"
                    actionListener="#{monitoramentoFiscalControlador.fechouDialogEmpresaIrregular}"
                    onclick="dialogEmpresaIrregular.hide()"
                    styleClass="padrao"
                    icon="ui-icon-close"
                    value="Cancelar"/>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>
