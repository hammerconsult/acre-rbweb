<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui">
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <h:form id="Formulario">
            <fc:cabecalhoPretty controlador="#{parametroFiscalizacaoControlador}"
                                origem="#{parametroFiscalizacaoControlador.caminhoPadrao}listar/"/>
            <p:tabView>
                <p:tab title="Parâmetros da Fiscalização">
                    <h:panelGrid columns="4">
                        <fc:outputLabelObrigatorio value="Exercício: "/>
                        <p:inputMask mask="9999" title="Selecione o Exercício"
                                     value="#{parametroFiscalizacaoControlador.selecionado.exercicio}"
                                     converter="#{parametroFiscalizacaoControlador.converterExercicio}"
                                     id="exercicio"
                                     disabled="#{parametroFiscalizacaoControlador.selecionado.id ne null}">

                        </p:inputMask>
                        <p:spacer/>
                        <p:spacer/>

                        <fc:outputLabelObrigatorio value="Secretaria: "/>
                        <p:autoComplete queryDelay="1000" id="secretaria"
                                        value="#{parametroFiscalizacaoControlador.selecionado.secretaria}"
                                        completeMethod="#{parametroFiscalizacaoControlador.completaEntidade}"
                                        converter="#{parametroFiscalizacaoControlador.converterEntidade}"
                                        var="secretaria"
                                        itemLabel="#{secretaria.nome}"
                                        itemValue="#{secretaria.id}"
                                        forceSelection="true"
                                        title="Selecione a Secretaria" size="70"
                                        maxResults="5">
                        </p:autoComplete>
                        <p:spacer/>
                        <p:commandButton styleClass="botao_azul icone_branco"
                                         actionListener="#{parametroFiscalizacaoControlador.iniciaPesquisa('SECRETARIA')}"
                                         update=":FormularioPesquisaGenerica"
                                         oncomplete="dialog.show()"
                                         icon="ui-icon-search"/>

                        <fc:outputLabelObrigatorio value="Tipo de Documento para Termo de Início: "/>
                        <p:autoComplete queryDelay="1000" id="tipoDoctoTermoInicio"
                                        value="#{parametroFiscalizacaoControlador.selecionado.tipoDoctoTermoInicio}"
                                        completeMethod="#{parametroFiscalizacaoControlador.completaTipoDoctoOficial}"
                                        converter="#{parametroFiscalizacaoControlador.converterTipoDoctoOficial}"
                                        var="tipoDoctoTermoInicio"
                                        itemLabel="#{tipoDoctoTermoInicio.descricao} #{tipoDoctoTermoInicio.tipoCadastroDoctoOficial.descricao}"
                                        itemValue="#{tipoDoctoTermoInicio.id}"
                                        forceSelection="true"
                                        title="Selecione um Tipo de Documento Oficial" size="70"
                                        maxResults="5">
                        </p:autoComplete>
                        <h:commandLink
                            actionListener="#{parametroFiscalizacaoControlador.novoTipoDoctoTermoInicio()}">
                            <p:button icon="ui-icon-circle-plus"/>
                        </h:commandLink>
                        <p:commandButton styleClass="botao_azul icone_branco"
                                         actionListener="#{parametroFiscalizacaoControlador.iniciaPesquisa('DOCUMENTO_TERMO_INICIO')}"
                                         update=":FormularioPesquisaGenerica"
                                         oncomplete="dialog.show()"
                                         icon="ui-icon-search"/>

                        <fc:outputLabelObrigatorio value="Tipo de Documento para Termo de Finalização: "/>
                        <p:autoComplete queryDelay="1000" id="tipoDoctoTermoFim"
                                        value="#{parametroFiscalizacaoControlador.selecionado.tipoDoctoTermoFim}"
                                        completeMethod="#{parametroFiscalizacaoControlador.completaTipoDoctoOficial}"
                                        converter="#{parametroFiscalizacaoControlador.converterTipoDoctoOficial}"
                                        var="tipoDoctoTermoFim"
                                        itemLabel="#{tipoDoctoTermoFim.descricao} #{tipoDoctoTermoFim.tipoCadastroDoctoOficial.descricao}"
                                        itemValue="#{tipoDoctoTermoFim.id}"
                                        forceSelection="true"
                                        title="Selecione um Tipo de Documento Oficial" size="70"
                                        maxResults="5">
                        </p:autoComplete>
                        <h:commandLink
                            actionListener="#{parametroFiscalizacaoControlador.novoTipoDoctoTermoFim()}">
                            <p:button icon="ui-icon-circle-plus"/>
                        </h:commandLink>
                        <p:commandButton styleClass="botao_azul icone_branco"
                                         actionListener="#{parametroFiscalizacaoControlador.iniciaPesquisa('DOCUMENTO_TERMO_FIM')}"
                                         update=":FormularioPesquisaGenerica"
                                         oncomplete="dialog.show()"
                                         icon="ui-icon-search"/>

                        <fc:outputLabelObrigatorio value="Tipo de Documento para Termo de Homologação: "/>
                        <p:autoComplete queryDelay="1000" id="tipoDoctoTermoHomologacao"
                                        value="#{parametroFiscalizacaoControlador.selecionado.tipoDoctoTermoHomologacao}"
                                        completeMethod="#{parametroFiscalizacaoControlador.completaTipoDoctoOficial}"
                                        converter="#{parametroFiscalizacaoControlador.converterTipoDoctoOficial}"
                                        var="tipoDoctoTermoHomologacao"
                                        itemLabel="#{tipoDoctoTermoHomologacao.descricao} #{tipoDoctoTermoHomologacao.tipoCadastroDoctoOficial.descricao}"
                                        itemValue="#{tipoDoctoTermoHomologacao.id}"
                                        forceSelection="true"
                                        title="Selecione um Tipo de Documento Oficial" size="70"
                                        maxResults="5">
                        </p:autoComplete>
                        <h:commandLink
                            actionListener="#{parametroFiscalizacaoControlador.novoTipoDoctoTermoHomologacao()}">
                            <p:button icon="ui-icon-circle-plus"/>
                        </h:commandLink>
                        <p:commandButton styleClass="botao_azul icone_branco"
                                         actionListener="#{parametroFiscalizacaoControlador.iniciaPesquisa('DOCUMENTO_TERMO_HOMOLOGACAO')}"
                                         update=":FormularioPesquisaGenerica"
                                         oncomplete="dialog.show()"
                                         icon="ui-icon-search"/>

                        <fc:outputLabelObrigatorio value="Tipo de Documento para o Auto de Infração: "/>
                        <p:autoComplete queryDelay="1000" id="tipoDoctoAutoInfracao"
                                        value="#{parametroFiscalizacaoControlador.selecionado.tipoDoctoAutoInfracao}"
                                        completeMethod="#{parametroFiscalizacaoControlador.completaTipoDoctoOficial}"
                                        converter="#{parametroFiscalizacaoControlador.converterTipoDoctoOficial}"
                                        var="tipoDoctoAutoInfracao"
                                        itemLabel="#{tipoDoctoAutoInfracao.descricao} #{tipoDoctoAutoInfracao.tipoCadastroDoctoOficial.descricao}"
                                        itemValue="#{tipoDoctoAutoInfracao.id}"
                                        forceSelection="true"
                                        title="Selecione um Tipo de Documento Oficial" size="70"
                                        maxResults="5">
                        </p:autoComplete>
                        <h:commandLink
                            actionListener="#{parametroFiscalizacaoControlador.novoTipoDoctoAutoInfracao()}">
                            <p:button icon="ui-icon-circle-plus"/>
                        </h:commandLink>
                        <p:commandButton styleClass="botao_azul icone_branco"
                                         actionListener="#{parametroFiscalizacaoControlador.iniciaPesquisa('DOCUMENTO_AUTO_INFRACAO')}"
                                         update=":FormularioPesquisaGenerica"
                                         oncomplete="dialog.show()"
                                         icon="ui-icon-search"/>

                        <fc:outputLabelObrigatorio value="Tipo de Documento para a Ordem de Serviço: "/>
                        <p:autoComplete queryDelay="1000" id="tipoDoctoOrdemServico"
                                        value="#{parametroFiscalizacaoControlador.selecionado.tipoDoctoOrdemServico}"
                                        completeMethod="#{parametroFiscalizacaoControlador.completaTipoDoctoOficial}"
                                        converter="#{parametroFiscalizacaoControlador.converterTipoDoctoOficial}"
                                        var="tipoDoctoOrdemServico"
                                        itemLabel="#{tipoDoctoOrdemServico.descricao} #{tipoDoctoOrdemServico.tipoCadastroDoctoOficial.descricao}"
                                        itemValue="#{tipoDoctoOrdemServico.id}"
                                        forceSelection="true"
                                        title="Selecione um Tipo de Documento Oficial" size="70"
                                        maxResults="5">
                        </p:autoComplete>
                        <h:commandLink
                            actionListener="#{parametroFiscalizacaoControlador.novoTipoDoctoOrdemServico()}">
                            <p:button icon="ui-icon-circle-plus"/>
                        </h:commandLink>
                        <p:commandButton styleClass="botao_azul icone_branco"
                                         actionListener="#{parametroFiscalizacaoControlador.iniciaPesquisa('DOCUMENTO_ORDEM_SERVICO')}"
                                         update=":FormularioPesquisaGenerica"
                                         oncomplete="dialog.show()"
                                         icon="ui-icon-search"/>

                        <fc:outputLabelObrigatorio value="Tipo de Documento para o Relatório Fiscal: "/>
                        <p:autoComplete queryDelay="1000" id="tipoDoctoRelatorioFiscal"
                                        value="#{parametroFiscalizacaoControlador.selecionado.tipoDoctoRelatorioFiscal}"
                                        completeMethod="#{parametroFiscalizacaoControlador.completaTipoDoctoOficial}"
                                        converter="#{parametroFiscalizacaoControlador.converterTipoDoctoOficial}"
                                        var="tipoDoctoRelatorioFiscal"
                                        itemLabel="#{tipoDoctoRelatorioFiscal.descricao} #{tipoDoctoRelatorioFiscal.tipoCadastroDoctoOficial.descricao}"
                                        itemValue="#{tipoDoctoRelatorioFiscal.id}"
                                        forceSelection="true"
                                        title="Selecione um Tipo de Documento Oficial" size="70"
                                        maxResults="5">
                        </p:autoComplete>
                        <h:commandLink
                            actionListener="#{parametroFiscalizacaoControlador.novoTipoDoctoRelatorioFiscal()}">
                            <p:button icon="ui-icon-circle-plus"/>
                        </h:commandLink>
                        <p:commandButton styleClass="botao_azul icone_branco"
                                         actionListener="#{parametroFiscalizacaoControlador.iniciaPesquisa('DOCUMENTO_RELATORIO_FISCAL')}"
                                         update=":FormularioPesquisaGenerica"
                                         oncomplete="dialog.show()"
                                         icon="ui-icon-search"/>

                        <h:outputText value="Diretor do Departamento: "/>
                        <p:autoComplete queryDelay="1000" id="diretor"
                                        value="#{parametroFiscalizacaoControlador.selecionado.diretor}"
                                        completeMethod="#{parametroFiscalizacaoControlador.completaDiretor}"
                                        converter="#{parametroFiscalizacaoControlador.converterPessoa}"
                                        var="diretor"
                                        itemLabel="#{diretor.nome}"
                                        itemValue="#{diretor.id}"
                                        forceSelection="true"
                                        title="Selecione um pessoa" size="70"
                                        maxResults="5">
                        </p:autoComplete>
                        <p:spacer/>
                        <p:commandButton styleClass="botao_azul icone_branco"
                                         actionListener="#{parametroFiscalizacaoControlador.iniciaPesquisa('DIRETOR')}"
                                         update=":FormularioPesquisaGenerica"
                                         oncomplete="dialog.show()"
                                         icon="ui-icon-search"/>

                        <fc:outputLabelObrigatorio value="Nome do Secretário: "/>
                        <p:inputText id="nomeSecretario"
                                     value="#{parametroFiscalizacaoControlador.selecionado.nomeSecretario}" size="70"
                                     maxlength="70"/>
                        <p:spacer/>
                        <p:spacer/>

                        <fc:outputLabelObrigatorio value="Vencimento do Auto de Infração(em dias): "/>
                        <p:inputText id="vencAutoInfracao"
                                     value="#{parametroFiscalizacaoControlador.selecionado.vencimentoAutoInfracao}"
                                     size="20" maxlength="6"/>
                        <p:spacer/>
                        <p:spacer/>

                        <fc:outputLabelObrigatorio value="Vencimento do Auto de Infração Revelia(em dias): "/>
                        <p:inputText id="vencAutoInfracaoRevelia"
                                     value="#{parametroFiscalizacaoControlador.selecionado.vencimentoAutoInfracaoRevelia}"
                                     size="20"
                                     maxlength="6"/>
                        <p:spacer/>
                        <p:spacer/>

                        <fc:outputLabelObrigatorio value="Prazo de Fiscalização(em dias): "/>
                        <p:inputText id="prazoFiscalizacao"
                                     value="#{parametroFiscalizacaoControlador.selecionado.prazoFiscalizacao}" size="20"
                                     maxlength="6"/>
                        <p:spacer/>
                        <p:spacer/>

                        <fc:outputLabelObrigatorio value="Prazo para Apresentação de Documentos(em dias): "/>
                        <p:inputText id="prazoApresentaDocto"
                                     value="#{parametroFiscalizacaoControlador.selecionado.prazoApresentacaoDocto}"
                                     size="20" maxlength="6"/>
                        <p:spacer/>
                        <p:spacer/>

                        <h:outputText value="Dia de Vencimento do ISSQN:"/>
                        <p:inputText id="vencimentoISS"
                                     value="#{parametroFiscalizacaoControlador.selecionado.diaVencimentoISS}" size="20"
                                     maxlength="6"/>
                        <p:spacer/>
                        <p:spacer/>

                        <h:outputText value="Tipo de Desconto:"/>
                        <h:selectOneMenu id="tipoDesconto"
                                         value="#{parametroFiscalizacaoControlador.selecionado.tipoDesconto}">
                            <f:selectItems value="#{parametroFiscalizacaoControlador.tipoDesconto}"/>
                        </h:selectOneMenu>
                        <p:spacer/>
                        <p:spacer/>


                        <h:outputText value="Desconto na Multa até 30 Dias: "/>
                        <p:inputText id="descontoMulta"
                                     value="#{parametroFiscalizacaoControlador.selecionado.descontoMultaTrintaDias}"
                                     size="20" maxlength="8" converter="porcentagemConverter"
                                     onkeypress="mascara(this, porcentagem)"/>
                        <p:spacer/>
                        <p:spacer/>

                        <h:outputText value="Desconto Multa: "/>
                        <p:inputText id="descontoDeMulta"
                                     value="#{parametroFiscalizacaoControlador.selecionado.descontoDeMulta}" size="20"
                                     converter="porcentagemConverter" onkeypress="mascara(this, porcentagem)"/>
                        <p:spacer/>
                        <p:spacer/>

                        <h:outputText value="Desconto Levantamento: "/>
                        <p:inputText id="descontoLevantamento" converter="porcentagemConverter"
                                     onkeypress="mascara(this, porcentagem)"
                                     value="#{parametroFiscalizacaoControlador.selecionado.descontoLevantamento}"
                                     size="20"/>
                        <p:spacer/>
                        <p:spacer/>

                        <h:outputText value="Data Competência: "/>
                        <p:calendar value="#{parametroFiscalizacaoControlador.selecionado.competencia}"
                                    id="dataCompetencia"
                                    title="Informe a data de competência."
                                    onkeypress="mascara(this, mdata)"
                                    pattern="dd/MM/yyyy"
                                    locale="pt_BR"
                                    navigator="true"/>
                        <p:spacer/>
                        <p:spacer/>
                    </h:panelGrid>
                    <br/>
                    <p:panel header="Últimos Números Utilizados" id="panelNumeros">
                        <h:panelGrid columns="2">
                            <h:outputText value="Levantamento: "/>
                            <p:inputText id="numLevantamento"
                                         value="#{parametroFiscalizacaoControlador.selecionado.ultimoNumLevantamento}"
                                         size="20" maxlength="6" disabled="true"/>

                            <h:outputText value="Auto de Infração: "/>
                            <p:inputText id="numAutoInfracao"
                                         value="#{parametroFiscalizacaoControlador.selecionado.ultimoNumAutoInfracao}"
                                         size="20" maxlength="6" disabled="true"/>

                            <h:outputText value="Programação: "/>
                            <p:inputText id="numProgramacao"
                                         value="#{parametroFiscalizacaoControlador.selecionado.ultimoNumProgramacao}"
                                         size="20" maxlength="6" disabled="true"/>

                            <h:outputText value="Termo de Início: "/>
                            <p:inputText id="numTermoInicio"
                                         value="#{parametroFiscalizacaoControlador.selecionado.ultimoNumTermoInicio}"
                                         size="20" maxlength="6" disabled="true"/>

                            <h:outputText value="Termo de Finalização: "/>
                            <p:inputText id="numTermoFim"
                                         value="#{parametroFiscalizacaoControlador.selecionado.ultimoNumTermoFim}"
                                         size="20" maxlength="6" disabled="true"/>

                            <h:outputText value="Ordem de Serviço: "/>
                            <p:inputText id="numOs"
                                         value="#{parametroFiscalizacaoControlador.selecionado.ultimoNumOrdemServico}"
                                         size="20"
                                         maxlength="6" disabled="true"/>

                            <h:outputText value="Homologação: "/>
                            <p:inputText id="numHomologacao"
                                         value="#{parametroFiscalizacaoControlador.selecionado.ultimoNumHomologacao}"
                                         size="20" maxlength="6" disabled="true"/>
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
                <p:tab title="Dados do DAM">
                    <h:panelGrid columns="2">
                        <h:outputLabel value="Desconto Até o Vencimento (%): "/>
                        <p:inputText id="descVenc"
                                     value="#{parametroFiscalizacaoControlador.selecionado.descontoAteVencimento}">
                            <p:ajax event="blur" process="@this" update="descVenc"/>
                            <f:convertNumber pattern="#,##0.00"/>
                        </p:inputText>

                        <h:outputLabel value="Mensagem do DAM: "/>
                        <p:inputTextarea value="#{parametroFiscalizacaoControlador.selecionado.mensagemDam }"
                                         maxlength="500"
                                         style="width: 500px;"/>
                    </h:panelGrid>
                </p:tab>

                <p:tab title="Dívidas do Lançamento Contábil">
                    <h:panelGroup id="dividasDoLancamentoContabil">
                        <h:panelGrid columns="2">
                            <h:outputText value="Dívida de ISSQN: "/>
                            <p:autoComplete queryDelay="1000"
                                            id="dividaIssqn"
                                            value="#{parametroFiscalizacaoControlador.dividaIssqn}"
                                            dropdown="true"
                                            completeMethod="#{parametroFiscalizacaoControlador.completarDividaISSQN}"
                                            converter="#{dividaControlador.converterGenerico}"
                                            var="divIssqn"
                                            itemLabel="#{divIssqn.codigo} - #{divIssqn.descricao}"
                                            itemValue="#{divIssqn.id}"
                                            forceSelection="true"
                                            title="Selecione uma Dívida"
                                            size="70"
                                            maxResults="10">
                            </p:autoComplete>
                        </h:panelGrid>

                        <p:commandButton value="Adicionar"
                                         icon="ui-icon-circle-plus"
                                         styleClass="mtop10 padrao"
                                         id="btAdicionarDividaIssqn"
                                         onstart="aguarde.show()"
                                         oncomplete="aguarde.hide();"
                                         update="dividasDoLancamentoContabil"
                                         title="Clique para adicionar este registro."
                                         actionListener="#{parametroFiscalizacaoControlador.adicionarDividaIssqn}"/>

                        <p:commandButton value="Cancelar"
                                         id="btLimparDividaIssqn"
                                         icon="ui-icon-cancel"
                                         styleClass="mtop10 padrao"
                                         onclick="aguarde.show()"
                                         oncomplete="aguarde.hide()"
                                         update="dividaIssqn"
                                         title="Clique para Limpar o campo de Dívida de ISSQN"
                                         actionListener="#{parametroFiscalizacaoControlador.limparDividaIssqn}"/>

                        <p:dataTable id="dividasIssqn"
                                     value="#{parametroFiscalizacaoControlador.dividasIssqnOrdenadas()}"
                                     var="parametroFiscalizacaoDivida"
                                     styleClass="mtop03"
                                     rowKey="#{parametroFiscalizacaoDivida.divida.codigo}"
                                     rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                     paginator="true"
                                     rows="10"
                                     paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>DÍVIDAS DE ISSQN&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                     emptyMessage="Não foram localizados registros para serem apresentados."
                                     rowIndexVar="rowlx">
                            <p:column style="text-align: center; width: 100px" headerText="Ações">
                                <p:commandButton icon="ui-icon-trash"
                                                 update="dividasIssqn"
                                                 process="@this"
                                                 styleClass="mlef05"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 actionListener="#{parametroFiscalizacaoControlador.removerDividaIssqn(parametroFiscalizacaoDivida)}"
                                                 title="Clique para remover este registro."
                                                 onclick="if(!confirm('Deseja remover este registro?')) return false;"
                                                 id="btRemover">
                                </p:commandButton>
                            </p:column>
                            <p:column headerText="Código" id="codigoDivida"
                                      style="width: 10px ; text-align: center">
                                <h:outputText value="#{parametroFiscalizacaoDivida.divida.codigo}"/>
                            </p:column>
                            <p:column headerText="Descrição" id="descricaoDivida"
                                      style="text-align: left;">
                                <h:outputText value="#{parametroFiscalizacaoDivida.divida.descricao}"/>
                            </p:column>
                        </p:dataTable>
                    </h:panelGroup>
                </p:tab>
            </p:tabView>
            <fc:rodapePretty controlador="#{parametroFiscalizacaoControlador}"/>
        </h:form>

        <p:dialog widgetVar="dialog" modal="true" width="1000" height="600">
            <h:form id="FormularioPesquisaGenerica">

                <fc:pesquisaGenerico id="lista"
                                     caminhoAtual="edita"
                                     nomeDaClasse="#{parametroFiscalizacaoControlador.atributoPesquisavel.classe}"
                                     dialog="true"
                                     pretty="true"
                                     iconmSelecionar="check-icon.png"
                                     novo="#{parametroFiscalizacaoControlador.novo()}"
                                     selecionar="#{parametroFiscalizacaoControlador.selecionarObjetoPesquisaGenerico}"
                                     mostrarHistorico="false"
                                     mostrarBotaoNovo="false"
                                     updateSelecionarTabela=":Formulario"
                                     utilizarTabelaPessoa="true"
                                     meuControlador="#{pessoaPesquisaGenerico}"/>

            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>
