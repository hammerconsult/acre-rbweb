<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui"
>
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <script type="text/javascript">
            function setaFoco(arg) {
                document.getElementById(arg).focus()
            }

            function mudaClasse(id) {
                var mudar = '#parcela' + id
                if ($(mudar).hasClass("warning")) {
                    $(mudar).removeClass("warning");
                } else {
                    $(mudar).addClass("warning");
                }

            }
        </script>
        <h:form id="Formulario">
            <fc:cabecalhoPretty origem="#{lancamentoIsencaoAcrescimoControlador.caminhoPadrao}/listar/"
                                controlador="#{lancamentoIsencaoAcrescimoControlador}"/>
            <p:panel header="Processo de Dedução de Acréscimos">
                <h:panelGrid columns="6" style="width: 50%">
                    <h:outputText value="Exercício"/>
                    <h:outputText value="Código"/>
                    <h:outputText value="Data"/>
                    <h:outputText value="Protocolo"/>
                    <h:outputText value="Situação"/>
                    <h:outputText value="Usuário"/>
                    <p:inputText size="4" value="#{lancamentoIsencaoAcrescimoControlador.selecionado.exercicio}"
                                 styleClass="campo-bloqueado" readonly="true"/>
                    <p:inputText id="codigo" size="10"
                                 value="#{lancamentoIsencaoAcrescimoControlador.selecionado.codigo}"
                                 title="Código do Processo de Débitos"
                                 styleClass="campo-bloqueado"
                                 readonly="true"/>

                    <p:inputText id="data" size="10"
                                 readonly="true"
                                 styleClass="campo-bloqueado"
                                 value="#{lancamentoIsencaoAcrescimoControlador.selecionado.dataLancamento}"
                                 title="Data do Processo de Débitos">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </p:inputText>

                    <p:inputText id="protocolo"
                                 value="#{lancamentoIsencaoAcrescimoControlador.selecionado.protocolo}"
                                 title="Digite o número do protocolo">
                        <p:ajax event="blur" process="@this"/>
                    </p:inputText>

                    <p:inputText id="situacao" size="10"
                                 value="Em Aberto"
                                 styleClass="amarelonegrito" readonly="true"/>

                    <p:inputText title="Usuário responsável pelo Processo de Débitos"
                                 value="#{lancamentoIsencaoAcrescimoControlador.selecionado.usuario.login}"
                                 styleClass="amarelonegrito" readonly="true"/>
                </h:panelGrid>


                <p:tabView id="tabViewProcesso" styleClass="mtop10">
                    <p:tab title="Processo" id="processo">
                        <h:panelGrid columns="1">
                            <h:outputText value="Ato Legal"/>
                            <p:autoComplete queryDelay="1000" id="atoLegal" maxResults="10"
                                            forceSelection="true"
                                            completeMethod="#{lancamentoIsencaoAcrescimoControlador.completaAtoLegal}"
                                            value="#{lancamentoIsencaoAcrescimoControlador.selecionado.atoLegal}"
                                            converter="#{lancamentoIsencaoAcrescimoControlador.converterAtoLegal}"
                                            var="atoLegal"
                                            itemLabel="#{atoLegal.nome} #{atoLegal.numero}"
                                            itemValue="#{atoLegal.id}"
                                            size="105"
                                            title="Informe o Ato Legal que define este processo">
                                <p:ajax event="itemSelect" process="@this"/>
                            </p:autoComplete>
                        </h:panelGrid>

                        <h:panelGrid columns="1">
                            <fc:outputLabelObrigatorio value="Motivo ou Fundamentação Legal"/>
                            <p:inputTextarea value="#{lancamentoIsencaoAcrescimoControlador.selecionado.motivo}"
                                             rows="6" cols="100"
                                             maxlength="3000"
                                             counter="counter"
                                             counterTemplate="{0} Caracteres Restantes.">
                                <p:ajax event="blur" process="@this"/>
                            </p:inputTextarea>
                            <h:outputText id="counter" styleClass="azulnegrito"/>
                        </h:panelGrid>
                    </p:tab>
                    <p:tab title="Configuração da Dedução">
                        <p:outputPanel id="panelConfiguracaoDeducao">
                            <h:panelGrid columns="2">
                                <fc:outputLabelObrigatorio value="Data Inicial: "/>
                                <fc:calendar id="dataInicial"
                                             value="#{lancamentoIsencaoAcrescimoControlador.selecionado.dataInicio}"
                                             disabled="#{lancamentoIsencaoAcrescimoControlador.selecionado.lancouDeducoes}"
                                             title="Informe a data de inicio da contagem da dedução"
                                             showOn="button"/>
                                <fc:outputLabelObrigatorio value="Data Final: "/>
                                <fc:calendar id="dataFinal"
                                             value="#{lancamentoIsencaoAcrescimoControlador.selecionado.dataFim}"
                                             disabled="#{lancamentoIsencaoAcrescimoControlador.selecionado.lancouDeducoes}"
                                             title="Informe a data de final da contagem da dedução"
                                             showOn="button"/>
                                <fc:outputLabelObrigatorio id="tipoDeducao" value="Tipo de Dedução: "/>
                                <h:selectOneMenu value="#{lancamentoIsencaoAcrescimoControlador.selecionado.tipoDeducao}"
                                                 disabled="#{lancamentoIsencaoAcrescimoControlador.selecionado.lancouDeducoes}">
                                    <f:selectItems value="#{lancamentoIsencaoAcrescimoControlador.tiposDeducao}"/>
                                    <p:ajax event="valueChange" process="panelConfiguracaoDeducao"
                                            update="panelConfiguracaoDeducao"
                                            listener="#{lancamentoIsencaoAcrescimoControlador.processarAlteracaoTipoDeducao()}"/>
                                </h:selectOneMenu>
                                <fc:outputLabelObrigatorio value="Percentual de Dedução (%): "
                                                           rendered="#{lancamentoIsencaoAcrescimoControlador.selecionado.tipoDeducao ne null and
                                                     lancamentoIsencaoAcrescimoControlador.selecionado.tipoDeducaoPercentual}"/>

                                <p:inputText style="text-align: right" size="15" id="percentualDeducao"
                                             value="#{lancamentoIsencaoAcrescimoControlador.selecionado.percentualDeducao}"
                                             rendered="#{lancamentoIsencaoAcrescimoControlador.selecionado.tipoDeducao ne null and
                                                     lancamentoIsencaoAcrescimoControlador.selecionado.tipoDeducaoPercentual}"
                                             disabled="#{lancamentoIsencaoAcrescimoControlador.selecionado.lancouDeducoes}"
                                             onkeypress="mascara(this, porcentagem)"
                                             maxlength="4"
                                             converter="#{lancamentoIsencaoAcrescimoControlador.superPercentualConverter}"
                                             title="Informe o percentual de dedução.">
                                    <p:ajax event="blur" process="@this"/>
                                </p:inputText>
                                <fc:outputLabelObrigatorio styleAsterisco="color: blue !important" value="Deduzir Juros: "/>
                                <p:selectBooleanCheckbox
                                    value="#{lancamentoIsencaoAcrescimoControlador.selecionado.isentaJuros}"
                                    disabled="#{lancamentoIsencaoAcrescimoControlador.selecionado.lancouDeducoes}">
                                    <p:ajax event="change" process="@this"/>
                                </p:selectBooleanCheckbox>
                                <fc:outputLabelObrigatorio styleAsterisco="color: blue !important" value="Deduzir Multa: "/>
                                <p:selectBooleanCheckbox
                                    value="#{lancamentoIsencaoAcrescimoControlador.selecionado.isentaMulta}"
                                    disabled="#{lancamentoIsencaoAcrescimoControlador.selecionado.lancouDeducoes}">
                                    <p:ajax event="change" process="@this"/>
                                </p:selectBooleanCheckbox>

                                <fc:outputLabelObrigatorio styleAsterisco="color: blue !important" value="Deduzir Correção: "/>
                                    <h:panelGrid columns="3" cellspacing="0" cellpadding="0">
                                        <p:selectBooleanCheckbox
                                            value="#{lancamentoIsencaoAcrescimoControlador.selecionado.isentaCorrecao}"
                                            disabled="#{lancamentoIsencaoAcrescimoControlador.selecionado.lancouDeducoes}">
                                            <p:ajax event="change" update="exercicioCorrecao"/>
                                        </p:selectBooleanCheckbox>

                                        <fc:outputLabelObrigatorio value="Exercício: " styleAsterisco="color: blue !important"/>
                                        <p:inputMask id="exercicioCorrecao"
                                                     mask="9999"
                                                     disabled="#{!lancamentoIsencaoAcrescimoControlador.selecionado.isentaCorrecao or lancamentoIsencaoAcrescimoControlador.selecionado.lancouDeducoes}"
                                                     size="10" maxlength="4"
                                                     converter="#{exercicioControlador.converterExercicio}"
                                                     value="#{lancamentoIsencaoAcrescimoControlador.selecionado.exercicioCorrecao}"
                                                     title="Informe o exercício."/>
                                    </h:panelGrid>
                            </h:panelGrid>
                        </p:outputPanel>
                    </p:tab>
                </p:tabView>

                <p:tabView id="tabViewDebitos" styleClass="mtop10">
                    <p:tab title="Dívidas" id="tabDividas">
                        <p:outputPanel id="panelDivida">
                            <h:panelGrid columns="3" id="cadastros">
                                <h:outputText value="Tipo de Cadastro: "
                                              rendered="#{!lancamentoIsencaoAcrescimoControlador.desabilitarAlteracaoCadastro()}"/>
                                <h:selectOneMenu value="#{lancamentoIsencaoAcrescimoControlador.tipoCadastroTributario}"
                                                 rendered="#{!lancamentoIsencaoAcrescimoControlador.desabilitarAlteracaoCadastro()}"
                                                 styleClass="mtop05">
                                    <f:selectItems value="#{lancamentoIsencaoAcrescimoControlador.tiposCadastro}"/>
                                    <p:ajax update="cadastros" event="change" process="@this"
                                            listener="#{lancamentoIsencaoAcrescimoControlador.limparCadastro()}"/>
                                </h:selectOneMenu>

                                <h:panelGrid columns="2" styleClass="verticalAlignTop">
                                    <p:autoComplete queryDelay="1000"
                                                    value="#{lancamentoIsencaoAcrescimoControlador.selecionado.cadastro}"
                                                    completeMethod="#{consultaDebitoControlador.completarCadastroEconomico}"
                                                    var="cmc"
                                                    size="70"
                                                    id="cadastroEconomico"
                                                    forceSelection="true"
                                                    scrollHeight="150" itemLabel="#{cmc.descricao}"
                                                    itemValue="#{cmc.id}"
                                                    converter="#{consultaDebitoControlador.converterCadastroEconomico}"
                                                    rendered="#{lancamentoIsencaoAcrescimoControlador.tipoCadastroTributario eq 'ECONOMICO'}"
                                                    disabled="#{lancamentoIsencaoAcrescimoControlador.desabilitarAlteracaoCadastro()}">
                                        <p:ajax event="itemSelect" process="@this" update="@form"/>
                                    </p:autoComplete>
                                    <h:panelGroup
                                        rendered="#{lancamentoIsencaoAcrescimoControlador.tipoCadastroTributario eq 'IMOBILIARIO'}">
                                        <h:panelGrid columns="1">
                                            <p:autoComplete queryDelay="1000"
                                                            value="#{lancamentoIsencaoAcrescimoControlador.selecionado.cadastro}"
                                                            completeMethod="#{consultaDebitoControlador.completarCadastroImobiliario}"
                                                            var="bci"
                                                            id="cadastroImobiliario"
                                                            size="70"
                                                            forceSelection="true"
                                                            scrollHeight="150"
                                                            itemLabel="#{bci.inscricaoCadastral}"
                                                            itemValue="#{bci.id}"
                                                            converter="#{consultaDebitoControlador.converterCadastroImobiliario}"
                                                            disabled="#{lancamentoIsencaoAcrescimoControlador.desabilitarAlteracaoCadastro()}">
                                                <p:ajax event="itemSelect" process="@this" update="@form"/>
                                            </p:autoComplete>
                                        </h:panelGrid>
                                    </h:panelGroup>
                                    <p:autoComplete queryDelay="1000"
                                                    value="#{lancamentoIsencaoAcrescimoControlador.selecionado.cadastro}"
                                                    completeMethod="#{consultaDebitoControlador.completarCadastroRural}"
                                                    var="bcr"
                                                    id="cadastroRural"
                                                    forceSelection="true"
                                                    scrollHeight="150"
                                                    size="70"
                                                    itemLabel="#{bcr}"
                                                    itemValue="#{bcr.id}"
                                                    converter="#{consultaDebitoControlador.converterCadastroRural}"
                                                    rendered="#{lancamentoIsencaoAcrescimoControlador.tipoCadastroTributario eq 'RURAL'}"
                                                    disabled="#{lancamentoIsencaoAcrescimoControlador.desabilitarAlteracaoCadastro()}">
                                        <p:ajax event="itemSelect" process="@this" update="@form"/>
                                    </p:autoComplete>

                                    <p:outputPanel id="pessoa"
                                                   rendered="#{lancamentoIsencaoAcrescimoControlador.tipoCadastroTributario eq 'PESSOA'}">
                                        <fc:novoAutocompletePessoa
                                            value="#{lancamentoIsencaoAcrescimoControlador.selecionado.pessoa}"
                                            disabled="#{lancamentoIsencaoAcrescimoControlador.desabilitarAlteracaoCadastro()}"
                                            situacoesPossiveis="#{consultaDebitoControlador.situacoesDisponiveis}"
                                            caminhoAtual="/tributario/atendimento-ao-contribuinte/consulta-de-debitos/"
                                            id="autoCompletePessoa"
                                            mostraBotoes="false"
                                            update="@form"/>
                                    </p:outputPanel>

                                    <p:commandButton icon="ui-icon-search" oncomplete="consultaGenerica.show()"
                                                     rendered="#{lancamentoIsencaoAcrescimoControlador.tipoCadastroTributario ne null}"
                                                     update=":dlgConsultaGenerica"/>
                                </h:panelGrid>
                            </h:panelGrid>

                            <p:commandButton value="Consulta de Débitos"
                                             styleClass="operacao mtop05 mbot05"
                                             icon="ui-icon-search"
                                             onclick="aguarde.show()"
                                             oncomplete="aguarde.hide()"
                                             disabled="#{lancamentoIsencaoAcrescimoControlador.selecionado.cadastro == null and lancamentoIsencaoAcrescimoControlador.selecionado.pessoa == null}"
                                             process="@form"
                                             update=":FormDialog"
                                             actionListener="#{lancamentoIsencaoAcrescimoControlador.iniciarConsultaDeDebitos()}"/>

                            <p:dataTable id="tabelaItens" emptyMessage="Nenhum registro foi adicionado" var="item"
                                         value="#{lancamentoIsencaoAcrescimoControlador.selecionado.isencoesParcela}">
                                <f:facet name="header">
                                    <h:outputText value="Débitos do Processo" styleClass="negrito"/>
                                </f:facet>
                                <p:column headerText="Cadastro">
                                    <h:outputText
                                        value="#{lancamentoIsencaoAcrescimoControlador.buscarInscricaoDoCadastro(item.parcela)}"/>
                                </p:column>
                                <p:column headerText="Dívida">
                                    <h:outputText value="#{item.dividaOriginal}"/>
                                </p:column>
                                <p:column headerText="Referência">
                                    <h:outputText
                                        value="#{item.referenciaOriginal}"/>
                                </p:column>
                                <p:column headerText="Exercício" style="text-align: center">
                                    <h:outputText value="#{item.exercicio}"/>
                                </p:column>
                                <p:column headerText="Parcela" style="text-align: right">
                                    <h:outputText value="#{item.numeroParcelaOriginal}"/>
                                </p:column>
                                <p:column headerText="Vencimento" style="text-align: center">
                                    <h:outputText value="#{item.vencimentoOriginal}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Tipo de Débito">
                                    <h:outputText
                                        value="#{item.tipoDebitoOriginal}"/>
                                </p:column>
                                <p:column headerText="Situação">
                                    <h:outputText
                                        value="#{item.situacaoParcelaOriginal.descricao}"/>
                                </p:column>
                                <p:column headerText="Imposto (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.valorImpostoOriginal}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Taxa (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.valorTaxaOriginal}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Juros (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.valorJurosOriginal}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Multa (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.valorMultaOriginal}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Correção (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.valorCorrecaoOriginal}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Honorários (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.valorHonorariosOriginal}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Total (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.valorTotalOriginal}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Remover" style="text-align: center">
                                    <p:commandButton
                                        actionListener="#{lancamentoIsencaoAcrescimoControlador.removerParcela(item)}"
                                        disabled="#{lancamentoIsencaoAcrescimoControlador.selecionado.lancouDeducoes}"
                                        onclick="aguarde.show()" oncomplete="aguarde.hide()"
                                        icon="ui-icon-trash"
                                        styleClass="icone_vermelho"
                                        update=":Formulario:tabViewDebitos:panelDivida">
                                    </p:commandButton>
                                </p:column>
                            </p:dataTable>

                            <p:commandButton value="Confirmar Dívidas Selecionadas"
                                             icon="ui-icon-arrowthick-1-s"
                                             styleClass="operacao mtop05"
                                             onclick="aguarde.show()"
                                             oncomplete="aguarde.hide();"
                                             actionListener="#{lancamentoIsencaoAcrescimoControlador.calcularDeducaoDebitosSelecionados()}"
                                             disabled="#{lancamentoIsencaoAcrescimoControlador.desabilitarConfirmarDividasSelecionadas()}"/>
                        </p:outputPanel>
                    </p:tab>
                </p:tabView>

                <p:tabView id="tabViewDebitosComIsencao" styleClass="mtop10">
                    <p:tab title="Dívidas Deduzidas" id="tabDividasComIsencao">
                        <p:outputPanel id="panelDividasComIsencao">
                            <p:commandButton value="Limpar Dívidas com Deduções"
                                             icon="ui-icon-clear"
                                             styleClass="operacao mbot05"
                                             disabled="#{lancamentoIsencaoAcrescimoControlador.desabilitarLimparDividasComDeducao()}"
                                             onclick="aguarde.show()"
                                             oncomplete="aguarde.hide();"
                                             actionListener="#{lancamentoIsencaoAcrescimoControlador.limparDividasComDeducao()}"/>

                            <p:dataTable id="tabelaDividasDesconto" emptyMessage="Nenhum registro foi adicionado" var="item"
                                         value="#{lancamentoIsencaoAcrescimoControlador.selecionado.isencoesParcelaComDeducoes}">
                                <f:facet name="header">
                                    <h:outputText value="Débitos do Processo com Dedução de Acréscimos" styleClass="negrito"/>
                                </f:facet>
                                <p:column headerText="Cadastro">
                                    <h:outputText
                                        value="#{lancamentoIsencaoAcrescimoControlador.buscarInscricaoDoCadastro(item.parcela)}"/>
                                </p:column>
                                <p:column headerText="Dívida">
                                    <h:outputText value="#{item.dividaOriginal}"/>
                                </p:column>
                                <p:column headerText="Referência">
                                    <h:outputText
                                        value="#{item.referenciaOriginal}"/>
                                </p:column>
                                <p:column headerText="Exercício" style="text-align: center">
                                    <h:outputText value="#{item.exercicio}"/>
                                </p:column>
                                <p:column headerText="Parcela" style="text-align: right">
                                    <h:outputText value="#{item.numeroParcelaOriginal}"/>
                                </p:column>
                                <p:column headerText="Vencimento" style="text-align: center">
                                    <h:outputText value="#{item.vencimentoOriginal}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Tipo de Débito">
                                    <h:outputText
                                        value="#{item.tipoDebitoOriginal}"/>
                                </p:column>
                                <p:column headerText="Situação">
                                    <h:outputText
                                        value="#{item.situacaoParcelaOriginal.descricao}"/>
                                </p:column>
                                <p:column headerText="Imposto (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.valorImpostoOriginal}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Taxa (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.valorTaxaOriginal}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Juros (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.valorJurosDeduzido}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Multa (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.valorMultaDeduzido}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Correção (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.valorCorrecaoDeduzido}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Honorários (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.valorHonorariosAtualizado}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Total (R$)" style="text-align: right">
                                    <h:outputText
                                        value="#{item.valorTotalDeduzido}">
                                        <f:convertNumber pattern="###,##0.00"/>
                                    </h:outputText>
                                </p:column>
                            </p:dataTable>
                        </p:outputPanel>
                    </p:tab>
                </p:tabView>
            </p:panel>

            <p:commandButton value="Salvar"
                             id="cbSalvar"
                             styleClass="operacao prioritario mtop05"
                             icon="ui-icon-disk"
                             title="Clique para salvar o registro"
                             actionListener="#{lancamentoIsencaoAcrescimoControlador.salvar()}"
                             onstart="statusDialog.show()"
                             oncomplete="statusDialog.hide()"/>
            <p:commandButton value="Cancelar"
                             id="cbCancelar"
                             styleClass="operacao mtop05"
                             icon="ui-icon-cancel"
                             title="clique para cancelar e retornar a página anterior"
                             actionListener="#{lancamentoIsencaoAcrescimoControlador.cancelar()}"
                             immediate="true"/>
        </h:form>

        <p:dialog header="Consulta do Cadastro" modal="true" widgetVar="consultaGenerica" width="900" height="500"
                  id="dlgConsultaGenerica">
            <h:form id="formularioConsultaDebito">
                <fc:pesquisaGenerico id="lista"
                                     caminhoAtual="edita"
                                     nomeDaClasse="#{lancamentoIsencaoAcrescimoControlador.nomeClasse}"
                                     dialog="true"
                                     pretty="true"
                                     iconmSelecionar="check-icon.png"
                                     novo="#{consultaDebitoControlador.novo()}"
                                     selecionar="#{lancamentoIsencaoAcrescimoControlador.selecionarObjetoPesquisaGenerico}"
                                     mostrarHistorico="false"
                                     mostrarBotaoNovo="false"
                                     meuControlador="#{lancamentoIsencaoAcrescimoControlador.componentePesquisa}"
                                     guardarNaSessao="false"
                                     pesquisaNoEnter="false"
                                     utilizarTabelaPessoa="#{lancamentoIsencaoAcrescimoControlador.tipoCadastroTributario eq 'PESSOA' ? 'true': 'false'}"
                                     updateSelecionarTabela=":Formulario"/>
            </h:form>
        </p:dialog>

        <p:dialog draggable="false"
                  id="dialog" width="1100" height="550"
                  dynamic="true"
                  position="center"
                  style="position: fixed !important;"
                  widgetVar="dialogo" header="Consultar Débitos" resizable="true" closable="false">
            <h:form id="FormDialog">
                <p:panel header="Filtros" id="panelDialog">
                    <h:panelGrid columns="2" id="gridFiltros">
                        <h:outputText value="Descrição da Dívida: "/>
                        <p:autoComplete queryDelay="1000" value="#{lancamentoIsencaoAcrescimoControlador.filtroDivida}"
                                        completeMethod="#{lancamentoIsencaoAcrescimoControlador.completaDivida}"
                                        converter="#{consultaDebitoControlador.converterDivida}"
                                        var="divida"
                                        maxResults="10"
                                        itemLabel="#{divida.descricao}"
                                        itemValue="#{divida}"
                                        size="60">
                            <p:ajax event="itemSelect" update="gridFiltros"/>
                        </p:autoComplete>
                        <h:outputText value="Situação da Dívida: "/>
                        <h:panelGrid columns="9">
                            <h:outputText value="Do Exercício: "/>
                            <p:selectBooleanCheckbox value="#{lancamentoIsencaoAcrescimoControlador.dividaDoExercicio}">
                                <p:ajax update="gridFiltros"/>
                            </p:selectBooleanCheckbox>
                            <h:outputText value="Dívida Ativa: "/>
                            <p:selectBooleanCheckbox value="#{lancamentoIsencaoAcrescimoControlador.dividaAtiva}">
                                <p:ajax update="gridFiltros"/>
                            </p:selectBooleanCheckbox>
                            <h:outputText value="Dívida Ativa Ajuizada: "/>
                            <p:selectBooleanCheckbox value="#{lancamentoIsencaoAcrescimoControlador.dividaAtivaAzuijada}">
                                <p:ajax update="gridFiltros"/>
                            </p:selectBooleanCheckbox>
                        </h:panelGrid>
                        <h:outputText value="Exercício: "/>
                        <h:panelGrid columns="6">
                            <fc:exercicioInicialFinal
                                exercicioInicial="#{lancamentoIsencaoAcrescimoControlador.filtroExercicioInicio}"
                                exercicioFinal="#{lancamentoIsencaoAcrescimoControlador.filtroExercicioFinal}"/>
                        </h:panelGrid>

                        <h:outputText value="Date de Vencimento Inicial:"/>
                        <p:calendar value="#{lancamentoIsencaoAcrescimoControlador.vencimentoInicial}" pattern="dd/MM/yyyy"
                                    onkeyup="mascara(this, Data)" maxlength="10" showOn="button" size="12">
                            <p:ajax event="blur" process="@this"/>
                        </p:calendar>
                        <h:outputText value="Date de Vencimento Final:"/>
                        <p:calendar value="#{lancamentoIsencaoAcrescimoControlador.vencimentoFinal}" pattern="dd/MM/yyyy"
                                    onkeyup="mascara(this, Data)" maxlength="10" showOn="button" size="12">
                            <p:ajax event="blur" process="@this"/>
                        </p:calendar>

                    </h:panelGrid>
                    <p:separator styleClass="mtop10 mbot10"/>
                    <h:panelGrid columns="4">
                        <p:commandButton
                            onstart="statusDialog.show()"
                            onsuccess="statusDialog.hide()"
                            value="Pesquisar" icon="ui-icon-search" styleClass="operacao prioritario"
                            actionListener="#{lancamentoIsencaoAcrescimoControlador.pesquisar()}"
                            update="@form"/>
                        <p:commandButton value="Limpar Campos/Tabela" style="width: 200px;" icon="ui-icon-document"
                                         styleClass="operacao" onclick="aguarde.show()" oncomplete="aguarde.hide()"
                                         actionListener="#{lancamentoIsencaoAcrescimoControlador.inicializarFiltros()}"
                                         update="@form"/>
                        <p:commandButton styleClass="icone_verde operacao"
                                         onstart="statusDialog.show()"
                                         onsuccess="statusDialog.hide()"
                                         value="Adicionar"
                                         title="Clique para adicionar as parcelas selecionadas no processo de débitos"
                                         icon="ui-icon-circle-plus"
                                         actionListener="#{lancamentoIsencaoAcrescimoControlador.adicionarDebitosSelecionados()}"
                                         update="@form"/>
                        <p:commandButton value="Fechar" icon="ui-icon-closethick" styleClass="operacao"
                                         onclick="dialogo.hide(); aguarde.show()" oncomplete="aguarde.hide()"
                                         process="@this"
                                         update=":Formulario:tabView:tabelaItens" ajax="false"/>
                    </h:panelGrid>
                </p:panel>
                <p:dataTable id="tabelaConsultas" rows="10" var="parcela"
                             rowKey="#{parcela.idParcela}"
                             widgetVar="tabela"
                             selection="#{lancamentoIsencaoAcrescimoControlador.parcelasTable}"
                             styleClass="mtop10"
                             emptyMessage="Nenhuma parcela encontrada" paginator="true"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink}
                                 {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="10,50,100" value="#{lancamentoIsencaoAcrescimoControlador.parcelas}">
                    <f:facet name="header">
                        <p:outputPanel>
                            <h:outputText value="Busca: "/>
                            <h:inputText id="globalFilter" onkeyup="tabela.filter()" size="70"/>
                        </p:outputPanel>
                    </f:facet>
                    <p:column selectionMode="multiple" style="width: 5%; text-align: center;"/>
                    <p:column headerText="Referência">
                        <h:outputText value="#{parcela.referencia}"/>
                    </p:column>
                    <p:column headerText="Dívida">
                        <h:outputText value="#{parcela.divida}"/>
                    </p:column>
                    <p:column headerText="Exercício">
                        <h:outputText value="#{parcela.exercicio}"/>
                    </p:column>
                    <p:column headerText="Parcela">
                        <h:outputText value="#{parcela.parcela}"/>
                    </p:column>
                    <p:column headerText="Vencimento">
                        <h:outputText value="#{parcela.vencimento}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Imposto">
                        <h:outputText value="#{parcela.valorImposto}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Taxa">
                        <h:outputText value="#{parcela.valorTaxa}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Desc...">
                        <h:outputText value="#{parcela.valorDesconto}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Juros">
                        <h:outputText value="#{parcela.valorJuros}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Multa">
                        <h:outputText value="#{parcela.valorMulta}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Correção">
                        <h:outputText value="#{parcela.valorCorrecao}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Honorários">
                        <h:outputText value="#{parcela.valorHonorarios}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Total">
                        <h:outputText value="#{parcela.valorTotal}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Tipo">
                        <h:outputText value="#{parcela.tipoDeDebito}"/>
                    </p:column>
                    <p:column headerText="Última Situação">
                        <h:outputText value="#{parcela.situacaoDescricaoEnum}"/>
                    </p:column>
                </p:dataTable>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>
