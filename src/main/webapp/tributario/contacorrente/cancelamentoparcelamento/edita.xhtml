<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui">
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <h:form id="Formulario">
            <p:panel header="Processo de Cancelamento de Parcelamento" styleClass="mbot05">
                <h:panelGrid columns="5" style="width: 50%">
                    <h:outputText value="Exercício"/>
                    <h:outputText value="Código"/>
                    <h:outputText value="Data"/>
                    <h:outputText value="Protocolo"/>
                    <h:outputText value="Usuário"/>

                    <p:inputText size="4" value="#{cancelamentoParcelamentoControlador.selecionado.exercicio}"
                                 styleClass="campo-bloqueado" readonly="true"/>
                    <p:inputText id="codigo" size="10"
                                 value="#{cancelamentoParcelamentoControlador.selecionado.codigo}"
                                 title="Código do Processo de Débitos"
                                 styleClass="campo-bloqueado"
                                 readonly="true"/>

                    <p:inputText id="data" size="10"
                                 readonly="true"
                                 styleClass="campo-bloqueado"
                                 value="#{cancelamentoParcelamentoControlador.selecionado.dataCancelamento}"
                                 title="Data do Processo de Cancelamento de Parcelamento">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </p:inputText>

                    <fc:protocolo controlador="#{cancelamentoParcelamentoControlador}" mostrarLabel="false"
                                  ano="#{cancelamentoParcelamentoControlador.selecionado.anoProtocolo}"
                                  numero="#{cancelamentoParcelamentoControlador.selecionado.numeroProtocolo}"/>

                    <p:inputText title="Usuário responsável pelo Processo de Cancelamento"
                                 value="#{cancelamentoParcelamentoControlador.selecionado.usuario.login}"
                                 styleClass="amarelonegrito" readonly="true" size="25"/>


                </h:panelGrid>
                <p:tabView id="tabView" styleClass="mtop10">
                    <p:tab title="Processo" id="processo">
                        <h:panelGrid columns="1">
                            <fc:outputLabelObrigatorio value="Motivo ou Fundamentação Legal"/>
                            <p:inputTextarea value="#{cancelamentoParcelamentoControlador.selecionado.motivo}"
                                             rows="4" cols="100"
                                             maxlength="3000"
                                             counter="counter"
                                             counterTemplate="{0} Caracteres Restantes.">
                                <p:ajax event="blur" process="@this"/>
                            </p:inputTextarea>
                            <h:outputText id="counter" styleClass="azulnegrito"/>
                        </h:panelGrid>

                        <h:panelGrid columns="1">
                            <fc:outputLabelObrigatorio value="Parcelamento: "
                                                       rendered="#{cancelamentoParcelamentoControlador.idParcelamento eq null}"/>
                            <p:autoComplete converter="#{processoParcelamentoControlador.converterGenerico}"
                                            completeMethod="#{cancelamentoParcelamentoControlador.completarProcessosParcelamento}"
                                            id="parcelamentos"
                                            var="parcelamento"
                                            itemValue="#{parcelamento}"
                                            itemLabel="#{parcelamento.numeroCompostoComAno}"
                                            value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento}"
                                            disabled="#{cancelamentoParcelamentoControlador.originais.size() > 0}"
                                            rendered="#{cancelamentoParcelamentoControlador.idParcelamento eq null}"
                                            size="70">
                                <p:ajax event="itemSelect" process="@form" update="@form"
                                        onstart="aguarde.show()" oncomplete="aguarde.hide()"
                                        listener="#{cancelamentoParcelamentoControlador.carregarParcelamentoParaCancelamento()}"/>
                            </p:autoComplete>
                        </h:panelGrid>

                        <h:panelGrid columns="2" rendered="#{cancelamentoParcelamentoControlador.idParcelamento ne null or
                                                             cancelamentoParcelamentoControlador.selecionado.processoParcelamento ne null}">
                            <h:outputText value="Parcelamento: "/>
                            <h:outputText
                                value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.numeroCompostoComAno}"
                                styleClass="negrito"/>
                            <h:outputText value="Situação: "/>
                            <h:outputText
                                value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.situacaoParcelamento.descricao}"
                                styleClass="negrito"/>
                            <h:outputText value="Data: "/>
                            <h:outputText
                                value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.dataProcessoParcelamento}"
                                styleClass="negrito">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                            <h:outputText value="Usuário Responsável: "/>
                            <h:outputText
                                value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.usuarioResponsavel.pessoaFisica.nome}"
                                styleClass="negrito"/>

                        </h:panelGrid>

                        <p:outputPanel
                            rendered="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.cadastro ne null}">
                            <h:panelGrid columns="2"
                                         rendered="#{cancelamentoParcelamentoControlador.tipoCadastro eq 'IMOBILIARIO'}">
                                <h:outputText value="Cadastro Imobiliário: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.cadastro.inscricaoCadastral}"/>
                                <h:outputText value="Distrito: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.lote.setor.distrito}"/>
                                <h:outputText value="Setor: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.lote.setor.codigo}"/>
                                <h:outputText value="Quadra: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.lote.quadra.codigo}"/>
                                <h:outputText value="Lote: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.lote.codigoLote}"/>
                                <h:outputText value="Loteamento: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.lote.quadra.loteamento.nome}"/>
                                <h:outputText value="Complemento do Lote: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.lote.complemento}"/>
                                <h:outputText value="Lote do Loteamento: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.lote.descricaoLoteamento}"/>
                                <h:outputText value="Endereço: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.lote.endereco}"/>
                                <h:outputText value="Área do Terreno: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.lote.areaLote}">
                                    <f:convertNumber pattern="#,##0.00"/>
                                </h:outputText>
                                <h:outputText value="Área Total Construída: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.cadastro.areaTotalConstruida}">
                                    <f:convertNumber pattern="#,##0.00"/>
                                </h:outputText>
                                <h:outputText value="Situação: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.cadastro.ativo ? 'Ativo' : 'Inativo'}"/>
                                <h:outputText value="Propritários: "/>
                                <h:panelGroup>
                                    <ui:repeat value="#{cancelamentoParcelamentoControlador.propriedadesBCI}"
                                               var="propriedade">
                                        <h:outputText styleClass="negrito"
                                                      value="#{propriedade.pessoa.nomeAutoComplete} - #{propriedade.proporcao}%"/><br/>
                                    </ui:repeat>
                                </h:panelGroup>
                            </h:panelGrid>
                            <h:panelGrid columns="2"
                                         rendered="#{cancelamentoParcelamentoControlador.tipoCadastro eq 'ECONOMICO'}">
                                <h:outputText value="C.M.C.: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.cadastro.descricao}"/>
                                <h:outputText value="Endereço de Localização: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.localizacao}"/>
                                <h:outputText value="Sócios: "/>
                                <h:panelGroup>
                                    <ui:repeat
                                        value="#{cancelamentoParcelamentoControlador.socios}"
                                        var="socio">
                                        <h:outputText styleClass="negrito"
                                                      value="#{socio.socio.nomeAutoComplete} - #{socio.proporcao}%"/><br/>
                                    </ui:repeat>
                                </h:panelGroup>
                            </h:panelGrid>

                            <h:panelGrid columns="2"
                                         rendered="#{cancelamentoParcelamentoControlador.tipoCadastro eq 'RURAL'}">
                                <h:outputText value="Cadastro Rural: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.cadastro.codigo} - #{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.cadastro.nomePropriedade} - #{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.cadastro.numeroIncra}"/>
                                <h:outputText value="Endereço Fiscal: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.cadastro.enderecoFiscal}"/>
                                <h:outputText value="Via de Acesso: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.cadastro.viaAcesso}"/>
                                <h:outputText value="Distância da Sede (Km): "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.cadastro.distanciaSede}"/>
                                <h:outputText value="Área: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.cadastro.areaLote}">
                                    <f:convertNumber pattern="#,##0.00"/>
                                </h:outputText>
                                <h:outputText value="Tipo de Área: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.cadastro.tipoAreaRural.descricao}"/>
                                <h:outputText value="Incra: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.cadastro.numeroIncra}"/>

                                <h:outputText value="Proprietários: "/>
                                <h:panelGroup>
                                    <ui:repeat
                                        value="#{cancelamentoParcelamentoControlador.propriedadesBCR}"
                                        var="propriedade">
                                        <h:outputText styleClass="negrito"
                                                      value="#{propriedade.pessoa.nomeAutoComplete} - #{propriedade.proporcao}%"/><br/>
                                    </ui:repeat>
                                </h:panelGroup>
                            </h:panelGrid>
                        </p:outputPanel>
                        <p:outputPanel
                            rendered="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.pessoa ne null}">
                            <h:panelGrid columns="2">
                                <h:outputText value="Contribuinte: "/>
                                <h:outputText styleClass="negrito"
                                              value="#{cancelamentoParcelamentoControlador.selecionado.processoParcelamento.pessoa.nome}"/>
                            </h:panelGrid>
                        </p:outputPanel>
                    </p:tab>
                    <p:tab title="Arquivos" id="anexo">
                        <p:fileUpload multiple="true" cancelLabel="Cancelar"
                                      sizeExceedMessage="Arquivo Maior que 10 MB."
                                      label="Selecione..."
                                      uploadLabel="Upload Arquivo" update="tabelaArquivosProcesso" sizeLimit="15728640"
                                      id="cfileUpload"
                                      fileUploadListener="#{cancelamentoParcelamentoControlador.uploadArquivo}"/>
                        <br/>
                        <p:dataTable id="tabelaArquivosProcesso" var="arq"
                                     value="#{cancelamentoParcelamentoControlador.selecionado.arquivos}"
                                     emptyMessage="Nenhum arquivo informado.">
                            <p:column headerText="Nome">
                                <h:outputText value="${arq.arquivo.nome}"/>
                            </p:column>
                            <p:column headerText="Tamanho" style="text-align: center; width: 100px">
                                <h:outputText value="${arq.arquivo.tamanho} Kb"/>
                            </p:column>
                            <p:column headerText="Download" style="text-align: center; width: 80px">
                                <a target="_blank" style="display: #{arq.id ne null ? 'block' : 'none'}"
                                   href='${facesContext.externalContext.requestContextPath}/arquivos/#{arq.arquivo.nome}?id=#{arq.arquivo.id}'>
                                    <h:outputText value="Download"/>
                                </a>
                            </p:column>
                            <p:column headerText="Remover" style="text-align: center; width: 30px">
                                <p:commandButton icon="ui-icon-trash" title="Remover" id="btRemoveAnexo"
                                                 update="tabelaArquivosProcesso"
                                                 actionListener="#{cancelamentoParcelamentoControlador.removerArquivo(arq)}">
                                </p:commandButton>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                </p:tabView>

                <div style="width: 100%; text-align: center">
                    <p:commandButton value="Buscar Parcelas" icon="ui-icon-search"
                                     actionListener="#{cancelamentoParcelamentoControlador.carregarParcelasParaCancelamento()}"
                                     rendered="#{cancelamentoParcelamentoControlador.idParcelamento eq null}"
                                     update="@form" process="@form" styleClass="operacao prioritario mtop10"
                                     onstart="statusDialog.show()"
                                     oncomplete="statusDialog.hide()"/>
                </div>

                <p:dataTable value="#{cancelamentoParcelamentoControlador.originais}"
                             var="original"
                             styleClass="mtop10"
                             emptyMessage="Nenhuma parcela original do parcelamento.">
                    <f:facet name="header">
                        <h:outputText value="Dívida Original Parcelada"/>
                    </f:facet>
                    <p:column headerText="Dívida" style="width: 22%; text-align: left">
                        <h:outputText value="#{original.divida}"/>
                    </p:column>
                    <p:column headerText="Referência" style="text-align: left">
                        <h:outputText value="#{original.referencia}"/>
                    </p:column>
                    <p:column headerText="Parcela" style="width:65px; text-align: center">
                        <h:outputText value="#{original.sequencia}" title="#{original.parcela.id}"/>
                    </p:column>
                    <p:column headerText="Situação" style="width:100px; text-align: center">
                        <h:outputText value="#{original.situacaoParcela.descricao}"/>
                    </p:column>
                    <p:column style="text-align: center; width: 110px" headerText="Vencimento">
                        <h:outputText value="#{original.vencimento}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Imposto" style="text-align: right">
                        <h:outputText value="#{original.valorImposto}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalImpostoDasOriginais}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Taxa / M.P.¹" style="text-align: right">
                        <h:outputText value="#{original.valorTaxa}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalTaxaDasOriginais}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Juros" style="text-align: right">
                        <h:outputText value="#{original.valorJuros}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalJurosDasOriginais}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Multa" style="text-align: right">
                        <h:outputText value="#{original.valorMulta}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalMultaDasOriginais}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Correção" style="text-align: right">
                        <h:outputText value="#{original.valorCorrecao}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalCorrecaoDasOriginais}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Honorários" style="text-align: right">
                        <h:outputText value="#{original.valorHonorarios}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalHonorariosDasOriginais}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Total" style="text-align: right">
                        <h:outputText value="#{original.valorTotalSemDesconto}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalDasOriginais}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                </p:dataTable>

                <p:dataTable value="#{cancelamentoParcelamentoControlador.originadasPagas}" var="pagas"
                             styleClass="mtop10"
                             emptyMessage="Nenhuma parcela paga no parcelamento.">
                    <f:facet name="header">
                        <h:outputText value="Parcelas Originadas Pagas"/>
                    </f:facet>
                    <p:column headerText="Dívida" style="width: 22%; text-align: left">
                        <h:outputText value="#{pagas.divida}"/>
                    </p:column>
                    <p:column headerText="Referência" style="text-align: left">
                        <h:outputText value="#{pagas.referencia}"/>
                    </p:column>
                    <p:column headerText="Parcela" style="width:65px; text-align: center">
                        <h:outputText value="#{pagas.sequencia}" title="#{pagas.parcela.id}"/>
                    </p:column>
                    <p:column headerText="Situação" style="width:100px; text-align: center">
                        <h:outputText value="#{pagas.situacaoParcela.descricao}"/>
                    </p:column>
                    <p:column headerText="Vencimento" style="text-align: center">
                        <h:outputText value="#{pagas.vencimento}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Pagamento" style="text-align: center">
                        <h:outputText value="#{pagas.pagamento}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Imposto" style="text-align: right">
                        <h:outputText value="#{pagas.valorImposto}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalImpostoDasPagas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Taxa / M.P.¹" style="text-align: right">
                        <h:outputText value="#{pagas.valorTaxa}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalTaxaDasPagas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Juros" style="text-align: right">
                        <h:outputText value="#{pagas.valorJuros}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalJurosDasPagas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Multa" style="text-align: right">
                        <h:outputText value="#{pagas.valorMulta}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalMultaDasPagas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Correção" style="text-align: right">
                        <h:outputText value="#{pagas.valorCorrecao}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalCorrecaoDasPagas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Honorários" style="text-align: right">
                        <h:outputText value="#{pagas.valorHonorarios}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalHonorariosDasPagas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Desconto" style="text-align: right">
                        <h:outputText value="#{pagas.valorDesconto}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalDescontoDasPagas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Total" style="text-align: right">
                        <h:outputText value="#{pagas.valorTotal}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalDasPagas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                </p:dataTable>

                <p:dataTable value="#{cancelamentoParcelamentoControlador.originadasPagasAtualizadas}" var="atualizada"
                             styleClass="mtop10"
                             emptyMessage="Nenhuma parcela paga no parcelamento.">
                    <f:facet name="header">
                        <h:outputText value="Parcelas Originadas Pagas Atualizadas"/>
                    </f:facet>
                    <p:column headerText="Dívida" style="width: 22%; text-align: left">
                        <h:outputText value="#{atualizada.divida}"/>
                    </p:column>
                    <p:column headerText="Referência" style="text-align: left">
                        <h:outputText value="#{atualizada.referencia}"/>
                    </p:column>
                    <p:column headerText="Parcela" style="width:65px; text-align: center">
                        <h:outputText value="#{atualizada.sequencia}" title="#{atualizada.parcela.id}"/>
                    </p:column>
                    <p:column headerText="Situação" style="width:100px; text-align: center">
                        <h:outputText value="#{atualizada.situacaoParcela.descricao}"/>
                    </p:column>
                    <p:column headerText="Vencimento" style="text-align: center">
                        <h:outputText value="#{atualizada.vencimento}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Pagamento" style="text-align: center">
                        <h:outputText value="#{atualizada.pagamento}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Atualização" style="text-align: right">
                        <h:outputText value="#{atualizada.indiceAtualizacao}">
                            <f:convertNumber pattern="#,##0.0000"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Imposto" style="text-align: right">
                        <h:outputText value="#{atualizada.valorImposto}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalImpostoDasPagasAtualizadas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Taxa / M.P.¹" style="text-align: right">
                        <h:outputText value="#{atualizada.valorTaxa}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalTaxaDasPagasAtualizadas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Juros" style="text-align: right">
                        <h:outputText value="#{atualizada.valorJuros}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalJurosDasPagasAtualizadas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Multa" style="text-align: right">
                        <h:outputText value="#{atualizada.valorMulta}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalMultaDasPagasAtualizadas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Correção" style="text-align: right">
                        <h:outputText value="#{atualizada.valorCorrecao}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalCorrecaoDasPagasAtualizadas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Honorários" style="text-align: right">
                        <h:outputText value="#{atualizada.valorHonorarios}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalHonorariosDasPagasAtualizadas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Desconto" style="text-align: right">
                        <h:outputText value="#{atualizada.valorDesconto}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalDescontoDasPagasAtualizadas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Total" style="text-align: right">
                        <h:outputText value="#{atualizada.valorTotal}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalDasPagasAtualizadas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                </p:dataTable>

                <p:dataTable value="#{cancelamentoParcelamentoControlador.originaisAtualizadas}" var="atualizada"
                             styleClass="mtop10"
                             emptyMessage="Nenhuma parcela original do parcelamento.">
                    <f:facet name="header">
                        <h:outputText value="Dívida Original Atualizada"/>
                    </f:facet>
                    <p:column headerText="Dívida" style="width: 22%; text-align: left">
                        <h:outputText value="#{atualizada.divida}"/>
                    </p:column>
                    <p:column headerText="Referência" style="text-align: left">
                        <h:outputText value="#{atualizada.referencia}"/>
                    </p:column>
                    <p:column headerText="Parcela" style="width:65px; text-align: center">
                        <h:outputText value="#{atualizada.sequencia}" title="#{atualizada.parcela.id}"/>
                    </p:column>
                    <p:column headerText="Situação" style="width:100px; text-align: center">
                        <h:outputText value="#{atualizada.situacaoParcela.descricao}"/>
                    </p:column>
                    <p:column headerText="Vencimento" style="text-align: center">
                        <h:outputText value="#{atualizada.vencimento}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Imposto" style="text-align: right">
                        <h:outputText value="#{atualizada.valorImposto}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalImpostoDasOriginaisAtualizadas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Taxa / M.P.¹" style="text-align: right">
                        <h:outputText value="#{atualizada.valorTaxa}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalTaxaDasOriginaisAtualizadas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Juros" style="text-align: right">
                        <h:outputText value="#{atualizada.valorJuros}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalJurosDasOriginaisAtualizadas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Multa" style="text-align: right">
                        <h:outputText value="#{atualizada.valorMulta}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalMultaDasOriginaisAtualizadas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Correção" style="text-align: right">
                        <h:outputText value="#{atualizada.valorCorrecao}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalCorrecaoDasOriginaisAtualizadas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Honorários" style="text-align: right">
                        <h:outputText value="#{atualizada.valorHonorarios}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalHonorariosDasOriginaisAtualizadas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Total" style="text-align: right">
                        <h:outputText value="#{atualizada.valorTotal}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText
                                value="#{cancelamentoParcelamentoControlador.valorTotalDasOriginaisAtualizadas}"
                                styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                </p:dataTable>

                <p:dataTable value="#{cancelamentoParcelamentoControlador.parcelasAbatidas}" var="abatida"
                             styleClass="mtop10"
                             emptyMessage="Nenhuma parcela original do parcelamento para ser abatida.">
                    <f:facet name="header">
                        <h:outputText value="Dívida Original Abatida"/>
                    </f:facet>
                    <p:column headerText="Dívida" style="width: 22%; text-align: left">
                        <h:outputText value="#{abatida.divida}"/>
                    </p:column>
                    <p:column headerText="Referência" style="text-align: left">
                        <h:outputText value="#{abatida.referencia}"/>
                    </p:column>
                    <p:column headerText="Parcela" style="width:65px; text-align: center">
                        <h:outputText value="#{abatida.sequencia}" title="#{abatida.parcela.id}"/>
                    </p:column>
                    <p:column headerText="Situação" style="width:100px; text-align: center">
                        <h:outputText value="#{abatida.situacaoParcela.descricao}"/>
                    </p:column>
                    <p:column headerText="Vencimento" style="text-align: center">
                        <h:outputText value="#{abatida.vencimento}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Imposto" style="text-align: right">
                        <h:outputText value="#{abatida.valorImposto}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalImpostoDasAbatidas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Taxa / M.P.¹" style="text-align: right">
                        <h:outputText value="#{abatida.valorTaxa}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalTaxaDasAbatidas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Juros" style="text-align: right">
                        <h:outputText value="#{abatida.valorJuros}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalJurosDasAbatidas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Multa" style="text-align: right">
                        <h:outputText value="#{abatida.valorMulta}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalMultaDasAbatidas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Correção" style="text-align: right">
                        <h:outputText value="#{abatida.valorCorrecao}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalCorrecaoDasAbatidas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Honorários" style="text-align: right">
                        <h:outputText value="#{abatida.valorHonorarios}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalHonorariosDasAbatidas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Total" style="text-align: right">
                        <h:outputText value="#{abatida.valorTotal}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalDasAbatidas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Pago" style="text-align: right">
                        <h:outputText value="#{abatida.valorPago}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalPagoDasAbatidas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                </p:dataTable>

                <p:dataTable value="#{cancelamentoParcelamentoControlador.parcelasEmAbertas}" var="aberta"
                             styleClass="mtop10"
                             emptyMessage="Nenhuma parcela original do parcelamento.">
                    <f:facet name="header">
                        <h:outputText value="Dívida Original Em Aberto"
                                      title="#{cancelamentoParcelamentoControlador.selecionado.referencia}"/>
                    </f:facet>
                    <p:column headerText="Dívida" style="width: 22%; text-align: left">
                        <h:outputText value="#{aberta.divida}"/>
                    </p:column>
                    <p:column headerText="Referência" style="text-align: left">
                        <h:outputText value="#{aberta.referencia}"/>
                    </p:column>
                    <p:column headerText="Parcela" style="width:65px; text-align: center">
                        <h:outputText value="#{aberta.sequencia}" title="#{aberta.parcela.id}"/>
                    </p:column>
                    <p:column headerText="Situação" style="width:100px; text-align: center">
                        <h:outputText value="#{aberta.situacaoParcela.descricao}"/>
                    </p:column>
                    <p:column headerText="Vencimento" style="text-align: center">
                        <h:outputText value="#{aberta.vencimento}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Imposto" style="text-align: right">
                        <h:outputText value="#{aberta.valorImposto}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalImpostoDasAbertas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Taxa / M.P.¹" style="text-align: right">
                        <h:outputText value="#{aberta.valorTaxa}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalTaxaDasAbertas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Juros" style="text-align: right">
                        <h:outputText value="#{aberta.valorJuros}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalJurosDasAbertas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Multa" style="text-align: right">
                        <h:outputText value="#{aberta.valorMulta}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalMultaDasAbertas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Correção" style="text-align: right">
                        <h:outputText value="#{aberta.valorCorrecao}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalCorrecaoDasAbertas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Honorários" style="text-align: right">
                        <h:outputText value="#{aberta.valorHonorarios}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalHonorariosDasAbertas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                    <p:column headerText="Total" style="text-align: right">
                        <h:outputText value="#{aberta.valorTotal}">
                            <f:convertNumber pattern="#,##0.00"/>
                        </h:outputText>
                        <f:facet name="footer">
                            <h:outputText value="#{cancelamentoParcelamentoControlador.valorTotalDasAbertas}"
                                          styleClass="negrito">
                                <f:convertNumber pattern="###,##0.00"/>
                            </h:outputText>
                        </f:facet>
                    </p:column>
                </p:dataTable>
            </p:panel>

            <p:commandButton value="Processar"
                             icon="ui-icon-check"
                             styleClass="operacao prioritario"
                             update=":Formulario"
                             disabled="#{!cancelamentoParcelamentoControlador.possivelProcessar}"
                             onstart="statusDialog.show()"
                             oncomplete="statusDialog.hide()"
                             actionListener="#{cancelamentoParcelamentoControlador.cancelarProcessoParcelamento()}"/>

            <fc:botaoTargetBlank
                actionListener="#{cancelamentoParcelamentoControlador.emitirDemonstrativoCancelamento()}"
                imprimeNoDialog="true"
                styleClass="operacao"
                label="Demonstrativo"/>

            <p:commandButton icon="ui-icon-cancel"
                             styleClass="operacao"
                             value="Voltar"
                             title="Clique aqui para voltar ao parcelamento."
                             actionListener="#{cancelamentoParcelamentoControlador.redirecionarVoltar()}"/>
        </h:form>

        <p:dialog widgetVar="dialogoConfirmaCancelamento" id="dlgConfirmaCancelamento" width="1000" modal="true">
            <h:form id="formDialogoConfirmacao">
                <div style="text-align: center;">
                    <div class="alert centralizado">
                        <strong>
                            Atenção!<br/>
                        </strong>
                        <p:outputPanel rendered="#{cancelamentoParcelamentoControlador.mensagemCancelamento ne null}">
                            #{cancelamentoParcelamentoControlador.mensagemCancelamento}
                        </p:outputPanel>
                        <p:outputPanel rendered="#{cancelamentoParcelamentoControlador.mensagemCancelamento eq null}">
                            Você tem certeza que deseja cancelar esse processo de parcelamento? Ao confirmar as parcelas assumirão as situações e valores exibidos no demonstrativo.
                        </p:outputPanel>
                    </div>
                    <br/>
                    <p:commandButton icon="ui-icon-check"
                                     styleClass="operacao prioritario"
                                     value="Sim, quero cancelar"
                                     title="Clique aqui para cancelar o Processo de Parcelamento."
                                     actionListener="#{cancelamentoParcelamentoControlador.confirmarCancelamentoProcessoParcelamento()}"
                                     process="@form"
                                     onclick="aguarde.show()"/>

                    <p:commandButton icon="ui-icon-close"
                                     styleClass="operacao"
                                     value="Não quero cancelar"
                                     title="Clique aqui para não confirmar o cancelamento o Processo de Parcelamento."
                                     update=":Formulario"
                                     onclick="dialogoConfirmaParcelamento.hide()"/>
                </div>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>
