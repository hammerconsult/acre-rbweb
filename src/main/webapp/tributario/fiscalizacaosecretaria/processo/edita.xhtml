<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui"
>
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">

        <p:dialog modal="true" widgetVar="statusDialog" header="Carregando ...."
                  draggable="false" closable="false" resizable="true" id="iddialogdeStatus">
            <p:graphicImage value="/img/ajaxloadingbar.gif"/>
        </p:dialog>
        <h:form id="Formulario">
            <p:panel header="Processo de Fiscalização">
                <div style="text-align: right;">
                    <h:outputText id="situacaoprincipal"
                                  value="Situação: #{processoFiscalizacaoControlador.ultimaSituacao(processoFiscalizacaoControlador.selecionado)}"
                                  style="font-size: 14px;font-style: italic " styleClass="negrito"/>
                </div>
                <h:panelGrid columns="2" id="gridPrincipal">
                    <h:outputLabel value="Código:"/>
                    <h:outputLabel value="#{processoFiscalizacaoControlador.selecionado.codigo}" styleClass="negrito"/>
                    <fc:outputLabelObrigatorio value="Secretaria: "/>
                    <h:panelGrid columns="2" cellpadding="0" cellspacing="0">
                        <h:panelGroup>
                            <p:autoComplete queryDelay="1000"
                                            value="#{processoFiscalizacaoControlador.selecionado.secretariaFiscalizacao}"
                                            completeMethod="#{processoFiscalizacaoControlador.completaSecretaria}"
                                            converter="#{processoFiscalizacaoControlador.converterSecretaria}"
                                            var="secretaria"
                                            size="120"
                                            id="secretaria"
                                            disabled="#{processoFiscalizacaoControlador.desabilitaSelecaoSecretaria()}"
                                            itemValue="#{secretaria.id}"
                                            itemLabel="#{secretaria.codigo} - #{secretaria.unidadeOrganizacional.descricao}"
                                            maxResults="10">
                                <p:ajax event="itemSelect" process="@this" update=":Formulario:tabs:tab-infracoes"
                                        listener="#{processoFiscalizacaoControlador.recuperaCodigo()}"/>
                            </p:autoComplete>&nbsp;
                        </h:panelGroup>
                    </h:panelGrid>
                    <fc:outputLabelObrigatorio value="Data da Fiscalização: "/>
                    <fc:calendar id="ipDataFiscalizacao"
                                 value="#{processoFiscalizacaoControlador.selecionado.dataCadastro}"
                                 disabled="#{processoFiscalizacaoControlador.desabilitaSelecaoDataDaFiscalizacao()}"/>
                    <fc:outputLabelObrigatorio value="Tipo do Levantamento: "/>
                    <h:selectOneMenu title="Selecione o tipo do levantamento."
                                     value="#{processoFiscalizacaoControlador.selecionado.tipoLevantamentoFiscalizacao}"
                                     id="levantamento"
                                     disabled="#{processoFiscalizacaoControlador.selecionado.id != null}">
                        <f:selectItems value="#{processoFiscalizacaoControlador.tiposLevantamentoFiscalizacao}"/>
                        <p:ajax event="valueChange" update="gridPrincipal" process="gridPrincipal"/>
                    </h:selectOneMenu>

                    <fc:outputLabelObrigatorio value="Denúncia: "
                                               rendered="#{processoFiscalizacaoControlador.denuncia}"/>
                    <h:panelGroup rendered="#{processoFiscalizacaoControlador.denuncia}">

                        <p:autoComplete queryDelay="1000"
                                        value="#{processoFiscalizacaoControlador.selecionado.denuncia}"
                                        id="denuncia"
                                        completeMethod="#{processoFiscalizacaoControlador.completaDenuncia}"
                                        converter="#{processoFiscalizacaoControlador.converterDenuncia}"
                                        var="denuncia"
                                        size="70"
                                        itemValue="#{denuncia.id}"
                                        itemLabel="#{denuncia}"
                                        forceSelection="true"
                        >
                            <p:ajax update="detalhesDenuncia" process="@this" event="itemSelect"/>
                        </p:autoComplete>
                        <button
                            class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only vinteLarguraVinteAltura"
                            title="Informações da Secretaria" type="submit" role="button" aria-disabled="true"
                            data-toggle="collapse" href="#collapseOne">
                            <span class="ui-button-icon-left ui-icon ui-icon-info"/>
                        </button>

                        <div id="collapseOne" class="accordion-body collapse">
                            <div class="accordion-inner">
                                <p:panel id="detalhesDenuncia">
                                    <h:panelGrid columns="2">
                                        <h:outputText value="Origem:"/>
                                        <h:outputText
                                            value="#{processoFiscalizacaoControlador.selecionado.denuncia.tipoOrigemDenuncia}"
                                            styleClass="negrito"/>
                                        <h:outputText value="Referência da Origem:"/>
                                        <h:outputText
                                            value="#{processoFiscalizacaoControlador.selecionado.denuncia.referenciaOrigem}"
                                            styleClass="negrito"/>
                                        <h:outputText value="Secretaria:"/>
                                        <h:outputText
                                            value="#{processoFiscalizacaoControlador.selecionado.denuncia.secretariaFiscalizacao}"
                                            styleClass="negrito"/>
                                        <h:outputText value="Data:"/>
                                        <h:outputText
                                            value="#{processoFiscalizacaoControlador.selecionado.denuncia.dataDenuncia}"
                                            styleClass="negrito">
                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                        </h:outputText>
                                        <h:outputText value="Usuário:"/>
                                        <h:outputText
                                            value="#{processoFiscalizacaoControlador.selecionado.denuncia.usuarioSistema.nome}"
                                            styleClass="negrito"/>
                                        <h:outputText value="Situação:"/>
                                        <h:outputText
                                            value="#{processoFiscalizacaoControlador.selecionado.denuncia.situacao}"
                                            styleClass="negrito"/>
                                        <h:outputText value="Tipo de Denúncia:"/>
                                        <h:outputText
                                            value="#{processoFiscalizacaoControlador.selecionado.denuncia.tipoDenuncia}"
                                            styleClass="negrito"/>
                                        <h:outputText value="Detalhes da Denúncia:"/>
                                        <h:outputText
                                            value="#{processoFiscalizacaoControlador.selecionado.denuncia.detalhamento}"
                                            styleClass="negrito"/>
                                    </h:panelGrid>
                                    <p:panel header="Dados do Denunciante" id="painelDenunciante">
                                        <h:panelGrid columns="2">
                                            <h:outputText value="Nome/Razão Social:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciante.nome}"
                                                styleClass="negrito"/>

                                            <h:outputText value="CPF/CNPJ:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciante.cpfCnpj}"
                                                styleClass="negrito"/>

                                            <h:outputText value="Endereço:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciante.endereco}"
                                                styleClass="negrito"/>

                                            <h:outputText value="Número:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciante.numero}"
                                                styleClass="negrito"/>

                                            <h:outputText value="Complemento:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciante.complemento}"
                                                styleClass="negrito"/>

                                            <h:outputText value="Bairro:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciante.bairro}"
                                                styleClass="negrito"/>

                                            <h:outputText value="Telefone Fixo:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciante.telefoneFixo}"
                                                styleClass="negrito"/>

                                            <h:outputText value="Telefone Celular:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciante.telefoneCelular}"
                                                styleClass="negrito"/>
                                        </h:panelGrid>
                                    </p:panel>
                                    <br/>
                                    <p:panel header="Dados do Denunciado" id="painelDenunciado">
                                        <h:panelGrid columns="2">
                                            <h:outputText value="Nome/Razão Social:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciado.nome}"
                                                styleClass="negrito"/>

                                            <h:outputText value="CPF/CNPJ:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciado.cpfCnpj}"
                                                styleClass="negrito"/>

                                            <h:outputText value="Endereço:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciado.endereco}"
                                                styleClass="negrito"/>

                                            <h:outputText value="Número:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciado.numero}"
                                                styleClass="negrito"/>

                                            <h:outputText value="Complemento:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciado.complemento}"
                                                styleClass="negrito"/>

                                            <h:outputText value="Bairro:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciado.bairro}"
                                                styleClass="negrito"/>

                                            <h:outputText value="Telefone Fixo:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciado.telefoneFixo}"
                                                styleClass="negrito"/>

                                            <h:outputText value="Telefone Celular:"/>
                                            <h:outputText
                                                value="#{processoFiscalizacaoControlador.selecionado.denuncia.denunciado.telefoneCelular}"
                                                styleClass="negrito"/>
                                        </h:panelGrid>
                                    </p:panel>
                                </p:panel>
                            </div>
                        </div>

                    </h:panelGroup>

                </h:panelGrid>
                <br/>
                <p:panel header="Dados do Fiscalizado" id="dadosFiscalizado">
                    <h:panelGrid columns="3">
                        <fc:outputLabelObrigatorio value="Tipo de Cadastro: "/>
                        <h:selectOneMenu title="Selecione o tipo de cadastro."
                                         value="#{processoFiscalizacaoControlador.selecionado.tipoCadastroFiscalizacao}"
                                         id="tipocadastro">
                            <f:selectItems value="#{processoFiscalizacaoControlador.tiposCadastroFiscalizacao}"/>
                            <p:ajax event="change" update="dadosFiscalizado" process="dadosFiscalizado"
                                    listener="#{processoFiscalizacaoControlador.limpaCadastroPessoa()}"/>
                        </h:selectOneMenu>
                        <p:spacer/>

                        <fc:outputLabelObrigatorio value="Cadastro : "/>
                        <p:inputText value="Selecione um Tipo de Cadastro" size="50" disabled="true"
                                     rendered="#{processoFiscalizacaoControlador.selecionado.tipoCadastroFiscalizacao eq null}"
                        />
                        <p:autoComplete queryDelay="1000"
                                        value="#{processoFiscalizacaoControlador.selecionado.cadastro}"
                                        converter="#{processoFiscalizacaoControlador.converterCadastroImobiliario}"
                                        completeMethod="#{processoFiscalizacaoControlador.completaCadastroImobiliario}"
                                        var="ci"
                                        size="100"
                                        id="cadastroImobiliario"
                                        itemLabel="#{ci}"
                                        disabled="#{processoFiscalizacaoControlador.selecionado.id != null}"
                                        itemValue="#{ci.id}"
                                        rendered="#{processoFiscalizacaoControlador.selecionado.tipoCadastroFiscalizacao eq 'IMOBILIARIO'}"
                                        maxResults="10">
                            <p:ajax event="itemSelect"
                                    onstart="aguarde.show()"
                                    oncomplete="aguarde.hide()"
                                    listener="#{processoFiscalizacaoControlador.carregaExisteReincidencia()}"/>
                        </p:autoComplete>
                        <fc:novoAutocompleteCadastroEconomico caminhoAtual="#{processoFiscalizacaoControlador.urlAtual}"
                                                              size="100"
                                                              mostraBotaoNovo="false"
                                                              mostraBotaoEdita="false"
                                                              value="#{processoFiscalizacaoControlador.selecionado.cadastro}"
                                                              id="cad"
                                                              disabled="#{processoFiscalizacaoControlador.selecionado.id != null}"
                                                              situacoesPossiveis="#{processoFiscalizacaoControlador.situacoesDisponiveis}"
                                                              rendered="#{processoFiscalizacaoControlador.selecionado.tipoCadastroFiscalizacao eq 'ECONOMICO'}"
                                                              mostraSituacoes="false"
                                                              mostraBotaoInfo="false"
                                                              listenerItemSelect="#{processoFiscalizacaoControlador.carregaExisteReincidencia()}"
                                                              permiteAlterarSituacoes="false"
                        />

                        <p:autoComplete queryDelay="1000"
                                        value="#{processoFiscalizacaoControlador.selecionado.cadastro}"
                                        converter="#{processoFiscalizacaoControlador.converterCadastroRural}"
                                        completeMethod="#{processoFiscalizacaoControlador.completaCadastroRural}"
                                        var="cadastroRural"
                                        size="100"
                                        disabled="#{processoFiscalizacaoControlador.selecionado.id != null}"
                                        id="cadastroRural"
                                        itemLabel="#{cadastroRural.codigo} - #{cadastroRural.nomePropriedade} - #{cadastroRural.numeroIncra}"
                                        itemValue="#{cadastroRural.id}"
                                        rendered="#{processoFiscalizacaoControlador.selecionado.tipoCadastroFiscalizacao eq 'RURAL'}"
                                        maxResults="10">
                            <p:ajax event="itemSelect"
                                    onstart="aguarde.show()"
                                    oncomplete="aguarde.hide()"
                                    listener="#{processoFiscalizacaoControlador.carregaExisteReincidencia()}"/>
                        </p:autoComplete>

                        <fc:novoAutocompletePessoa value="#{processoFiscalizacaoControlador.selecionado.pessoa}"
                                                   id="pessoa"
                                                   size="100"
                                                   situacoesPossiveis="#{novoComponentePesquisaPessoaControlador.situacaoPorDescricao('ATIVO')}"
                                                   mostraSituacoes="false"
                                                   mostraBotaoInfo="false"
                                                   listenerNavegacao="#{processoFiscalizacaoControlador.poeNaSessao()}"
                                                   listenerItemSelect="#{processoFiscalizacaoControlador.carregaExisteReincidencia()}"
                                                   rendered="#{processoFiscalizacaoControlador.selecionado.tipoCadastroFiscalizacao eq 'PESSOA'}"
                                                   caminhoAtual="#{processoFiscalizacaoControlador.urlAtual}"/>

                        <p:commandButton icon="ui-icon-search" oncomplete="consultaGenerica.show()"
                                         disabled="#{processoFiscalizacaoControlador.selecionado.tipoCadastroFiscalizacao eq null}"
                                         update=":dlgConsultaGenerica"/>
                    </h:panelGrid>
                    <p:outputPanel rendered="#{processoFiscalizacaoControlador.selecionado.cadastro ne null}">
                        <h:panelGrid
                            columns="2"
                            rendered="#{processoFiscalizacaoControlador.selecionado.tipoCadastroFiscalizacao eq 'IMOBILIARIO'}">
                            <h:outputText value="Distrito: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.lote.setor.distrito}"/>
                            <h:outputText value="Setor: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.lote.setor.codigo}"/>
                            <h:outputText value="Quadra: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.lote.quadra.codigo}"/>
                            <h:outputText value="Lote: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.lote.codigoLote}"/>
                            <h:outputText value="Loteamento: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.lote.quadra.loteamento.nome}"/>
                            <h:outputText value="Complemento do Lote: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.lote.complemento}"/>
                            <h:outputText value="Lote do Loteamento: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.lote.descricaoLoteamento}"/>
                            <h:outputText value="Endereço: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.lote.endereco}"/>
                            <h:outputText value="Área do Terreno: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.lote.areaLote}">
                                <f:convertNumber pattern="#,##0.00"/>
                            </h:outputText>
                            <h:outputText value="Área Total Construída: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.selecionado.cadastro.areaTotalConstruida}">
                                <f:convertNumber pattern="#,##0.00"/>
                            </h:outputText>
                            <h:outputText value="Situação: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.selecionado.cadastro.ativo ? 'Ativo' : 'Inativo'}"/>
                            <h:outputText value="Propritários: "/>
                            <h:panelGroup>
                                <ui:repeat value="#{processoFiscalizacaoControlador.propriedadesBCI}"
                                           var="propriedade">
                                    <h:outputText styleClass="negrito"
                                                  value="#{propriedade.pessoa.nomeAutoComplete} - #{propriedade.proporcao}%"/><br/>
                                </ui:repeat>
                            </h:panelGroup>
                        </h:panelGrid>
                        <h:panelGrid
                            columns="2"
                            rendered="#{processoFiscalizacaoControlador.selecionado.tipoCadastroFiscalizacao eq 'ECONOMICO'}">
                            <h:outputText value="Endereço de Localização: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.selecionado.cadastro.localizacao}"/>
                            <h:outputText value="Sócios: "/>
                            <h:panelGroup>
                                <ui:repeat
                                    value="#{processoFiscalizacaoControlador.socios}"
                                    var="socio">
                                    <h:outputText styleClass="negrito"
                                                  value="#{socio.socio.nomeAutoComplete} - #{socio.proporcao}%"/><br/>
                                </ui:repeat>
                            </h:panelGroup>
                        </h:panelGrid>

                        <h:panelGrid
                            columns="2"
                            rendered="#{processoFiscalizacaoControlador.selecionado.tipoCadastroFiscalizacao eq 'RURAL'}">
                            <h:outputText value="Endereço Fiscal: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.selecionado.cadastro.enderecoFiscal}"/>
                            <h:outputText value="Via de Acesso: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.selecionado.cadastro.viaAcesso}"/>
                            <h:outputText value="Distância da Sede (Km): "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.selecionado.cadastro.distanciaSede}"/>
                            <h:outputText value="Área: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.selecionado.cadastro.areaLote}">
                                <f:convertNumber pattern="#,##0.00"/>
                            </h:outputText>
                            <h:outputText value="Tipo de Área: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.selecionado.cadastro.tipoAreaRural.descricao}"/>
                            <h:outputText value="Incra: "/>
                            <h:outputText styleClass="negrito"
                                          value="#{processoFiscalizacaoControlador.selecionado.cadastro.numeroIncra}"/>

                            <h:outputText value="Proprietários: "/>
                            <h:panelGroup>
                                <ui:repeat
                                    value="#{processoFiscalizacaoControlador.propriedadesBCR}"
                                    var="propriedade">
                                    <h:outputText styleClass="negrito"
                                                  value="#{propriedade.pessoa.nomeAutoComplete} - #{propriedade.proporcao}%"/><br/>
                                </ui:repeat>
                            </h:panelGroup>
                        </h:panelGrid>
                    </p:outputPanel>
                    <p:outputPanel rendered="#{processoFiscalizacaoControlador.selecionado.pessoa ne null}">
                        <p:dataTable value="#{processoFiscalizacaoControlador.enderecos}"
                                     emptyMessage="Nenhum endereço encontrado"
                                     var="endereco">
                            <f:facet name="header">
                                Endereço(s) do Denunciante
                            </f:facet>
                            <p:column headerText="Tipo" styleClass="negrito">
                                #{endereco.tipoEndereco.descricao}
                            </p:column>
                            <p:column headerText="Logradouro">
                                #{endereco.logradouro}
                            </p:column>
                            <p:column headerText="Número">
                                #{endereco.numero}
                            </p:column>
                            <p:column headerText="Complemento">
                                #{endereco.complemento}
                            </p:column>
                            <p:column headerText="Bairro">
                                #{endereco.bairro}
                            </p:column>
                            <p:column headerText="Cidade">
                                #{endereco.localidade}
                            </p:column>
                            <p:column headerText="UF">
                                #{endereco.uf}
                            </p:column>
                            <p:column headerText="CEP">
                                #{endereco.cep}
                            </p:column>
                            <p:column headerText="Principal">
                                #{endereco.principal? 'Sim' : 'Não'}
                            </p:column>
                        </p:dataTable>
                        <br/>
                        <p:dataTable value="#{processoFiscalizacaoControlador.telefones}"
                                     emptyMessage="Nenhum telefone encontrado"
                                     var="telefone">
                            <f:facet name="header">
                                Telefone(s) do Denunciante
                            </f:facet>
                            <p:column headerText="Tipo" styleClass="negrito">
                                #{telefone.tipoFone.tipoFone}
                            </p:column>
                            <p:column headerText="Número">
                                #{telefone.telefone}
                            </p:column>
                            <p:column headerText="Principal">
                                #{telefone.principal? 'Sim' : 'Não'}
                            </p:column>
                        </p:dataTable>
                    </p:outputPanel>
                    <p:watermark value="Ex. 100120050381001" for="cadastroImobiliario"
                                 rendered="#{processoFiscalizacaoControlador.selecionado.tipoCadastroFiscalizacao eq 'IMOBILIARIO'}"
                    />
                    <p:watermark value="Ex. 6194382, SERINGAL BOM DESTINO" for="cadastroRural"
                                 rendered="#{processoFiscalizacaoControlador.selecionado.tipoCadastroFiscalizacao eq 'RURAL'}"
                    />
                </p:panel>

                <br/>
                <p:panel header="Local da Ocorrência">
                    <h:panelGrid columns="2">
                        <fc:outputLabelObrigatorio value="Bairro:"/>
                        <p:autoComplete queryDelay="1000"
                                        value="#{processoFiscalizacaoControlador.selecionado.localOcorrencia.logradouroBairro.bairro}"
                                        completeMethod="#{bairroControlador.completaBairro}"
                                        converter="#{bairroControlador.converterGenerico}"
                                        var="bairro"
                                        size="120"
                                        id="acBairro"
                                        itemValue="#{bairro.id}"
                                        itemLabel="#{bairro}"
                                        maxResults="10">
                            <p:ajax event="itemSelect" process="@this" update="acLogradouro"
                                    listener="#{processoFiscalizacaoControlador.limparLogradouroLocalOcorrencia()}"/>
                        </p:autoComplete>

                        <fc:outputLabelObrigatorio value="Logradouro:"/>
                        <p:autoComplete queryDelay="1000"
                                        value="#{processoFiscalizacaoControlador.selecionado.localOcorrencia.logradouroBairro.logradouro}"
                                        completeMethod="#{processoFiscalizacaoControlador.completaLogradouros}"
                                        converter="#{logradouroControlador.converterGenerico}"
                                        var="logradouro"
                                        size="120"
                                        id="acLogradouro"
                                        itemValue="#{logradouro.id}"
                                        itemLabel="#{logradouro}"
                                        maxResults="10"
                        >
                            <p:ajax event="itemSelect" process="@this"
                                    listener="#{processoFiscalizacaoControlador.vinculaLogradouroBairroLocalOcorrencia()}"/>
                        </p:autoComplete>

                        <h:outputText value="Número:"/>
                        <p:inputText value="#{processoFiscalizacaoControlador.selecionado.localOcorrencia.numero}"
                                     size="30"/>

                        <h:outputText value="Ponto de Referência:"/>
                        <p:inputText
                            value="#{processoFiscalizacaoControlador.selecionado.localOcorrencia.pontoReferencia}"
                            size="70"/>
                    </h:panelGrid>
                </p:panel>
                <br/>


                <p:blockUI block="tabs" widgetVar="bui"
                           blocked="#{processoFiscalizacaoControlador.selecionado.cadastro eq null
           and processoFiscalizacaoControlador.selecionado.pessoa eq null and processoFiscalizacaoControlador.selecionado.secretariaFiscalizacao eq null}"/>

                <p:tabView id="tabs" activeIndex="#{processoFiscalizacaoControlador.tabIndex}">
                    <p:tab title="Situações do Processo" id="tabssituacao">
                        <p:outputPanel id="tab-situacoes">
                            <p:dataTable
                                value="#{processoFiscalizacaoControlador.selecionado.situacoesProcessoFiscalizacao}"
                                var="situacao" emptyMessage="Nenhuma situacao encontrada!"
                                sortBy="#{situacao.data}"
                                sortOrder="ascending">
                                <p:column headerText="Data">
                                    <h:outputText value="#{situacao.data}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Situação">
                                    <h:outputText value="#{situacao.statusProcessoFiscalizacao.descricao}"/>
                                </p:column>
                            </p:dataTable>
                        </p:outputPanel>
                    </p:tab>
                    <p:tab title="Infrações e Penalidades" id="tabInfracoes">
                        <p:outputPanel id="tab-infracoes">
                            <p:fieldset legend="Nova Infração/Penalidade">
                                <h:panelGrid columns="2">
                                    <h:outputText value="Tarefa do Auditor Fiscal:"/>
                                    <h:selectOneMenu id="tarefa"
                                                     value="#{processoFiscalizacaoControlador.novoItemProcessoFiscalizacao.tarefaAuditorFiscal}"
                                                     title="Selecione uma tarefa"
                                                     converter="#{processoFiscalizacaoControlador.converterTarefa}"
                                                     style="width: 300px;">
                                        <f:selectItem itemValue="#{null}" itemLabel=" "/>
                                        <f:selectItems value="#{processoFiscalizacaoControlador.tarefas()}"
                                                       var="tarefa"
                                                       itemValue="#{tarefa}"
                                                       itemLabel="#{tarefa.codigo} - #{tarefa.descricaoReduzida}"/>
                                    </h:selectOneMenu>
                                    <h:outputText value="Infração:"/>
                                    <h:selectOneMenu id="infracao"
                                                     value="#{processoFiscalizacaoControlador.novoItemProcessoFiscalizacao.infracaoFiscalizacaoSecretaria}"
                                                     title="Selecione uma infração"
                                                     converter="#{processoFiscalizacaoControlador.converterInfracao}"
                                                     style="width: 300px;">
                                        <f:selectItem itemValue="#{null}" itemLabel=" "/>
                                        <f:selectItems value="#{processoFiscalizacaoControlador.infracoes()}"
                                                       var="infracao"
                                                       itemValue="#{infracao}"
                                                       itemLabel="#{infracao.codigo} - #{infracao.descricaoReduzida}"/>
                                    </h:selectOneMenu>
                                    <h:outputText value="Penalidade:"/>
                                    <h:selectOneMenu id="penalidade"
                                                     value="#{processoFiscalizacaoControlador.novoItemProcessoFiscalizacao.penalidadeFiscalizacaoSecretaria}"
                                                     title="Selecione uma penalidade"
                                                     converter="#{processoFiscalizacaoControlador.converterPenalidade}"
                                                     style="width: 300px;">
                                        <f:selectItem itemValue="#{null}" itemLabel=" "/>
                                        <f:selectItems value="#{processoFiscalizacaoControlador.penalidades()}"
                                                       var="penalidade"
                                                       itemValue="#{penalidade}"
                                                       itemLabel="#{penalidade.codigo} - #{penalidade.descricaoReduzida}"/>
                                        <p:ajax event="change" process="@this" update="@this otValorUFM"/>
                                    </h:selectOneMenu>
                                    <h:outputText value="Valor UFM:"
                                                  rendered="#{processoFiscalizacaoControlador.novoItemProcessoFiscalizacao.penalidadeFiscalizacaoSecretaria.tipoCobranca eq 'FIXO_UFM'}"/>
                                    <h:outputText id="otValorUFM"
                                                  rendered="#{processoFiscalizacaoControlador.novoItemProcessoFiscalizacao.penalidadeFiscalizacaoSecretaria.tipoCobranca eq 'FIXO_UFM'}"
                                                  value="#{processoFiscalizacaoControlador.novoItemProcessoFiscalizacao.penalidadeFiscalizacaoSecretaria.valor}">
                                        <f:convertNumber pattern="#,##0.0000"/>
                                    </h:outputText>
                                    <h:outputText value="Valor Real:"
                                                  rendered="#{processoFiscalizacaoControlador.novoItemProcessoFiscalizacao.penalidadeFiscalizacaoSecretaria.tipoCobranca eq 'FIXO_REAL'}"/>
                                    <h:outputText id="otValorReal"
                                                  rendered="#{processoFiscalizacaoControlador.novoItemProcessoFiscalizacao.penalidadeFiscalizacaoSecretaria.tipoCobranca eq 'FIXO_REAL'}"
                                                  value="#{processoFiscalizacaoControlador.novoItemProcessoFiscalizacao.penalidadeFiscalizacaoSecretaria.valor}">
                                        <f:convertNumber pattern="#,##0.00"/>
                                    </h:outputText>
                                    <h:outputText value="Quantidade:"/>
                                    <fc:inputValorMonetario
                                        value="#{processoFiscalizacaoControlador.novoItemProcessoFiscalizacao.quantidade}"/>
                                    <h:outputText value="Observação:"/>
                                    <p:inputTextarea
                                        value="#{processoFiscalizacaoControlador.novoItemProcessoFiscalizacao.observacao}"
                                        maxlength="255"
                                        cols="80" maxHeight="50"
                                        counter="conta" counterTemplate="{0} caracteres restantes."/>
                                    <h:outputText id="conta"/>
                                </h:panelGrid>
                                <br/>
                                <p:commandButton value="Adicionar Infração/Penalidade"
                                                 title="Clique para adicionar uma nova infração/penalidade"
                                                 actionListener="#{processoFiscalizacaoControlador.adicionarNovoItemProcessoFiscalizacao}"
                                                 styleClass="operacao"
                                                 update=":Formulario:tabs:tab-infracoes :Formulario:secretaria :Formulario:ipDataFiscalizacao"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 icon="ui-icon-circle-plus"
                                                 disabled="#{processoFiscalizacaoControlador.desabilitaInsercaoInfracaoPenalidade()}"/>
                            </p:fieldset>

                            <br/>
                            <p:dataTable
                                value="#{processoFiscalizacaoControlador.selecionado.itensProcessoFiscalizacao}"
                                emptyMessage="Nenhum infração/penalidade registrado"
                                var="item">
                                <f:facet name="header">
                                    Infrações/Penalidades
                                </f:facet>
                                <p:column headerText="Operações">
                                    <p:commandButton icon="ui-icon-close" title="Clique para remover este registro."
                                                     actionListener="#{processoFiscalizacaoControlador.removerInfracaoPenalidade(item)}"
                                                     update=":Formulario:tabs:tab-infracoes :Formulario:secretaria :Formulario:ipDataFiscalizacao"
                                                     disabled="#{processoFiscalizacaoControlador.desabilitaRemocaoInfracaoPenalidade()}"/>

                                </p:column>
                                <p:column headerText="Tarefa" style="width: 20%; text-align: left;">
                                    <h:outputText
                                        value="#{item.tarefaAuditorFiscal.codigo} - #{item.tarefaAuditorFiscal.descricaoReduzida} - #{item.tarefaAuditorFiscal.descricaoDetalhada}"/>
                                </p:column>
                                <p:column headerText="Infração" style="width: 20%; text-align: left;">
                                    <h:outputText
                                        value="#{item.infracaoFiscalizacaoSecretaria.codigo} - #{item.infracaoFiscalizacaoSecretaria.descricaoReduzida} - #{item.infracaoFiscalizacaoSecretaria.descricaoDetalhada}"/>
                                </p:column>
                                <p:column headerText="Penalidade" style="width: 20%; text-align: left; ">
                                    <h:outputText
                                        value="#{item.penalidadeFiscalizacaoSecretaria.codigo} - #{item.penalidadeFiscalizacaoSecretaria.descricaoReduzida} - #{item.penalidadeFiscalizacaoSecretaria.descricaoDetalhada}"/>
                                </p:column>
                                <p:column headerText="Observação" style="width: 10%">
                                    <h:outputText value="#{item.observacao}"/>
                                </p:column>
                                <p:column headerText="Quantidade" style="width: 10%; text-align: right; ">
                                    <h:outputText value="#{item.quantidade}"/>
                                </p:column>
                                <p:column headerText="Valor Unitário (R$)" style="width: 10%; text-align: right; ">
                                    <h:outputText
                                        value="#{item.valorReais(processoFiscalizacaoControlador.valorUFMVigente())}">
                                        <f:convertNumber pattern="#,##0.00"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Valor Total (R$)" style="width: 10%; text-align: right; ">
                                    <h:outputText
                                        value="#{item.valorTotalReais(processoFiscalizacaoControlador.valorUFMVigente())}">
                                        <f:convertNumber pattern="#,##0.00"/>
                                    </h:outputText>
                                    <f:facet name="footer" styleClass="negrito">
                                        Total (R$):
                                        <h:outputText
                                            value="#{processoFiscalizacaoControlador.selecionado.somaValorTotalReaisItemProcesso(processoFiscalizacaoControlador.valorUFMVigente())}">
                                            <f:convertNumber pattern="#,##0.00"/>
                                        </h:outputText>
                                    </f:facet>
                                </p:column>
                            </p:dataTable>
                        </p:outputPanel>
                    </p:tab>
                    <p:tab title="Termo de Advertência/Notificação" id="tabAdv">
                        <p:outputPanel id="tab-termo-advertencia">
                            <h:panelGrid columns="2" id="gridTermoAdvertencia">
                                <fc:outputLabelObrigatorio value="Número do Termo:"/>
                                <p:inputText id="numTermo"
                                             value="#{processoFiscalizacaoControlador.selecionado.termoAdvertencia.numero}"
                                             size="25"/>

                                <h:outputText value="Nome Pessoa Ciência:"/>
                                <p:inputText id="nomeCiencia"
                                             value="#{processoFiscalizacaoControlador.selecionado.termoAdvertencia.nomePessoaCiencia}"
                                             size="30"/>

                                <fc:outputLabelObrigatorio value="Auditor Fiscal:"/>
                                <p:autoComplete queryDelay="1000"
                                                value="#{processoFiscalizacaoControlador.selecionado.termoAdvertencia.usuarioSistema}"
                                                completeMethod="#{processoFiscalizacaoControlador.completaUsuarioSistema}"
                                                converter="#{processoFiscalizacaoControlador.converterUsuarioSistema}"
                                                var="usuarioSistema"
                                                id="usuarioSistema"
                                                size="25"
                                                itemLabel="#{usuarioSistema.pessoaFisica.nome}"
                                                itemValue="#{usuarioSistema.id}"
                                                maxResults="10"/>

                                <h:outputText value="Encerramento do Termo:"/>
                                <h:selectOneMenu id="encerramentoTermo"
                                                 value="#{processoFiscalizacaoControlador.selecionado.termoAdvertencia.enceramentoTermoAdvertencia}"
                                                 title="Selecione um tipo de encerramento do termo de advertência">
                                    <f:selectItems value="#{processoFiscalizacaoControlador.tiposEnceramento}"/>
                                </h:selectOneMenu>

                                <h:outputText value="Data Ciência:"/>
                                <p:inputMask id="dataCiencia"
                                             size="25"
                                             value="#{processoFiscalizacaoControlador.selecionado.termoAdvertencia.dataCiencia}"
                                             mask="99/99/9999 99:99">
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                                    <p:ajax event="blur" update="dataRetorno" process="gridTermoAdvertencia"/>
                                </p:inputMask>

                                <fc:outputLabelObrigatorio value="Data Lavratura:"/>
                                <fc:calendar id="dataLavratura"
                                             value="#{processoFiscalizacaoControlador.selecionado.termoAdvertencia.dataLavratura}"/>

                                <h:outputText value="Prazo para Cumprimento (em dias):"/>
                                <p:inputText id="prazoTermo"
                                             value="#{processoFiscalizacaoControlador.selecionado.termoAdvertencia.prazoDiasCumprimento}"
                                             size="25">
                                    <p:ajax event="keyup" update="dataRetorno" process="gridTermoAdvertencia"/>
                                </p:inputText>

                                <h:outputText value="Data Retorno:"/>
                                <h:outputText id="dataRetorno"
                                              value="#{processoFiscalizacaoControlador.selecionado.termoAdvertencia.dataRetorno}"
                                              styleClass="negrito">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </h:panelGrid>

                            <h:panelGrid columns="1">
                                <h:outputText value="Descrição da  Infração/Notificação:"/>
                                <p:inputTextarea id="descricaoDaInfracaoTermo"
                                                 value="#{processoFiscalizacaoControlador.selecionado.termoAdvertencia.descricaoDaInfracao}"
                                                 cols="100" rows="5"/>
                            </h:panelGrid>


                            <p:commandButton value="Gerar Termo de Advertência/Notificação" styleClass="operacao"
                                             actionListener="#{processoFiscalizacaoControlador.solicitaGeracaoTermoDeAdvertencia()}"
                                             update=":Formulario:tabs:tab-termo-advertencia :Formulario:tabs:tab-recursos :Formulario:ipDataFiscalizacao"
                                             icon="ui-icon-document" onstart="aguarde.show()"
                                             oncomplete="aguarde.hide()"
                                             disabled="#{processoFiscalizacaoControlador.desabilitaGeracaoTermoInfracaoNotificacao()}"/>


                            <p:commandButton value="Imprimir Termo de Advertência/Notificação" icon="ui-icon-print"
                                             styleClass="operacao"
                                             onclick="aguarde.show()"
                                             oncomplete="aguarde.hide()"
                                             actionListener="#{processoFiscalizacaoControlador.geraPDFTermoDeAdvertencia()}"
                                             disabled="#{processoFiscalizacaoControlador.desabilitaImpressaoTermoInfracaoNotificacao()}"
                            />


                        </p:outputPanel>
                    </p:tab>

                    <p:tab title="Auto de Infração" id="tabInfracao">
                        <p:outputPanel id="tab-auto-infracao">
                            <h:panelGrid columns="2">
                                <h:outputText value="Número:" style="margin-right: 110px!important"/>
                                <p:inputText
                                    value="#{processoFiscalizacaoControlador.selecionado.autoInfracaoFiscalizacao.numero}"
                                    disabled="true" style="margin-right: 47px!important"/>

                                <h:outputText value="Número do Formulário:"/>
                                <p:inputText
                                    value="#{processoFiscalizacaoControlador.selecionado.autoInfracaoFiscalizacao.numeroFormulario}"
                                    label="Número do Formulário"
                                    id="numeroFormulario">
                                    <f:convertNumber integerOnly="true" for="numeroFormulario"/>
                                </p:inputText>

                                <fc:outputLabelObrigatorio value="Auditor Fiscal:"/>
                                <p:autoComplete queryDelay="1000"
                                                value="#{processoFiscalizacaoControlador.selecionado.autoInfracaoFiscalizacao.usuarioSistema}"
                                                title="Selecione o usuário"
                                                converter="#{processoFiscalizacaoControlador.converterUsuarioSistema}"
                                                completeMethod="#{processoFiscalizacaoControlador.completaUsuarioSistema}"
                                                var="usuario"
                                                size="40"
                                                itemLabel="#{usuario.pessoaFisica.nome}"
                                                itemValue="#{usuario.id}"
                                                maxResults="10"/>

                                <h:outputText value="Data Infração:"/>
                                <fc:calendar
                                    value="#{processoFiscalizacaoControlador.selecionado.autoInfracaoFiscalizacao.dataInfracao}"/>

                                <fc:outputLabelObrigatorio value="Data Lavratura:"/>
                                <fc:calendar
                                    value="#{processoFiscalizacaoControlador.selecionado.autoInfracaoFiscalizacao.dataLavratura}"/>

                                <h:outputText value="Nome Pessoa Ciência:"/>
                                <p:inputText
                                    value="#{processoFiscalizacaoControlador.selecionado.autoInfracaoFiscalizacao.pessoaCiencia}"
                                    size="40"/>


                                <h:outputText value="Data Ciência:"/>
                                <p:inputMask id="dataCienciaAF"
                                             value="#{processoFiscalizacaoControlador.selecionado.autoInfracaoFiscalizacao.dataCiencia}"
                                             mask="99/99/9999 99:99">
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                                    <p:ajax event="blur"
                                            listener="#{processoFiscalizacaoControlador.atualizaPrazoRecurso()}"
                                            update=":Formulario:tabs:prazoRecurso :Formulario:gerarDAM"
                                            process="@this"/>
                                </p:inputMask>

                                <h:outputText value="Prazo Recurso:"/>
                                <h:outputText id="prazoRecurso"
                                              value="#{processoFiscalizacaoControlador.selecionado.autoInfracaoFiscalizacao.prazoRecurso}"
                                              styleClass="negrito">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </h:panelGrid>
                            <br/>
                            <h:panelGrid columns="1">
                                <h:outputText value="Descrição:"/>
                                <p:inputTextarea
                                    value="#{processoFiscalizacaoControlador.selecionado.autoInfracaoFiscalizacao.descricaoInfracao}"
                                    cols="100" rows="5"/>
                            </h:panelGrid>
                            <p:commandButton value="Gerar Auto de Infração"
                                             actionListener="#{processoFiscalizacaoControlador.solicitaGeracaoAutoInfracao()}"
                                             update=":Formulario:tabs:tab-auto-infracao :Formulario:tabs:tab-recursos :Formulario:tabs:tab-infracoes :Formulario:ipDataFiscalizacao"
                                             icon="ui-icon-document"
                                             styleClass="operacao" onstart="aguarde.show()" oncomplete="aguarde.hide()"
                                             disabled="#{processoFiscalizacaoControlador.desabilitaGeracaoAutoInfracao()}"/>


                            <p:commandButton value="Imprimir Auto de Infração" icon="ui-icon-print"
                                             styleClass="operacao"
                                             onclick="aguarde.show()"
                                             oncomplete="aguarde.hide()"
                                             actionListener="#{processoFiscalizacaoControlador.geraPDFAutoInfracao()}"
                                             disabled="#{processoFiscalizacaoControlador.desabilitaImpressaoAutoInfracao()}"
                            />

                        </p:outputPanel>
                    </p:tab>
                    <p:tab title="Recursos" id="tabviewrecursos">
                        <p:outputPanel id="tab-recursos">
                            <h:panelGrid columns="4">
                                <h:outputText value="Nº Protocolo:"/>
                                <p:inputText id="numeroProtocolo"
                                             value="#{processoFiscalizacaoControlador.recursoFiscalizacao.processoProtocolo}"
                                             styleClass="negrito"/>

                                <h:outputText value="Data de Entrada:"/>
                                <p:calendar id="dataEntradaRecurso"
                                            value="#{processoFiscalizacaoControlador.recursoFiscalizacao.dataEntrada}"
                                            pattern="dd/MM/yyyy"
                                />

                                <h:outputText value="Tipo de recursos: "/>
                                <h:outputText id="asdf"
                                              value="#{processoFiscalizacaoControlador.recursoFiscalizacao.tipoRecursoFiscalizacao.descricao}"
                                              styleClass="negrito"/>

                                <p:spacer/>
                                <p:spacer/>

                            </h:panelGrid>
                            <h:panelGrid columns="1">
                                <h:outputText value="Teor:"/>
                                <p:inputTextarea id="teorRecurso"
                                                 value="#{processoFiscalizacaoControlador.recursoFiscalizacao.teorRecurso}"
                                                 cols="100" rows="5" autoResize="false"/>
                            </h:panelGrid>
                            <br/>
                            <p:commandButton value="Adicionar Recurso" id="botaoAdicionarRecurso"
                                             styleClass="operacao prioritario"
                                             disabled="#{processoFiscalizacaoControlador.processoPago or
                         processoFiscalizacaoControlador.recursoFiscalizacao.tipoRecursoFiscalizacao eq null}"
                                             icon="ui-icon-plus"
                                             actionListener="#{processoFiscalizacaoControlador.adicionarRecurso()}"
                                             update=":Formulario:tabs:tab-recursos"/>
                            <p:commandButton value="Limpar Campos"
                                             actionListener="#{processoFiscalizacaoControlador.atualizaRecurso()}"
                                             update=":Formulario:tabs:tab-recursos" icon="ui-icon-document"
                                             styleClass="operacao"/>
                            <br/>
                            <br/>
                            <p:dataTable value="#{processoFiscalizacaoControlador.selecionado.recursoFiscalizacaos}"
                                         var="recurso" emptyMessage="Nenhum recurso encontrado!">

                                <p:column headerText="Data Entrada" style="text-align: center">
                                    <h:outputText value="#{recurso.dataEntrada}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </p:column>

                                <p:column headerText="Tipo" style="text-align: center">
                                    <h:outputText value="#{recurso.tipoRecursoFiscalizacao.descricao}"/>
                                </p:column>

                                <p:column headerText="Teor" style="text-align: center">
                                    <h:outputText value="[ Passe o mouse aqui ]" title="#{recurso.teorRecurso}"
                                                  style="font-size: xx-small"/>
                                </p:column>

                                <p:column headerText="Data do Parecer" style="text-align: center">
                                    <h:outputText value="#{recurso.dataParecer}" style="font-size: xx-small"
                                                  rendered="#{recurso.dataParecer != null}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                    <h:outputText value=" - " style="font-size: xx-small"
                                                  rendered="#{recurso.dataParecer == null}"/>
                                </p:column>

                                <p:column headerText="Data do Novo Prazo" style="text-align: center">
                                    <h:outputText value="#{recurso.dataNovoPrazo}" style="font-size: xx-small"
                                                  rendered="#{recurso.dataNovoPrazo != null}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                    <h:outputText value=" - " style="font-size: xx-small"
                                                  rendered="#{recurso.dataNovoPrazo == null}"/>
                                </p:column>

                                <p:column headerText="Emitir Parecer" style="text-align: center;">
                                    <p:commandButton icon="ui-icon-clipboard" title="Clique para emitir o parecer"
                                                     styleClass="wp-botao-tabela"
                                                     oncomplete="dialogParecerRecurso.show()"
                                                     actionListener="#{processoFiscalizacaoControlador.emitirParecer(recurso)}"
                                                     update=":formParecerRecurso"
                                                     disabled="#{recurso.parecerRecurso != null}"/>
                                </p:column>


                                <p:column headerText="Imprimir Parecer" style="text-align: center;">
                                    <p:commandButton icon="ui-icon-print"
                                                     styleClass="wp-botao-tabela"
                                                     onclick="aguarde.show()"
                                                     oncomplete="aguarde.hide()"
                                                     actionListener="#{processoFiscalizacaoControlador.geraPDFRecurso(recurso)}"
                                                     disabled="#{recurso.documentoOficial.id == null}"
                                    />
                                </p:column>

                                <p:column headerText="Remover" style="text-align: center;">
                                    <p:commandButton icon="ui-icon-trash" title="Clique para remover o recurso"
                                                     styleClass="wp-botao-tabela"
                                                     actionListener="#{processoFiscalizacaoControlador.removerRecurso(recurso)}"
                                                     update=":Formulario:tabs:tab-recursos"
                                                     disabled="#{processoFiscalizacaoControlador.processoPago or recurso.parecerRecurso != null }"/>
                                </p:column>
                            </p:dataTable>

                        </p:outputPanel>
                    </p:tab>
                    <p:tab title="Termos Gerais" id="termosgerais">
                        <p:outputPanel id="tab-termos-gerais">
                            <h:panelGrid columns="4">
                                <fc:outputLabelObrigatorio value="Tipo de Documento Oficial:"/>
                                <p:autoComplete queryDelay="1000"
                                                value="#{processoFiscalizacaoControlador.tipoDoctoOficialTermoGeral}"
                                                completeMethod="#{processoFiscalizacaoControlador.completaTipoDoctoOficialTermoGerais}"
                                                converter="#{processoFiscalizacaoControlador.converterTipoDoctoOficial()}"
                                                var="tipoDoctoTermoGeral"
                                                size="50"
                                                id="tipoDocumentoTermoGeral"
                                                itemLabel="#{tipoDoctoTermoGeral.descricao}"
                                                itemValue="#{tipoDoctoTermoGeral.id}"
                                                maxResults="10">
                                    <p:ajax event="itemSelect" update="tab-termos-gerais" onstart="aguarde.show()"
                                            oncomplete="aguarde.hide()"
                                            listener="#{processoFiscalizacaoControlador.selecionou}"/>
                                </p:autoComplete>

                            </h:panelGrid>
                            <br/>
                            <p:dataTable
                                value="#{processoFiscalizacaoControlador.termoGeralFiscalizacao.valoresAtributosFiscalizacao}"
                                var="atributo" emptyMessage="Nenhum atributo encontrado!">
                                <p:column headerText="Obrigatório" style="width: 150px; text-align: center">
                                    <h:outputText
                                        value="#{utilBean.converterBooleanSimOuNao(atributo.atributoDoctoOficial.obrigatorio)}"
                                        rendered="#{!atributo.atributoDoctoOficial.obrigatorio}"
                                        styleClass="vermelhonegrito"/>
                                    <h:outputText
                                        value="#{utilBean.converterBooleanSimOuNao(atributo.atributoDoctoOficial.obrigatorio)}"
                                        rendered="#{atributo.atributoDoctoOficial.obrigatorio}"
                                        styleClass="verdenegrito"/>
                                </p:column>
                                <p:column headerText="Atributo" style="text-align: center">
                                    <h:outputText value="#{atributo.atributoDoctoOficial.campo}"/>
                                </p:column>
                                <p:column headerText="Valor" style="text-align: center">
                                    <p:inputText value="#{atributo.valor}" size="50"/>
                                </p:column>

                            </p:dataTable>

                            <br/>
                            <br/>

                            <p:commandButton value="Gerar Documento" title="Clique para gerar documento"
                                             disabled="#{processoFiscalizacaoControlador.tipoDoctoOficialTermoGeral eq null}"
                                             icon="ui-icon-note" styleClass="operacao"
                                             update=":Formulario:tabs:termosGerais"
                                             actionListener="#{processoFiscalizacaoControlador.recuperaDocumentoVigente()}"/>&nbsp;
                            <br/>
                            <br/>
                            <p:dataTable value="#{processoFiscalizacaoControlador.selecionado.termoGeralFiscalizacao}"
                                         var="termoGeral" emptyMessage="Nenhum termo encontrado!" id="termosGerais">
                                <p:column headerText="Descrição" style="text-align: center">
                                    <h:outputText
                                        value="#{termoGeral.documentoOficial.modeloDoctoOficial.tipoDoctoOficial.descricao}"/>
                                </p:column>
                                <p:column headerText="Data de Emissão" style="text-align: center">
                                    <h:outputText value="#{termoGeral.documentoOficial.dataEmissao}">
                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Imprimir" style="text-align: center">
                                    <p:commandButton icon="ui-icon-print"
                                                     styleClass="wb-botao-tabela"
                                                     onclick="aguarde.show()"
                                                     oncomplete="aguarde.hide()"
                                                     actionListener="#{processoFiscalizacaoControlador.geraPDF(termoGeral.documentoOficial)}"
                                    />
                                </p:column>
                                <p:column headerText="Remover" style="text-align: center">

                                    <p:commandButton
                                        actionListener="#{processoFiscalizacaoControlador.removerTermoGeral(termoGeral)}"
                                        icon="ui-icon-trash"
                                        update=":Formulario:tabs:termosGerais"/>
                                </p:column>
                            </p:dataTable>
                        </p:outputPanel>
                    </p:tab>
                    <p:tab title="Anexar Arquivos">
                        <p:panel id="panelUpload" header="Arquivos">
                            <p:fileUpload multiple="true" cancelLabel="Cancelar"
                                          sizeExceedMessage="Arquivo Maior que 10 MB."
                                          label="Selecione..."
                                          uploadLabel="Upload Arquivo" update="tabelaItem panelUpload"
                                          sizeLimit="15728640"
                                          id="iBotaoUpload"
                                          fileUploadListener="#{processoFiscalizacaoControlador.assistenteDetentorArquivoComposicao.handleFileUpload}"/>

                            <br/>

                            <p:dataTable id="tabelaItem"
                                         value="#{processoFiscalizacaoControlador.selecionado.detentorArquivoComposicao.arquivosComposicao}"
                                         var="arquivoComposicao"
                                         emptyMessage="Nenhum arquivo cadastrado.">
                                <p:column headerText="Data do Upload">
                                    <h:outputText value="#{arquivoComposicao.dataUpload}">
                                        <f:convertDateTime pattern="dd/MM/yyy"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Descrição" style="text-align: center">
                                    <p:inputText value="#{arquivoComposicao.arquivo.descricao}" size="100"
                                                 maxlength="100"
                                                 rendered="#{arquivoComposicao.arquivo.id eq null}"/>
                                    <h:outputText value="#{arquivoComposicao.arquivo.descricao}"
                                                  rendered="#{arquivoComposicao.arquivo.id ne null}"/>
                                </p:column>
                                <p:column rendered="#{arquivoComposicao.arquivo.id eq null}" headerText="Visualizar"
                                          style="text-align: center">
                                    <p:commandButton id="downloadLink" value="Download" ajax="false"
                                                     icon="ui-icon-circle-arrow-s"
                                                     process="@form" update="@this"
                                                     onstart="statusDialog.show();"
                                                     oncomplete="statusDialog.hide();">
                                        <p:fileDownload
                                            value="#{processoFiscalizacaoControlador.assistenteDetentorArquivoComposicao.getStream(arquivoComposicao)}"/>
                                    </p:commandButton>
                                </p:column>
                                <p:column rendered="#{arquivoComposicao.arquivo.id ne null}" headerText="Download"
                                          style="width: 10%; text-align: center">
                                    <a title="Download"
                                       href="${facesContext.externalContext.requestContextPath}/arquivos/#{arquivoComposicao.arquivo.nome}?id=#{arquivoComposicao.arquivo.id}">#{arquivoComposicao.arquivo.nome}</a>
                                </p:column>
                                <p:column headerText="" style="width: 5%; text-align: center">
                                    <p:commandButton icon="ui-icon-close"
                                                     update="tabelaItem"
                                                     process="@this"
                                                     actionListener="#{processoFiscalizacaoControlador.assistenteDetentorArquivoComposicao.removerArquivo(arquivoComposicao)}"
                                                     onclick="if (!confirm('Tem certeza que deseja remover este registro?')) {return false; } else {statusDialog.show();}"
                                                     oncomplete="statusDialog.hide()"/>
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                    </p:tab>
                </p:tabView>
                <br/>
                <p:dataTable id="tabelaparcelas"
                             paginator="true"
                             rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                             rowIndexVar="rowIx"
                             styleClass="mtop05"
                             rows="10"
                             value="#{processoFiscalizacaoControlador.recuperaParcelas}"
                             var="parcela"
                             emptyMessage="Não há parcelas geradas."
                             style="margin-top: 5px"
                             paginatorTemplate="{CurrentPageReport}  &lt;spanclass='titulo-tabela mrig10'>PARCELAS&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                             rowsPerPageTemplate="10,25,50,100">
                    <p:column headerText="Cadastro" style="width: 8%;">
                        <h:outputText value="#{parcela.cadastro}"/>
                    </p:column>
                    <p:column headerText="Dívida" style="width: 12%;">
                        <h:outputText value="#{parcela.divida}"/>
                    </p:column>
                    <p:column headerText="Exercício" style="width: 5%; text-align: center;">
                        <h:outputText value="#{parcela.exercicio}"/>
                    </p:column>
                    <p:column headerText="Tipo de Débito" style="width: 5%;">
                        <h:outputText value="#{parcela.tipoDeDebito}"/>
                    </p:column>
                    <p:column headerText="Parcela" style="width: 2%; text-align: center;">
                        <h:outputText value="#{parcela.parcela}"/>
                    </p:column>
                    <p:column headerText="SD" style="width: 2%; text-align: center;">
                        <h:outputText value="#{parcela.sd}"/>
                    </p:column>
                    <p:column headerText="Vencimento" style="width: 5%; text-align: center;">
                        <h:outputText value="#{parcela.vencimentoToString}"/>
                    </p:column>
                    <p:column headerText="Valor" style="text-align: right">
                        <h:outputText value="#{parcela.valorOriginal}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Imposto" style="text-align: right">
                        <h:outputText value="#{parcela.valorImposto}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Taxa" style="text-align: right">
                        <h:outputText value="#{parcela.valorTaxa}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Desconto" style="text-align: right">
                        <h:outputText value="#{parcela.valorDesconto}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Juros" style="text-align: right">
                        <h:outputText value="#{parcela.valorJuros}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Multa" style="text-align: right">
                        <h:outputText value="#{parcela.valorMulta}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Correcao" style="text-align: right">
                        <h:outputText value="#{parcela.valorCorrecao}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Honorários" style="text-align: right">
                        <h:outputText value="#{parcela.valorHonorarios}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Total" style="text-align: right">
                        <h:outputText value="#{parcela.valorTotal}">
                            <f:convertNumber pattern="###,##0.00"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Situação">
                        <h:outputText value="#{parcela.situacaoDescricaoEnum}" title="cod. ${parcela.idParcela}"/>
                    </p:column>
                </p:dataTable>
            </p:panel>
            <br/>

            <div align="left">
                <p:commandButton id="salvar"
                                 icon="ui-icon-disk"
                                 styleClass="mtop10 mrig05 prioritario"
                                 style="height: 30px;"
                                 value="Salvar"
                                 actionListener="#{processoFiscalizacaoControlador.salvar}"
                                 onstart="aguarde.show()"
                                 oncomplete="aguarde.hide()"/>

                <p:commandButton id="gerarDAM"
                                 actionListener="#{processoFiscalizacaoControlador.geraDam()}"
                                 value="Gerar Dam" icon="ui-icon-print"
                                 onstart="aguarde.show()"
                                 oncomplete="aguarde.hide()"
                                 disabled="#{processoFiscalizacaoControlador.desabilitaBotaoGerarDam()}"
                                 style="height: 30px;"
                                 styleClass="mtop10 mrig05"
                                 update="Formulario"
                                 title="Clique aqui para gerar o dam."/>
                <p:commandButton ajax="false"
                                 style="height: 30px;"
                                 styleClass="mtop10"
                                 id="cancelar"
                                 icon="ui-icon-cancel"
                                 value="Fechar"
                                 actionListener="#{processoFiscalizacaoControlador.cancelar}"/>
            </div>
        </h:form>
        <p:dialog id="idDialogParecerRecurso" widgetVar="dialogParecerRecurso" width="750" modal="true" closable="false"
                  header="Parecer do Recurso">
            <h:form id="formParecerRecurso">
                <h:panelGrid columns="2">
                    <h:outputText value="Parecer do Recurso: "/>
                    <p:inputTextarea value="#{processoFiscalizacaoControlador.recursoFiscalizacao.parecerRecurso}"
                                     cols="70"
                                     rows="7" autoResize="false"/>
                    <h:outputText value="Data do Parecer: "/>
                    <p:inputText value="#{processoFiscalizacaoControlador.recursoFiscalizacao.dataParecer}"
                                 readonly="true"
                                 styleClass="campo-bloqueado">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </p:inputText>
                    <h:outputText value="Resultado do Recurso: "/>
                    <h:selectOneMenu title="Selecione o resultado do recurso."
                                     value="#{processoFiscalizacaoControlador.recursoFiscalizacao.resultadoParecerFiscalizacao}"
                                     id="resultado">
                        <f:selectItems value="#{processoFiscalizacaoControlador.resultadoRecursoFiscalizacao}"/>
                    </h:selectOneMenu>
                    <h:outputText value="Data Novo Prazo:"/>
                    <p:inputText value="#{processoFiscalizacaoControlador.recursoFiscalizacao.dataNovoPrazo}"
                                 readonly="true"
                                 styleClass="campo-bloqueado">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </p:inputText>

                    <h:outputText value="Tipo de Documento Oficial: "/>
                    <p:autoComplete queryDelay="1000" value="#{processoFiscalizacaoControlador.tipoDoctoOficialParecer}"
                                    var="tipoDoctParecer"
                                    size="66"
                                    id="tipoDocumentoParecer"
                                    itemLabel="#{tipoDoctParecer.codigo} - #{tipoDoctParecer.descricao}"
                                    itemValue="#{tipoDoctParecer.id}"
                                    converter="#{processoFiscalizacaoControlador.converterTipoDoctoOficial()}"
                                    completeMethod="#{processoFiscalizacaoControlador.completaTipoDoctoOficialParecerRecurso}"
                                    maxResults="10">
                        <p:ajax event="itemSelect" process="@this"/>
                    </p:autoComplete>

                </h:panelGrid>
                <br/>
                <p:commandButton value="Salvar" icon="ui-icon-disk"
                                 actionListener="#{processoFiscalizacaoControlador.salvarEmissaoParecer()}"
                                 onstart="aguarde.show()" oncomplete="aguarde.hide()"
                                 update=":Formulario" styleClass="operacao"/>
                <p:commandButton value="Cancelar"
                                 styleClass="operacao"
                                 id="cancelar"
                                 icon="ui-icon-cancel"
                                 onclick="dialogParecerRecurso.hide()"/>
            </h:form>
        </p:dialog>

        <p:dialog header="Consulta do Cadastro" modal="true" widgetVar="consultaGenerica" width="900" height="500"
                  id="dlgConsultaGenerica">
            <h:form id="formularioConsultaDebito">
                <fc:pesquisaGenerico id="lista"
                                     caminhoAtual="edita"
                                     nomeDaClasse="#{processoFiscalizacaoControlador.nomeClasse}"
                                     dialog="true"
                                     pretty="true"
                                     iconmSelecionar="check-icon.png"
                                     novo="#{processoFiscalizacaoControlador.novo()}"
                                     selecionar="#{processoFiscalizacaoControlador.selecionarObjetoPesquisaGenerico}"
                                     mostrarHistorico="false"
                                     mostrarBotaoNovo="false"
                                     meuControlador="#{processoFiscalizacaoControlador.componentePesquisa}"
                                     guardarNaSessao="false"
                                     pesquisaNoEnter="false"
                                     utilizarTabelaPessoa="#{processoFiscalizacaoControlador.selecionado.tipoCadastroFiscalizacao eq 'PESSOA' ? 'true': 'false'}"
                                     updateSelecionarTabela=":Formulario"/>
            </h:form>
        </p:dialog>
        <p:dialog header="Atenção"
                  modal="true"
                  widgetVar="confirmaGeracaoTermo"
                  dynamic="true"
                  position="center"
                  id="dlgConfirmaGeracaoTermo"
                  closable="false">
            <h:form>
                <div class="alert centralizado">
                    <h:outputLabel style="margin-bottom: 20px; "
                                   value="Já existe um Termo de Advertência/Notificação gerado. Deseja substituir o documento atual com dados atualizados?"/>
                    <br/>
                    <br/>
                    <p:commandButton value="Sim" icon="ui-icon-check" styleClass="operacao prioritario"
                                     actionListener="#{processoFiscalizacaoControlador.gerarTermoDeAdvertencia()}"
                                     onstart="aguarde.show()"
                                     oncomplete="aguarde.hide(); confirmaGeracaoTermo.hide()"
                                     update=":Formulario:tabs:tab-termo-advertencia :Formulario:tabs:tab-recursos"
                                     style="margin-left: 10px;"/>
                    <p:commandButton value="Não" icon="ui-icon-cancel" styleClass="operacao"
                                     oncomplete="confirmaGeracaoTermo.hide()"/>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog header="Atenção"
                  modal="true"
                  widgetVar="confirmaGeracaoTermoSemInfracao"
                  dynamic="true"
                  position="center"
                  id="dlgConfirmaGeracaoTermoSemInfracao"
                  closable="false">
            <h:form>
                <div class="alert centralizado">
                    <h:outputLabel style="margin-bottom: 20px; "
                                   value="Nenhuma Infração/Penalidade foi lançada, deseja gerar o Termo de Advertência/Notificação sem Infração/Penalidade?"/>
                    <br/>
                    <br/>
                    <p:commandButton value="Sim" icon="ui-icon-check" styleClass="operacao prioritario"
                                     actionListener="#{processoFiscalizacaoControlador.gerarTermoDeAdvertencia()}"
                                     onstart="aguarde.show()"
                                     oncomplete="aguarde.hide(); confirmaGeracaoTermoSemInfracao.hide()"
                                     update=":Formulario:tabs:tab-termo-advertencia :Formulario:tabs:tab-recursos"
                                     style="margin-left: 10px;"/>
                    <p:commandButton value="Não" icon="ui-icon-cancel" styleClass="operacao"
                                     oncomplete="confirmaGeracaoTermoSemInfracao.hide()"/>
                </div>
            </h:form>
        </p:dialog>
        <p:dialog header="Atenção"
                  modal="true"
                  widgetVar="confirmaGeracaoAuto"
                  dynamic="true"
                  position="center"
                  id="dlgConfirmaGeracaoAuto"
                  closable="false">
            <h:form>
                <div class="alert centralizado">
                    <h:outputLabel style="margin-bottom: 20px; "
                                   value="Já existe um Auto de Infração gerado. Deseja substituir o documento atual com dados atualizados?"/>
                    <br/>
                    <br/>
                    <p:commandButton value="Sim" icon="ui-icon-check" styleClass="operacao prioritario"
                                     actionListener="#{processoFiscalizacaoControlador.gerarAutoInfracao()}"
                                     onstart="aguarde.show()"
                                     oncomplete="aguarde.hide(); confirmaGeracaoAuto.hide()"
                                     update=":Formulario:tabs:tab-termo-advertencia :Formulario:tabs:tab-recursos"
                                     style="margin-left: 10px;"/>
                    <p:commandButton value="Não" icon="ui-icon-cancel" styleClass="operacao"
                                     oncomplete="confirmaGeracaoAuto.hide()"/>
                </div>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>
