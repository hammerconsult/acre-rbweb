<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core">
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <h:form id="Formulario">
            <p:panel header="Solicitação de Processo de Isenção de Cálculo de IPTU">
                <h:panelGrid columns="2">
                    <h:outputText value="Cadastro Imobiliário:"/>
                    <h:outputText value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.cadastroImobiliario}"
                                  styleClass="azulnegrito"/>

                    <h:outputText value="Proprietário(s):"/>
                    <ui:repeat value="#{solicitacaoProcessoIsencaoIPTUControlador.propriedades}"
                               var="prop">
                        <h:outputText
                            value="#{prop.pessoa.nome} (#{prop.pessoa.cpf_Cnpj})"
                            styleClass="negrito"/><br/>
                    </ui:repeat>

                    <h:outputText value="Setor:"/>
                    <h:outputText value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.cadastroImobiliario.lote.setor}"
                                  styleClass="negrito"/>
                    <h:outputText value="Quadra:"/>
                    <h:outputText value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.cadastroImobiliario.lote.quadra}"
                                  styleClass="negrito"/>
                    <h:outputText value="Distrito:"/>
                    <h:outputText value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.cadastroImobiliario.lote.setor.distrito.nome}"
                                  styleClass="negrito"/>
                    <h:outputLabel value="Situação: "/>
                    <h:outputText styleClass="negrito"
                                  value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.processoIsencaoIPTU.situacao.descricao}"/>
                    <h:outputText value="Código do Processo: "/>
                    <h:panelGrid columns="3">
                        <h:outputText styleClass="negrito"
                                      value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.processoIsencaoIPTU.numero}"/>
                        <h:outputText value="Exercício do Processo: "/>
                        <h:outputText styleClass="negrito"
                                      value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.processoIsencaoIPTU.exercicioProcesso}"/>
                    </h:panelGrid>

                    <h:outputText value="Protocolo: "/>
                    <fc:protocolo mostrarLabel="false"
                                  numero="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.processoIsencaoIPTU.numeroProtocolo}"
                                  ano="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.processoIsencaoIPTU.anoProtocoloString}"
                                  controlador="#{solicitacaoProcessoIsencaoIPTUControlador}"
                                  readonly="true"/>

                    <h:outputText value="Início de Vigência: "/>
                    <h:panelGrid columns="2">
                        <h:outputText styleClass="negrito"
                                      value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.inicioVigencia}">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>

                        <h:panelGroup>
                            <div class="ui-messages-warn ui-corner-all" style="margin: 0px !important; padding: 5px !important;">
                                <h:outputText value="A Data de deferimento do processo é o início da vigência do mesmo."
                                              styleClass="ui-messages-warn-detail"/>
                            </div>
                        </h:panelGroup>
                    </h:panelGrid>

                    <h:outputText value="Fim de Vigência: "/>
                    <h:outputText styleClass="negrito"
                                  value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.finalVigencia}">
                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                    </h:outputText>


                    <h:outputText value="Exercício de Referência: "/>
                    <h:outputText styleClass="negrito"
                                  value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.processoIsencaoIPTU.exercicioReferencia}"/>

                    <h:outputText value="Categoria de Isenção: "/>
                    <h:outputText styleClass="negrito"
                                  value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.processoIsencaoIPTU.categoriaIsencaoIPTU}"/>

                    <h:outputText value="Sequência:"/>
                    <h:outputText value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.sequencia}" styleClass="negrito"/>
                    <h:outputText value="Tipo de Lancamento:"/>
                    <h:outputText value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.tipoLancamentoIsencao.descricao}"
                                  styleClass="negrito"/>
                    <h:outputText value="Lança Imposto:"/>
                    <h:outputText value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.lancaImposto ? 'Sim':'Não'}"
                                  styleClass="negrito"/>
                    <h:outputText value="Lança Taxa:"/>
                    <h:outputText value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.lancaTaxa ? 'Sim':'Não'}"
                                  styleClass="negrito"/>
                    <h:outputText value="Usuário Responsável:"/>
                    <h:outputText
                        value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.processoIsencaoIPTU.usuarioResponsavel.pessoaFisica.nome}"
                        styleClass="negrito"/>

                    <h:outputText value="Situação:"/>
                    <h:outputText value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.situacao.descricao}"
                                  styleClass="negrito"/>
                </h:panelGrid>
                <br/>
                <p:tabView id="tabsProcessoIsencao">
                    <p:tab title="Observação">
                        <p:inputTextarea
                            value="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.processoIsencaoIPTU.observacao}"
                            style="width: 100%" rows="8"
                            autoResize="false" id="observacao" readonly="true"/>
                    </p:tab>
                    <p:tab title="Anexos">
                        <p:dataTable id="tabelaArquivosProcesso" var="arq"
                                     value="#{solicitacaoProcessoIsencaoIPTUControlador.selecionado.arquivos}"
                                     emptyMessage="Nenhum anexo informado.">
                            <p:column headerText="Nome">
                                <h:outputText value="${arq.arquivo.nome}"/>
                            </p:column>
                            <p:column headerText="Tamanho">
                                <h:outputText value="${arq.arquivo.tamanho} KB"/>
                            </p:column>
                            <p:column headerText="Download" style="text-align: center">
                                <a target="_blank"
                                   href='${facesContext.externalContext.requestContextPath}/arquivos/#{arq.arquivo.nome}?id=#{arq.arquivo.id}'>
                                    <h:outputText value="Download"/>
                                </a>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                </p:tabView>
                <br/>
                <h:panelGrid columns="2">
                    <fc:botaoTargetBlank label="Termo Isenção" imprimeNoDialog="true"
                                         disabled="#{!solicitacaoProcessoIsencaoIPTUControlador.isPossivelEmitirTermo(solicitacaoProcessoIsencaoIPTUControlador.isencao)}"
                                         actionListener="#{solicitacaoProcessoIsencaoIPTUControlador.imprimirDocumentoOficial(solicitacaoProcessoIsencaoIPTUControlador.isencao)}"/>

                    <h:panelGrid columns="1">
                        <p:outputPanel
                            rendered="#{!solicitacaoProcessoIsencaoIPTUControlador.isPreenchidoTipoDoctoNaCategoria(solicitacaoProcessoIsencaoIPTUControlador.isencao)}">
                            <div class="alert alert-error">
                                <strong>Não é possível imprimir o termo!</strong> Não há um Documento Oficial configurado na categoria de isenção.
                            </div>
                        </p:outputPanel>
                    </h:panelGrid>
                </h:panelGrid>
            </p:panel>
            <fc:rodapeVisualizarPretty controlador="#{solicitacaoProcessoIsencaoIPTUControlador}" mostrarExcluir="false"
                                       mostrarEditar="#{solicitacaoProcessoIsencaoIPTUControlador.isencao.processoIsencaoIPTU.situacao eq 'ABERTO'}"/>
        </h:form>
    </ui:define>
</ui:composition>
</html>
