<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
>
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <link rel="stylesheet"
              href="#{facesContext.externalContext.requestContextPath}/resources/js/code_edit/lib/codemirror.css"/>
        <link rel="stylesheet"
              href="#{facesContext.externalContext.requestContextPath}/resources/js/code_edit/lib/util/simple-hint.css"/>
        <script type="text/javascript"
                src="#{facesContext.externalContext.requestContextPath}/resources/js/code_edit/lib/codemirror.js"></script>
        <script type="text/javascript"
                src="#{facesContext.externalContext.requestContextPath}/resources/js/code_edit/lib/util/simple-hint.js"></script>
        <script type="text/javascript"
                src="#{facesContext.externalContext.requestContextPath}/resources/js/code_edit/lib/util/javascript-hint.js"></script>
        <script type="text/javascript"
                src="#{facesContext.externalContext.requestContextPath}/resources/js/code_edit/mode/javascript/javascript.js"></script>

        <h:form id="Formulario">
            <fc:cabecalhoPretty id="cpCabecalhoPretty"
                                origem="#{paginaPrefeituraPortalControlador.caminhoPadrao}listar/"
                                controlador="#{paginaPrefeituraPortalControlador}"/>
            <p:panel header="Cadastro de Página">
                <h:panelGrid columns="2">
                    <fc:outputLabelObrigatorio for="descricao" value="Descrição:"/>
                    <p:inputText title="Digite a descrição da pagina"
                                 value="#{paginaPrefeituraPortalControlador.selecionado.nome}"
                                 id="descricao" maxlength="255" size="70"/>

                    <fc:outputLabelObrigatorio for="chave" value="Chave (url):"/>
                    <p:inputText title="Digite a chave da página, vai aparecer na url"
                                 value="#{paginaPrefeituraPortalControlador.selecionado.chave}"
                                 id="chave" maxlength="255" size="70"/>

                    <h:outputText for="subNome" value="Sub Nome:"/>
                    <p:inputText title="Digite o sub nome que irá aparecer em baixo do nome da tela."
                                 value="#{paginaPrefeituraPortalControlador.selecionado.subNome}"
                                 id="subNome" maxlength="70" size="70"/>

                    <h:outputText for="chaveSubNome" value="Chave do Sub Nome (url):"/>
                    <p:inputText title="Digite a chave do sub nome para torná-lo redirecionavel para a chave informada."
                                 value="#{paginaPrefeituraPortalControlador.selecionado.chaveSubNome}"
                                 id="chaveSubNome" maxlength="255" size="70"/>

                    <h:outputText value="Ordem:"/>
                    <h:panelGrid cellspacing="0" cellpadding="0" columns="2">
                        <p:inputText title="Digite a ordem em que a pagina irá aparecer dentro do módulo."
                                     value="#{paginaPrefeituraPortalControlador.selecionado.ordem}"
                                     onkeyup="mascara(this,soNumeros)"
                                     id="ordem" maxlength="5" size="6"/>
                        <fc:botaoInformacao id="infoOrdem" styleClassBotao="mlef05"
                                            resumo="Informações"
                                            detalhes="&lt;br>&lt;br>Ordem em que será exibida a pagina dentro do módulo. &lt;br>É necessário informar a ordem caso queira que a pagina seja listada."/>
                    </h:panelGrid>

                    <fc:outputLabelObrigatorio for="tipo" value="Tipo:"/>
                    <h:selectOneMenu
                        id="tipo"
                        value="#{paginaPrefeituraPortalControlador.selecionado.tipoPaginaPortal}">
                        <f:selectItems value="#{paginaPrefeituraPortalControlador.tiposPagina}"/>
                        <p:ajax event="valueChange" update=":Formulario" process=":Formulario"/>
                    </h:selectOneMenu>

                    <fc:outputLabelObrigatorio for="componente" value="Componente:"/>
                    <h:selectOneMenu
                        id="componente"
                        value="#{paginaPrefeituraPortalControlador.selecionado.tipoComponente}">
                        <f:selectItems value="#{paginaPrefeituraPortalControlador.tiposComponentePagina}"/>
                    </h:selectOneMenu>

                    <h:outputLabel for="filtrarTodosRegistros" value="Filtrar todos registros:"/>
                    <p:selectBooleanCheckbox
                        value="#{paginaPrefeituraPortalControlador.selecionado.filtrarTodosRegistros}"
                        id="filtrarTodosRegistros"/>

                    <h:outputLabel for="paginaPublica" value="Página Pública:"/>
                    <p:selectBooleanCheckbox value="#{paginaPrefeituraPortalControlador.selecionado.paginaPublica}"
                                             id="paginaPublica"/>

                    <h:outputLabel for="anexoGeral" value="Página de Anexo Geral:"/>
                    <p:selectBooleanCheckbox value="#{paginaPrefeituraPortalControlador.selecionado.anexoGeral}"
                                             id="anexoGeral">
                        <p:ajax event="change" process="@this chave" update=":Formulario"
                                onstart="aguarde.show()" oncomplete="aguarde.hide()"
                                listener="#{paginaPrefeituraPortalControlador.atualizarConsultasQuandoAnexoGeral()}"/>
                    </p:selectBooleanCheckbox>

                    <fc:outputLabelObrigatorio value="Portal: "/>
                    <p:autoComplete queryDelay="1000" id="portal" title="Informe um portal."
                                    value="#{paginaPrefeituraPortalControlador.selecionado.prefeitura}"
                                    completeMethod="#{portalTransparenciaNovoControlador.buscar}"
                                    var="portal"
                                    dropdown="true"
                                    size="70"
                                    maxResults="10"
                                    itemLabel="#{portal.nome} "
                                    itemValue="#{portal}"
                                    forceSelection="true"
                                    converter="#{portalTransparenciaNovoControlador.converterGenerico}">
                        <p:ajax event="itemSelect" process="@this" update="@this"/>
                    </p:autoComplete>

                    <fc:outputLabelObrigatorio for="modulo" value="Modulo:"/>
                    <p:autoComplete queryDelay="1000" id="modulo" title="Informe um módulo."
                                    value="#{paginaPrefeituraPortalControlador.selecionado.modulo}"
                                    completeMethod="#{paginaPrefeituraPortalControlador.buscarModulo}"
                                    var="modulo"
                                    dropdown="true"
                                    size="70"
                                    maxResults="10"
                                    itemLabel="#{modulo.modulo.descricao} "
                                    itemValue="#{modulo}"
                                    forceSelection="true"
                                    converter="#{paginaPrefeituraPortalControlador.converterModulo}">
                        <p:ajax event="itemSelect" process="@this" update="@this"/>
                    </p:autoComplete>
                </h:panelGrid>
            </p:panel>
            <br/>
            <p:panel header="Estrutura da consulta">
                <h:inputHidden id="inputEscondidoConsulta"
                               value="#{paginaPrefeituraPortalControlador.consultaPortal.consulta}"/>

                <h:inputHidden id="inputEscondidoCount"
                               value="#{paginaPrefeituraPortalControlador.consultaPortal.count}"/>

                <p:remoteCommand
                    name="montarFieldsConsultaParaExportacaoEntidade"
                    update="@form" process="@form" onstart="aguarde.show()" oncomplete="aguarde.hide()"/>

                <h4>Select</h4>
                <textarea id="campoConsulta" name="campoConsulta"></textarea>
                <br/>
                <tr>
                    <td colspan="2" valign="top" class="centralizado italico">
                        TAGS:
                        <c:forEach items="#{paginaPrefeituraPortalControlador.tags}"
                                   var="tag"
                                   varStatus="index">
                            $${tag} &nbsp;
                        </c:forEach>
                    </td>
                    <td>
                        <p:commandButton value="SQL UNIDADE" icon="ui-icon-refresh"
                                         update="@form" process="@form" onstart="aguarde.show()"
                                         oncomplete="aguarde.hide()"
                                         actionListener="#{paginaPrefeituraPortalControlador.montarSelectUnidadePortal()}"/>
                    </td>
                </tr>
                <br/>
                <h4>Count</h4>
                <textarea id="campoCount" name="campoCount"></textarea>
                <div class="centralizado mtop10">
                    Total de Registros: #{paginaPrefeituraPortalControlador.consultaPortal.totalRegistros}
                </div>

                <script type="text/javascript">

                    var editorConsulta = CodeMirror.fromTextArea(document.getElementById("campoConsulta"), {
                        lineNumbers: true,
                        mode: "Pl/SQL",
                        extraKeys: {"Ctrl-Space": "autocomplete"},
                        onBlur: transferirConteudo
                    });

                    var editorCount = CodeMirror.fromTextArea(document.getElementById("campoCount"), {
                        lineNumbers: true,
                        mode: "Pl/SQL",
                        extraKeys: {"Ctrl-Space": "autocomplete"},
                        onBlur: transferirConteudo
                    });

                    $(document).ready(function () {
                        setTimeout(function () {
                            var conteudoHiddenConsulta = document.getElementById('Formulario:inputEscondidoConsulta').value;
                            editorConsulta.setValue(conteudoHiddenConsulta);

                            var conteudoHiddenCount = document.getElementById('Formulario:inputEscondidoCount').value;
                            editorCount.setValue(conteudoHiddenCount);
                        }, 500);
                    });

                    function transferirConteudo() {
                        var conteudoConsulta = editorConsulta.getValue();
                        var conteudoCount = editorCount.getValue();
                        document.getElementById('Formulario:inputEscondidoConsulta').value = conteudoConsulta;
                        document.getElementById('Formulario:inputEscondidoCount').value = conteudoCount;
                        montarFieldsConsultaParaExportacaoEntidade();
                    }

                </script>
                <div class="centralizado">
                    <h:panelGrid columns="4">


                        <p:commandButton value="Montar Consulta" icon="ui-icon-refresh"
                                         update="@form" process="@form" onstart="aguarde.show()"
                                         oncomplete="aguarde.hide()"
                                         actionListener="#{paginaPrefeituraPortalControlador.montarFieldsConsultaParaExportacaoEntidade()}"/>

                        <p:commandButton value="Criar Página de Visualização" icon="ui-icon-disk"
                                         immediate="true"
                                         onclick="aguarde.show()"
                                         oncomplete="aguarde.hide()"
                                         rendered="#{paginaPrefeituraPortalControlador.selecionado.id ne null}"
                                         actionListener="#{paginaPrefeituraPortalControlador.copiarPagina()}"/>

                        <p:fileUpload multiple="false"
                                      cancelLabel="Cancelar"
                                      sizeExceedMessage="Arquivo maior que 15MB."
                                      label="Importar Arquivo"
                                      uploadLabel="Upload Arquivo"
                                      sizeLimit="10485760"
                                      dragDropSupport="true"
                                      invalidFileMessage="Formato de arquivo inválido."
                                      styleClass="mtop30"
                                      process="@this"
                                      onstart="aguarde.show()"
                                      update="@form"
                                      oncomplete="aguarde.hide()"
                                      auto="true"
                                      id="btnUpload"
                                      allowTypes="/(\.|\/)(json)$/"
                                      fileUploadListener="#{paginaPrefeituraPortalControlador.importar}"/>

                        <p:commandLink value="toJson"
                                       rendered="#{!empty paginaPrefeituraPortalControlador.selecionado.chave}"
                                       ajax="false"
                                       id="linkDownload"
                                       onstart="aguarde.show()"
                                       oncomplete="aguarde.hide()"
                                       styleClass="pull-right"
                                       onclick="PrimeFaces.monitorDownload(start, stop)">
                            <p:fileDownload value="#{paginaPrefeituraPortalControlador.toJson()}"/>
                        </p:commandLink>

                    </h:panelGrid>
                </div>
                <div class="centralizado">
                    <div class="alert alert-info centralizado mtop05">
                        Adicionar na consulta o
                        <strong> $WHERE. </strong> <br/>
                        1 - Caso não tenha alguma condição padrão, automaticamente vai ser adicionado no final da query $WHERE.<br/>
                        2 - Caso tenha alguma condição padrão, por exemplo, 'where emp.CATEGORIAORCAMENTARIA = 'NORMAL' $WHERE'.<br/>
                    </div>
                    <div class="alert alert-info centralizado mtop05">

                        <strong> Observações gerais. </strong> <br/>
                        1 - A ordem dos campos no sql deve ser a mesma ordem dos campos da tabela.<br/>

                    </div>
                </div>
            </p:panel>
            <br/>
            <fc:camposTabelaPortal fields="#{paginaPrefeituraPortalControlador.consultaPortal.fields}"
                                   tipoPaginaPortal="#{paginaPrefeituraPortalControlador.selecionado.tipoPaginaPortal}"
                                   pesquisaveis="#{paginaPrefeituraPortalControlador.consultaPortal.pesquisaveis}"
                                   controlador="#{paginaPrefeituraPortalControlador}"/>

            <p:panel header="Tabs"
                     styleClass="mtop20"
                     id="tabs">

                <p:commandButton icon="ui-icon-plus" value="Novo" styleClass="operacao mrig05"
                                 rendered="#{paginaPrefeituraPortalControlador.tabPortal eq null}"
                                 actionListener="#{paginaPrefeituraPortalControlador.novaTabPortal()}"
                                 onstart="aguarde.show();"
                                 oncomplete="aguarde.hide();"
                                 process="@this"
                                 update=":Formulario:tabs"/>

                <p:outputPanel id="outPutTabPortal" rendered="#{paginaPrefeituraPortalControlador.tabPortal ne null}">
                    <h4>Título</h4>
                    <p:inputText value="#{paginaPrefeituraPortalControlador.tabPortal.titulo}"/>
                    <br/>

                    <h4>Subtítulo</h4>
                    <p:inputText value="#{paginaPrefeituraPortalControlador.tabPortal.subTitulo}"/>
                    <br/>

                    <h4>Ordem</h4>
                    <p:inputText title="Digite a ordem da tab."
                                 value="#{paginaPrefeituraPortalControlador.tabPortal.ordem}"
                                 onkeyup="mascara(this,soNumeros)"
                                 id="ordemTabs" maxlength="5" size="6"/>
                    <br/>

                    <h4>Select</h4>
                    <p:inputTextarea value="#{paginaPrefeituraPortalControlador.tabPortal.consulta}"
                                     autoResize="false" rows="5" style="width: 98%" scrollHeight="250"/>
                    <br/>

                    <tr>
                        <td colspan="2" valign="top" class="centralizado italico">
                            TAGS:
                            <c:forEach items="#{paginaPrefeituraPortalControlador.tags}"
                                       var="tag"
                                       varStatus="index">
                                $${tag} &nbsp;
                            </c:forEach>
                        </td>
                    </tr>

                    <h4>Count</h4>
                    <p:inputTextarea value="#{paginaPrefeituraPortalControlador.tabPortal.count}"
                                     autoResize="false" rows="5" style="width: 98%" scrollHeight="250"/>
                    <br/>

                    <div class="centralizado">
                        <div class="alert alert-info centralizado mtop05">
                            Adicionar na consulta o
                            <strong> $WHERE. </strong> <br/>
                            1 - Caso não tenha alguma condição padrão, automaticamente vai ser adicionado no final da query $WHERE.<br/>
                            2 - Caso tenha alguma condição padrão, por exemplo, 'where emp.CATEGORIAORCAMENTARIA = 'NORMAL' $WHERE'.<br/>
                        </div>
                        <div class="alert alert-info centralizado mtop05">
                            <strong> Observações gerais. </strong> <br/>
                            1 - A ordem dos campos no sql deve ser a mesma ordem dos campos da tabela.<br/>

                        </div>
                    </div>

                    <fc:camposTabelaPortal fields="#{paginaPrefeituraPortalControlador.tabPortal.fields}"
                                           tipoPaginaPortal="SQL"
                                           pesquisaveis="#{paginaPrefeituraPortalControlador.tabPortal.pesquisaveis}"
                                           controlador="#{paginaPrefeituraPortalControlador}"/>

                    <p:commandButton value="Adicionar"
                                     rendered="#{paginaPrefeituraPortalControlador.tabPortal ne null}"
                                     styleClass="mtop10 mrig05 prioritario"
                                     style="height: 30px;"
                                     update=":Formulario:tabs"
                                     process=":Formulario:outPutTabPortal"
                                     icon="ui-icon-plus"
                                     title="Clique para adicionar uma tab."
                                     actionListener="#{paginaPrefeituraPortalControlador.adicionarTabPortal()}"
                                     onclick="aguarde.show()"
                                     oncomplete="aguarde.hide()"/>

                    <p:commandButton value="Cancelar"
                                     rendered="#{paginaPrefeituraPortalControlador.tabPortal ne null}"
                                     styleClass="mtop10 mrig05 prioritario"
                                     style="height: 30px;"
                                     update=":Formulario:tabs"
                                     process="@this"
                                     icon="ui-icon-cancel"
                                     title="Clique para cancelar."
                                     actionListener="#{paginaPrefeituraPortalControlador.cancelarTabPortal()}"
                                     onclick="aguarde.show()"
                                     oncomplete="aguarde.hide()"/>
                </p:outputPanel>

                <table class="table table-striped table-bordered mtop20 ">
                    <tr>
                        <th style="text-align: center!important;">Ações</th>
                        <th style="text-align: left!important;">Título</th>
                        <th style="text-align: left!important;">Subtítulo</th>
                        <th style="text-align: center!important;">Select</th>
                        <th style="text-align: center!important;">Count</th>
                        <th style="text-align: center!important;">Ordem</th>
                    </tr>
                    <c:forEach items="#{paginaPrefeituraPortalControlador.consultaPortal.tabs}"
                               varStatus="index"
                               var="tabPortal">
                        <tr>
                            <td style="text-align: center!important; width: 90px;">
                                <p:commandButton icon="ui-icon-pencil"
                                                 styleClass="mrig05"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 update=":Formulario:tabs"
                                                 process="@this"
                                                 title="Clique para alterar este registro."
                                                 actionListener="#{paginaPrefeituraPortalControlador.editarTabPortal(tabPortal)}"/>

                                <p:commandButton icon="ui-icon-trash"
                                                 actionListener="#{paginaPrefeituraPortalControlador.removerTabPortal(tabPortal)}"
                                                 onclick="aguarde.show()"
                                                 styleClass="mrig05"
                                                 title="Remover"
                                                 oncomplete="aguarde.hide()"
                                                 update=":Formulario:tabs"
                                                 process="@this"/>

                            </td>
                            <td style="text-align: left!important;">
                                <h:outputText value="#{tabPortal.titulo}"/>
                            </td>
                            <td style="text-align: left!important;">
                                <h:outputText value="#{tabPortal.subTitulo}"/>
                            </td>
                            <td style="text-align: center!important;">
                                <h:outputText value="#{tabPortal.ordem}"/>
                            </td>
                            <td style="text-align: center!important;">
                                <p:commandButton styleClass="botao_azul icone_branco"
                                                 actionListener="#{paginaPrefeituraPortalControlador.atualizarStringDialog(tabPortal.consulta)}"
                                                 process="@this"
                                                 onstart="aguarde.show()"
                                                 update=":FormularioDialogVerString"
                                                 oncomplete="dialogVerString.show();aguarde.hide()"
                                                 image="ui-icon-search"/>
                            </td>
                            <td style="text-align: center!important;">
                                <p:commandButton styleClass="botao_azul icone_branco"
                                                 actionListener="#{paginaPrefeituraPortalControlador.atualizarStringDialog(tabPortal.count)}"
                                                 process="@this"
                                                 onstart="aguarde.show()"
                                                 update=":FormularioDialogVerString"
                                                 oncomplete="dialogVerString.show();aguarde.hide()"
                                                 image="ui-icon-search"/>
                            </td>
                        </tr>
                    </c:forEach>
                </table>
                <br/>
            </p:panel>

            <p:panel header="Paineis"
                     styleClass="mtop20"
                     id="paineis">

                <p:commandButton icon="ui-icon-plus" value="Novo" styleClass="operacao mrig05"
                                 rendered="#{paginaPrefeituraPortalControlador.painelPortal eq null}"
                                 actionListener="#{paginaPrefeituraPortalControlador.novoPainelPortal()}"
                                 onstart="aguarde.show();"
                                 oncomplete="aguarde.hide();"
                                 process="@this"
                                 update=":Formulario:paineis"/>

                <p:outputPanel id="outPutPainelPortal"
                               rendered="#{paginaPrefeituraPortalControlador.painelPortal ne null}">
                    <h4>Título</h4>
                    <p:inputText value="#{paginaPrefeituraPortalControlador.painelPortal.descricao}"/>
                    <br/>

                    <h4>Tipo do Painel</h4>
                    <h:selectOneMenu
                        id="tipoPainelPortal"
                        value="#{paginaPrefeituraPortalControlador.painelPortal.tipoPainelPortal}">
                        <f:selectItems value="#{paginaPrefeituraPortalControlador.tiposPaineis}"/>
                        <p:ajax event="valueChange" update="tipoGrafico" process="@this"
                                listener="#{paginaPrefeituraPortalControlador.limparTipoGrafico()}"/>
                    </h:selectOneMenu>
                    <br/>

                    <h4>Tipo do Gráfico</h4>
                    <h:selectOneMenu
                        id="tipoGrafico"
                        disabled="#{!paginaPrefeituraPortalControlador.painelPortal.tipoPainelPortal.grafico}"
                        value="#{paginaPrefeituraPortalControlador.painelPortal.tipoGrafico}">
                        <f:selectItem itemLabel="" itemValue="null"/>
                        <f:selectItem itemLabel="BARRA" itemValue="bar"/>
                        <f:selectItem itemLabel="LINHA" itemValue="line"/>
                        <f:selectItem itemLabel="PIZZA" itemValue="pie"/>
                        <f:selectItem itemLabel="DONUT" itemValue="donut"/>
                    </h:selectOneMenu>
                    <br/>

                    <h4>Tipo do Valor do Gráfico</h4>
                    <h:selectOneMenu
                        id="tipoValorGrafico"
                        disabled="#{!paginaPrefeituraPortalControlador.painelPortal.tipoPainelPortal.grafico}"
                        value="#{paginaPrefeituraPortalControlador.painelPortal.tipoValorGrafico}">
                        <f:selectItem itemLabel="" itemValue="null"/>
                        <f:selectItem itemLabel="QUANTIDADE" itemValue="quantidade"/>
                        <f:selectItem itemLabel="MONETARIO" itemValue="monetario"/>
                    </h:selectOneMenu>
                    <br/>

                    <h4>Metade da Tela?</h4>
                    <p:selectBooleanCheckbox
                        value="#{paginaPrefeituraPortalControlador.painelPortal.metadeDaTela}"
                        title="Selecione caso queira que o painel ocupe apenas metade da tela."/>
                    <br/>

                    <h4>Select</h4>
                    <p:inputTextarea value="#{paginaPrefeituraPortalControlador.painelPortal.consulta}"
                                     autoResize="false" rows="5" style="width: 98%" scrollHeight="250"/>
                    <br/>

                    <tr>
                        <td colspan="2" valign="top" class="centralizado italico">
                            TAGS:
                            <c:forEach items="#{paginaPrefeituraPortalControlador.tags}"
                                       var="tag"
                                       varStatus="index">
                                $${tag} &nbsp;
                            </c:forEach>
                        </td>
                    </tr>

                    <div class="centralizado">
                        <div class="alert alert-info centralizado mtop05">
                            Adicionar na consulta o
                            <strong> $WHERE. </strong> <br/>
                            1 - Caso não tenha alguma condição padrão, automaticamente vai ser adicionado no final da query $WHERE.<br/>
                            2 - Caso tenha alguma condição padrão, por exemplo, 'where emp.CATEGORIAORCAMENTARIA = 'NORMAL' $WHERE'.<br/>
                        </div>
                    </div>

                    <p:commandButton value="Adicionar"
                                     rendered="#{paginaPrefeituraPortalControlador.painelPortal ne null}"
                                     styleClass="mtop10 mrig05 prioritario"
                                     style="height: 30px;"
                                     update=":Formulario:paineis"
                                     process=":Formulario:outPutPainelPortal"
                                     icon="ui-icon-plus"
                                     title="Clique para adicionar um grafico."
                                     actionListener="#{paginaPrefeituraPortalControlador.adicionarPainelPortal()}"
                                     onclick="aguarde.show()"
                                     oncomplete="aguarde.hide()"/>

                    <p:commandButton value="Cancelar"
                                     rendered="#{paginaPrefeituraPortalControlador.painelPortal ne null}"
                                     styleClass="mtop10 mrig05 prioritario"
                                     style="height: 30px;"
                                     process="@this"
                                     update=":Formulario:paineis"
                                     icon="ui-icon-cancel"
                                     title="Clique para cancelar."
                                     actionListener="#{paginaPrefeituraPortalControlador.cancelarPainelPortal()}"
                                     onclick="aguarde.show()"
                                     oncomplete="aguarde.hide()"/>
                </p:outputPanel>

                <table class="table table-striped table-bordered mtop20 ">
                    <tr>
                        <th style="text-align: center!important;">Ações</th>
                        <th style="text-align: left!important;">Título</th>
                        <th style="text-align: left!important;">Tipo do Painel</th>
                        <th style="text-align: center!important;">Select</th>
                    </tr>
                    <c:forEach items="#{paginaPrefeituraPortalControlador.consultaPortal.paineis}"
                               varStatus="index"
                               var="painelPortal">
                        <tr>
                            <td style="text-align: center!important; width: 90px;">
                                <p:commandButton icon="ui-icon-pencil"
                                                 styleClass="mrig05"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 update=":Formulario:paineis"
                                                 process="@this"
                                                 title="Clique para alterar este registro."
                                                 actionListener="#{paginaPrefeituraPortalControlador.editarPainelPortal(painelPortal)}"/>

                                <p:commandButton icon="ui-icon-trash"
                                                 actionListener="#{paginaPrefeituraPortalControlador.removerPainelPortal(painelPortal)}"
                                                 onclick="aguarde.show()"
                                                 styleClass="mrig05"
                                                 title="Remover"
                                                 oncomplete="aguarde.hide()"
                                                 update=":Formulario:paineis"
                                                 process="@this"/>

                            </td>
                            <td style="text-align: left!important;">
                                <h:outputText value="#{painelPortal.descricao}"/>
                            </td>
                            <td style="text-align: left!important;">
                                <h:outputText value="#{painelPortal.tipoPainelPortal.descricao}"/>
                            </td>
                            <td style="text-align: center!important;">
                                <p:commandButton styleClass="botao_azul icone_branco"
                                                 actionListener="#{paginaPrefeituraPortalControlador.atualizarStringDialog(painelPortal.consulta)}"
                                                 process="@this"
                                                 onstart="aguarde.show()"
                                                 update=":FormularioDialogVerString"
                                                 oncomplete="dialogVerString.show();aguarde.hide()"
                                                 image="ui-icon-search"/>
                            </td>
                        </tr>
                    </c:forEach>
                </table>
                <br/>
            </p:panel>

            <p:panel header="Conteúdo HTML"
                     styleClass="mtop20"
                     id="panelHtml"
                     rendered="#{paginaPrefeituraPortalControlador.selecionado.tipoPaginaPortal eq 'HTML'}">

                <p:inputTextarea value="#{paginaPrefeituraPortalControlador.selecionado.conteudoHtml}"
                                 cols="100"
                                 rows="30"
                />
            </p:panel>

            <p:panel header="Usuários"
                     styleClass="mtop20"
                     id="usuarios">

                <h:panelGrid columns="2">
                    <h:outputLabel value="Usuário: "/>
                    <p:autoComplete queryDelay="1000" id="usuario" title="Informe um usuário."
                                    value="#{paginaPrefeituraPortalControlador.usuario}"
                                    completeMethod="#{usuarioPaginaPortalControlador.completarEstaEntidade}"
                                    var="usuario"
                                    dropdown="true"
                                    size="70"
                                    maxResults="10"
                                    itemLabel="#{usuario.login} "
                                    itemValue="#{usuario}"
                                    forceSelection="true"
                                    converter="#{usuarioPaginaPortalControlador.converterGenerico}">
                        <p:ajax event="itemSelect" process="@this" update=":Formulario:usuarios"/>
                    </p:autoComplete>

                </h:panelGrid>

                <p:commandButton value="Adicionar"
                                 rendered="#{paginaPrefeituraPortalControlador.usuario ne null}"
                                 styleClass="mtop10 mrig05 prioritario"
                                 style="height: 30px;"
                                 update=":Formulario:usuarios"
                                 process=":Formulario:usuarios"
                                 icon="ui-icon-plus"
                                 title="Clique para adicionar o usuário"
                                 actionListener="#{paginaPrefeituraPortalControlador.adicionarUsuario()}"
                                 onclick="aguarde.show()"
                                 oncomplete="aguarde.hide()"/>

                <p:commandButton value="Adicionar Todos"
                                 styleClass="mtop10 mrig05 prioritario"
                                 style="height: 30px;"
                                 update=":Formulario:usuarios"
                                 process=":Formulario:usuarios"
                                 icon="ui-icon-plus"
                                 title="Clique para adicionar todos os usuário"
                                 actionListener="#{paginaPrefeituraPortalControlador.adicionarTodosUsuario()}"
                                 onclick="aguarde.show()"
                                 oncomplete="aguarde.hide()"/>

                <table class="table table-striped table-bordered mtop20 ">
                    <tr>
                        <th></th>
                        <th style="text-align: center!important;">Login</th>
                        <th style="text-align: center!important;">E-mail</th>
                        <th style="text-align: center!important;">Ativo</th>
                    </tr>
                    <c:forEach items="#{paginaPrefeituraPortalControlador.usuarios}"
                               varStatus="index"
                               var="usuario">
                        <tr>
                            <td style="text-align: center!important;">
                                <p:commandButton icon="ui-icon-trash"
                                                 actionListener="#{paginaPrefeituraPortalControlador.removerUsuario(usuario)}"
                                                 onclick="aguarde.show()"
                                                 title="Remover"
                                                 oncomplete="aguarde.hide()"
                                                 update=":Formulario:usuarios"
                                                 process="@this"/>

                            </td>
                            <td style="text-align: center!important;">
                                <h:outputText value="#{usuario.login}"/>
                            </td>
                            <td style="text-align: center!important;">
                                <h:outputText value="#{usuario.email}"/>
                            </td>
                            <td style="text-align: center!important;">
                                <h:outputText value="#{usuario.ativo? 'Sim' :'Não'}"/>
                            </td>
                        </tr>
                    </c:forEach>
                </table>
            </p:panel>

            <fc:rodapePretty id="rpRodapePretty" controlador="#{paginaPrefeituraPortalControlador}"/>
        </h:form>

        <style type="text/css">
            .CodeMirror {
                border: 1px solid #717171;
            }

            .CodeMirror-scroll {
                height: 100px !important;
            }
        </style>

        <p:dialog widgetVar="dialogVerString"
                  modal="true"
                  position="center"
                  style="position: fixed !important;"
                  resizable="false"
                  closable="true"
                  width="900"
                  height="500">
            <h:form id="FormularioDialogVerString">
                <p:panel id="panelDialog">
                    <p:inputTextarea value="#{paginaPrefeituraPortalControlador.stringDialogVisualizar}"
                                     styleClass="negrito" resizable="false" disabled="true"
                                     autoResize="false" rows="28" style="width: 98%" scrollHeight="250"/>
                </p:panel>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>
