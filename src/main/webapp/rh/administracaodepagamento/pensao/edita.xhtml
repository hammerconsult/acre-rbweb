<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:rh="http://java.sun.com/jsf/composite/components/rh"
      xmlns:p="http://primefaces.org/ui"
>
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <h:form id="Formulario">
            <fc:cabecalhoPretty origem="#{pensaoControlador.caminhoPadrao}listar/"
                                controlador="#{pensaoControlador}"/>
            <p:tabView activeIndex="#{pensaoControlador.selecionado.activeIndex}" id="tab-view-geral">
                <p:tab id="tab-instituidor" title="Instituidor">


                    <p:panel id="painelDadosServidor"
                             style="float : right; width: 500px;"
                             header="Dados do Instituidor">

                        <h:panelGroup rendered="#{pensaoControlador.selecionado.contratoFP ne null}">
                            <h:panelGroup columns="2" columnClasses="width200, none"
                                          rendered="#{pensaoControlador.aposentadoria ne null}">
                                <h:outputText value="Tipo Aposentadoria:"/>
                                <h:outputText
                                    value="#{pensaoControlador.aposentadoria.tipoAposentadoria}"/>
                            </h:panelGroup>
                            <h:panelGroup columns="2" columnClasses="width200, none"
                                          rendered="#{pensaoControlador.selecionado.contratoFP ne null}">
                                <h:panelGrid columns="2">
                                    <h:outputText value="Matricula/Contrato:"/>
                                    <h:outputText
                                        value="#{pensaoControlador.selecionado.contratoFP.matriculaFP.matricula}/#{pensaoControlador.selecionado.contratoFP.numero}"/>
                                    <h:outputText value="Admissão:"/>
                                    <h:outputText
                                        value="#{pensaoControlador.selecionado.contratoFP.dataAdmissao}"><f:convertDateTime
                                        pattern="dd/MM/yyyy"/> </h:outputText>
                                    <h:outputText value="Cargo:"/>
                                    <h:outputText value="#{pensaoControlador.selecionado.contratoFP.cargo}"/>
                                    <h:outputText value="Modalidade:"/>
                                    <h:outputText
                                        value="#{pensaoControlador.selecionado.contratoFP.modalidadeContratoFP}"/>
                                    <h:outputText value="Regime:"/>
                                    <h:outputText value="#{pensaoControlador.selecionado.contratoFP.tipoRegime}"/>
                                    <h:outputText rendered="#{pensaoControlador.situacaoFuncional ne null}"
                                                  value="Situacao Funcional:"/>
                                    <h:outputText rendered="#{pensaoControlador.situacaoFuncional ne null}"
                                                  value="#{pensaoControlador.situacaoFuncional}"/>
                                    <h:outputText rendered="#{pensaoControlador.enquadramentoFuncional ne null}"
                                                  value="Enquadramento Funcional:"/>
                                    <h:outputText rendered="#{pensaoControlador.enquadramentoFuncional ne null}"
                                                  value="#{pensaoControlador.enquadramentoFuncional.descricaoCompletaValor}"/>

                                    <h:outputText value="Local de Trabalho:"/>
                                    <h:outputText value="#{pensaoControlador.lotacaoFuncional()}"/>
                                </h:panelGrid>
                            </h:panelGroup>
                        </h:panelGroup>
                    </p:panel>

                    <h:panelGrid columns="4">
                        <fc:outputLabelObrigatorio value="Instituidor: " for="auto-complete-instituidor"/>

                        <rh:auto-complete-vinculofp id="auto-complete-instituidor"
                                                    validarPermissaoDeAcessoAoVinculo="false"
                                                    process=":Formulario:tab-view-geral:auto-complete-instituidor"
                                                    converter="#{pensaoControlador.converterContratoFP}"
                                                    completeMethod="#{pensaoControlador.completarContratoFP}"
                                                    onstart="aguarde.show()"
                                                    oncomplete="aguarde.hide()"
                                                    classe="ContratoFP"
                                                    actionListener="#{pensaoControlador.carregarInstituidor}"
                                                    value="#{pensaoControlador.selecionado.contratoFP}"
                                                    update=":Formulario"
                                                    size="60"/>

                        <p:spacer rendered="#{pensaoControlador.arquivoNull}"/>
                        <p:panel rendered="#{pensaoControlador.arquivoNull eq true}" id="panelDownloadCedido">
                            <a title="#{pensaoControlador.arquivoRegistroDeObito.descricao}"
                               href="${facesContext.externalContext.requestContextPath}/arquivos/#{pensaoControlador.arquivoRegistroDeObito.arquivo.nome}?id=#{pensaoControlador.arquivoRegistroDeObito.arquivo.id}">#{pensaoControlador.arquivoRegistroDeObito.arquivo.nome}</a>
                        </p:panel>
                    </h:panelGrid>

                    <h:panelGrid id="painel-grid-info-basico" columns="2">
                        <h:panelGroup>
                            <h:panelGrid columns="2" columnClasses="none, verticalAlignTop, verticalAlignTop">

                                <p:fieldset legend="Informações Básicas">
                                    <fc:botaoInformacao id="btInfo" resumo="Observações:"
                                                        detalhes="O cadastro de Pensão, recupera vários valores das tabelas de referênciaFP. Sem esses valores não é possivel realizar os calculos, por favor verifique se esse valores estão lançados corretamente."/>
                                    <table>
                                        <tr>
                                            <td><h:outputText value="Remuneração:"/></td>
                                            <td><p:inputText id="remuneracaoInstituicao"
                                                             value="#{pensaoControlador.selecionado.remuneracaoInstituidor}"
                                                             styleClass="alinhamentoDireita"
                                                             onkeypress="mascaraMonetaria(this)"
                                                             converter="moneyConverter"
                                                             size="15">
                                                <p:ajax event="change"
                                                        listener="#{pensaoControlador.atualizaValorParcelaExcedenteTeto()}"
                                                        onstart="aguarde.show();"
                                                        oncomplete="aguarde.hide();"
                                                        update="parcelaExcedenteTeto rppsParcelaExcedenteTeto valorBrutoPensao valorRPPSDeficiente valorRPPS"/>
                                            </p:inputText></td>
                                        </tr>


                                        <tr>
                                            <td><h:outputText value="Valor do Teto do RGPS:"/></td>
                                            <td><p:inputText id="tetoDataObito" size="15"
                                                             value="#{pensaoControlador.tetoRPPS().valor}"
                                                             converter="moneyConverter"
                                                             readonly="true"
                                                             styleClass="alinhamentoDireita"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><h:outputText value="Valor do Teto do RGPS na Data do Óbito:"/></td>
                                            <td><p:inputText size="15"
                                                             value="#{pensaoControlador.tetoRPPSHistorico().valor}"
                                                             converter="moneyConverter"
                                                             readonly="true"
                                                             styleClass="alinhamentoDireita"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><h:outputText value="Percentual Excedente:"/></td>
                                            <td><p:inputText size="15" value="#{pensaoControlador.percentualExcedente}"
                                                             converter="percentualConverter"
                                                             readonly="true"
                                                             styleClass="alinhamentoDireita"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><h:outputText value="Parcela Excedente ao Teto:"/></td>
                                            <td><p:inputText size="15" id="parcelaExcedenteTeto"
                                                             value="#{pensaoControlador.parcelaExcedenteTeto}"
                                                             converter="moneyConverter"
                                                             readonly="true"
                                                             styleClass="alinhamentoDireita"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><h:outputText value="RPPS Parcela Excedente ao Teto:"/></td>
                                            <td><p:inputText size="15" id="rppsParcelaExcedenteTeto"
                                                             value="#{pensaoControlador.rppsParcelaExcedenteTeto}"
                                                             converter="moneyConverter"
                                                             readonly="true"
                                                             styleClass="alinhamentoDireita"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><h:outputText value="Valor Bruto da Pensão:"/></td>
                                            <td><p:inputText size="15" id="valorBrutoPensao"
                                                             value="#{pensaoControlador.valorBrutoPensao}"
                                                             converter="moneyConverter"
                                                             readonly="true"
                                                             styleClass="alinhamentoDireita"/>
                                            </td>
                                        </tr>
                                    </table>
                                </p:fieldset>
                                <p:fieldset rendered="false" legend="Valores Calculados">
                                    <table>
                                        <tr>
                                            <td>
                                                <h:outputText value="Valor Bruto RPPS Normal:"/>
                                                <h:outputText id="valorRPPS" style="color: red"
                                                              value="#{pensaoControlador.valorRPPS}"
                                                              converter="moneyConverter"/>
                                                <br/>
                                                <h:outputText value="Valor Bruto RPPS Deficiente:"/>
                                                <h:outputText id="valorRPPSDeficiente" style="color: purple"
                                                              value="#{pensaoControlador.valorRPPSDeficiente}"
                                                              converter="moneyConverter"/>
                                            </td>
                                        </tr>
                                    </table>
                                </p:fieldset>

                            </h:panelGrid>
                        </h:panelGroup>

                    </h:panelGrid>

                    <h:panelGrid id="panelGridAtoLegal" columns="2">
                        <fc:outputLabelObrigatorio value="Ato Legal " for="atoLegal"/>
                        <h:panelGroup>
                            <p:autoComplete queryDelay="1000" id="atoLegal"
                                            completeMethod="#{pensaoControlador.completaAtoLegal}"
                                            value="#{pensaoControlador.atoLegal}"
                                            var="atoLegal"
                                            itemLabel="#{atoLegal}"
                                            itemValue="#{atoLegal.id}"
                                            converter="#{pensaoControlador.converterAtoLegal}"
                                            forceSelection="true"
                                            styleClass="mrig05"
                                            size="64">
                                <p:ajax event="itemSelect" listener="#{pensaoControlador.adicionarPensaoAtoLegal}"
                                        update="panelGridAtoLegal"
                                        onstart="aguarde.show()" oncomplete="aguarde.hide()"/>
                            </p:autoComplete>

                            <p:commandButton id="bt-novo-ato-legal"
                                             icon="ui-icon-circle-plus"
                                             title="Clique para inserir um novo registro."
                                             styleClass="mrig05"
                                             update="@none"
                                             process="@none"
                                             onclick="window.open('#{request.contextPath}/atolegal/novo/', '_blank')"/>

                            <table class="table" style="width: 500px">
                                <ui:repeat
                                    value="#{pensaoControlador.selecionado.pensaoAtoLegal}"
                                    var="pensao">
                                    <tr>
                                        <td><h:outputText value="#{pensao.atoLegal}"
                                                          styleClass="negrito"/></td>
                                        <td><p:commandButton icon="ui-icon-trash"
                                                             onclick="aguarde.show()"
                                                             oncomplete="aguarde.hide()"
                                                             actionListener="#{pensaoControlador.removerPensaoAtoLegal(pensao)}"
                                                             update=":Formulario:tab-view-geral:panelGridAtoLegal"/>
                                        </td>
                                    </tr>
                                </ui:repeat>
                            </table>
                        </h:panelGroup>

                        <fc:outputLabelObrigatorio value="Número de cota inicial:" for="numeroCotas"/>
                        <p:inputText immediate="true" title="Digite o número de cota inicial da Pensão"
                                     onkeypress="mascara(this, soNumeros);"
                                     value="#{pensaoControlador.selecionado.numeroCotas}" id="numeroCotas"
                                     maxlength="15" size="15">
                            <p:ajax process="numeroCotas" event="blur"/>
                        </p:inputText>

                        <fc:outputLabelObrigatorio value="Número de cotas vigêntes:"/>
                        <h:outputText value="#{pensaoControlador.numeroCotasVigentes}" id="idCotasVigentes"
                                      styleClass="negrito"/>

                        <h:outputText value="Valor por Pensão:"
                                      rendered="#{pensaoControlador.selecionado.modoRateio eq 'AUTOMATICO'}"/>
                        <p:inputText size="10" id="valorPorPensionista"
                                     value="#{pensaoControlador.valorPorPensionista()}" readonly="true"
                                     converter="moneyConverter"
                                     style="text-align: right"
                                     rendered="#{pensaoControlador.selecionado.modoRateio eq 'AUTOMATICO'}"/>
                    </h:panelGrid>


                    <p:panel header="Dados do Instituidor" id="panelPrevidenciaRPPS"
                             rendered="#{pensaoControlador.mostraPainelDados}">
                        <h:panelGrid columns="2">
                            <h:outputText value="Regra de Aposentadoria:"/>
                            <h:outputText value="#{pensaoControlador.regraAposentadoria.descricao}"/>

                            <h:outputText value="Cargo:"/>
                            <h:outputText value="#{pensaoControlador.selecionado.contratoFP.cargo}"/>

                            <h:outputText value="Data do Óbito:"/>
                            <h:outputText value="#{pensaoControlador.dataDeObito}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>

                        </h:panelGrid>
                        <br/>
                        <p:panel header="Itens da Ficha Financeira">
                            <p:dataTable id="itensFichaFinanceira"
                                         emptyMessage="Este instituidor não possui Fichas Financeiras"
                                         value="#{pensaoControlador.listaItemFichaFinanceiraFP}" var="item">
                                <p:column headerText="Verba">
                                    <h:outputText value="#{item.eventoFP.codigo} - #{item.eventoFP.descricao}"/>
                                </p:column>
                                <p:column headerText="Tipo Vant">
                                    <h:outputText value="#{item.eventoFP.tipoEventoFP}"/>
                                </p:column>
                                <p:column headerText="Ref." style="text-align: right!important;">
                                    <h:outputText value="#{item.valorReferencia}"/>
                                </p:column>
                                <p:column headerText="Valor Base" style="text-align: right!important;">
                                    <h:outputText value="#{item.valorBaseDeCalculo}" converter="moneyConverter"/>
                                </p:column>
                                <p:column headerText="Valor Verba" style="text-align: right!important;">
                                    <h:outputText value="#{item.valor}" converter="moneyConverter"/>
                                </p:column>
                            </p:dataTable>

                            <div align="right">
                                <h:panelGrid columns="2">
                                    <h:outputText value="Total Rendimentos:"/>
                                    <h:outputText style="font-weight: bold; color: #090"
                                                  value="#{pensaoControlador.totalVantagens}">
                                        <f:convertNumber pattern="#,##0.00"/>
                                    </h:outputText>
                                    <h:outputText value="Total Descontos:"/>
                                    <h:outputText style="font-weight: bold; color: #FF0000"
                                                  value="#{pensaoControlador.totalDescontos}"
                                                  converter="moneyConverter"/>
                                    <h:outputText value="Total Líquido:"/>
                                    <h:outputText style="font-weight: bold"
                                                  value="#{pensaoControlador.total}"
                                                  converter="moneyConverter"/>
                                </h:panelGrid>
                            </div>
                        </p:panel>

                    </p:panel>

                </p:tab>
                <p:tab id="tab-view-pensionista" title="Pensionista(s)">
                    <p:outputPanel id="panel-adicionar-pensionista">
                        <div style="text-align: center">
                            <p:commandButton id="btn-adicionar-pensionista" title="Adicionar Pensionista"
                                             value="Adicionar Pensionista"
                                             icon="ui-icon-circle-plus"
                                             onclick="aguarde.show();"
                                             oncomplete="aguarde.hide();"
                                             rendered="#{pensaoControlador.selecionado.listaDePensionistas.size() le 0}"
                                             update="@form"
                                             actionListener="#{pensaoControlador.criarAndAdicionarPensionista}">

                            </p:commandButton>
                        </div>
                    </p:outputPanel>

                    <p:outputPanel id="registros-pensionistas">
                        <ui:repeat value="#{pensaoControlador.selecionado.listaDePensionistas}" var="pensionista"
                                   varStatus="statusPensionista">
                            <h:panelGroup id="painel-grupo-pensionista">
                                <p:panel id="painel-pensionista" header="#{pensionista.matriculaFP}">

                                    <div class="alinhamentoDireita">
                                        <p:commandButton id="btn-remover-pensionista" title="Remover Pensionista"
                                                         value="Remover"
                                                         process="@this"
                                                         update="@form"
                                                         actionListener="#{pensaoControlador.removerItemPensao(pensionista)}"
                                                         onclick="if (!confirm('Tem certeza que deseja remover este registro?'))
                                                                  {return false; } else {aguarde.show();}"
                                                         oncomplete="aguarde.hide()"
                                                         icon="ui-icon-trash"
                                                         styleClass="padrao"/>
                                    </div>

                                    <h:panelGrid id="painel-grid-pensionista" columns="2">

                                        <fc:outputLabelObrigatorio for="tipopensao" value="Tipo da Pensão:"/>
                                        <h:selectOneMenu id="tipopensao" value="#{pensionista.tipoPensao}">
                                            <f:selectItems value="#{pensaoControlador.listaTiposPensao}"/>
                                            <p:ajax event="change" process="@this" update="grauDeParentesco"/>
                                        </h:selectOneMenu>

                                        <fc:outputLabelObrigatorio value="Tipo de Fundamentação:"/>
                                        <h:selectOneMenu id="tipoFundamentacao"
                                                         value="#{pensionista.tipoFundamentacao}">
                                            <f:selectItems value="#{pensaoControlador.listaTiposFundamentacao}"/>
                                            <p:ajax process="painel-grupo-pensionista"
                                                    onstart="aguarde.show();"
                                                    oncomplete="aguarde.hide();"
                                                    listener="#{pensaoControlador.definirTipoReajusteAposentadoria(pensionista)}"
                                                    update="tipoReajuste"
                                                    event="change"/>
                                        </h:selectOneMenu>

                                        <fc:outputLabelObrigatorio value="Tipo de Reajuste:"/>
                                        <h:outputText id="tipoReajuste" styleClass="negrito"
                                                      value="#{pensionista.tipoReajusteAposentadoria.descricao}"/>

                                        <fc:outputLabelObrigatorio for="matricula" value="Matrícula do Pensionista:"/>
                                        <h:panelGroup>
                                            <p:autoComplete queryDelay="1000" id="matricula"
                                                            completeMethod="#{pensaoControlador.completaMatricula}"
                                                            value="#{pensionista.matriculaFP}"
                                                            var="matricula"
                                                            itemLabel="#{matricula.matricula} - #{matricula.pessoa.nome} - #{matricula.unidadeMatriculado.descricao}"
                                                            itemValue="#{matricula.id}"
                                                            converter="#{pensaoControlador.converterMatricula}"
                                                            forceSelection="true"
                                                            size="70"
                                                            styleClass="mrig05"
                                                            style="font-weight: bolder">
                                                <p:ajax update="painel-grupo-pensionista"
                                                        process="painel-grupo-pensionista"
                                                        event="itemSelect"
                                                        onstart="aguarde.show();"
                                                        oncomplete="aguarde.hide();"
                                                        listener="#{pensaoControlador.atribuiValoresUsandoMatricula(pensionista)}"/>
                                            </p:autoComplete>

                                            <p:commandButton id="bt-novo-matriculafp-pensionista"
                                                             icon="ui-icon-circle-plus"
                                                             title="Clique para inserir um novo registro."
                                                             styleClass="mrig05"
                                                             update="@none"
                                                             process="@none"
                                                             onclick="window.open('#{request.contextPath}/matriculafp-pensionista/novo/', '_blank')"/>
                                        </h:panelGroup>

                                        <h:outputText value="Data de Nasc.:"/>
                                        <h:outputText id="dataNascimentoPensionista"
                                                      value="#{pensionista.matriculaFP.pessoa.dataNascimento}">
                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                        </h:outputText>

                                        <h:outputText value="Tipo:"/>
                                        <h:outputText value="#{pensaoControlador.selecionado.tipoPensionista}"
                                                      id="tipoPensionista"/>

                                        <h:outputText value="Número Cont.:"/>
                                        <p:inputText id="contrato" disabled="true"
                                                     value="#{pensionista.numero}"/>

                                        <h:outputLabel value="Conta Corrente Bancária:"/>
                                        <h:panelGroup>
                                            <h:selectOneMenu value="#{pensionista.contaCorrente}"
                                                             title="Selecione a conta corrente, quando não selecionada, para a geração do crédito de salario, o sistema irá recuperar a conta principal da pessoa"
                                                             id="contaCorrente"
                                                             converter="#{contratoFPControlador.converterConta}"
                                                             readonly="#{pensionista eq null}">
                                                <f:selectItems
                                                    value="#{pensaoControlador.contasCorrentesBancarias(pensionista)}"/>
                                                <p:ajax process="@this"
                                                        onstart="aguarde.show();"
                                                        oncomplete="aguarde.hide();"/>
                                            </h:selectOneMenu>
                                            <p:commandButton id="addContaCorrente" style="margin-left: 2px"
                                                             update="@this"
                                                             disabled="#{pensionista eq null}"
                                                             process="@this"
                                                             icon="ui-icon-circle-plus"
                                                             actionListener="#{pensaoControlador.novaContaCorrente(pensionista)}"/>
                                        </h:panelGroup>

                                        <fc:outputLabelObrigatorio for="grauDeParentesco" value="Grau de Parentesco:"/>
                                        <h:panelGroup>
                                            <p:autoComplete queryDelay="1000" id="grauDeParentesco"
                                                            completeMethod="#{pensaoControlador.completaGrauDeParentesco}"
                                                            value="#{pensionista.grauParentescoPensionista}"
                                                            var="parentesco"
                                                            itemLabel="#{parentesco}"
                                                            itemValue="#{parentesco.id}"
                                                            converter="#{pensaoControlador.converterGrauParentescoPensionista}"
                                                            forceSelection="true"
                                                            size="70"
                                                            styleClass="mrig05"
                                                            style="font-weight: bolder">
                                                <p:ajax event="itemSelect"
                                                        process="painel-grupo-pensionista"
                                                        update="painel-grupo-pensionista"
                                                        listener="#{pensaoControlador.setaDataFinalVigencia(pensionista)}"/>
                                            </p:autoComplete>

                                            <p:commandButton id="bt-novo-grau-parentesco-pensionista"
                                                             icon="ui-icon-circle-plus"
                                                             title="Clique para inserir um novo registro."
                                                             styleClass="mrig05"
                                                             update="@none"
                                                             process="@none"
                                                             onclick="window.open('#{request.contextPath}/grauparentescopensionista/novo/', '_blank')"/>
                                        </h:panelGroup>

                                        <h:outputText value="Data de Óbito do Instituidor:"/>
                                        <h:outputText value="#{pensaoControlador.dataDeObito}">
                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                        </h:outputText>

                                        <fc:outputLabelObrigatorio value="Início de Vigência:"/>
                                        <p:calendar onkeypress="mascara(this, Data)"
                                                    maxlength="10"
                                                    size="10"
                                                    navigator="true"
                                                    pattern="dd/MM/yyyy"
                                                    id="inicioVigenciaPensionista"
                                                    value="#{pensionista.inicioVigencia}">
                                            <p:ajax event="dateSelect"
                                                    onstart="aguarde.show()"
                                                    oncomplete="aguarde.hide()"
                                                    process="@this"
                                                    update=":Formulario:tab-view-geral :Formulario:tab-view-geral:panelGridAtoLegal"/>
                                            <p:ajax event="valueChange"
                                                    process="@this"
                                                    onstart="aguarde.show()"
                                                    oncomplete="aguarde.hide()"
                                                    update=":Formulario:tab-view-geral :Formulario:tab-view-geral:panelGridAtoLegal"/>
                                        </p:calendar>

                                        <h:outputText value="Final de Vigência:"/>
                                        <p:calendar onkeypress="mascara(this, Data)"
                                                    maxlength="10"
                                                    size="10"
                                                    navigator="true"
                                                    pattern="dd/MM/yyyy"
                                                    id="finalvigencia"
                                                    value="#{pensionista.finalVigencia}">
                                            <p:ajax event="dateSelect"
                                                    onstart="aguarde.show()"
                                                    oncomplete="aguarde.hide()"
                                                    process="@this"
                                                    update=":Formulario:tab-view-geral:panelGridAtoLegal"/>
                                            <p:ajax event="valueChange"
                                                    update=":Formulario:tab-view-geral:panelGridAtoLegal"
                                                    onstart="aguarde.show()"
                                                    oncomplete="aguarde.hide()"
                                                    process="@this"/>
                                        </p:calendar>

                                        <h:outputText value="IR sobre Múltiplos Vínculos:"/>
                                        <h:panelGroup>
                                            <h:selectBooleanCheckbox
                                                title="Se marcado esta opção, o sistema irá acumular o valor do imposto de renda de outros vínculos para o vínculo atual(este)."
                                                value="#{pensionista.descontarIrMultiploVinculo}"
                                                id="descontar-ir-multiplos-vinculos">
                                            </h:selectBooleanCheckbox>

                                            <p:commandButton icon="ui-icon-info"
                                                             id="info-ir"
                                                             styleClass="mrig05"
                                                             process="@none"
                                                             update="@none"
                                                             style="width: 20px; height: 20px; margin-left: 5px!important; "/>

                                            <p:overlayPanel at="right"
                                                            for="info-ir"
                                                            showEvent="mouseover"
                                                            dynamic="false"
                                                            style="width: 250px;">
                                                <h:outputText
                                                    value="Se marcado esta opção, o sistema irá acumular o valor do imposto de renda de outros vínculos para o vínculo atual(este). Deve ser marcado somente um dos vínculos!"
                                                    escape="false"/>
                                            </p:overlayPanel>
                                        </h:panelGroup>

                                        <h:outputText value="Não Acumular Multiplo Vínculo:"/>
                                        <h:panelGroup>
                                            <h:selectBooleanCheckbox
                                                title="Se marcado esta opção, o sistema não irá acumular o valor do IRRF de outros vínculos"
                                                value="#{pensionista.descontarIRRFMultiploVinculo}"
                                                id="descontar-irrf-multiplos-vinculos">
                                            </h:selectBooleanCheckbox>

                                            <p:commandButton icon="ui-icon-info"
                                                             id="info-irrf"
                                                             styleClass="mrig05"
                                                             process="@none"
                                                             update="@none"
                                                             style="width: 20px; height: 20px; margin-left: 5px!important; "/>

                                            <p:overlayPanel at="right"
                                                            for="info-irrf"
                                                            showEvent="mouseover"
                                                            dynamic="false"
                                                            style="width: 250px;">
                                                <h:outputText
                                                    value="Se marcado esta opção, o sistema não irá acumular o valor do IRRF de outros vínculos."
                                                    escape="false"/>
                                            </p:overlayPanel>
                                        </h:panelGroup>


                                    </h:panelGrid>

                                    <p:tabView activeIndex="#{pensionista.activeIndex}" id="tab">
                                        <p:tab title="Valores do Pensionista" id="tab-valores-pensionista">
                                            <h:panelGroup id="painel-grupo-valor-pensionista">

                                                <p:commandButton value="Novo Valor"
                                                                 icon="ui-icon-circle-plus"
                                                                 onclick="aguarde.show();"
                                                                 oncomplete="aguarde.hide();"
                                                                 actionListener="#{pensaoControlador.criarNovoValorPensionsita(pensionista)}"
                                                                 disabled="#{pensionista.itemValorPensionista ne null}"
                                                                 process="@this"
                                                                 update="painel-grupo-valor-pensionista"
                                                                 styleClass="padrao"/>

                                                <p:panel rendered="#{pensionista.itemValorPensionista ne null}"
                                                         header="Novo/Editar Valor"
                                                         styleClass="mtop05 mbot05"
                                                         id="painelValores">

                                                    <h:panelGrid columns="2">
                                                        <fc:outputLabelObrigatorio value="Início da Vigência"
                                                                                   for="inicioVigenciaVAlor"/>
                                                        <p:calendar onkeypress="mascara(this, Data)"
                                                                    maxlength="10"
                                                                    size="10"
                                                                    pattern="dd/MM/yyyy"
                                                                    navigator="true"
                                                                    value="#{pensionista.itemValorPensionista.inicioVigencia}"
                                                                    id="inicioVigenciaVAlor">
                                                        </p:calendar>

                                                        <h:outputText value="Final da Vigência"/>
                                                        <p:calendar onkeypress="mascara(this, Data)"
                                                                    maxlength="10"
                                                                    size="10"
                                                                    pattern="dd/MM/yyyy"
                                                                    navigator="true"
                                                                    value="#{pensionista.itemValorPensionista.finalVigencia}"
                                                                    id="finalVigenciaVAlor">
                                                        </p:calendar>

                                                        <fc:outputLabelObrigatorio value="Verba:"/>
                                                        <h:selectOneMenu id="verba"
                                                                         value="#{pensionista.itemValorPensionista.eventoFP}"
                                                                         converter="#{eventoFPControlador.converterGenerico}">
                                                            <f:selectItems value="#{eventoFPControlador.eventos}"/>
                                                        </h:selectOneMenu>

                                                        <h:outputText value="Valor Restante da Pensão (R$):"/>
                                                        <h:outputText id = "valorRestantePensao"
                                                            value="#{pensaoControlador.valorRestanteDaPensao}">
                                                            <f:convertNumber pattern="#,###,##0.00"/>
                                                        </h:outputText>

                                                        <fc:outputLabelObrigatorio for="val" value="Valor:"/>
                                                        <p:inputText
                                                            converter="#{propostaFornecedorControlador.moneyConverter}"
                                                            onkeydown="mascaraMonetaria(this);"
                                                            value="#{pensionista.itemValorPensionista.valor}"
                                                            id="val" style="text-align: right">
                                                            <p:ajax event="blur"
                                                                    update="painel-grupo-valor-pensionista"
                                                                    process="painel-grupo-valor-pensionista"
                                                                    listener="#{pensaoControlador.aplicarValorPercentual(pensionista)}"/>
                                                        </p:inputText>

                                                        <h:outputText value="ou %:"/>
                                                        <p:inputText id="percent"
                                                                     value="#{pensionista.percentual}"
                                                                     style="text-align: right">
                                                            <p:ajax event="blur"
                                                                    update="painel-grupo-valor-pensionista"
                                                                    onstart="aguarde.show();"
                                                                    oncomplete="aguarde.hide();"
                                                                    process="painel-grupo-valor-pensionista"
                                                                    listener="#{pensaoControlador.aplicarPercentualValor(pensionista)}"/>
                                                        </p:inputText>

                                                    </h:panelGrid>

                                                    <h:outputText
                                                        value="#{pensaoControlador.mensagemErroDialogValorPensionista}"
                                                        rendered="#{pensaoControlador.mensagemErroDialogValorPensionista.length() > 0}"
                                                        style="color: red"/>

                                                    <p:commandButton value="Confirmar"
                                                                     icon="ui-icon-circle-plus"
                                                                     styleClass="mtop10 mrig05 padrao"
                                                                     onclick="aguarde.show()"
                                                                     oncomplete="aguarde.hide()"
                                                                     process="painel-grupo-valor-pensionista"
                                                                     update="painel-grupo-valor-pensionista"
                                                                     actionListener="#{pensaoControlador.adicionarItemValorPensionista(pensionista)}"/>

                                                    <p:commandButton value="Cancelar"
                                                                     icon="ui-icon-cancel"
                                                                     id="btn-cancelar-valorr"
                                                                     styleClass="mtop10 mrig05 padrao"
                                                                     actionListener="#{pensaoControlador.cancelarValorPensionista(pensionista)}"
                                                                     title="clique para cancelar."
                                                                     onclick="aguarde.show()"
                                                                     oncomplete="aguarde.hide()"
                                                                     update="painel-grupo-valor-pensionista"/>
                                                </p:panel>

                                                <p:dataTable id="itensValor"
                                                             paginator="true"
                                                             editable="true"
                                                             rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada trintaAltura' : 'trintaAltura'}"
                                                             rowIndexVar="rowIx"
                                                             styleClass="mtop05"
                                                             emptyMessage="Não foram localizados registros para serem apresentados"
                                                             value="#{pensionista.itensValorPensionista}"
                                                             rows="10"
                                                             paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>VALORES&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                             currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                                             rowsPerPageTemplate="10,25,50,100"
                                                             var="itemValor">

                                                    <p:column style="width:8%; text-align: center" headerText="Ações">
                                                        <p:commandButton icon="ui-icon-pencil"
                                                                         onstart="aguarde.show();"
                                                                         oncomplete="aguarde.hide();"
                                                                         actionListener="#{pensaoControlador.editarItemValorPensionista(pensionista,itemValor)}"
                                                                         process="itensValor"
                                                                         update=":Formulario:tab-view-geral">
                                                        </p:commandButton>
                                                        <p:commandButton icon="ui-icon-trash"
                                                                         onstart="aguarde.show();"
                                                                         oncomplete="aguarde.hide();"
                                                                         actionListener="#{pensaoControlador.removerItemValorPensionista(pensionista,itemValor)}"
                                                                         process="itensValor"
                                                                         update="itensValor">
                                                        </p:commandButton>
                                                    </p:column>
                                                    <p:column headerText="Verba Pagamento">
                                                        <p:cellEditor>
                                                            <f:facet name="output">
                                                                <h:outputText value="#{itemValor.eventoFP}"/>
                                                            </f:facet>
                                                            <f:facet name="input">
                                                                <h:selectOneMenu value="#{itemValor.eventoFP}"
                                                                                 converter="#{eventoFPControlador.converterGenerico}">
                                                                    <f:selectItems
                                                                        value="#{eventoFPControlador.eventos}"/>
                                                                </h:selectOneMenu>
                                                            </f:facet>
                                                        </p:cellEditor>
                                                    </p:column>
                                                    <p:column style="text-align: center" headerText="Verba Principal">
                                                        <h:selectBooleanCheckbox
                                                            title="Verba Principal. Atenção, o sistema irá somar todos os valores que estão marcados como verba principal a verba que tem a chamada do valor do pensionista."
                                                            value="#{itemValor.verbaPrincipal}" id="verbaPrincipal"/>
                                                    </p:column>
                                                    <p:column headerText="Início de Vigência">
                                                        <h:outputText value="#{itemValor.inicioVigencia}">
                                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                        </h:outputText>
                                                    </p:column>
                                                    <p:column headerText="Final de Vigência">
                                                        <p:cellEditor>
                                                            <f:facet name="output">
                                                                <h:outputText value="#{itemValor.finalVigencia}">
                                                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                                </h:outputText>
                                                            </f:facet>
                                                            <f:facet name="input">
                                                                <p:calendar onkeypress="mascara(this, Data)"
                                                                            maxlength="10"
                                                                            id="finalVigenciaPrevEdit"
                                                                            pattern="dd/MM/yyyy"
                                                                            value="#{itemValor.finalVigencia}"/>
                                                            </f:facet>
                                                        </p:cellEditor>
                                                    </p:column>
                                                    <p:column headerText="Valor (R$)">
                                                        <h:outputText value="#{itemValor.valor}" style="float: right">
                                                            <f:convertNumber pattern="#,###,###,##0.00"/>
                                                        </h:outputText>
                                                    </p:column>
                                                </p:dataTable>
                                            </h:panelGroup>
                                        </p:tab>

                                        <p:tab title="Lotação Administrativa" d="tab-lotacao-administrativa">
                                            <h:panelGroup id="painel-grupo-lotacao-administrativa">
                                                <p:commandButton value="Nova Lotação Administrativa"
                                                                 icon="ui-icon-circle-plus"
                                                                 styleClass="padrao"
                                                                 onclick="aguarde.show()"
                                                                 oncomplete="aguarde.hide()"
                                                                 immediate="true"
                                                                 actionListener="#{pensaoControlador.criarNovaLotacao(pensionista)}"
                                                                 process="painel-grupo-lotacao-administrativa"
                                                                 update="painel-grupo-lotacao-administrativa"/>

                                                <p:panel rendered="#{pensionista.lotacaoFuncional ne null}"
                                                         header="Nova/Editar Lotação Administrativa"
                                                         styleClass="mtop05 mbot05">

                                                    <h:panelGrid id="painel-grid-lotacao-administrativa" columns="2">
                                                        <fc:outputLabelObrigatorio value="Início da Vigência:"/>
                                                        <p:calendar onkeypress="mascara(this, Data)" maxlength="10"
                                                                    title="Informe o início da vigência"
                                                                    value="#{pensionista.lotacaoFuncional.inicioVigencia}"
                                                                    navigator="true" pattern="dd/MM/yyyy"
                                                                    id="inicioVigenciaLotacao" size="20"/>

                                                        <h:outputText value="Final da Vigência:"/>
                                                        <p:calendar onkeypress="mascara(this, Data)" maxlength="10"
                                                                    title="Informe o final da vigência"
                                                                    value="#{pensionista.lotacaoFuncional.finalVigencia}"
                                                                    navigator="true" pattern="dd/MM/yyyy"
                                                                    id="finalVigenciaLotacao" size="20"/>

                                                        <fc:outputLabelObrigatorio for="lotacaoExercicio"
                                                                                   value="Unidade Organizacional (Administrativa):"/>
                                                        <p:autoComplete queryDelay="1000" id="lotacaoExercicio"
                                                                        value="#{pensaoControlador.hierarquiaOrganizacional}"
                                                                        completeMethod="#{pensaoControlador.completaHierarquiaOrganizacionalAdministrativa}"
                                                                        converter="#{pensaoControlador.converterHierarquiaOrganizacional}"
                                                                        var="ho"
                                                                        forceSelection="true"
                                                                        itemValue="#{ho.id}"
                                                                        itemLabel="#{ho}"
                                                                        maxResults="10"
                                                                        size="70">
                                                            <p:ajax process="@this" event="blur"/>
                                                        </p:autoComplete>
                                                    </h:panelGrid>

                                                    <p:commandButton id="adicionarLotacaoFuncional" value="Confirmar"
                                                                     styleClass="mtop10"
                                                                     onstart="aguarde.show();"
                                                                     oncomplete="aguarde.hide();"
                                                                     icon="ui-icon-circle-plus"
                                                                     actionListener="#{pensaoControlador.addLotacao(pensionista)}"
                                                                     update="painel-grupo-lotacao-administrativa"/>
                                                    <p:commandButton value="Cancelar"
                                                                     icon="ui-icon-cancel"
                                                                     id="btn-cancelar-lotacao"
                                                                     styleClass="mtop10"
                                                                     actionListener="#{pensaoControlador.cancelarLotacao(pensionista)}"
                                                                     title="clique para cancelar."
                                                                     onclick="aguarde.show()"
                                                                     oncomplete="aguarde.hide()"
                                                                     process="@this"
                                                                     update="painel-grupo-lotacao-administrativa"/>
                                                </p:panel>

                                                <p:dataTable id="tabelaLotacaoFuncional"
                                                             paginator="true"
                                                             rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada trintaAltura' : 'trintaAltura'}"
                                                             rowIndexVar="rowIx"
                                                             styleClass="mtop05"
                                                             emptyMessage="Não foram localizados registros para serem apresentados"
                                                             value="#{pensionista.lotacaoFuncionals}"
                                                             rows="10"
                                                             paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>LOTAÇÕES ADMINISTRATIVA&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                             currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                                             rowsPerPageTemplate="10,25,50,100"
                                                             var="l">

                                                    <p:column style="width:8%; text-align: center" headerText="Ações">
                                                        <p:commandButton icon="ui-icon-pencil"
                                                                         onstart="aguarde.show();"
                                                                         oncomplete="aguarde.hide();"
                                                                         actionListener="#{pensaoControlador.editarLotacaoFuncional(pensionista,l)}"
                                                                         process="tabelaLotacaoFuncional"
                                                                         update="@form">
                                                        </p:commandButton>
                                                        <p:commandButton icon="ui-icon-trash"
                                                                         onstart="aguarde.show();"
                                                                         oncomplete="aguarde.hide();"
                                                                         actionListener="#{pensaoControlador.removeLotacaoFuncional(pensionista,l)}"
                                                                         process="tabelaLotacaoFuncional"
                                                                         update="@form">
                                                        </p:commandButton>
                                                    </p:column>
                                                    <p:column headerText="Unidade Organizacional">
                                                        <h:outputText
                                                            value="#{pensaoControlador.hierarquiaPai(l.unidadeOrganizacional).codigo} - #{l.unidadeOrganizacional}"/>
                                                    </p:column>
                                                    <p:column style="width:12%; text-align: center"
                                                              headerText="Início da Vigência">
                                                        <h:outputText value="#{l.inicioVigencia}">
                                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                        </h:outputText>
                                                    </p:column>
                                                    <p:column headerText="Final Vigência"
                                                              style="width:12%; text-align: center">
                                                        <h:outputText value="#{l.finalVigencia}">
                                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                        </h:outputText>
                                                    </p:column>
                                                </p:dataTable>
                                            </h:panelGroup>
                                        </p:tab>

                                        <p:tab title="Lotação Orçamentária" id="tab-lotacao-orcamentaria">
                                            <h:panelGroup id="painel-grupo-lotacao-orcamentaria">
                                                <p:commandButton value="Nova Lotação Orçamentária"
                                                                 icon="ui-icon-circle-plus"
                                                                 onclick="aguarde.show();"
                                                                 oncomplete="aguarde.hide();"
                                                                 actionListener="#{pensaoControlador.criarNovoRecursoDoVinculo(pensionista)}"
                                                                 process="painel-grupo-lotacao-orcamentaria"
                                                                 update="painel-grupo-lotacao-orcamentaria"/>

                                                <p:panel rendered="#{pensionista.recursoDoVinculoFP ne null}"
                                                         header="Nova/Editar Lotação Orçamentária"
                                                         styleClass="mtop05 mbot05">
                                                    <h:panelGrid id="painel-grid-lotacao" columns="2">
                                                        <fc:outputLabelObrigatorio value="Início da Vigência:"/>
                                                        <p:calendar onkeypress="mascara(this, Data)" maxlength="10"
                                                                    title="Informe o início da vigência"
                                                                    value="#{pensionista.recursoDoVinculoFP.inicioVigencia}"
                                                                    navigator="true" pattern="dd/MM/yyyy"
                                                                    id="inicioVigenciaRecursoDoVinculo" size="20"/>

                                                        <h:outputText value="Final da Vigência:"/>
                                                        <p:calendar onkeypress="mascara(this, Data)" maxlength="10"
                                                                    title="Informe o final da vigência"
                                                                    value="#{pensionista.recursoDoVinculoFP.finalVigencia}"
                                                                    navigator="true" pattern="dd/MM/yyyy"
                                                                    id="finalVigenciaRecursoDoVinculo" size="20"/>

                                                        <fc:outputLabelObrigatorio
                                                            value="Lotação Orçamentária(Recurso FP): "/>
                                                        <p:autoComplete queryDelay="1000" id="recursoFP"
                                                                        title="Digite o nome do recurso fp"
                                                                        value="#{pensionista.recursoDoVinculoFP.recursoFP}"
                                                                        completeMethod="#{recursoFPControlador.completaRecursoFP}"
                                                                        var="recurso"
                                                                        itemLabel="#{recurso}"
                                                                        itemValue="#{recurso.id}"
                                                                        forceSelection="true"
                                                                        size="70"
                                                                        converter="#{recursoFPControlador.converterRecursoFP}"/>

                                                    </h:panelGrid>
                                                    <p:commandButton id="adicionarRecursoDoVinculo" value="Confirmar"
                                                                     styleClass="mtop10"
                                                                     onstart="aguarde.show();"
                                                                     oncomplete="aguarde.hide();"
                                                                     icon="ui-icon-circle-plus"
                                                                     actionListener="#{pensaoControlador.addRecursoDoVinculoFP(pensionista)}"
                                                                     process="painel-grupo-lotacao-orcamentaria"
                                                                     update="painel-grupo-lotacao-orcamentaria"/>
                                                    <p:commandButton value="Cancelar"
                                                                     icon="ui-icon-cancel"
                                                                     id="btn-cancelar-recursofp"
                                                                     styleClass="mtop10"
                                                                     actionListener="#{pensaoControlador.cancelarRecursoDoVinculo(pensionista)}"
                                                                     title="clique para cancelar."
                                                                     onclick="aguarde.show()"
                                                                     oncomplete="aguarde.hide()"
                                                                     process="painel-grupo-lotacao-orcamentaria"
                                                                     update="painel-grupo-lotacao-orcamentaria"/>

                                                </p:panel>

                                                <p:dataTable id="tabelaRecursoDoVinculo"
                                                             paginator="true"
                                                             rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada trintaAltura' : 'trintaAltura'}"
                                                             rowIndexVar="rowIx"
                                                             styleClass="mtop05"
                                                             emptyMessage="Não foram localizados registros para serem apresentados"
                                                             value="#{pensionista.recursosDoVinculoFP}"
                                                             rows="10"
                                                             paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>LOTAÇÕES ORÇAMENTÁRIAS&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                             currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                                             rowsPerPageTemplate="10,25,50,100"
                                                             var="l">

                                                    <p:column style="width:8%; text-align: center" headerText="Ações">
                                                        <p:commandButton icon="ui-icon-pencil"
                                                                         onstart="aguarde.show();"
                                                                         oncomplete="aguarde.hide();"
                                                                         actionListener="#{pensaoControlador.editarRecursoDoVinculoFP(pensionista,l)}"
                                                                         process="tabelaRecursoDoVinculo"
                                                                         update=":Formulario:tab-view-geral">
                                                        </p:commandButton>
                                                        <p:commandButton icon="ui-icon-trash"
                                                                         onstart="aguarde.show();"
                                                                         oncomplete="aguarde.hide();"
                                                                         actionListener="#{pensaoControlador.removeRecursoDoVinculoFP(pensionista,l)}"
                                                                         process="tabelaRecursoDoVinculo"
                                                                         update="tabelaRecursoDoVinculo">
                                                        </p:commandButton>
                                                    </p:column>
                                                    <p:column headerText="Recurso Folha de Pagamento">
                                                        <h:outputText value="#{l.recursoFP}"/>
                                                    </p:column>
                                                    <p:column style="width:12%; text-align: center"
                                                              headerText="Início da Vigência">
                                                        <h:outputText value="#{l.inicioVigencia}">
                                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                        </h:outputText>
                                                    </p:column>
                                                    <p:column headerText="Final Vigência"
                                                              style="width:12%; text-align: center">
                                                        <h:outputText value="#{l.finalVigencia}">
                                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                        </h:outputText>
                                                    </p:column>
                                                </p:dataTable>

                                            </h:panelGroup>
                                        </p:tab>

                                        <p:tab id="tab-invalidez-pensionista" title="Invalidez Do Pensionista">
                                            <p:outputPanel id="painel-grupo-invalidez">
                                                <p:commandButton value="Nova Invalidez"
                                                                 icon="ui-icon-circle-plus"
                                                                 onclick="aguarde.show();"
                                                                 oncomplete="aguarde.hide();"
                                                                 actionListener="#{pensaoControlador.criarNovaInvalidez(pensionista)}"
                                                                 process="@this"
                                                                 update="painel-grupo-invalidez"/>

                                                <p:panel rendered="#{pensionista.invalidezPensao ne null}"
                                                         header="Nova/Editar Invalidez"
                                                         styleClass="mtop05 mbot05"
                                                         id="painelInvalidez">

                                                    <h:panelGrid columns="2">
                                                        <fc:outputLabelObrigatorio value="Início da Vigência:"
                                                                                   for="inicioVigenciaInvalidez"/>
                                                        <p:calendar onkeypress="mascara(this, Data)" maxlength="10"
                                                                    title="Digite o início da vigência da invalidez"
                                                                    value="#{pensionista.invalidezPensao.inicioVigencia}"
                                                                    navigator="true"
                                                                    pattern="dd/MM/yyyy" size="10"
                                                                    id="inicioVigenciaInvalidez"/>

                                                        <h:outputText value="Final da Vigência:"/>
                                                        <p:calendar onkeypress="mascara(this, Data)" maxlength="10"
                                                                    title="Digite o final da vigência da invalidez"
                                                                    value="#{pensionista.invalidezPensao.finalVigencia}"
                                                                    navigator="true"
                                                                    pattern="dd/MM/yyyy" size="10"
                                                                    id="finalVigenciaInvalidez"/>

                                                        <fc:outputLabelObrigatorio for="cid" value="CID:"/>
                                                        <p:autoComplete queryDelay="1000" widgetVar="cid" id="cid"
                                                                        title="Digite o CID"
                                                                        value="#{pensionista.cids}"
                                                                        completeMethod="#{pensaoControlador.completaCids}"
                                                                        var="cid" size="70"
                                                                        itemLabel="#{cid}"
                                                                        itemValue="#{cid.id}"
                                                                        multiple="true"
                                                                        styleClass="auto-complete-multiple"
                                                                        converter="#{pensaoControlador.converterCid}">
                                                            <p:ajax process="@this" event="itemSelect"/>
                                                        </p:autoComplete>

                                                        <fc:outputLabelObrigatorio for="medico" value="Médico:"/>
                                                        <h:panelGrid columns="2"
                                                                     cellpadding="0"
                                                                     cellspacing="0"
                                                                     id="dataInvalidez">
                                                            <p:dataList
                                                                rendered="#{pensaoControlador.listInvalidezMedico.size() ne 0 }"
                                                                value="#{pensaoControlador.listInvalidezMedico}"
                                                                var="invalidez"
                                                                type="definition">
                                                                #{invalidez.getMedicos()}
                                                            </p:dataList>
                                                            <p:commandButton icon="ui-icon-circle-plus"
                                                                             title="Clique para adicionar Médicos"
                                                                             oncomplete="DlgInvalidezMedico.show()"
                                                                             styleClass="mlef05"
                                                                             update=":Formulario-invalidez"
                                                                             process=":Formulario-invalidez"/>
                                                        </h:panelGrid>
                                                        <h:outputText
                                                            rendered="#{pensaoControlador.isPossuiDeficiencia(pensionista)}"
                                                            value="Deficência:"/>
                                                        <h:outputText
                                                            rendered="#{pensaoControlador.isPossuiDeficiencia(pensionista)}"
                                                            style="color: blueviolet"
                                                            value="#{pensaoControlador.getDescricaoDeficiencia(pensionista)}"/>

                                                        <h:outputText value="Isento de IRRF:"/>
                                                        <h:selectBooleanCheckbox title="Isento de IRRF"
                                                                                 value="#{pensionista.invalidezPensao.isentoIRRF}"
                                                                                 id="isentoIRRF"/>

                                                        <h:outputText value="Isento de Previdência:"/>
                                                        <h:panelGrid cellpadding="0"
                                                                     columns="2"
                                                                     cellspacing="0">
                                                            <h:selectBooleanCheckbox
                                                                title="Limitado ao dobro do teto do RGPS."
                                                                value="#{pensionista.invalidezPensao.isentoPrevidencia}"
                                                                id="isentoPrevidencia">
                                                                <p:ajax process="@this" event="change"
                                                                        update="infoPrev"/>
                                                            </h:selectBooleanCheckbox>
                                                            <h:outputText id="infoPrev"
                                                                          style="#{pensionista.invalidezPensao.isentoPrevidencia eq false ? 'display: none' : ''};color:dodgerblue; margin-left: 2px;"
                                                                          value="Limitado ao dobro do teto do RGPS."/>
                                                        </h:panelGrid>

                                                    </h:panelGrid>

                                                    <p:commandButton value="Confirmar"
                                                                     icon="ui-icon-circle-plus"
                                                                     styleClass="mtop10"
                                                                     onclick="aguarde.show()"
                                                                     oncomplete="aguarde.hide()"
                                                                     update="painel-grupo-invalidez"
                                                                     actionListener="#{pensaoControlador.adicionarInvalidez(pensionista)}"
                                                    />

                                                    <p:commandButton value="Cancelar"
                                                                     icon="ui-icon-cancel"
                                                                     id="btn-cancelar-invalidez"
                                                                     styleClass="mtop10"
                                                                     actionListener="#{pensaoControlador.cancelarInvalidez(pensionista)}"
                                                                     title="clique para cancelar."
                                                                     onclick="aguarde.show()"
                                                                     oncomplete="aguarde.hide()"
                                                                     update="painel-grupo-invalidez"/>
                                                </p:panel>

                                                <p:dataTable id="tabelaInvalidezPensao"
                                                             paginator="true"
                                                             editable="true"
                                                             rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada trintaAltura' : 'trintaAltura'}"
                                                             rowIndexVar="rowIx"
                                                             styleClass="mtop05"
                                                             emptyMessage="Não foram localizados registros para serem apresentados"
                                                             value="#{pensionista.listaInvalidez}"
                                                             rows="10"
                                                             paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>LISTA DE INVALIDEZ&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                             currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                                             rowsPerPageTemplate="10,25,50,100"
                                                             var="obj">

                                                    <p:column headerText="Ações" styleClass="alinhamentoCentralizado"
                                                              style="width: 8%">
                                                        <p:commandButton icon="ui-icon-pencil"
                                                                         onstart="aguarde.show();"
                                                                         oncomplete="aguarde.hide();"
                                                                         actionListener="#{pensaoControlador.editarInvalidez(pensionista,obj)}"
                                                                         process="tabelaInvalidezPensao"
                                                                         update="@form">
                                                        </p:commandButton>
                                                        <p:commandButton icon="ui-icon-trash"
                                                                         onstart="aguarde.show();"
                                                                         oncomplete="aguarde.hide();"
                                                                         actionListener="#{pensaoControlador.removerInvalidez(pensionista,obj)}"
                                                                         process="tabelaInvalidezPensao"
                                                                         update="tabelaInvalidezPensao">
                                                        </p:commandButton>
                                                    </p:column>
                                                    <p:column headerText="Início da Vigência" style="width: 12%">
                                                        <h:outputText value="#{obj.inicioVigencia}">
                                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                        </h:outputText>
                                                    </p:column>
                                                    <p:column headerText="Final da Vigência" style="width: 12%">
                                                        <h:outputText value="#{obj.finalVigencia}">
                                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                        </h:outputText>
                                                    </p:column>

                                                    <p:column headerText="CIDs">
                                                        <ui:repeat value="#{obj.cids}"
                                                                   var="cid">
                                                            <h:outputText value="#{cid}"/>
                                                            <br/>
                                                        </ui:repeat>
                                                    </p:column>
                                                    <p:column headerText="Médico">
                                                        <h:outputText value="#{obj.invalidezMedicos}"/>
                                                    </p:column>
                                                    <p:column headerText="Isento IRRF" style="width: 8%">
                                                        <h:outputText value="#{obj.isentoIRRF ? 'Sim' : 'Não'}"/>
                                                    </p:column>
                                                    <p:column headerText="Isento Previdência" style="width: 10%">
                                                        <h:outputText value="#{obj.isentoPrevidencia ? 'Sim' : 'Não'}"/>
                                                    </p:column>

                                                </p:dataTable>
                                            </p:outputPanel>
                                        </p:tab>
                                        <p:tab id="tab-tipo-relacao-instituidor"
                                               title="Tipo de Relação com Instituidor Estudo Atuarial">
                                            <fc:outputLabelObrigatorio
                                                value="Tipo de Relação com Instituidor Estudo Atuarial:"/>
                                            <h:selectOneMenu id="tipoDependenciaCaixaAtuarial"
                                                             value="#{pensionista.tipoDependEstudoAtuarial}">
                                                <f:selectItems
                                                    value="#{pensaoControlador.tiposDependenciasEstudoAtuarial}"
                                                    size="20"/>
                                            </h:selectOneMenu>
                                        </p:tab>
                                    </p:tabView>

                                </p:panel>
                            </h:panelGroup>
                        </ui:repeat>
                    </p:outputPanel>

                    <div style="text-align: center" class="mtop20">

                        <p:commandButton title="Adicinar Pensionista"
                                         id="btn-adicionar-outro-pensionista"
                                         style="width: 170px; height: 38px;"
                                         onclick="aguarde.show();"
                                         oncomplete="aguarde.hide();"
                                         rendered="#{pensaoControlador.selecionado.listaDePensionistas.size() gt 0}"
                                         styleClass="prioritario"
                                         icon="ui-icon-circle-plus"
                                         value="Adicionar outro Pensionista"
                                         update=":Formulario:tab-view-geral"
                                         actionListener="#{pensaoControlador.criarAndAdicionarPensionista}">
                        </p:commandButton>
                    </div>
                </p:tab>
            </p:tabView>

            <fc:rodapePretty controlador="#{pensaoControlador}"/>

        </h:form>
        <p:dialog
            widgetVar="DlgInvalidezMedico"
            modal="true"
            resizable="false"
            position="center"
            closable="false"
            width="850"
            height="350"
            style="position: fixed !important;">
            <h:form id="Formulario-invalidez">
                <p:panel header="Cadastro de Médicos">
                    <p:outputPanel id="panel-invalidezmedico">
                        <h:selectOneRadio value="#{pensaoControlador.selecionarMedico}">
                            <f:selectItem itemLabel="Carregar" itemValue="carregar"/>
                            <f:selectItem itemLabel="Novo" itemValue="novo"/>
                            <p:ajax
                                update="panelgrid-medico panel-invalidezmedico"/>
                        </h:selectOneRadio>
                        <h:panelGrid id="panelgrid-medico" columns="2"
                                     rendered="#{pensaoControlador.selecionarMedico eq 'carregar'}">
                            <fc:outputLabelObrigatorio value="Médico: "/>
                            <p:autoComplete queryDelay="1000" id="completarMedico"
                                            value="#{pensaoControlador.invalidezMedico.medico}"
                                            completeMethod="#{pensaoControlador.completarMedico}"
                                            converter="#{aposentadoriaControlador.converterMedico}"
                                            size="45"
                                            forceSelection="true"
                                            maxResults="10"
                                            var="medico"
                                            itemValue="#{medico}"
                                            itemLabel="#{medico.medico}"/>
                        </h:panelGrid>
                        <h:panelGrid id="panelgrid-invalidezmedico" columns="2"
                                     rendered="#{pensaoControlador.selecionarMedico eq 'novo'}">
                            <h:outputText value="Médico:"/>
                            <p:inputText title="Digite o nome do Médico"
                                         value="#{pensaoControlador.invalidezMedico.nomeMedico}"/>
                            <h:outputText value="Registro CRM:"/>
                            <p:inputText title="Digite o registro CRM"
                                         value="#{pensaoControlador.invalidezMedico.registroCRM}" maxlength="15"
                                         size="20"/>
                        </h:panelGrid>

                        <p:commandButton value="Adicionar"
                                         icon="ui-icon-plus"
                                         onclick="statusDialog.show()"
                                         oncomplete="statusDialog.hide()"
                                         styleClass="mtop05"
                                         actionListener="#{pensaoControlador.adicionarInvalidezMedico}"
                                         update=":Formulario-invalidez tabelaInvalidezMedico"/>
                        <p:commandButton value="Limpar"
                                         icon="ui-icon-trash"
                                         styleClass="mtop05"
                                         actionListener="#{pensaoControlador.limparInvalidesMedico}"
                                         update="panelgrid-medico panel-invalidezmedico"/>
                    </p:outputPanel>
                    <p:dataTable id="tabelaInvalidezMedico"
                                 var="invaMed"
                                 styleClass="mtop05"
                                 value="#{pensaoControlador.listInvalidezMedico}"
                                 editable="true"
                                 paginator="true"
                                 rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha->selecionada' : 'trintaAltura'}"
                                 rowIndexVar="rowlx"
                                 emptyMessage="Não foram localizados registros para serem apresentados"
                                 rows="10"
                                 paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo->tabela mrig10'>INVALIDEZ MÉDICO&lt;/span>
                                 {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                 rowsPerPageTemplate="10,25,50,100">
                        <p:column headerText="Medico">
                            <h:outputText value="#{invaMed.getMedicos()}"/>
                        </p:column>
                        <p:column style="width:8%; text-align: center" headerText="Remover">
                            <p:commandButton icon="ui-icon-trash"
                                             actionListener="#{pensaoControlador.removerInvalidezMedico(invaMed)}"
                                             process="tabelaInvalidezMedico"
                                             update="tabelaInvalidezMedico">
                                <f:attribute value="#{invaMed}" name="objeto"/>
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                    <p:commandButton value="Atualizar"
                                     icon="ui-icon-refresh"
                                     onclick="aguarde.show()"
                                     oncomplete="DlgInvalidezMedico.hide(); aguarde.hide()"
                                     styleClass="mtop05"
                                     update=":Formulario"/>
                </p:panel>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>
