<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
        >
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">

        <h:form id="formDialog">
            <p:panel >

                    <h:panelGrid columns="2">
                    <h:outputText value="Tipo de Cálculo: " />
                    <h:selectOneMenu title="Selecione o Tipo de Cálculo"
                                     value="#{calculoFolhaDePagamentoControlador.tipoCalculo}"
                                     id="tipocalculo" style="width: 100px">
                        <f:selectItems value="#{calculoFolhaDePagamentoControlador.tiposDeCalculo}"/>
                        <p:ajax event="change" onstart="aguarde.show()" oncomplete="aguarde.hide()" update="@form"/>
                    </h:selectOneMenu>

                    <h:outputLabel value="Servidor: " />
                        <p:autoComplete queryDelay="1000" id="contratoFP"
                                        value="#{calculoFolhaDePagamentoControlador.vinculoFP}"
                                        completeMethod="#{consultaFichaFinanceiraControlador.completaContrato}"
                                        converter="#{consultaFichaFinanceiraControlador.converterContratoFP}"
                                        var="contrato"
                                        maxResults="10"
                                        forceSelection="true"
                                        dropdown="true"
                                        itemValue="#{contrato.id}"
                                        itemLabel="#{contrato}"
                                        size="70">
                            <p:ajax event="itemSelect" process="@this" update="@form"
                                    onstart="aguarde.show()"
                                    oncomplete="aguarde.hide()"
                                    listener="#{calculoFolhaDePagamentoControlador.carregarTodosOsVinculos()}"/>
                        </p:autoComplete>

                        <p:commandButton icon="ui-icon-clear" styleClass="operacao mtop05 mlef05"
                                         title="Limpar campos"
                                         value="Limpar"
                                         onstart="aguarde.show();"
                                         oncomplete="aguarde.hide();"
                                         update="@form"
                                         process="@form"
                                         actionListener="#{calculoFolhaDePagamentoControlador.limparFiltros()}"/>

                    </h:panelGrid>


            <p:panel header="Detalhes do Cálculo">
                <h:panelGrid columns="2" >
                    Mês: <h:outputText style="font-weight: bold" value="#{calculoFolhaDePagamentoControlador.selecionado.mes.descricao}"/>
                    Ano: <h:outputText style="font-weight: bold" value="#{calculoFolhaDePagamentoControlador.selecionado.ano}"/>
                    Versão: <h:outputText style="font-weight: bold" value="#{calculoFolhaDePagamentoControlador.selecionado.versao}"/>
                    Tipo de Folha: <h:outputText style="font-weight: bold" value="#{calculoFolhaDePagamentoControlador.selecionado.tipoFolhaDePagamento.descricao}"/>
                    Último Cálculo em: <h:outputText style="font-weight: bold"
                        value="#{calculoFolhaDePagamentoControlador.selecionado.calculadaEm}"><f:convertDateTime
                    pattern="dd/MM/yyyy"/> </h:outputText>
                    Efetivada Em: <h:outputText
                    value="#{calculoFolhaDePagamentoControlador.selecionado.efetivadaEm}"><f:convertDateTime
                    pattern="dd/MM/yyyy"/> </h:outputText>
                </h:panelGrid>
                <hr size="10"/>
                <!--<div id="tabelaDetalhesFolhaPagamento" >-->
                <ui:repeat value="#{calculoFolhaDePagamentoControlador.detalhesCalculoRHListOrdenado}" var="detalhe"
                           varStatus="status">
                    <h:panelGrid columns="2">
                        Data de Calculo: <h:outputText
                            value="#{detalhe.dataCalculo}"><f:convertDateTime
                            pattern="dd/MM/yyyy HH:mm:ss"/> </h:outputText>
                        Meses de Retroação: <h:outputText
                        value="#{detalhe.mesesRetroacao}"/>
                        Total de Registros:
                        <h:panelGroup>
                            <h:outputText
                                value="#{detalhe.totalServidores}"/>
                            <p:spacer width="10"/>
                            <p:commandLink value="(Lista de Servidores)"
                                           id="bt-ver-matriculas"
                                           style="color: #0044cc !important;"
                                           onstart="aguarde.show()" oncomplete="aguarde.hide()"
                                           update=":formMatriculas"
                                           actionListener="#{calculoFolhaDePagamentoControlador.recuperarMatriculasDetalhe(detalhe)}"/>
                        </h:panelGroup>
                        Total Não Calculados <h:outputText
                            value="#{detalhe.totalNaoCalculados}"/>
                        Total Com Problemas Em Algum Evento: <h:outputText
                            value="#{detalhe.totalComProblemasNoCalculo}"/>
                        Usuário Que Iniciou o Cálculo: <h:outputText style="color: firebrick"
                                                                     value="#{detalhe.usuarioSistema.nome}"/>

                        Tipo de Cálculo: <h:outputText value="#{detalhe.filtroFolhaDePagamento.filtroDTO.tipoCalculo}"/>
                        Verbas Bloqueadas : <h:outputText
                        value="#{calculoFolhaDePagamentoControlador.eventosBloqueados(detalhe.filtroFolhaDePagamento.filtroDTO.eventoFPsBloqueadosIds)}"/>

                    </h:panelGrid>
                    <center><h:outputText value="Erros coletados durante o calculo"
                                          style="color: #283744; font-weight: bolder"/></center>
                    <p:dataList var="itens"
                                value="#{detalhe.itensDetalhesErrosCalculos}">
                        <h:outputText style="font-weight: bold" value="#{itens.vinculoFP}"/> <p:spacer height="2"/>
                        <h:outputText value="#{itens.erros}"/> <br/>
                    </p:dataList>
                    <hr/>
                </ui:repeat>
                <!--</div>-->
            </p:panel>
            </p:panel>
            <p:commandButton styleClass="operacao mtop10"
                             icon="ui-icon-cancel"
                             value="Voltar"
                             action="lista"/>
        </h:form>

        <p:dialog widgetVar="dialogMatriculas"
                  modal="true"
                  draggable="false"
                  width="1000"
                  position="center"
                  style="position: fixed !important;"
                  resizable="false"
                  closable="false">
            <h:form id="formMatriculas">
                <p:dataTable value="#{calculoFolhaDePagamentoControlador.mapVinculos.get(calculoFolhaDePagamentoControlador.detalhesCalculoRHSelecionado)}"
                             var="fila"
                             rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                             paginator="true"
                             styleClass="mtop05"
                             rows="10"
                             paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10 maiusculo'>Vínculos&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                             emptyMessage="Não foram localizados registros para serem apresentados."
                             rowIndexVar="rowlx">
                    <p:column headerText="Matricula" filterBy="#{fila.vinculoFP.matriculaFP.matricula}">
                        <h:outputText value="#{fila.vinculoFP.matriculaFP.matricula}"/>
                    </p:column>
                    <p:column headerText="Contrato" filterBy="#{fila.vinculoFP.numero}">
                        <h:outputText value="#{fila.vinculoFP.numero}"/>
                    </p:column>
                    <p:column headerText="Pessoa" filterBy="#{fila.vinculoFP.matriculaFP.pessoa.nome}">
                        <h:outputText value="#{fila.vinculoFP.matriculaFP.pessoa.nome}  (#{fila.vinculoFP.matriculaFP.pessoa.nomeTratamento})" />
                    </p:column>
                </p:dataTable>
                    <p:commandButton value="Cancelar"
                                     styleClass="mtop20"
                                     style="height: 30px;"
                                     icon="ui-icon-cancel"
                                     onstart="aguarde.show()"
                                     oncomplete="aguarde.hide();dialogMatriculas.hide()"/>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>
</html>
