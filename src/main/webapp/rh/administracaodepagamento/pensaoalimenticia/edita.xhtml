<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:rh="http://java.sun.com/jsf/composite/components/rh"
      xmlns:p="http://primefaces.org/ui"
>
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <h:form id="Formulario">
            <fc:cabecalhoPretty origem="#{pensaoAlimenticiaControlador.caminhoPadrao}listar/"
                                controlador="#{pensaoAlimenticiaControlador}"/>
            <p:panel header="Cadastro de Pensão Alimentícia" id="panelGeral">
                <h:panelGrid columns="4">
                    <fc:outputLabelObrigatorio for="contratoFP" value="Instituidor:"/>
                    <rh:auto-complete-vinculofp id="contratoFP"
                                                completeMethod="#{pensaoAlimenticiaControlador.completarInstituidor}"
                                                value="#{pensaoAlimenticiaControlador.selecionado.vinculoFP}"
                                                classe="VinculoFP"
                                                onstart="aguarde.show()"
                                                oncomplete="aguarde.hide()"
                                                update=":Formulario:painelBeneficiario"/>

                    <fc:novoParente destino="/contratofp/novo/"
                                    selecionado="#{pensaoAlimenticiaControlador.selecionado}"
                                    origem="/pensao-alimenticia/novo/"/>
                </h:panelGrid>

                <p:panel id="painelBeneficiario" header="Beneficiário" styleClass="mtop05">
                    <p:commandButton value="Novo"
                                     icon="ui-icon-plus"
                                     title="Clique para adicionar um novo registro."
                                     onstart="aguarde.show()"
                                     oncomplete="aguarde.hide()"
                                     styleClass="padrao"
                                     rendered="#{pensaoAlimenticiaControlador.beneficioPensaoAlimenticia eq null}"
                                     actionListener="#{pensaoAlimenticiaControlador.novoBeneficiario()}"
                                     process=":Formulario:painelBeneficiario :Formulario:panelGeral"
                                     update=":Formulario:painelBeneficiario"/>

                    <h:panelGrid columns="2"
                                 rendered="#{pensaoAlimenticiaControlador.beneficioPensaoAlimenticia ne null}">
                        <fc:outputLabelObrigatorio value="Beneficiário da Pensão Alimentícia:" for="beneficiario"/>
                        <h:panelGroup>
                            <p:autoComplete queryDelay="1000"
                                            id="beneficiario"
                                            completeMethod="#{pensaoAlimenticiaControlador.completarBeneficiariosPensaoAlimenticia}"
                                            value="#{pensaoAlimenticiaControlador.beneficioPensaoAlimenticia.pessoaFisicaBeneficiario}"
                                            var="beneficiario"
                                            itemLabel="#{beneficiario}"
                                            itemValue="#{beneficiario.id}"
                                            converter="#{pensaoAlimenticiaControlador.converterPessoa}"
                                            size="70"
                                            styleClass="mrig02"
                                            process="@this">
                                <p:ajax event="itemSelect"
                                        process="@this"
                                        onstart="aguarde.show()"
                                        oncomplete="aguarde.hide()"
                                        update="painelBeneficiario"
                                        listener="#{pensaoAlimenticiaControlador.verificarInstituidorBeneficiario()}"/>
                            </p:autoComplete>

                            <fc:novoParente destino="/pessoa-pensionista/novo/"
                                            selecionado="#{pensaoAlimenticiaControlador.selecionado}"
                                            origem="/pensao-alimenticia/novo/"/>
                        </h:panelGroup>

                        <h:outputText value="Grau de Parentesco :"/>
                        <h:selectOneMenu
                            value="#{pensaoAlimenticiaControlador.beneficioPensaoAlimenticia.grauParentesco}">
                            <f:selectItems value="#{pensaoAlimenticiaControlador.getGrauDeParentesco()}"/>
                        </h:selectOneMenu>

                        <h:outputText value="Responsável pelo Recebimento :"/>
                        <h:panelGroup>
                            <p:autoComplete queryDelay="1000"
                                            id="responsavel"
                                            completeMethod="#{pensaoAlimenticiaControlador.completarPessoaFisica}"
                                            value="#{pensaoAlimenticiaControlador.beneficioPensaoAlimenticia.pessoaFisicaResponsavel}"
                                            title="Selecione um responsável pelo recebimento."
                                            var="responsavel"
                                            process="@this"
                                            styleClass="mrig05"
                                            itemLabel="#{responsavel}"
                                            itemValue="#{responsavel.id}"
                                            converter="#{pensaoAlimenticiaControlador.converterPessoa}"
                                            size="70"/>

                            <fc:novoParente destino="/pessoa/novo/"
                                            selecionado="#{pensaoAlimenticiaControlador.selecionado}"
                                            origem="/pensao-alimenticia/novo/"/>
                        </h:panelGroup>

                        <fc:outputLabelObrigatorio for="inicioVigencia" value="Início da Vigência:"/>
                        <p:calendar onkeypress="mascara(this, Data)"
                                    maxlength="10"
                                    size="12"
                                    title="Digite o início da pensão."
                                    value="#{pensaoAlimenticiaControlador.beneficioPensaoAlimenticia.inicioVigencia}"
                                    id="inicioVigencia"
                                    pattern="dd/MM/yyyy"
                                    navigator="true"
                                    locale="pt_BR"/>

                        <h:outputText value="Final de Vigência:"/>
                        <p:calendar onkeypress="mascara(this, Data)" maxlength="10"
                                    title="Digite o final da vigência."
                                    size="12"
                                    value="#{pensaoAlimenticiaControlador.beneficioPensaoAlimenticia.finalVigencia}"
                                    id="finalVigencia"
                                    pattern="dd/MM/yyyy"
                                    navigator="true"
                                    locale="pt_BR"/>

                        <fc:outputLabelObrigatorio for="atoLegal" value="Ato Legal:"/>
                        <h:panelGroup>
                            <p:autoComplete queryDelay="1000" id="atoLegal"
                                            completeMethod="#{pensaoAlimenticiaControlador.completarAtoLegal}"
                                            value="#{pensaoAlimenticiaControlador.beneficioPensaoAlimenticia.atoLegal}"
                                            title="Selecione um ato legal"
                                            var="atoLegal"
                                            itemLabel="#{atoLegal}"
                                            itemValue="#{atoLegal.id}"
                                            converter="#{pensaoAlimenticiaControlador.converterAtoLegal}"
                                            size="70"
                                            styleClass="mrig05"
                                            process="@this"/>

                            <p:commandButton style="margin-left: 2px"
                                             update="@this"
                                             process="@this"
                                             onclick="window.open('#{request.contextPath}/atolegal/novo/?sessao=true', '_blank')"
                                             icon="ui-icon-circle-plus"/>
                        </h:panelGroup>

                        <fc:outputLabelObrigatorio value="Conta Corrente Bancária:"/>
                        <h:selectOneMenu title="Selecione a conta corrente"
                                         id="contaCorrente"
                                         value="#{pensaoAlimenticiaControlador.beneficioPensaoAlimenticia.contaCorrenteBancaria}"
                                         converter="#{pensaoAlimenticiaControlador.converterConta}"
                                         style="width: 380px">
                            <f:selectItems value="#{pensaoAlimenticiaControlador.contasCorrentesBancarias}"/>
                        </h:selectOneMenu>

                        <fc:outputLabelObrigatorio value="Verba de Desconto: "/>
                        <h:selectOneMenu title="Selecione um Evento (verba), evento que será efetuado o desconto."
                                         value="#{pensaoAlimenticiaControlador.beneficioPensaoAlimenticia.eventoFP}"
                                         id="eventoFP"
                                         converter="#{pensaoAlimenticiaControlador.converterEventoFP}">
                            <f:selectItems value="#{pensaoAlimenticiaControlador.eventoFP}"/>
                        </h:selectOneMenu>

                        <fc:outputLabelObrigatorio value="Tipo de Valor:"/>
                        <h:selectOneMenu id="tipoValor"
                                         title="Selecione um tipo de valor"
                                         value="#{pensaoAlimenticiaControlador.beneficioPensaoAlimenticia.tipoValorPensaoAlimenticia}">
                            <f:selectItems value="#{pensaoAlimenticiaControlador.tipoValorPensaoAlimenticia}"/>
                        </h:selectOneMenu>

                        <fc:outputLabelObrigatorio value="Hierarquia Organizacional: "/>
                        <p:autoComplete queryDelay="1000"
                                        id="hierarquiaOrg"
                                        completeMethod="#{pensaoAlimenticiaControlador.completarHierarquiaOrganizacional}"
                                        value="#{pensaoAlimenticiaControlador.beneficioPensaoAlimenticia.hierarquiaOrganizacional}"
                                        title="Selecione uma hierarquia organizacional."
                                        var="ho"
                                        itemLabel="#{ho}"
                                        itemValue="#{ho.id}"
                                        converter="#{hierarquiaOrganizacionalControlador.converterHierarquiaOrganizacional}"
                                        size="70"
                                        process="@this"/>
                    </h:panelGrid>

                    <p:commandButton value="Adicionar"
                                     icon="ui-icon-plus"
                                     title="Clique para adicionar este registro."
                                     onclick="aguarde.show()"
                                     oncomplete="aguarde.hide()"
                                     styleClass="padrao mrig05 mtop10"
                                     rendered="#{pensaoAlimenticiaControlador.beneficioPensaoAlimenticia ne null}"
                                     actionListener="#{pensaoAlimenticiaControlador.adicionarBeneficiario}"
                                     process=":Formulario:painelBeneficiario"/>

                    <p:commandButton value="Cancelar"
                                     icon="ui-icon-cancel"
                                     title="Clique para cancelar esta operação."
                                     onclick="aguarde.show()"
                                     oncomplete="aguarde.hide()"
                                     styleClass="padrao mtop10"
                                     rendered="#{pensaoAlimenticiaControlador.beneficioPensaoAlimenticia ne null}"
                                     actionListener="#{pensaoAlimenticiaControlador.cancelarBeneficiario()}"
                                     process="@this"
                                     update=":Formulario:painelBeneficiario"/>

                    <p:dataTable
                        value="#{pensaoAlimenticiaControlador.selecionado.beneficiosPensaoAlimenticia}"
                        var="ben"
                        editable="true"
                        id="itens"
                        paginator="true"
                        rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada trintaAltura' : 'trintaAltura'}"
                        rowIndexVar="rowIx"
                        styleClass="mtop02"
                        emptyMessage="Não foram localizados registros para serem apresentados"
                        rows="10"
                        paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>BENEFICIÁRIOS&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                        currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                        rowsPerPageTemplate="10,25,50,100">
                        <p:column headerText="Ações" style="text-align: center; width: 8%">
                            <p:commandButton icon="ui-icon-pencil"
                                             onstart="aguarde.show()"
                                             oncomplete="aguarde.hide()"
                                             styleClass="mrig05"
                                             actionListener="#{pensaoAlimenticiaControlador.editarBeneficiario(ben)}"
                                             title="Clique para alterar este registro."
                                             id="btEditarDocto"
                                             process="@this"
                                             update=":Formulario:painelBeneficiario :FormularioDialog:itensValor"/>

                            <p:commandButton icon="ui-icon-trash"
                                             update=":FormularioDialog:itensValor :Formulario:itens"
                                             process="@this"
                                             title="Clique para remover este registro."
                                             onclick="if (!confirm('Tem certeza que deseja remover este registro?')) {return false; } else {aguarde.show();}"
                                             oncomplete="aguarde.hide()"
                                             actionListener="#{pensaoAlimenticiaControlador.removerBeneficiario}">
                                <f:attribute value="#{ben}" name="item"/>
                            </p:commandButton>
                        </p:column>
                        <p:column headerText="Beneficiário" styleClass="alinhamentoEsquerda">
                            <h:outputText value="#{ben.pessoaFisicaBeneficiario}"/>
                        </p:column>
                        <p:column headerText="Grau de Parentesco" styleClass="alinhamentoEsquerda">
                            <h:outputText value="#{ben.grauParentesco.toString()}"/>
                        </p:column>
                        <p:column headerText="Responsável" styleClass="alinhamentoEsquerda">
                            <h:outputText value="#{ben.pessoaFisicaResponsavel}"/>
                        </p:column>
                        <p:column headerText="Início de Vigência" styleClass="alinhamentoCentralizado">
                            <h:outputText value="#{ben.inicioVigencia}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Final de Vigência" styleClass="alinhamentoCentralizado">
                            <h:outputText value="#{ben.finalVigencia}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Verba" styleClass="alinhamentodireita">
                            <h:outputText value="#{ben.eventoFP.codigo}"/>
                        </p:column>
                        <p:column headerText="Tipo de Valor" styleClass="alinhamentoEsquerda">
                            <h:outputText value="#{ben.tipoValorPensaoAlimenticia.descricao}"/>
                        </p:column>
                        <p:column headerText="Valor"
                                  styleClass="alinhamentodireita">
                            <p:commandLink id="adicionarLotacao"
                                           update=":FormularioDialog:painelValores"
                                           onclick="aguarde.show()"
                                           actionListener="#{pensaoAlimenticiaControlador.associarValorBeneficio(ben)}"
                                           oncomplete="aguarde.hide(); dlgValorBeneficio.show();">
                                <h:outputText
                                    value="#{pensaoAlimenticiaControlador.recuperarValorVigenteBeneficio(ben)}"/>
                            </p:commandLink>
                        </p:column>
                        <p:column headerText="Conta Bancária">
                            <h:outputText value="#{ben.contaCorrenteBancaria}"/>
                        </p:column>
                        <p:column rendered="#{pensaoAlimenticiaControlador.mostrarBase()}"
                                  headerText="Base"
                                  styleClass="alinhamentoCentralizado">
                            <p:commandLink id="adicionarLotacaoBase"
                                           update=":FormularioDialog:painelValores"
                                           onclick="aguarde.show()"
                                           actionListener="#{pensaoAlimenticiaControlador.associarValorBeneficio(ben)}"
                                           rendered="#{pensaoAlimenticiaControlador.mostrarBase(ben)}"
                                           oncomplete="aguarde.hide(); dlgValorBeneficio.show();">
                                <h:outputText
                                    value="#{pensaoAlimenticiaControlador.recuperarBaseVigenteBeneficio(ben)}"/>
                            </p:commandLink>
                        </p:column>
                        <p:column headerText="Hierarquia Organizacional" styleClass="alinhamentoEsquerda">
                            <h:outputText value="#{ben.hierarquiaOrganizacional}"/>
                        </p:column>
                    </p:dataTable>
                </p:panel>
            </p:panel>

            <fc:rodapePretty id="rpRodapePretty" controlador="#{pensaoAlimenticiaControlador}"/>
        </h:form>

        <p:dialog widgetVar="dlgValorBeneficio"
                  position="center"
                  closable="false"
                  resizable="false"
                  showHeader="false"
                  draggable="false"
                  dynamic="true"
                  style="position: fixed!important;"
                  modal="true"
                  width="900"
                  minHeight="450">
            <h:form id="FormularioDialog">
                <p:panel id="painelValores" header="Valores">
                    <h:panelGrid columns="2" id="valores">
                        <fc:outputLabelObrigatorio value="Início da Vigência: " for="inicioVigenciaVAlor"/>
                        <p:calendar onkeypress="mascara(this, Data)"
                                    maxlength="10"
                                    size="12"
                                    pattern="dd/MM/yyyy"
                                    navigator="true"
                                    value="#{pensaoAlimenticiaControlador.valorPensaoAlimenticia.inicioVigencia}"
                                    id="inicioVigenciaVAlor">
                        </p:calendar>

                        <h:outputText value="Final da Vigência: "/>
                        <p:calendar onkeypress="mascara(this, Data)"
                                    maxlength="10"
                                    pattern="dd/MM/yyyy"
                                    navigator="true"
                                    size="12"
                                    value="#{pensaoAlimenticiaControlador.valorPensaoAlimenticia.finalVigencia}"
                                    id="finalVigenciaValor">
                        </p:calendar>

                        <h:outputText value="Salário Mínimo (R$): "
                                      rendered="#{pensaoAlimenticiaControlador.ehPercentualSalarioMinimo()}"/>
                        <h:outputText style="color: red;"
                                      value="#{pensaoAlimenticiaControlador.recuperaValorSalarioMinimo()}"
                                      rendered="#{pensaoAlimenticiaControlador.ehPercentualSalarioMinimo()}">
                            <f:convertNumber pattern="#,###,##0.00"/>
                        </h:outputText>

                        <fc:outputLabelObrigatorio for="percentual" value="Percentual (%):"
                                                   rendered="#{pensaoAlimenticiaControlador.ehPercentualSalarioMinimo() or pensaoAlimenticiaControlador.mostrarBase()}"/>
                        <p:inputText value="#{pensaoAlimenticiaControlador.valorPensaoAlimenticia.valor}"
                                     id="percentual"
                                     size="12"
                                     rendered="#{pensaoAlimenticiaControlador.ehPercentualSalarioMinimo() or pensaoAlimenticiaControlador.mostrarBase()}">
                            <p:ajax event="valueChange"
                                    onstart="aguarde.show()"
                                    oncomplete="aguarde.hide()"
                                    process="@this"
                                    update="percentual valorSobreSalarioMinimo"
                                    listener="#{pensaoAlimenticiaControlador.calcularPercentualSobreSalarioMinimo()}"/>
                            <f:convertNumber pattern="#,###,##0.00"/>
                        </p:inputText>

                        <fc:outputLabelObrigatorio for="valorSobreSalarioMinimo"
                                                   value="Valor (R$): "
                                                   rendered="#{pensaoAlimenticiaControlador.valorFixoSalarioMinimo}"/>
                        <p:inputText value="#{pensaoAlimenticiaControlador.valorPensaoAlimenticia.valor}"
                                     id="valorSobreSalarioMinimo"
                                     rendered="#{pensaoAlimenticiaControlador.valorFixoSalarioMinimo}">
                            <f:convertNumber pattern="#,###,##0.00"/>
                        </p:inputText>

                        <fc:outputLabelObrigatorio for="val"
                                                   value="Quantidade: "
                                                   rendered="#{pensaoAlimenticiaControlador.ehSalarioMinimoIntegral()}"/>
                        <p:inputText value="#{pensaoAlimenticiaControlador.valorPensaoAlimenticia.valor}"
                                     title="Define a quantidade de salario mínimos que será pago."
                                     id="val" rendered="#{pensaoAlimenticiaControlador.ehSalarioMinimoIntegral()}">
                            <f:convertNumber pattern="#,###,##0.00"/>
                        </p:inputText>

                        <h:outputText rendered="#{pensaoAlimenticiaControlador.mostrarBase()}"
                                      value="Modo de Base FP: "/>
                        <h:selectOneMenu rendered="#{pensaoAlimenticiaControlador.mostrarBase()}"
                                         value="#{pensaoAlimenticiaControlador.modoSelecao}">
                            <f:selectItems value="#{pensaoAlimenticiaControlador.modos}"/>
                            <p:ajax event="change"
                                    update="panelGroupBase"
                                    process="@this"
                                    listener="#{pensaoAlimenticiaControlador.instanciarBaseConformeTipo()}"
                                    onstart="aguarde.show()"
                                    oncomplete="aguarde.hide()"/>
                        </h:selectOneMenu>

                        <fc:outputLabelObrigatorio value="BaseFP:"
                                                   rendered="#{pensaoAlimenticiaControlador.mostrarBaseItem()}"/>
                        <h:panelGroup rendered="#{pensaoAlimenticiaControlador.mostrarBase()}" id="panelGroupBase">
                            <fc:autoComplete id="base-folha-pagamento"
                                             converter="#{pensaoAlimenticiaControlador.converterBaseFP}"
                                             value="#{pensaoAlimenticiaControlador.valorPensaoAlimenticia.baseFP}"
                                             maxResults="50"
                                             rendered="#{pensaoAlimenticiaControlador.mostrarBaseItem() and pensaoAlimenticiaControlador.modoSelecao eq 'EXISTENTE' and !pensaoAlimenticiaControlador.clonando}"
                                             completeMethod="#{pensaoAlimenticiaControlador.completarBasesFP}"/>
                            <h:outputLabel value="#{pensaoAlimenticiaControlador.valorPensaoAlimenticia.baseFP}"
                                           rendered="#{pensaoAlimenticiaControlador.clonando}"/>
                            <p:commandButton rendered="#{pensaoAlimenticiaControlador.modoSelecao eq 'EXISTENTE' and !pensaoAlimenticiaControlador.clonando}"
                                             icon="ui-icon-copy"
                                             process=":FormularioDialog"
                                             title="Clique para clonar a base para o lançamento."
                                             value="Clonar"
                                             id="clonarBaseFP"
                                             actionListener="#{pensaoAlimenticiaControlador.clonarBase}"
                                             onstart="aguarde.show()"
                                             styleClass="mlef05"
                                             oncomplete="aguarde.hide();"
                                             update=":formBases FormularioDialog:irrfFicticio"/>
                            <p:commandLink rendered="#{pensaoAlimenticiaControlador.modoSelecao eq 'NOVO'}"
                                           onstart="aguarde.show()"
                                           actionListener="#{pensaoAlimenticiaControlador.definirBase()}"
                                           oncomplete="aguarde.hide();dialogbasefp.show()"
                                           id="basefp-id">
                                <h:outputText
                                    rendered="#{pensaoAlimenticiaControlador.baseAux ne null and pensaoAlimenticiaControlador.baseAux.itensBasesFPs.size() gt 0}"
                                    value="#{pensaoAlimenticiaControlador.baseAux}"/>
                            </p:commandLink>

                            <p:commandButton rendered="#{pensaoAlimenticiaControlador.modoSelecao eq 'NOVO'}"
                                             icon="ui-icon-circle-plus"
                                             title="Clique para configurar uma base para a pensão."
                                             actionListener="#{pensaoAlimenticiaControlador.associarBase}"
                                             onstart="aguarde.show()"
                                             oncomplete="aguarde.hide();dialogbasefp.show()"
                                             update=":formBases basefp-id"/>
                        </h:panelGroup>

                        <h:outputLabel value="IRRF Fictício? :"
                                       rendered="#{pensaoAlimenticiaControlador.mostrarBaseItem()}"/>
                        <h:selectBooleanCheckbox
                            rendered="#{pensaoAlimenticiaControlador.mostrarBaseItem()}"
                            value="#{pensaoAlimenticiaControlador.valorPensaoAlimenticia.irrfFicticio}"
                            id="irrfFicticio"/>

                    </h:panelGrid>

                    <p:commandButton value="Adicionar"
                                     actionListener="#{pensaoAlimenticiaControlador.adicionarItemValorBeneficio}"
                                     update=":FormularioDialog :Formulario:itens"
                                     icon="ui-icon-plus"
                                     process=":FormularioDialog "
                                     styleClass="padrao mtop10"
                                     onstart="aguarde.show()"
                                     oncomplete="aguarde.hide()"/>

                    <p:commandButton value="Cancelar"
                                     actionListener="#{pensaoAlimenticiaControlador.cancelarValorPensaoAlimenticia}"
                                     update=":FormularioDialog :Formulario:itens"
                                     icon="ui-icon-cancel"
                                     styleClass="padrao mtop10 mlef05"
                                     onclick="aguarde.show()"
                                     oncomplete="aguarde.hide()"/>

                    <p:dataTable id="itensValor"
                                 value="#{pensaoAlimenticiaControlador.valoresPensaoAlimenticia}" var="itemValor"
                                 editable="true"
                                 paginator="true"
                                 styleClass="mtop02"
                                 rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada trintaAltura' : 'trintaAltura'}"
                                 rowIndexVar="rowIx"
                                 style="overflow: auto ; min-height: 200px"
                                 emptyMessage="Não foram localizados registros para serem apresentados"
                                 rows="10"
                                 paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>VALORES&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                 rowsPerPageTemplate="10,25,50,100">
                        <p:column headerText="Ações" style="text-align: center; width: 12%">
                            <p:commandButton icon="ui-icon-pencil"
                                             onstart="aguarde.show()"
                                             oncomplete="aguarde.hide()"
                                             styleClass="mlef05"
                                             actionListener="#{pensaoAlimenticiaControlador.editarValorPensaoAlimenticia(itemValor)}"
                                             title="Clique para alterar este registro."
                                             process="@this"
                                             update=":FormularioDialog"/>

                            <p:commandButton icon="ui-icon-trash"
                                             update=":FormularioDialog:itensValor :Formulario:itens"
                                             title="Clique para remover este registro."
                                             process="@this"
                                             styleClass="mlef05"
                                             onclick="if (!confirm('Tem certeza que deseja remover este registro?')) {return false; } else {aguarde.show();}"
                                             oncomplete="aguarde.hide()"
                                             actionListener="#{pensaoAlimenticiaControlador.removerItemValorBeneficio(itemValor)}"/>
                        </p:column>
                        <p:column headerText="Início de Vigência" styleClass="alinhamentoCentralizado">
                            <h:outputText value="#{itemValor.inicioVigencia}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Final de Vigência" styleClass="alinhamentoCentralizado">
                            <p:cellEditor>
                                <f:facet name="output">
                                    <h:outputText value="#{itemValor.finalVigencia}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </f:facet>
                                <f:facet name="input">
                                    <p:calendar onkeypress="mascara(this, mdata)" maxlength="10"
                                                id="finalVigenciaItemValorEdit"
                                                navigator="true"
                                                locale="pt_BR"
                                                pattern="dd/MM/yyyy"
                                                value="#{itemValor.finalVigencia}">
                                        <p:ajax process="@this"
                                                event="dateSelect"
                                                update="@none"
                                                onstart="aguarde.show()"
                                                oncomplete="aguarde.hide()"
                                                listener="#{pensaoAlimenticiaControlador.validarFimVigencia(itemValor)}"
                                        />
                                        <p:ajax process="@this"
                                                event="valueChange"
                                                update="@none"
                                                onstart="aguarde.show()"
                                                oncomplete="aguarde.hide()"
                                                listener="#{pensaoAlimenticiaControlador.validarFimVigencia(itemValor)}"
                                        />
                                    </p:calendar>
                                </f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column
                            styleClass="alinhamentoDireita"
                            headerText="#{pensaoAlimenticiaControlador.ehPercentualSalarioMinimo() ? 'Percentual' : 'Valor'}">
                            <h:outputText value="#{itemValor.valor}" style="float: right">
                                <f:convertNumber pattern="#,###,##0.00"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Valor"
                                  styleClass="alinhamentoDireita"
                                  rendered="#{pensaoAlimenticiaControlador.ehPercentualSalarioMinimo()}">
                            <h:outputText
                                value="#{pensaoAlimenticiaControlador.recuperaValorCalculadoSobrePercentualSalarioMinimo(itemValor.valor)}"
                                style="float: right">
                                <f:convertNumber pattern="#,###,##0.00"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Base" rendered="#{pensaoAlimenticiaControlador.mostrarBaseItem()}"
                                  styleClass="alinhamentoEsquerda">
                            <p:commandLink onstart="aguarde.show()"
                                           actionListener="#{pensaoAlimenticiaControlador.definirBase(itemValor)}"
                                           oncomplete="aguarde.hide();dialogbasefp.show()">
                                <h:outputText
                                    value="#{itemValor.baseFP}"/>
                            </p:commandLink>
                        </p:column>
                        <p:column headerText="IRRF Fictício"
                                  rendered="#{pensaoAlimenticiaControlador.mostrarBaseItem()}"
                                  styleClass="alinhamentoEsquerda">
                            <h:outputText
                                value="#{itemValor.irrfFicticio ? 'SIM' : 'NÃO'}"/>
                        </p:column>
                    </p:dataTable>
                </p:panel>

                <p:commandButton styleClass="padrao mtop10"
                                 title="Clique para fechar esta janela."
                                 onstart="aguarde.show()"
                                 oncomplete="aguarde.hide();dlgValorBeneficio.hide()"
                                 value="Fechar"
                                 icon="ui-icon-close"/>

            </h:form>
        </p:dialog>

        <p:dialog header="Base"
                  position="center"
                  modal="true"
                  dynamic="true"
                  style="position: fixed!important;"
                  id="dialogBase"
                  width="900"
                  minHeight="470"
                  widgetVar="dialogbasefp"
                  showHeader="false"
                  closable="false">
            <h:form id="formBases">
                <p:panel id="panelBaseFP" header="Cadastro de Base Folha de Pagamento">
                    <h:panelGrid columns="2" id="gridBaseFP">
                        <fc:outputLabelObrigatorio value="Código:"/>
                        <p:inputText title="código gerado automaticamente."
                                     disabled="true"
                                     value="#{pensaoAlimenticiaControlador.valorPensaoAlimenticia.baseFP.codigo}"
                                     id="codigo"
                                     size="10">
                            <p:ajax process="@this"
                                    event="blur"
                                    onstart="aguarde.show()"
                                    oncomplete="aguarde.hide()"
                                    listener="#{pensaoAlimenticiaControlador.buscarBaseFP}"
                                    update=":formBases"/>
                        </p:inputText>

                        <fc:outputLabelObrigatorio value="Descrição: "/>
                        <p:inputText title="Digite a descrição da base folha de pagamento."
                                     value="#{pensaoAlimenticiaControlador.valorPensaoAlimenticia.baseFP.descricao}"
                                     id="descricao"
                                     maxlength="70"
                                     size="70"/>

                        <h:outputText value="Descrição Reduzida: "/>
                        <p:inputText title="Digite a descrição reduzida da base folha de pagamento."
                                     value="#{pensaoAlimenticiaControlador.valorPensaoAlimenticia.baseFP.descricaoReduzida}"
                                     id="descricaoReduzida"
                                     maxlength="70"
                                     size="70"/>
                    </h:panelGrid>

                    <p:panel header="Item da Base Folha de Pagamento"
                             styleClass="mtop10">

                        <h:panelGrid columns="2">
                            <h:outputText value="Evento Folha de Pagamento:"/>
                            <h:selectOneMenu title="Selecione um EventoFP"
                                             value="#{pensaoAlimenticiaControlador.itemBaseFP.eventoFP}"
                                             id="eventoFPItem"
                                             converter="#{baseFPControlador.converterEventoFP}">
                                <f:selectItems value="#{baseFPControlador.eventoFP}"/>
                            </h:selectOneMenu>

                            <h:outputText value="Operação Fórmula:"/>
                            <h:selectOneMenu title="Selecione a Operação Fórmula"
                                             value="#{pensaoAlimenticiaControlador.itemBaseFP.operacaoFormula}"
                                             id="operacaoFormula">
                                <f:selectItems value="#{baseFPControlador.operacaoFormula}"/>
                            </h:selectOneMenu>

                            <h:outputText value="Tipo de Valor:"/>
                            <h:selectOneMenu
                                title="Selecione a Tipo de valor(Normal é o valor respeitando os dias trabalhados.. já o valor intregal, considera o valor cheio no mês)"
                                value="#{pensaoAlimenticiaControlador.itemBaseFP.tipoValor}"
                                id="tipoValorBase">
                                <f:selectItems value="#{baseFPControlador.tipoValores}"/>
                            </h:selectOneMenu>
                        </h:panelGrid>

                        <p:commandButton id="adicionarItemBaseFP"
                                         value="Adicionar"
                                         onclick="aguarde.show()"
                                         oncomplete="aguarde.hide()"
                                         actionListener="#{pensaoAlimenticiaControlador.adicionarItemBaseFP}"
                                         styleClass="mtop05"
                                         update="panelBaseFP"
                                         process="panelBaseFP"
                                         icon="ui-icon-plus"/>

                        <p:dataTable id="tabelaItemBaseFPItem"
                                     value="#{pensaoAlimenticiaControlador.valorPensaoAlimenticia.baseFP.itensBasesFPs}"
                                     var="item"
                                     editable="true"
                                     paginator="true"
                                     rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'linha-selecionada trintaAltura' : 'trintaAltura'}"
                                     rowIndexVar="rowIx"
                                     styleClass="mtop02"
                                     style="overflow: auto ; max-height: 150px"
                                     emptyMessage="Não foram localizados registros para serem apresentados"
                                     rows="10"
                                     paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>BASES&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                     rowsPerPageTemplate="10,25,50,100">
                            <p:column headerText="Editar" style="width: 7%; text-align: center">
                                <p:rowEditor id="editor"/>
                            </p:column>
                            <p:column headerText="Remover" style="width: 7%; text-align: center">
                                <p:commandButton id="clRemover"
                                                 icon="ui-icon-trash"
                                                 onclick="if (!confirm('Tem certeza que deseja remover este registro?')) {return false; } else {aguarde.show();}"
                                                 oncomplete="aguarde.hide()"
                                                 actionListener="#{pensaoAlimenticiaControlador.removerItemBaseFP(item)}"
                                                 process="@this"
                                                 update="tabelaItemBaseFPItem">
                                </p:commandButton>
                            </p:column>
                            <p:column headerText="EventoFP" styleClass="alinhamentoEsquerda">
                                <p:commandLink value="#{item.eventoFP}"
                                               onclick="window.open('#{request.contextPath}/eventofp/editar/#{item.eventoFP.id}','_blank')"/>
                            </p:column>
                            <p:column headerText="Operação Fórmula" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{item.operacaoFormula.descricao}"/>
                            </p:column>
                            <p:column headerText="Tipo de Valor" styleClass="alinhamentoEsquerda">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="#{item.tipoValor}"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <h:selectOneMenu
                                            title="Selecione o Tipo de valor(Normal é o valor respeitando os dias trabalhados, já o valor integral, considera o valor cheio no mês)"
                                            value="#{item.tipoValor}">
                                            <f:selectItems value="#{baseFPControlador.tipoValores}"/>
                                        </h:selectOneMenu>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                        </p:dataTable>
                    </p:panel>
                </p:panel>

                <p:commandButton style="vertical-align: middle"
                                 styleClass="prioritario padrao mtop10 mrig05"
                                 value="Confirmar"
                                 actionListener="#{pensaoAlimenticiaControlador.validarAndFecharDialog}"
                                 icon="ui-icon-check"
                                 onstart="aguarde.show();"
                                 oncomplete="aguarde.hide();"
                                 process="@form :FormularioDialog"
                                 update=":FormularioDialog"/>

                <p:commandButton styleClass="padrao mtop10"
                                 title="Clique para fechar esta janela."
                                 update="@none"
                                 process="@none"
                                 onstart="aguarde.show()"
                                 oncomplete="aguarde.hide();dialogbasefp.hide()"
                                 value="Fechar"
                                 icon="ui-icon-close"/>
            </h:form>
        </p:dialog>

        <p:dialog header="Mensagens"
                  position="center"
                  modal="true"
                  dynamic="true"
                  style="position: fixed!important;"
                  id="dialogMensagens"
                  width="900"
                  minHeight="470"
                  widgetVar="mensagens"
                  showHeader="false"
                  closable="false">
            <h:form id="formMensagens">
                <div align="center" class="alert">
                    <h:outputLabel value="Atenção!" styleClass="negrito"/>
                </div>
                <p:scrollPanel mode="native" style="max-height: 350px; border: 0px">
                    <table id="msgs" class="table table-striped" style="border-radius: 0px">

                        <ui:repeat value="#{pensaoAlimenticiaControlador.beneficiariosEncontrados}"
                                   var="msg">
                            <tr>
                                <td class="alert">
                                    #{msg}
                                </td>
                            </tr>
                        </ui:repeat>
                    </table>
                    <hr class="mtop02 mbot02"/>
                </p:scrollPanel>

                <div align="center">
                    <h:outputLabel value="Deseja continuar com o beneficiário selecionado?"
                                   styleClass="negrito"/>
                    <h:panelGrid columns="2">
                        <p:commandButton styleClass="prioritario padrao mtop10 mrig05"
                                         value="Sim"
                                         icon="ui-icon-check"
                                         title="Clique para continuar com o beneficiário selecionado"
                                         onstart="aguarde.show();"
                                         update="@none"
                                         process="@none"
                                         oncomplete="aguarde.hide();mensagens.hide()"/>

                        <p:commandButton styleClass="padrao mtop10"
                                         title="Clique para remover o beneficiário selecionado."
                                         update=":Formulario:painelBeneficiario"
                                         actionListener="#{pensaoAlimenticiaControlador.limparBeneficiario()}"
                                         onstart="aguarde.show()"
                                         oncomplete="aguarde.hide();mensagens.hide()"
                                         value="Não"
                                         icon="ui-icon-close"/>
                    </h:panelGrid>
                </div>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>
</html>
