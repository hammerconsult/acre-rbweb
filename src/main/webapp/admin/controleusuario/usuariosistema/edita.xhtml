<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:p="http://primefaces.org/ui"
>
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">


        <h:form id="Formulario" enctype="multipart/form-data;charset=UTF-8">
            <p:remoteCommand
                name="continuarGestorProtocolo"
                onstart="statusDialog.show()"
                oncomplete="statusDialog.hide()"
                update=":Formulario:tabViewUsuario:tabelaParticipantes :Formulario:tabViewUsuario:panelGridUnidade :Formulario:tabViewUsuario:panelGridUnidadeOrc :Formulario:tabViewUsuario:tabelaUndsOrc"
                actionListener="#{usuarioSistemaControlador.alterarFilhosGestorProtocolo()}"/>

            <p:remoteCommand
                name="continuarGestorMateriais"
                onstart="statusDialog.show()"
                oncomplete="statusDialog.hide()"
                update=":Formulario:tabViewUsuario:tabelaParticipantes :Formulario:tabViewUsuario:panelGridUnidade :Formulario:tabViewUsuario:panelGridUnidadeOrc :Formulario:tabViewUsuario:tabelaUndsOrc"
                actionListener="#{usuarioSistemaControlador.alterarFilhosGestorMateriais()}"/>

            <p:remoteCommand
                name="continuarGestorLicitacao"
                onstart="statusDialog.show()"
                oncomplete="statusDialog.hide()"
                update=":Formulario:tabViewUsuario:tabelaParticipantes :Formulario:tabViewUsuario:panelGridUnidade :Formulario:tabViewUsuario:panelGridUnidadeOrc :Formulario:tabViewUsuario:tabelaUndsOrc"
                actionListener="#{usuarioSistemaControlador.alterarFilhosGestorLicitacao()}"/>

            <p:remoteCommand
                name="continuarGestorPatrimonio"
                onstart="statusDialog.show()"
                oncomplete="statusDialog.hide()"
                update=":Formulario:tabViewUsuario:tabelaParticipantes :Formulario:tabViewUsuario:panelGridUnidade :Formulario:tabViewUsuario:panelGridUnidadeOrc :Formulario:tabViewUsuario:tabelaUndsOrc"
                actionListener="#{usuarioSistemaControlador.alterarFilhosGestorPatrimonio()}"/>

            <p:remoteCommand
                name="continuarGestorOrcamento"
                onstart="statusDialog.show()"
                oncomplete="statusDialog.hide()"
                update=":Formulario:tabViewUsuario:tabelaParticipantes :Formulario:tabViewUsuario:panelGridUnidade :Formulario:tabViewUsuario:panelGridUnidadeOrc :Formulario:tabViewUsuario:tabelaUndsOrc"
                actionListener="#{usuarioSistemaControlador.alterarFilhosGestorOrcamento()}"/>

            <p:remoteCommand
                name="continuarGestorFinanceiro"
                onstart="statusDialog.show()"
                oncomplete="statusDialog.hide()"
                update=":Formulario:tabViewUsuario:tabelaParticipantes :Formulario:tabViewUsuario:panelGridUnidade :Formulario:tabViewUsuario:panelGridUnidadeOrc :Formulario:tabViewUsuario:tabelaUndsOrc"
                actionListener="#{usuarioSistemaControlador.alterarFilhosGestorFinanceiro()}"/>

            <p:remoteCommand
                name="continuarGestorControleInterno"
                onstart="statusDialog.show()"
                oncomplete="statusDialog.hide()"
                update=":Formulario:tabViewUsuario:tabelaParticipantes :Formulario:tabViewUsuario:panelGridUnidade :Formulario:tabViewUsuario:panelGridUnidadeOrc :Formulario:tabViewUsuario:tabelaUndsOrc"
                actionListener="#{usuarioSistemaControlador.alterarFilhosGestorControleInterno()}"/>

            <p:remoteCommand
                name="continuarSelecionar"
                onstart="statusDialog.show()"
                oncomplete="statusDialog.hide()"
                update=":Formulario:tabViewUsuario:tabelaParticipantes :Formulario:tabViewUsuario:panelGridUnidade :Formulario:tabViewUsuario:panelGridUnidadeOrc :Formulario:tabViewUsuario:tabelaUndsOrc"
                actionListener="#{usuarioSistemaControlador.selecionarFilhosUnidadesAdministrativas()}"/>

            <div style="width: 100%; ">
                <p:panel header="Cadastro de Usuários do Sistema">
                    <h:panelGrid columns="2" id="panelUsuario">
                        <h:outputText value="Login: "/>
                        <p:inputText title="Digite o Login do Usuário"
                                     value="#{usuarioSistemaControlador.selecionado.login}" id="Login"
                                     maxlength="30"
                                     onkeypress="mascara(this, semEspaco)"
                                     disabled="#{usuarioSistemaControlador.editando()}">
                            <p:ajax event="blur" listener="#{usuarioSistemaControlador.setaLoginNaSenha()}"/>
                        </p:inputText>

                        <p:spacer rendered="#{!usuarioSistemaControlador.editando()}"/>
                        <p:commandButton icon="ui-icon-key" title="Informar senha" value="Informar Senha"
                                         update="panelUsuario"
                                         maxlength="30"
                                         actionListener="#{usuarioSistemaControlador.mudaInformarSenha()}"
                                         rendered="#{!usuarioSistemaControlador.editando()}"/>

                        <h:outputText value="Senha: " rendered="#{usuarioSistemaControlador.informarSenha}"
                                      id="oSenha"/>
                        <p:password id="iSenha" value="#{usuarioSistemaControlador.senha2}" size="20" maxlength="30"
                                    title="Digite a senha do Usuário. Mínimo 6 caracteres." feedback="true"
                                    inline="true"
                                    promptLabel="Informe a senha" weakLabel="Fraca" goodLabel="Boa" strongLabel="Ótima"
                                    rendered="#{usuarioSistemaControlador.informarSenha}"/>

                        <h:outputText value="Repete Senha: " rendered="#{usuarioSistemaControlador.informarSenha}"
                                      id="oRepeteSenha"/>
                        <p:password id="iRepeteSenha" value="#{usuarioSistemaControlador.selecionado.senha}" size="20"
                                    maxlength="30"
                                    title="Digite novamente a senha do Usuário" feedback="true" inline="true"
                                    promptLabel="Repita a senha" weakLabel="Fraca" goodLabel="Boa" strongLabel="Ótima"
                                    rendered="#{usuarioSistemaControlador.informarSenha}"/>

                        <h:outputText value="Pessoa: "/>
                        <p:autoComplete queryDelay="1000" id="pessoaFisica" title="Digite o nome do Usuário" size="70"
                                        value="#{usuarioSistemaControlador.selecionado.pessoaFisica}"
                                        completeMethod="#{usuarioSistemaControlador.completaPessoaFisica}"
                                        disabled="#{usuarioSistemaControlador.editando()}"
                                        var="pessoaFisica"
                                        maxResults="10"
                                        itemLabel="#{pessoaFisica.nomeCpfCnpj} "
                                        itemValue="#{pessoaFisica.id}"
                                        converter="#{usuarioSistemaControlador.converterPessoaFisica}">
                            <p:ajax update="panelDestahesPessoa" event="itemSelect"
                                    listener="#{usuarioSistemaControlador.setaPessoa}"/>
                        </p:autoComplete>

                        <p:spacer/>
                        <p:panel id="panelDestahesPessoa">
                            <h:panelGrid columns="2" rendered="#{usuarioSistemaControlador.mostraPainel}">
                                <h:outputText value="Perfil: "/>
                                <h:outputText value="#{usuarioSistemaControlador.perfilPessoaSelecionada()}"
                                              style="font-weight: bold"/>

                                <h:outputText value="Unidade Externa: "/>
                                <h:outputText
                                    value="#{usuarioSistemaControlador.selecionado.pessoaFisica.unidadeExterna.pessoaJuridica.nome}"
                                    style="font-weight: bold"/>

                                <h:outputText value="Esfera de Governo: "/>
                                <h:outputText
                                    value="#{usuarioSistemaControlador.selecionado.pessoaFisica.unidadeExterna.esferaGoverno.nome}"
                                    style="font-weight: bold"/>
                            </h:panelGrid>
                        </p:panel>

                        <h:outputText value="Último Acesso: "/>
                        <p:inputText styleClass="negrito"
                                     disabled="true"
                                     value="#{usuarioSistemaControlador.getUltimoAcessoFormatado()}" />

                        <h:outputText rendered="#{usuarioSistemaControlador.perfilPessoaSelecionada() eq 'Perfil Especial'}"
                                      value="Tempo de bloqueio por inatividade (em dias): "/>
                        <p:inputText styleClass="negrito"
                                     disabled="true"
                                     rendered="#{usuarioSistemaControlador.perfilPessoaSelecionada() eq 'Perfil Especial'}"
                                     value="#{usuarioSistemaControlador.getTempoMaximoInatividade() eq null ? 'Indeterminado' : usuarioSistemaControlador.getTempoMaximoInatividade()}" />
                    </h:panelGrid>
                    <p:commandButton value="Redefinir Senha" styleClass="prioritario mtop05 mbot05"
                                     icon="ui-icon-locked"
                                     onclick="confirmarRedefinirSenha.show()"
                                     rendered="#{usuarioSistemaControlador.operacao eq 'EDITAR'}"/>

                    <p:panel styleClass="mbot05">
                        <h:panelGrid columns="2">
                            <h:outputText value="Bloquear Acesso: "/>
                            <h:selectBooleanCheckbox id="expira"
                                                     value="#{usuarioSistemaControlador.selecionado.expira}"/>

                            <h:outputText value="Não Bloquear Automaticamente: "/>
                            <h:panelGroup>
                                <h:selectBooleanCheckbox id="naoBloquear"
                                                         value="#{usuarioSistemaControlador.selecionado.naoBloquearAutomaticamente}"/>
                                <fc:botaoInformacao id="btnInfoNaoBloquear"
                                                    resumo="Informativo:"
                                                    detalhes="Opção válida apenas para as seguintes rotinas: Afastamentos, Férias, Licença Prêmio, Exoneração e Cessão Sem Ônus. Por favor, verificar a configuração vigente de Bloqueio/Desbloqueio de Usuário."/>
                            </h:panelGroup>
                            <h:outputText value="Pode alterar data do sistema: "/>
                            <h:selectBooleanCheckbox id="alterarData"
                                                     value="#{usuarioSistemaControlador.selecionado.podeAlterarData}"/>

                            <h:outputText value="Pode visualizar históricos: "/>
                            <h:selectBooleanCheckbox id="visualizarHistoricos"
                                                     value="#{usuarioSistemaControlador.selecionado.visualizarHistorico}"/>

                            <h:outputText value="Exibir Tela de Nova Versão no Login: "/>
                            <h:selectBooleanCheckbox id="exibirVersao"
                                                     value="#{usuarioSistemaControlador.selecionado.exibirVersao}"/>

                            <h:outputText value="Data de Cadastro: "/>
                            <p:calendar value="#{usuarioSistemaControlador.selecionado.dataCadastro}"
                                        disabled="true" id="datacadastro" pattern="dd/MM/yyyy"/>

                            <h:outputText value="Tempo Máximo de Inatividade (minutos): "/>
                            <h:panelGroup>
                            <p:inputText title="Digite o Tempo Máximo de Inatividade"
                                         id="tempoMaximoInativo" onkeypress="mascara(this, soNumeros)"
                                         value="#{usuarioSistemaControlador.selecionado.tempoMaximoInativoMinutos}" maxlength="3"/>
                            <fc:botaoInformacao id="btnInfoTempoMaximoInativo"
                                                resumo="Informativo:"
                                                detalhes="Tempo em minutos para expiração da sessão do sistema. Se não preenchido, o sistema adota o tempo padrão (#{sistemaControlador.tempoMaximoInativoPadrao} minutos)."/>
                            </h:panelGroup>

                            <h:outputText value="Nome Legado: "/>
                            <p:inputText title="Digite o Nome Legado"
                                         value="#{usuarioSistemaControlador.selecionado.nomeLegado}"
                                         id="nomelegado" maxlength="70" size="70"/>

                            <h:outputText value="Observação: "/>
                            <p:inputTextarea id="observacao" title="Digite a observação" rows="3" cols="70"
                                             value="#{usuarioSistemaControlador.selecionado.observacao}"
                                             maxlength="3000"/>
                        </h:panelGrid>
                    </p:panel>
                    <p:tabView id="tabViewUsuario">
                        <p:tab title="Configurações do Usuário" id="tabConfiguracoesUsuario">
                            <p:panel header="Grupos de Usuário" styleClass="mbot05">
                                <h:panelGrid columns="2" id="panelGrupoUsuario">
                                    <h:outputText value="Grupo de Usuário: "/>
                                    <p:autoComplete queryDelay="1000" id="grupo" title="Digite o nome do Grupo"
                                                    size="70"
                                                    value="#{usuarioSistemaControlador.grupoUsuario}"
                                                    completeMethod="#{usuarioSistemaControlador.completaGrupoUsuario}"
                                                    converter="#{usuarioSistemaControlador.converterGrupoUsuario}"
                                                    var="grp" forceSelection="true" maxResults="10"
                                                    onkeypress="if(event.keyCode===13){$('.botaoAdicionarGrupoUsuario').click();return false;}"
                                                    itemLabel="#{grp.nome}"
                                                    itemValue="#{grp.id}"/>
                                </h:panelGrid>
                                <p:commandButton value="Adicionar" icon="ui-icon-arrowthick-1-s"
                                                 actionListener="#{usuarioSistemaControlador.addGrupo()}"
                                                 update="tabelaGrupos panelGrupoUsuario"
                                                 styleClass="operacao botaoAdicionarGrupoUsuario"/>
                                <p:dataTable id="tabelaGrupos" value="#{usuarioSistemaControlador.selecionado.grupos}"
                                             var="g"
                                             styleClass="mtop05"
                                             emptyMessage="Nenhum grupo cadastrado.">
                                    <p:column headerText="" style="width: 5%; text-align: center">
                                        <p:commandButton icon="ui-icon-trash" title="Remover" update="tabelaGrupos"

                                                         actionListener="#{usuarioSistemaControlador.removeGrupo(g)}"/>
                                    </p:column>
                                    <p:column headerText="Nome">
                                        <h:outputText value="#{g.nome}"/>
                                    </p:column>

                                </p:dataTable>
                            </p:panel>
                            <p:tabView styleClass="mbot05">
                                <p:tab title="Grupos de Recursos Especiais">
                                    <p:panel header="Grupos de Recursos Especiais">
                                        <h:panelGrid columns="2" id="panelGrupoRecurso">
                                            <h:outputText value="Grupo de Recurso: "/>
                                            <h:selectOneMenu value="#{usuarioSistemaControlador.grupoRecurso}"
                                                             id="grupoRec"
                                                             converter="#{usuarioSistemaControlador.converterGrupoRecurso}">
                                                <f:selectItems value="#{usuarioSistemaControlador.gruposRecurso}"/>
                                            </h:selectOneMenu>
                                        </h:panelGrid>
                                        <p:commandButton value="Adicionar" icon="ui-icon-arrowthick-1-s"
                                                         actionListener="#{usuarioSistemaControlador.addGrupoRecurso()}"
                                                         update="tabelaGruposRecursos panelGrupoRecurso"
                                                         styleClass="operacao"/>
                                        <p:dataTable id="tabelaGruposRecursos"
                                                     styleClass="mtop05"
                                                     value="#{usuarioSistemaControlador.selecionado.grupoRecursosUsuario}"
                                                     var="g"
                                                     emptyMessage="Nenhum grupo de recursos cadastrado.">
                                            <p:column headerText="" style="width: 5%; text-align: center">
                                                <p:commandButton icon="ui-icon-trash" title="Remover"
                                                                 update="tabelaGruposRecursos"
                                                                 actionListener="#{usuarioSistemaControlador.removeGrupoRecurso(g)}"/>
                                            </p:column>
                                            <p:column headerText="Nome">
                                                <h:outputText value="#{g.grupoRecurso.nome}"/>
                                            </p:column>
                                            <p:column headerText="Leitura" style="width: 7%; text-align: center">
                                                <p:selectBooleanCheckbox value="#{g.leitura}"/>
                                            </p:column>
                                            <p:column headerText="Escrita" style="width: 7%; text-align: center">
                                                <p:selectBooleanCheckbox value="#{g.escrita}"/>
                                            </p:column>
                                            <p:column headerText="Exclusão" style="width: 7%; text-align: center">
                                                <p:selectBooleanCheckbox value="#{g.exclusao}"/>
                                            </p:column>

                                        </p:dataTable>
                                    </p:panel>
                                </p:tab>
                                <p:tab title="Recursos Especiais">
                                    <p:panel header="Recursos Especiais">
                                        <h:panelGrid columns="2" id="panelRecurso">
                                            <h:outputText value="Recurso: "/>
                                            <p:autoComplete queryDelay="1000" id="recurso"
                                                            title="Digite o nome do Recurso" size="70"
                                                            value="#{usuarioSistemaControlador.recursoSistema}"
                                                            completeMethod="#{usuarioSistemaControlador.completaRecursoSistema}"
                                                            converter="#{usuarioSistemaControlador.converterRecursoSistema}"
                                                            var="rec" maxResults="10"
                                                            itemLabel="#{rec.nome}"
                                                            itemValue="#{rec.id}"
                                                            forceSelection="true"/>
                                        </h:panelGrid>
                                        <p:commandButton value="Adicionar" icon="ui-icon-arrowthick-1-s"
                                                         actionListener="#{usuarioSistemaControlador.addRecursoSistema()}"
                                                         update="tabelaRecursos panelRecurso" styleClass="operacao"/>
                                        <p:dataTable id="tabelaRecursos"
                                                     value="#{usuarioSistemaControlador.selecionado.recursosUsuario}"
                                                     styleClass="mtop05"
                                                     var="r" emptyMessage="Nenhum recurso cadastrado.">
                                            <p:column headerText="" style="width: 5%; text-align: center">
                                                <p:commandButton icon="ui-icon-trash" title="Remover"
                                                                 update="tabelaRecursos"
                                                                 actionListener="#{usuarioSistemaControlador.removeRecursoSistema(r)}"/>
                                            </p:column>
                                            <p:column headerText="Nome">
                                                <h:outputText value="#{r.recursoSistema.nome}"/>
                                            </p:column>
                                            <p:column headerText="Leitura" style="width: 7%; text-align: center">
                                                <p:selectBooleanCheckbox value="#{r.leitura}"/>
                                            </p:column>
                                            <p:column headerText="Escrita" style="width: 7%; text-align: center">
                                                <p:selectBooleanCheckbox value="#{r.escrita}"/>
                                            </p:column>
                                            <p:column headerText="Exclusão" style="width: 7%; text-align: center">
                                                <p:selectBooleanCheckbox value="#{r.exclusao}"/>
                                            </p:column>
                                        </p:dataTable>
                                    </p:panel>
                                </p:tab>
                            </p:tabView>
                            <p:panel id="arvoreParticipantes" header="Unidades Organizacionais Administrativas"
                                     styleClass="mbot05">
                                <p:tree id="orcTree" value="#{usuarioSistemaControlador.rootOrc}" var="treeOrc"
                                        style="width: 100%;border: 0px " selectionMode="single"
                                        selection="#{usuarioSistemaControlador.selectedNode}">
                                    <p:treeNode expandedIcon="ui-icon-folder-open"
                                                collapsedIcon="ui-icon-folder-collapsed">
                                        <h:outputText value="#{treeOrc}"/>
                                    </p:treeNode>
                                </p:tree>
                                <p:commandButton id="cbuSelUnidade" value="Selecionar Unidade Organizacional"
                                                 icon="ui-icon-arrowthick-1-s"
                                                 styleClass="operacao"
                                                 actionListener="#{usuarioSistemaControlador.selecionarHierarquiaDaArvore()}"
                                                 update="panelGridUnidade"
                                                 onstart="statusDialog.show()"
                                                 oncomplete="statusDialog.hide()"/>

                                <h:panelGrid columns="2" id="panelGridUnidade">
                                    <h:outputText value="Apenas unidades vigentes: "/>
                                    <h:selectBooleanCheckbox id="apenasUnidadesVigentes"
                                                             value="#{usuarioSistemaControlador.apenasUnidadesVigentes}">
                                        <p:ajax process="@this"/>
                                    </h:selectBooleanCheckbox>
                                    <h:outputText value="Unidade Organizacional: "/>
                                    <p:autoComplete queryDelay="1000" widgetVar="hierarquiaOrg" id="hierarquiaOrg" title="Digite a descrição"
                                                    completeMethod="#{usuarioSistemaControlador.completaHierarquiaOrganizacionalAdiministrativa}"
                                                    value="#{usuarioSistemaControlador.hierarquiaOrgParticipante}"
                                                    var="un"
                                                    size="70"
                                                    maxResults="10"
                                                    itemLabel="#{un} #{usuarioSistemaControlador.descricaoVigenciaHierarquias.get(un)}"
                                                    itemValue="#{un.id}"
                                                    forceSelection="true"
                                                    converter="#{componenteHOControlador.converterHierarquiaOrganizacional}"/>
                                </h:panelGrid>
                                <h:panelGrid columns="4" id="botoesAddUnds">
                                    <p:commandButton value="Adicionar"
                                                     icon="ui-icon-arrowthick-1-s"
                                                     update="panelGridUnidade tabelaParticipantes panelGridUnidadeOrc tabelaUndsOrc"
                                                     actionListener="#{usuarioSistemaControlador.validarHierarquiaAdministrativa}"
                                                     styleClass="operacao"/>

                                    <p:commandButton value="Adicionar Todas" icon="ui-icon-arrowthick-1-s"
                                                     actionListener="#{usuarioSistemaControlador.salvarTodosParticipantes()}"
                                                     update="panelGridUnidade tabelaParticipantes panelGridUnidadeOrc tabelaUndsOrc"
                                                     onstart="statusDialog.show()"
                                                     oncomplete="statusDialog.hide()"
                                                     styleClass="operacao"/>

                                    <p:commandButton value="Remover Todas" icon="ui-icon-arrowthick-1-n"
                                                     actionListener="#{usuarioSistemaControlador.removerTodosParticipantes()}"
                                                     update="panelGridUnidade tabelaParticipantes panelGridUnidadeOrc tabelaUndsOrc"
                                                     onstart="statusDialog.show()"
                                                     oncomplete="statusDialog.hide()"
                                                     styleClass="operacao"/>

                                    <p:commandButton value="Remover Selecionados" icon="ui-icon-arrowthick-1-n"
                                                     actionListener="#{usuarioSistemaControlador.removerUnidadesAdministrativas()}"
                                                     update="panelGridUnidade tabelaParticipantes panelGridUnidadeOrc tabelaUndsOrc"
                                                     onstart="statusDialog.show()"
                                                     oncomplete="statusDialog.hide()"
                                                     styleClass="operacao"/>
                                </h:panelGrid>
                                <p:dataTable id="tabelaParticipantes"
                                             paginator="true" rows="10"
                                             styleClass="mtop05"
                                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             rowsPerPageTemplate="10,20,50,100"
                                             widgetVar="tabelaUnidades"
                                             value="#{usuarioSistemaControlador.hierarquiasAdministrativasUsuarioPesquisa}"
                                             var="uni"
                                             emptyMessage="Nenhuma unidade organizacional cadastrada.">
                                    <f:facet name="header">
                                        <p:outputPanel>
                                            <h:outputText value="Busca:"/>
                                            <h:inputText size="70"
                                                         onkeypress="if(event.keyCode===13){$('.filtrarUnidadeAdministrativaUsuario').click();return false;}"
                                                         value="#{usuarioSistemaControlador.filtroUnidadeAdministrativa}"/>
                                            <p:commandButton
                                                actionListener="#{usuarioSistemaControlador.filtrarUnidadeAdministrativaUsuario}"
                                                value="Pesquisar"
                                                icon="ui-icon-search"
                                                update="tabelaParticipantes"
                                                styleClass="operacao mlef05 filtrarUnidadeAdministrativaUsuario"
                                                onclick="aguarde.show()"
                                                oncomplete="aguarde.hide()"/>
                                        </p:outputPanel>
                                    </f:facet>
                                    <p:column headerText="Selecionar" style="text-align: center">
                                        <f:facet name="header">
                                            <table>
                                                <tr>
                                                    <td> Selecionar</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <p:commandButton icon="ui-icon-check"
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.selecionarUnidadesAdministrativas(true)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                        <p:commandButton value=" "
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.selecionarUnidadesAdministrativas(false)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                    </td>
                                                </tr>
                                            </table>
                                        </f:facet>
                                        <p:selectBooleanCheckbox
                                            value="#{uni.marcado}">
                                            <p:ajax update="tabelaParticipantes"
                                                    onstart="#{usuarioSistemaControlador.hasFilhasParaMarcarPelaHierarquiaUsuario(uni) ? 'confirmarMarcarFilhas(continuarSelecionar)' :'aguarde.show()'}"
                                                    oncomplete="aguarde.hide()"
                                                    listener="#{usuarioSistemaControlador.escolherUnidade(uni)}"/>
                                        </p:selectBooleanCheckbox>
                                    </p:column>
                                    <p:column headerText="Unidade Administrativa"
                                              style="width: 40%">
                                        <h:outputText
                                            value="#{uni.hierarquiaOrganizacional.codigo} - #{uni.hierarquiaOrganizacional.descricao}"/>
                                    </p:column>
                                    <p:column headerText="Gestor Protocolo" style="text-align: center">
                                        <f:facet name="header">
                                            <table>
                                                <tr>
                                                    <td> Gestor Protocolo</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <p:commandButton icon="ui-icon-check"
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.alterarUnidadesGestorProtocolo(true)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                        <p:commandButton value=" "
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.alterarUnidadesGestorProtocolo(false)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                    </td>
                                                </tr>
                                            </table>
                                        </f:facet>
                                        <p:selectBooleanCheckbox
                                            value="#{uni.usuarioUnidadeOrganizacional.gestorProtocolo}">
                                            <p:ajax update="tabelaParticipantes"
                                                    onstart="#{usuarioSistemaControlador.hasFilhasParaMarcarPelaHierarquiaUsuario(uni) ? 'confirmarMarcarFilhas(continuarGestorProtocolo)' :'aguarde.show()'}"
                                                    oncomplete="aguarde.hide()"
                                                    listener="#{usuarioSistemaControlador.escolherUnidade(uni)}"/>
                                        </p:selectBooleanCheckbox>
                                    </p:column>
                                    <p:column headerText="Gestor Materiais" style="text-align: center">
                                        <f:facet name="header">
                                            <table>
                                                <tr>
                                                    <td> Gestor Materiais</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <p:commandButton icon="ui-icon-check"
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.alterarUnidadesGestorMateriais(true)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                        <p:commandButton value=" "
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.alterarUnidadesGestorMateriais(false)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                    </td>
                                                </tr>
                                            </table>
                                        </f:facet>
                                        <p:selectBooleanCheckbox
                                            value="#{uni.usuarioUnidadeOrganizacional.gestorMateriais}">
                                            <p:ajax update="tabelaParticipantes"
                                                    onstart="#{usuarioSistemaControlador.hasFilhasParaMarcarPelaHierarquiaUsuario(uni) ? 'confirmarMarcarFilhas(continuarGestorMateriais)' : 'aguarde.show()'}"
                                                    oncomplete="aguarde.hide()"
                                                    listener="#{usuarioSistemaControlador.escolherUnidade(uni)}"/>
                                        </p:selectBooleanCheckbox>
                                    </p:column>
                                    <p:column headerText="Gestor Licitação" style="text-align: center">
                                        <f:facet name="header">
                                            <table>
                                                <tr>
                                                    <td> Gestor Licitação</td>
                                                </tr>
                                                <tr>
                                                    <td><p:commandButton icon="ui-icon-check"
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.alterarUnidadesGestorLicitacao(true)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                        <p:commandButton value=" "
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.alterarUnidadesGestorLicitacao(false)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                    </td>

                                                </tr>
                                            </table>
                                        </f:facet>
                                        <p:selectBooleanCheckbox
                                            value="#{uni.usuarioUnidadeOrganizacional.gestorLicitacao}">
                                            <p:ajax update="tabelaParticipantes"
                                                    onstart="#{usuarioSistemaControlador.hasFilhasParaMarcarPelaHierarquiaUsuario(uni) ? 'confirmarMarcarFilhas(continuarGestorLicitacao)' :'aguarde.show()'}"
                                                    oncomplete="aguarde.hide()"
                                                    listener="#{usuarioSistemaControlador.escolherUnidade(uni)}"/>
                                        </p:selectBooleanCheckbox>
                                    </p:column>
                                    <p:column headerText="Gestor Patrimônio" style="text-align: center">
                                        <f:facet name="header">
                                            <table>
                                                <tr>
                                                    <td> Gestor Patrimônio</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <p:commandButton icon="ui-icon-check"
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.alterarUnidadesGestorPatrimonio(true)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                        <p:commandButton value=" "
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.alterarUnidadesGestorPatrimonio(false)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                    </td>

                                                </tr>
                                            </table>
                                        </f:facet>
                                        <p:selectBooleanCheckbox
                                            value="#{uni.usuarioUnidadeOrganizacional.gestorPatrimonio}">
                                            <p:ajax update="tabelaParticipantes"
                                                    onstart="#{usuarioSistemaControlador.hasFilhasParaMarcarPelaHierarquiaUsuario(uni) ? 'confirmarMarcarFilhas(continuarGestorPatrimonio)' :'aguarde.show()'}"
                                                    oncomplete="aguarde.hide()"
                                                    listener="#{usuarioSistemaControlador.escolherUnidade(uni)}"/>
                                        </p:selectBooleanCheckbox>
                                    </p:column>

                                    <p:column headerText="Gestor Orçamento" style="text-align: center">
                                        <f:facet name="header">
                                            <table>
                                                <tr>
                                                    <td> Gestor Orçamento</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <p:commandButton icon="ui-icon-check"
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.alterarUnidadesGestorOrcamento(true)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                        <p:commandButton value=" "
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.alterarUnidadesGestorOrcamento(false)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                    </td>

                                                </tr>
                                            </table>
                                        </f:facet>
                                        <p:selectBooleanCheckbox
                                            value="#{uni.usuarioUnidadeOrganizacional.gestorOrcamento}">
                                            <p:ajax update="tabelaParticipantes"
                                                    onstart="#{usuarioSistemaControlador.hasFilhasParaMarcarPelaHierarquiaUsuario(uni) ? 'confirmarMarcarFilhas(continuarGestorOrcamento)' : 'aguarde.show()'}"
                                                    oncomplete="aguarde.hide()"
                                                    listener="#{usuarioSistemaControlador.escolherUnidade(uni)}"/>
                                        </p:selectBooleanCheckbox>
                                    </p:column>

                                    <p:column headerText="Gestor Financeiro" style="text-align: center">
                                        <f:facet name="header">
                                            <table>
                                                <tr>
                                                    <td> Gestor Financeiro</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <p:commandButton icon="ui-icon-check"
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.alterarUnidadesGestorFinanceiro(true)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                        <p:commandButton value=" "
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.alterarUnidadesGestorFinanceiro(false)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                    </td>

                                                </tr>
                                            </table>
                                        </f:facet>
                                        <p:selectBooleanCheckbox
                                            value="#{uni.usuarioUnidadeOrganizacional.gestorFinanceiro}">
                                            <p:ajax update="tabelaParticipantes"
                                                    onstart="#{usuarioSistemaControlador.hasFilhasParaMarcarPelaHierarquiaUsuario(uni) ? 'confirmarMarcarFilhas(continuarGestorFinanceiro)' : 'aguarde.show()'}"
                                                    oncomplete="aguarde.hide()"
                                                    listener="#{usuarioSistemaControlador.escolherUnidade(uni)}"/>
                                        </p:selectBooleanCheckbox>
                                    </p:column>

                                    <p:column headerText="Gestor do Controle Interno" style="text-align: center">
                                        <f:facet name="header">
                                            <table>
                                                <tr>
                                                    <td> Gestor do Controle Interno</td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <p:commandButton icon="ui-icon-check"
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.alterarUnidadesGestorControleInterno(true)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                        <p:commandButton value=" "
                                                                         styleClass="vinteLarguraVinteAltura"
                                                                         actionListener="#{usuarioSistemaControlador.alterarUnidadesGestorControleInterno(false)}"
                                                                         update="tabelaParticipantes"
                                                                         onstart="statusDialog.show()"
                                                                         oncomplete="statusDialog.hide()"/>
                                                    </td>

                                                </tr>
                                            </table>
                                        </f:facet>
                                        <p:selectBooleanCheckbox
                                            value="#{uni.usuarioUnidadeOrganizacional.gestorControleInterno}">
                                            <p:ajax update="tabelaParticipantes"
                                                    onstart="#{usuarioSistemaControlador.hasFilhasParaMarcarPelaHierarquiaUsuario(uni) ? 'confirmarMarcarFilhas(continuarGestorControleInterno)' : 'aguarde.show()'}"
                                                    oncomplete="aguarde.hide()"
                                                    listener="#{usuarioSistemaControlador.escolherUnidade(uni)}"/>
                                        </p:selectBooleanCheckbox>
                                    </p:column>

                                </p:dataTable>
                            </p:panel>
                            <p:panel id="arvoreParticipantesOrc" header="Unidades Organizacionais Orçamentárias"
                                     styleClass="mbot05">

                                <h:panelGrid columns="2" id="panelGridUnidadeOrc">
                                    <h:outputText value="Unidade Organizacional Orçamentária: "/>
                                    <p:autoComplete queryDelay="1000" id="hierarquiaOrc"
                                                    title="Digite a descrição ou código da Unidade Orçamentária"
                                                    size="70"
                                                    value="#{usuarioSistemaControlador.hierarquiaOrgOrc}"
                                                    completeMethod="#{usuarioSistemaControlador.completaHierarquiaOrganizacionalOrcamentaria}"
                                                    var="hier"
                                                    maxResults="10"
                                                    forceSelection="true"
                                                    itemLabel="#{hier} "
                                                    itemValue="#{hier.id}"
                                                    onkeypress="if(event.keyCode===13){$('.botaoAdicionarUnidadeOrcamentaria').click();return false;}"
                                                    converter="#{usuarioSistemaControlador.converterHierarquiaOrganizacional}"/>
                                </h:panelGrid>
                                <h:panelGrid columns="3" id="botoesAddUndsOrc" cellspacing="0" cellpadding="0">
                                    <p:commandButton value="Adicionar" icon="ui-icon-arrowthick-1-s"
                                                     actionListener="#{usuarioSistemaControlador.salvarOrgOrc()}"
                                                     onstart="statusDialog.show()"
                                                     oncomplete="statusDialog.hide()"
                                                     update="panelGridUnidadeOrc tabelaUndsOrc"
                                                     styleClass="operacao botaoAdicionarUnidadeOrcamentaria"/>
                                </h:panelGrid>
                                <p:dataTable id="tabelaUndsOrc"
                                             paginator="true" rows="10"
                                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             rowsPerPageTemplate="10,20,50,100"
                                             widgetVar="tabelaUnidadesOrc"
                                             styleClass="mtop05"
                                             value="#{usuarioSistemaControlador.hierarquiasOrcamentariasUsuarioPesquisa}"
                                             var="uni"
                                             emptyMessage="Nenhuma unidade organizacional cadastrada.">
                                    <f:facet name="header">
                                        <p:outputPanel>
                                            <h:outputText value="Busca:"/>
                                            <h:inputText size="70"
                                                         onkeypress="if(event.keyCode===13){$('.filtrarUnidadeOrcamentariaUsuario').click();return false;}"
                                                         value="#{usuarioSistemaControlador.filtroUnidadeOrcamentaria}"/>
                                            <p:commandButton
                                                actionListener="#{usuarioSistemaControlador.filtrarUnidadeOrcamentariaUsuario}"
                                                value="Pesquisar"
                                                icon="ui-icon-search"
                                                update="tabelaUndsOrc"
                                                styleClass="operacao mlef05 filtrarUnidadeOrcamentariaUsuario"
                                                onclick="aguarde.show()"
                                                oncomplete="aguarde.hide()"/>
                                        </p:outputPanel>
                                    </f:facet>
                                    <p:column headerText="Ação" style="width: 5%; text-align: center">
                                        <p:commandButton icon="ui-icon-trash"
                                                         title="Clique para remover o registro"
                                                         onstart="statusDialog.show()"
                                                         oncomplete="statusDialog.hide();"
                                                         update="tabelaUndsOrc"
                                                         actionListener="#{usuarioSistemaControlador.removerHierarquiaOrcamentaria(uni)}"/>
                                    </p:column>
                                    <p:column headerText="Unidade Orçamentária">
                                        <h:outputText
                                            value="#{uni.hierarquiaOrganizacional.codigo} - #{uni.hierarquiaOrganizacional.descricao}"/>
                                    </p:column>


                                </p:dataTable>
                            </p:panel>
                        </p:tab>
                        <p:tab title="Arquivos do Usuário">
                            <p:panel id="panelUpload" header="Arquivos">
                                <p:fileUpload multiple="true" cancelLabel="Cancelar"
                                              sizeExceedMessage="Arquivo Maior que 10 MB."
                                              label="Selecione..."
                                              uploadLabel="Upload Arquivo" update="tabelaItem panelUpload"
                                              sizeLimit="15728640"
                                              id="iBotaoUpload"
                                              fileUploadListener="#{usuarioSistemaControlador.handleFileUpload}"/>

                                <p:dataTable id="tabelaItem" value="#{usuarioSistemaControlador.arquivos}" var="item"
                                             styleClass="mtop05"
                                             emptyMessage="Nenhum arquivo cadastrado.">
                                    <p:column headerText="" style="width: 5%; text-align: center">
                                        <p:commandButton icon="ui-icon-trash" update="tabelaItem"
                                                         actionListener="#{usuarioSistemaControlador.removeArquivo(item)}"/>
                                    </p:column>
                                    <p:column headerText="Data do Upload">
                                        <h:outputText value="#{item.dataUpload}">
                                            <f:convertDateTime pattern="dd/MM/yyy"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Descrição" style="text-align: center">
                                        <h:inputText value="#{item.arquivo.descricao}" size="100" maxlength="100"/>
                                    </p:column>
                                    <p:column rendered="#{item.arquivo.id eq null}" headerText="Download"
                                              style="text-align: center">
                                        <p:commandButton id="downloadLink" value="Download" ajax="false"
                                                         icon="ui-icon-arrowthichk-s">
                                            <p:fileDownload
                                                value="#{usuarioSistemaControlador.getArquivoStream(item)}"/>
                                        </p:commandButton>
                                    </p:column>
                                    <p:column rendered="#{item.arquivo.id ne null}" headerText="Download"
                                              style="width: 10%; text-align: center">
                                        <a title="Download"
                                           href="${facesContext.externalContext.requestContextPath}/arquivos/#{item.arquivo.nome}?id=#{item.arquivo.id}">#{item.arquivo.nome}</a>
                                    </p:column>

                                </p:dataTable>
                            </p:panel>
                        </p:tab>
                        <p:tab title="Configurações do Tributário">
                            <p:panel header="Vigência da Configuração" id="panelVigencia" styleClass="mbot05">
                                <p:panel header="Tipo de Usuáro">
                                    <h:panelGrid columns="2" id="panelTipoUsuario">
                                        <h:outputText value="Tipo do Usuário: "/>
                                        <h:selectOneMenu title="Tipo do Usuário do Tributário" id="tipousuario"
                                                         value="#{usuarioSistemaControlador.tipoUsuarioTribUsuario.tipoUsuarioTributario}">
                                            <f:selectItems value="#{usuarioSistemaControlador.tiposUsuarioTributario}"/>
                                        </h:selectOneMenu>

                                        <h:outputText value="Supervisor: "/>
                                        <p:selectBooleanCheckbox
                                            value="#{usuarioSistemaControlador.tipoUsuarioTribUsuario.supervisor}"
                                            id="supervidor"/>
                                    </h:panelGrid>
                                    <p:commandButton value="Adicionar" icon="ui-icon-arrowthick-1-s"
                                                     actionListener="#{usuarioSistemaControlador.addTipoUsuario()}"
                                                     update="tabelaTipoUsuario panelTipoUsuario" styleClass="operacao"/>
                                    <p:dataTable id="tabelaTipoUsuario" styleClass="mtop05"
                                                 value="#{usuarioSistemaControlador.vigenciaTribUsuario.tipoUsuarioTribUsuarios}"
                                                 var="item"
                                                 emptyMessage="Nenhum tipo de usuário cadastrado.">
                                        <p:column headerText="" style="width: 5%; text-align: center">
                                            <p:commandButton icon="ui-icon-trash" title="Remover"
                                                             update="tabelaTipoUsuario"
                                                             actionListener="#{usuarioSistemaControlador.removeTipoUsuario(item)}"/>
                                        </p:column>
                                        <p:column headerText="Tipo de Usuário">
                                            <h:outputText value="#{item.tipoUsuarioTributario.descricao}"/>
                                        </p:column>
                                        <p:column headerText="Supervisor">
                                            <h:outputText value="#{item.supervisor ? 'Sim' : 'Não'}"/>
                                        </p:column>

                                    </p:dataTable>
                                </p:panel>
                                <p:panel header="Lotações" styleClass="mbot05">
                                    <h:panelGrid columns="2" id="panelLotacao">
                                        <h:outputText value="Lotação: "/>
                                        <h:selectOneMenu title="Lotação do Usuário do Tributário" id="lotacao"
                                                         converter="#{usuarioSistemaControlador.converterLotacao}"
                                                         value="#{usuarioSistemaControlador.lotacaoTribUsuario.lotacao}">
                                            <f:selectItems value="#{usuarioSistemaControlador.lotacoes}"/>
                                        </h:selectOneMenu>
                                    </h:panelGrid>
                                    <p:commandButton value="Adicionar" icon="ui-icon-arrowthick-1-s"
                                                     actionListener="#{usuarioSistemaControlador.addLotacao()}"
                                                     update="tabelaLotacao panelLotacao" styleClass="operacao"/>
                                    <p:dataTable id="tabelaLotacao"
                                                 value="#{usuarioSistemaControlador.vigenciaTribUsuario.lotacaoTribUsuarios}"
                                                 var="item" emptyMessage="Nenhuma lotação cadastrada."
                                                 styleClass="mtop05">
                                        <p:column headerText="" style="width: 5%; text-align: center">
                                            <p:commandButton icon="ui-icon-trash" title="Remover" update="tabelaLotacao"

                                                             actionListener="#{usuarioSistemaControlador.removeLotacao(item)}"/>
                                        </p:column>
                                        <p:column headerText="Lotação">
                                            <h:outputText value="#{item.lotacao.descricao}"/>
                                        </p:column>

                                    </p:dataTable>
                                </p:panel>
                                <p:panel header="Controle de Autorizações" styleClass="mbot05">
                                    <h:panelGrid columns="2" id="panelAutorizacoes">
                                        <h:outputText value="Autorização: "/>
                                        <h:selectOneMenu title="Autorização do Usuário do Tributário" id="autorizacao"
                                                         value="#{usuarioSistemaControlador.autorizacaoTributarioUsuario.autorizacao}">
                                            <f:selectItems value="#{usuarioSistemaControlador.autorizacoes}"/>
                                        </h:selectOneMenu>
                                    </h:panelGrid>
                                    <p:commandButton value="Adicionar" icon="ui-icon-arrowthick-1-s"
                                                     actionListener="#{usuarioSistemaControlador.addAutorizacao()}"
                                                     update="tabelaAutorizacao panelAutorizacoes"
                                                     styleClass="operacao"/>
                                    <p:dataTable id="tabelaAutorizacao"
                                                 value="#{usuarioSistemaControlador.vigenciaTribUsuario.autorizacaoTributarioUsuarios}"
                                                 styleClass="mtop05"
                                                 var="item" emptyMessage="Nenhuma autorização cadastrada.">
                                        <p:column headerText="" style="width: 5%; text-align: center">
                                            <p:commandButton icon="ui-icon-trash" title="Remover"
                                                             update="tabelaAutorizacao"
                                                             actionListener="#{usuarioSistemaControlador.removeAutorizacao(item)}"/>
                                        </p:column>
                                        <p:column headerText="Autorização">
                                            <h:outputText value="#{item.autorizacao.descricao}"/>
                                        </p:column>

                                    </p:dataTable>
                                </p:panel>
                                <p:commandButton value="Adicionar Vigência" icon="ui-icon-arrowthick-1-s"
                                                 actionListener="#{usuarioSistemaControlador.addVigencia()}"
                                                 update="tabelaVigencia panelVigencia"
                                                 id="btnAdicionarVigencia"
                                                 onclick="aguarde.show()" oncomplete="aguarde.hide()"
                                                 styleClass="operacao prioritario"/>
                                <p:dataTable id="tabelaVigencia"
                                             value="#{usuarioSistemaControlador.selecionado.vigenciaTribUsuarios}"
                                             styleClass="mtop05"
                                             var="vig" emptyMessage="Nenhuma vigência cadastrada.">
                                    <p:column headerText="" style="width: 10%; text-align: center">
                                        <p:commandButton icon="ui-icon-trash" title="Remover" update="tabelaVigencia"
                                                         onclick="aguarde.show()" oncomplete="aguarde.hide()"
                                                         actionListener="#{usuarioSistemaControlador.removerVigencia(vig)}"/>
                                        <p:commandButton icon="ui-icon-pencil" title="Editar" update=":Formulario:tabViewUsuario:panelVigencia"
                                                         onclick="aguarde.show()" oncomplete="aguarde.hide()"
                                                         actionListener="#{usuarioSistemaControlador.editarVigencia(vig)}"/>
                                    </p:column>
                                    <p:column>
                                        <p:rowToggler/>
                                    </p:column>
                                    <p:column headerText="Inicial">
                                        <h:outputText value="#{vig.vigenciaInicial}">
                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Final">
                                        <h:outputText value="#{vig.vigenciaFinal}">
                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:rowExpansion>
                                        <p:dataTable value="#{vig.tipoUsuarioTribUsuarios}" var="tipo"
                                                     styleClass="mbot05">
                                            <f:facet name="header">
                                                <h:outputText value="Tipos do Usuário"/>
                                            </f:facet>
                                            <p:column headerText="Tipo">
                                                <h:outputText value="#{tipo.tipoUsuarioTributario.descricao}"/>
                                            </p:column>
                                            <p:column headerText="Supervisor">
                                                <h:outputText value="#{tipo.supervisor ? 'Sim' : 'Não'}"/>
                                            </p:column>
                                        </p:dataTable>
                                        <p:dataTable value="#{vig.lotacaoTribUsuarios}" var="lotacao">
                                            <f:facet name="header">
                                                <h:outputText value="Lotações do Usuário"/>
                                            </f:facet>
                                            <p:column headerText="Lotação">
                                                <h:outputText value="#{lotacao.lotacao.descricao}"/>
                                            </p:column>
                                        </p:dataTable>
                                        <br/>
                                        <p:dataTable value="#{vig.autorizacaoTributarioUsuarios}" var="aut">
                                            <f:facet name="header">
                                                <h:outputText value="Autorizações do Usuário"/>
                                            </f:facet>
                                            <p:column headerText="Autorização">
                                                <h:outputText value="#{aut.autorizacao.descricao}"/>
                                            </p:column>
                                        </p:dataTable>
                                    </p:rowExpansion>
                                </p:dataTable>
                            </p:panel>
                        </p:tab>

                        <p:tab title="Configurações do RH">
                            <h:panelGrid columns="2">
                                <h:outputText value="Acesso todos vínculos do RH: "/>
                                <h:selectBooleanCheckbox id="vinculos"
                                                         value="#{usuarioSistemaControlador.selecionado.acessoTodosVinculosRH}"/>

                                <h:outputText value="Valida Status no RH: "/>
                                <h:selectBooleanCheckbox id="statusRh"
                                                         value="#{usuarioSistemaControlador.selecionado.validaStatusRh}"/>
                            </h:panelGrid>
                            <p:panel header="Controle de Autorizações" styleClass="mbot05">

                                <h:panelGrid columns="2" id="panelAutorizacoesRH">
                                    <h:outputText value="Autorização: "/>
                                    <h:selectOneMenu title="Autorização do Usuário do RH" id="autorizacaoRH"
                                                     value="#{usuarioSistemaControlador.autorizacaoUsuarioRH.tipoAutorizacaoRH}">
                                        <f:selectItems value="#{usuarioSistemaControlador.autorizacoesRH}"/>
                                    </h:selectOneMenu>
                                </h:panelGrid>

                                <p:commandButton value="Adicionar" icon="ui-icon-arrowthick-1-s"
                                                 actionListener="#{usuarioSistemaControlador.adicionarAutorizacaoRH}"
                                                 update="tabelaAutorizacaoRH panelAutorizacoesRH"
                                                 onclick="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 styleClass="operacao"/>
                                <p:dataTable id="tabelaAutorizacaoRH"
                                             value="#{usuarioSistemaControlador.selecionado.autorizacaoUsuarioRH}"
                                             styleClass="mtop05"
                                             var="itemAutorizacaoRH" emptyMessage="Nenhuma autorização cadastrada.">
                                    <p:column headerText="" style="width: 5%; text-align: center">
                                        <p:commandButton icon="ui-icon-trash" title="Remover"
                                                         update="tabelaAutorizacaoRH"
                                                         onclick="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         actionListener="#{usuarioSistemaControlador.removerAutorizacaoRH(itemAutorizacaoRH)}"/>
                                    </p:column>
                                    <p:column headerText="Autorização">
                                        <h:outputText value="#{itemAutorizacaoRH.tipoAutorizacaoRH.descricao}"/>
                                    </p:column>
                                </p:dataTable>
                            </p:panel>
                        </p:tab>

                        <p:tab id="tabAssinatura" title="Assinatura">
                            <p:panel id="panelAssinatura" styleClass="semBorda" style="max-width: 50%">
                                <fc:fileUploadWP selecionado="#{usuarioSistemaControlador.assinatura}" allowTypes="/(\.|\/)(gif|jpe?g|png)$/"/>
                            </p:panel>

                            <p:commandButton value="Adicionar" styleClass="operacao mbot05"
                                             actionListener="#{usuarioSistemaControlador.adicionarAssinatura()}"
                                             icon="ui-icon-plus" process="@this"
                                             style="margin-left: 25px !important;"
                                             onclick="aguarde.show()"/>

                            <p:dataTable id="tabelaAssinaturas"
                                         emptyMessage="Nenhum arquivo anexado." style="margin-left: 25px !important;"
                                         value="#{usuarioSistemaControlador.selecionado.assinaturas}"
                                         var="assinatura" styleClass="mtop05" paginator="true"
                                         rows="10" rowIndexVar="rowlx"
                                         paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>ASSINATURAS&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}">
                                <p:column headerText="Ações" style="text-align: center; width:100px">
                                    <p:commandButton
                                        actionListener="#{usuarioSistemaControlador.excluirAssinatura(assinatura)}"
                                        icon="ui-icon-trash"
                                        onclick="if(!confirm('Tem certeza que deseja remover este arquivo?')) {return false;} else {aguarde.show();}"
                                        onstart="aguarde.show()"
                                        oncomplete="aguarde.hide()"
                                        process="@this"
                                        update=":Formulario:tabViewUsuario:tabAssinatura"/>
                                </p:column>
                                <p:column headerText="Arquivos">
                                    <h:outputText
                                        value="#{assinatura.detentorArquivoComposicao.arquivoComposicao.arquivo.descricao}"/>
                                </p:column>
                            </p:dataTable>

                        </p:tab>
                    </p:tabView>
                </p:panel>
            </div>
            <fc:rodapePretty id="rpRodapePretty" controlador="#{usuarioSistemaControlador}"/>
        </h:form>
        <p:dialog header="Unidades Filhas"
                  position="center"
                  modal="true"
                  style="position: fixed!important;"
                  id="dialogUnidades"
                  width="400"
                  minHeight="200"
                  widgetVar="unidades"
                  showHeader="true"
                  closable="false">
            <h:form id="formUnidades">
                <div align="center">
                    <h:outputLabel value="Deseja adicionar as unidades filhas da unidade selecionada?"/>
                    <h:panelGrid columns="2">
                        <p:commandButton styleClass="padrao mtop10 mrig05"
                                         value="Sim"
                                         icon="ui-icon-check"
                                         title="Clique para adicionar as filhas da unidade selecionada"
                                         onstart="aguarde.show();"
                                         process="@this"
                                         actionListener="#{usuarioSistemaControlador.salvarParticipante(true)}"
                                         update=":Formulario:tabViewUsuario:tabelaParticipantes :Formulario:tabViewUsuario:panelGridUnidade :Formulario:tabViewUsuario:panelGridUnidadeOrc :Formulario:tabViewUsuario:tabelaUndsOrc"
                                         oncomplete="aguarde.hide();unidades.hide()"/>

                        <p:commandButton styleClass="padrao mtop10 mrig05"
                                         title="Clique para não adicionar as filhas da unidade selecionada"
                                         actionListener="#{usuarioSistemaControlador.salvarParticipante(false)}"
                                         onstart="aguarde.show()"
                                         oncomplete="aguarde.hide();unidades.hide()"
                                         update=":Formulario:tabViewUsuario:tabelaParticipantes :Formulario:tabViewUsuario:panelGridUnidade :Formulario:tabViewUsuario:panelGridUnidadeOrc :Formulario:tabViewUsuario:tabelaUndsOrc"
                                         process="@this"
                                         value="Não"
                                         icon="ui-icon-close"/>
                    </h:panelGrid>
                </div>
            </h:form>
        </p:dialog>


        <p:dialog header="Unidades Filhas"
                  position="center"
                  modal="true"
                  style="position: fixed!important;"
                  id="dialogMarcarFilhas"
                  width="400"
                  minHeight="200"
                  widgetVar="marcarFilhas"
                  showHeader="true"
                  closable="false">
            <h:form id="formMarcarFilhar">
                <div align="center">
                    <h:outputLabel value="Deseja marcar/desmarcar as unidades filhas da unidade selecionada?"/>
                    <h:panelGrid columns="2">
                        <p:commandButton styleClass="padrao mtop10 mrig05"
                                         value="Sim"
                                         icon="ui-icon-check"
                                         title="Clique para marcar/desmarcar as filhas da unidade selecionada"
                                         onstart="continuarMarcarFilhas();"
                                         process="@this"
                                         oncomplete="marcarFilhas.hide()"/>

                        <p:commandButton styleClass="padrao mtop10 mrig05"
                                         title="Clique para não marcar/desmarcar as filhas da unidade selecionada"
                                         onstart="aguarde.show()"
                                         oncomplete="aguarde.hide();marcarFilhas.hide()"
                                         process="@this"
                                         value="Não"
                                         icon="ui-icon-cancel"/>
                    </h:panelGrid>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog header="Confirmação"
                  position="center"
                  modal="true"
                  style="position: fixed!important;"
                  id="dialogConfirmarRedefnirSenha"
                  width="400"
                  minHeight="200"
                  widgetVar="confirmarRedefinirSenha"
                  showHeader="true"
                  resizable="false"
                  closable="false">
            <h:form id="formRedefinir">
                <div align="center">
                    <h:outputLabel value="Tem certeza que deseja redefinir a senha desse usuário?"
                                   styleClass="negrito"/>

                    <h:panelGrid columns="2">
                        <p:commandButton styleClass="operacao prioritario mtop10 mrig05"
                                         value="Sim"
                                         icon="ui-icon-check"
                                         actionListener="#{usuarioSistemaControlador.redefinirSenha}"
                                         oncomplete="confirmarRedefinirSenha.hide()"/>

                        <p:commandButton styleClass="operacao mtop10 mrig05"
                                         onclick="confirmarRedefinirSenha.hide()"
                                         process="@this"
                                         value="Não"
                                         icon="ui-icon-cancel"/>
                    </h:panelGrid>
                </div>
            </h:form>
        </p:dialog>

        <script type="application/javascript">
            var metodo;

            function confirmarMarcarFilhas(callback) {
                marcarFilhas.show();
                metodo = callback;
            }

            function continuarMarcarFilhas() {
                metodo();
            }


            $(document).ready(function () {
                var allInputs = $('.ui-inputfield');

                $('.ui-inputfield').keypress(function (e) {
                    if (e.which === 13) {
                        $(this).next('.ui-inputfield').focus();
                        e.preventDefault();
                        var nextInput = allInputs.get(allInputs.index(this) + 1);//(3)The next input in my collection of all inputs
                        if (nextInput) {
                            nextInput.focus(); //(4)focus that next input if the input is not null
                        }
                    }
                });
            });

        </script>

    </ui:define>
</ui:composition>
</html>
