DECLARE
texto CLOB := '{"consulta":"select\r\n    trim(o.nome) as nome,\r\n    o.id as id,\r\n    os.situacao as situacaoAtual,\r\n    case when c.id is not null then c.numerocontrato || ''/'' || extract(year from (c.datalancamento)) || '' - '' || c.numerotermo || ''/'' || ex.ano || '' - '' ||\r\n                                    coalesce(formatacpfcnpj(pf.cpf), formatacpfcnpj(pj.cnpj)) || '' - '' || coalesce(pf.nome, pj.razaosocial) else '''' end as contrato,\r\n    c.id as idcontrato,\r\n    trunc(odc.datarecebimento) as datainiciodoprocesso,\r\n    trunc(ot.dataemissao) as datafimdoprocesso,\r\n    trunc(o.inicioexecucao) as iniciodaobra,\r\n    trunc(o.prazoentrega) as terminoobra\r\nfrom obra o\r\n         left join contrato c on o.contrato_id = c.id\r\n         left join exercicio ex on c.exerciciocontrato_id = ex.id\r\n         left join pessoajuridica pj on c.contratado_id = pj.id\r\n         left join pessoafisica pf on c.contratado_id = pf.id\r\n         left join obrasituacao os on os.obra_id = o.id\r\n                                   and os.datasituacao = (select max(datasituacao) from obrasituacao where obra_id = o.id)\r\n         left join ordemdeservicocontrato odc on c.id = odc.contrato_id\r\n                                              and odc.id = (select max(odsc.id) from ordemdeservicocontrato odsc where odsc.contrato_id = c.id)\r\n         left join obratermo ot on ot.obra_id = o.id\r\n                                and ot.definitivo = 1\r\n                                and ot.id = (select max(obt.id) from obratermo obt where obt.obra_id = o.id)\r\nwhere os.situacao = ''PARALIZADA''\r\n    $WHERE\r\norder by c.iniciovigencia desc","count":"select count(o.id)\r\nfrom obra o\r\n         left join contrato c on o.contrato_id = c.id\r\n         left join exercicio ex on c.exerciciocontrato_id = ex.id\r\n         left join pessoajuridica pj on c.contratado_id = pj.id\r\n         left join pessoafisica pf on c.contratado_id = pf.id\r\n         left join obrasituacao os on os.obra_id = o.id\r\n                                   and os.datasituacao = (select max(datasituacao) from obrasituacao where obra_id = o.id)\r\n         left join ordemdeservicocontrato odc on c.id = odc.contrato_id\r\n                                              and odc.id = (select max(odsc.id) from ordemdeservicocontrato odsc where odsc.contrato_id = c.id)\r\n         left join obratermo ot on ot.obra_id = o.id\r\n                                and ot.definitivo = 1\r\n                                and ot.id = (select max(obt.id) from obratermo obt where obt.obra_id = o.id)\r\nwhere os.situacao = ''PARALIZADA''\r\n    $WHERE","totalRegistros":1,"fields":[{"posicao":1,"descricao":"Nome","columnName":"NOME","columnValue":"NOME","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":{"chaveDestino":"detalhe-obra","columnOrigem":"ID","columnDestino":"o.id"},"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":2,"descricao":"ID","columnName":"ID","columnValue":"ID","tipoAlinhamento":"CENTRO","totalizar":false,"link":null,"tipo":"INTEGER","tipoEnum":null,"valorPadrao":null,"escondido":true},{"posicao":3,"descricao":"Situação Atual","columnName":"SITUACAOATUAL","columnValue":"SITUACAOATUAL","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"ENUM","tipoEnum":"br.com.webpublico.enums.TipoSituacaoObra","valorPadrao":[null,"EM_ANDAMENTO","PARALIZADA","CANCELADA","CONCLUIDA"],"escondido":false},{"posicao":4,"descricao":"Contrato","columnName":"CONTRATO","columnValue":"CONTRATO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":{"chaveDestino":"contrato-ver","columnOrigem":"IDCONTRATO","columnDestino":"c.id"},"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":5,"descricao":"IDCONTRATO","columnName":"IDCONTRATO","columnValue":"IDCONTRATO","tipoAlinhamento":"CENTRO","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":true},{"posicao":6,"descricao":"Data de Início de Processo","columnName":"DATAINICIODOPROCESSO","columnValue":"DATAINICIODOPROCESSO","tipoAlinhamento":"CENTRO","totalizar":false,"link":null,"tipo":"DATE","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":7,"descricao":"Data de Fim de Processo","columnName":"DATAFIMDOPROCESSO","columnValue":"DATAFIMDOPROCESSO","tipoAlinhamento":"CENTRO","totalizar":false,"link":null,"tipo":"DATE","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":8,"descricao":"Início da Obra","columnName":"INICIODAOBRA","columnValue":"INICIODAOBRA","tipoAlinhamento":"CENTRO","totalizar":false,"link":null,"tipo":"DATE","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":9,"descricao":"Término da Obra","columnName":"TERMINOOBRA","columnValue":"TERMINOOBRA","tipoAlinhamento":"CENTRO","totalizar":false,"link":null,"tipo":"DATE","tipoEnum":null,"valorPadrao":null,"escondido":false}],"pesquisaveis":[],"tabs":[],"paineis":[]}';
BEGIN
update PAGINAPREFEITURAPORTAL set CONTEUDO = texto where NOME = 'Obras Paralizadas' and CHAVE = 'obra-paralizada';
END;
