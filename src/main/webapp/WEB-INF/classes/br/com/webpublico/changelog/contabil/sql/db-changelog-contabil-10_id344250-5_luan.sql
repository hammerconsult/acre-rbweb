DECLARE
texto CLOB := '{"consulta":"WITH ITENS(ID, CODIGO, DESCRICAO, SUPERIOR_ID, ORCADA_INI, ORCADA_ATU, ARRECADADO) AS (SELECT CONTA_ID,\r\n CONTA_COD,\r\n CONTA_DESC,\r\n CONTA_SUPER,\r\n SUM(ORCADA_INI) AS ORCADA_INI,\r\n SUM(ORCADA_ATU) as ORCADA_ATU,\r\n SUM(ARRECADADO) as ARRECADADO\r\n FROM (SELECT C.ID AS CONTA_ID,\r\n C.CODIGO AS CONTA_COD,\r\n C.DESCRICAO AS CONTA_DESC,\r\n C.SUPERIOR_ID AS CONTA_SUPER,\r\n 0 as orcada_ini,\r\n case\r\n when ALT.operacaoreceita in\r\n (''DEDUCAO_RECEITA_RENUNCIA'',\r\n ''DEDUCAO_RECEITA_RESTITUICAO'',\r\n ''DEDUCAO_RECEITA_DESCONTO'',\r\n ''DEDUCAO_RECEITA_FUNDEB'',\r\n ''DEDUCAO_RECEITA_OUTRAS'')\r\n then\r\n (COALESCE(\r\n DECODE(\r\n ALT.TIPOALTERACAOORC,\r\n ''PREVISAO'',\r\n ALT.VALOR,\r\n ALT.VALOR *\r\n (-1)),\r\n 0)) *\r\n -1\r\n else (COALESCE(\r\n DECODE(\r\n ALT.TIPOALTERACAOORC,\r\n ''PREVISAO'',\r\n ALT.VALOR,\r\n ALT.VALOR *\r\n (-1)),\r\n 0)) end AS ORCADA_ATU,\r\n 0 AS ARRECADADO\r\n FROM RECEITALOA REC\r\n INNER JOIN RECEITAALTERACAOORC ALT ON REC.ID = ALT.RECEITALOA_ID\r\n INNER join fontederecursos fr on alt.fontederecurso_id = fr.id\r\n INNER join contadedestinacao cd on cd.id = alt.contaDeDestinacao_id\r\n INNER JOIN ALTERACAOORC ALTORC ON ALTORC.ID = ALT.ALTERACAOORC_ID\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VW\r\n ON VW.SUBORDINADA_ID =\r\n REC.ENTIDADE_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VWORG\r\n ON VWORG.SUBORDINADA_ID =\r\n VW.SUPERIOR_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VWORG.INICIOVIGENCIA AND COALESCE(VWORG.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN CONTA C ON REC.CONTADERECEITA_ID = C.ID\r\n INNER JOIN exercicio ex ON c.exercicio_id = ex.ID\r\n where trunc(ALTORC.DATAEFETIVACAO) between TO_DATE(''01/01/'' || ex.ano, ''DD/MM/YYYY'') AND TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'')\r\n and ALTORC.STATUS in (''DEFERIDO'', ''ESTORNADA'')\r\n and ex.ano = $ANO\r\n and VW.SUBORDINADA_ID in (select UNIDADE_ID from UNIDADEPREFEITURAPORTAL where PREFEITURA_ID = $PREFEITURAPORTAL_ID)\r\n UNION ALL\r\n SELECT C.ID AS CONTA_ID,\r\n C.CODIGO AS CONTA_COD,\r\n C.DESCRICAO AS CONTA_DESC,\r\n C.SUPERIOR_ID AS CONTA_SUPER,\r\n 0 as orcada_ini,\r\n case\r\n when ALT.operacaoreceita in\r\n (''DEDUCAO_RECEITA_RENUNCIA'',\r\n ''DEDUCAO_RECEITA_RESTITUICAO'',\r\n ''DEDUCAO_RECEITA_DESCONTO'',\r\n ''DEDUCAO_RECEITA_FUNDEB'',\r\n ''DEDUCAO_RECEITA_OUTRAS'')\r\n then\r\n (COALESCE(\r\n DECODE(\r\n ALT.TIPOALTERACAOORC,\r\n ''PREVISAO'',\r\n ALT.VALOR *\r\n (-1),\r\n ALT.VALOR),\r\n 0)) *\r\n -1\r\n else (COALESCE(\r\n DECODE(\r\n ALT.TIPOALTERACAOORC,\r\n ''PREVISAO'',\r\n ALT.VALOR *\r\n (-1),\r\n ALT.VALOR),\r\n 0)) end AS ORCADA_ATU,\r\n 0 AS ARRECADADO\r\n FROM RECEITALOA REC\r\n INNER JOIN RECEITAALTERACAOORC ALT ON REC.ID = ALT.RECEITALOA_ID\r\n INNER JOIN ALTERACAOORC ALTORC ON ALTORC.ID = ALT.ALTERACAOORC_ID\r\n INNER JOIN ESTORNOALTERACAOORC EST ON EST.ALTERACAOORC_ID = ALTORC.ID\r\n INNER join fontederecursos fr on alt.fontederecurso_id = fr.id\r\n INNER join contadedestinacao cd on cd.id = alt.contaDeDestinacao_id\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VW\r\n ON VW.SUBORDINADA_ID =\r\n REC.ENTIDADE_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VWORG\r\n ON VWORG.SUBORDINADA_ID =\r\n VW.SUPERIOR_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VWORG.INICIOVIGENCIA AND COALESCE(VWORG.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN CONTA C ON REC.CONTADERECEITA_ID = C.ID\r\n INNER JOIN exercicio ex ON c.exercicio_id = ex.ID\r\n where trunc(est.dataestorno) between TO_DATE(''01/01/'' || ex.ano, ''DD/MM/YYYY'') AND TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'')\r\n and ex.ano = $ANO\r\n and VW.SUBORDINADA_ID in (select UNIDADE_ID from UNIDADEPREFEITURAPORTAL where PREFEITURA_ID = $PREFEITURAPORTAL_ID)\r\n UNION ALL\r\n SELECT C.ID AS CONTA_ID,\r\n C.CODIGO AS CONTA_COD,\r\n C.DESCRICAO AS CONTA_DESC,\r\n C.SUPERIOR_ID AS CONTA_SUPER,\r\n case\r\n when RECLOA.operacaoreceita in\r\n (''DEDUCAO_RECEITA_RENUNCIA'',\r\n ''DEDUCAO_RECEITA_RESTITUICAO'',\r\n ''DEDUCAO_RECEITA_DESCONTO'',\r\n ''DEDUCAO_RECEITA_FUNDEB'',\r\n ''DEDUCAO_RECEITA_OUTRAS'')\r\n then COALESCE(SUM(RECLOAFONTE.VALOR), 0) * -1\r\n else COALESCE(SUM(RECLOAFONTE.VALOR), 0) end as ORCADA_INI,\r\n 0 AS ORCADA_ATU,\r\n 0 AS ARRECADADO\r\n FROM RECEITALOA RECLOA\r\n INNER JOIN receitaloafonte RECLOAFONTE ON RECLOAFONTE.RECEITALOA_ID = RECLOA.ID\r\n INNER join contadedestinacao cd on RECLOAFONTE.destinacaoderecursos_id = cd.id\r\n INNER join fontederecursos fr on cd.fontederecursos_id = fr.id\r\n INNER JOIN LOA ON LOA.ID = RECLOA.LOA_ID\r\n INNER JOIN LDO ON LDO.ID = LOA.LDO_ID\r\n inner join exercicio ex on LDO.EXERCICIO_ID = ex.ID\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VW\r\n ON VW.SUBORDINADA_ID =\r\n RECLOA.ENTIDADE_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VWORG\r\n ON VWORG.SUBORDINADA_ID =\r\n VW.SUPERIOR_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VWORG.INICIOVIGENCIA AND COALESCE(VWORG.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN CONTA C ON RECLOA.CONTADERECEITA_ID = C.ID\r\n WHERE ex.ano = $ANO\r\n and VW.SUBORDINADA_ID in (select UNIDADE_ID from UNIDADEPREFEITURAPORTAL where PREFEITURA_ID = $PREFEITURAPORTAL_ID)\r\n GROUP BY C.ID, C.CODIGO,\r\n C.DESCRICAO,\r\n C.SUPERIOR_ID,\r\n vw.codigo,\r\n vw.descricao,\r\n vworg.codigo,\r\n vworg.descricao,\r\n c.categoria,\r\n RECLOA.operacaoreceita\r\n UNION ALL\r\n SELECT CONTA_ID,\r\n CONTA_COD,\r\n CONTA_DESC,\r\n CONTA_SUPER,\r\n 0 AS ORCADA_INI,\r\n 0 AS ORCADA_ATU,\r\n COALESCE(SUM(ARRECADADO), 0) AS ARRECADADO\r\n FROM (SELECT C.ID AS CONTA_ID,\r\n C.CODIGO AS CONTA_COD,\r\n C.DESCRICAO AS CONTA_DESC,\r\n C.SUPERIOR_ID AS CONTA_SUPER,\r\n\r\n case\r\n when lanc.operacaoreceitarealizada in\r\n (''DEDUCAO_RECEITA_RENUNCIA'',\r\n ''DEDUCAO_RECEITA_RESTITUICAO'',\r\n ''DEDUCAO_RECEITA_DESCONTO'',\r\n ''DEDUCAO_RECEITA_FUNDEB'',\r\n ''DEDUCAO_RECEITA_OUTRAS'')\r\n then COALESCE(LANCrec.VALOR, 0) * -1\r\n else COALESCE(LANCrec.VALOR, 0) end AS ARRECADADO\r\n FROM CONTA C\r\n INNER JOIN RECEITALOA RECLOA ON RECLOA.CONTADERECEITA_ID = C.ID\r\n INNER JOIN LANCAMENTORECEITAORC LANC ON LANC.RECEITALOA_ID = RECLOA.ID\r\n inner join lancReceitaFonte lancrec on lancrec.LANCRECEITAORC_ID = lanc.id\r\n INNER JOIN receitaloafonte RECLOAFONTE\r\n ON RECLOAFONTE.ID = lancrec.RECEITALOAFONTE_ID\r\n INNER join contadedestinacao cd on RECLOAFONTE.destinacaoderecursos_id = cd.id\r\n INNER join fontederecursos fr on cd.fontederecursos_id = fr.id\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VW\r\n ON VW.SUBORDINADA_ID =\r\n RECLOA.ENTIDADE_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VWORG\r\n ON VWORG.SUBORDINADA_ID =\r\n VW.SUPERIOR_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VWORG.INICIOVIGENCIA AND COALESCE(VWORG.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n where trunc(LANC.DATALANCAMENTO) between TO_DATE(''01/01/$ANO'', ''DD/MM/YYYY'') AND TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'')\r\n and VW.SUBORDINADA_ID in (select UNIDADE_ID from UNIDADEPREFEITURAPORTAL where PREFEITURA_ID = $PREFEITURAPORTAL_ID)\r\n UNION ALL\r\n SELECT C.ID AS CONTA_ID,\r\n ';
 texto2 CLOB := 'C.CODIGO AS CONTA_COD,\r\n C.DESCRICAO AS CONTA_DESC,\r\n C.SUPERIOR_ID AS CONTA_SUPER,\r\n case\r\n when lanc.operacaoreceitarealizada in\r\n (''DEDUCAO_RECEITA_RENUNCIA'',\r\n ''DEDUCAO_RECEITA_RESTITUICAO'',\r\n ''DEDUCAO_RECEITA_DESCONTO'',\r\n ''DEDUCAO_RECEITA_FUNDEB'',\r\n ''DEDUCAO_RECEITA_OUTRAS'')\r\n then (COALESCE(lancrecF.VALOR, 0) * -1) * -1\r\n else COALESCE(lancrecF.VALOR, 0) * -1 end AS ARRECADADO\r\n FROM CONTA C\r\n INNER JOIN RECEITALOA RECLOA ON RECLOA.CONTADERECEITA_ID = C.ID\r\n INNER JOIN RECEITAORCESTORNO LANC ON LANC.RECEITALOA_ID = RECLOA.ID\r\n INNER JOIN ReceitaORCFonteEstorno lancrecF\r\n ON lancrecf.receitaorcestorno_id = LANC.id\r\n INNER JOIN receitaloafonte RECLOAFONTE\r\n ON RECLOAFONTE.ID = lancrecF.RECEITALOAFONTE_ID\r\n INNER join contadedestinacao cd on RECLOAFONTE.destinacaoderecursos_id = cd.id\r\n INNER join fontederecursos fr on cd.fontederecursos_id = fr.id\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VW\r\n ON VW.SUBORDINADA_ID =\r\n RECLOA.ENTIDADE_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VWORG\r\n ON VWORG.SUBORDINADA_ID =\r\n VW.SUPERIOR_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VWORG.INICIOVIGENCIA AND COALESCE(VWORG.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n where trunc(LANC.DATAESTORNO) between TO_DATE(''01/01/$ANO'', ''DD/MM/YYYY'')\r\n AND TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'')\r\n and VW.SUBORDINADA_ID in (select UNIDADE_ID from UNIDADEPREFEITURAPORTAL where PREFEITURA_ID = $PREFEITURAPORTAL_ID)\r\n ) ARRECADADO_NO_MES\r\n GROUP BY CONTA_ID, CONTA_COD, CONTA_DESC, CONTA_SUPER) DADOS\r\n GROUP BY CONTA_ID, CONTA_COD, CONTA_DESC, CONTA_SUPER\r\n UNION ALL\r\n SELECT SUP.ID,\r\n SUP.CODIGO,\r\n SUP.DESCRICAO,\r\n SUP.SUPERIOR_ID,\r\n IT.ORCADA_INI,\r\n IT.ORCADA_ATU,\r\n IT.ARRECADADO\r\n FROM ITENS IT\r\n INNER JOIN CONTA SUP ON IT.SUPERIOR_ID = SUP.ID)\r\nSELECT id,\r\n codigo,\r\n descricao,\r\n COALESCE(SUM(ORCADA_INI), 0) AS orcadaInicial,\r\n COALESCE(SUM(ORCADA_INI), 0) + COALESCE(SUM(ORCADA_ATU), 0) AS orcadaAtual,\r\n COALESCE(SUM(ARRECADADO), 0) AS arrecadado,\r\n NIVELESTRUTURA(CODIGO, ''.'') as nivel\r\nFROM ITENS WHERE CODIGO is not null $WHERE\r\nGROUP BY id, CODIGO, DESCRICAO\r\nORDER BY CODIGO, DESCRICAO ","count":"select count(id) from (\r\n WITH ITENS(ID, CODIGO, DESCRICAO, SUPERIOR_ID, ORCADA_INI, ORCADA_ATU, ARRECADADO) AS (SELECT CONTA_ID,\r\n CONTA_COD,\r\n CONTA_DESC,\r\n CONTA_SUPER,\r\n SUM(ORCADA_INI) AS ORCADA_INI,\r\n SUM(ORCADA_ATU) as ORCADA_ATU,\r\n SUM(ARRECADADO) as ARRECADADO\r\n FROM (SELECT C.ID AS CONTA_ID,\r\n C.CODIGO AS CONTA_COD,\r\n C.DESCRICAO AS CONTA_DESC,\r\n C.SUPERIOR_ID AS CONTA_SUPER,\r\n 0 as orcada_ini,\r\n case\r\n when ALT.operacaoreceita in\r\n (''DEDUCAO_RECEITA_RENUNCIA'',\r\n ''DEDUCAO_RECEITA_RESTITUICAO'',\r\n ''DEDUCAO_RECEITA_DESCONTO'',\r\n ''DEDUCAO_RECEITA_FUNDEB'',\r\n ''DEDUCAO_RECEITA_OUTRAS'')\r\n then\r\n (COALESCE(\r\n DECODE(\r\n ALT.TIPOALTERACAOORC,\r\n ''PREVISAO'',\r\n ALT.VALOR,\r\n ALT.VALOR *\r\n (-1)),\r\n 0)) *\r\n -1\r\n else (COALESCE(\r\n DECODE(\r\n ALT.TIPOALTERACAOORC,\r\n ''PREVISAO'',\r\n ALT.VALOR,\r\n ALT.VALOR *\r\n (-1)),\r\n 0)) end AS ORCADA_ATU,\r\n 0 AS ARRECADADO\r\n FROM RECEITALOA REC\r\n INNER JOIN RECEITAALTERACAOORC ALT ON REC.ID = ALT.RECEITALOA_ID\r\n INNER join fontederecursos fr on alt.fontederecurso_id = fr.id\r\n INNER join contadedestinacao cd on cd.id = alt.contaDeDestinacao_id\r\n INNER JOIN ALTERACAOORC ALTORC ON ALTORC.ID = ALT.ALTERACAOORC_ID\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VW\r\n ON VW.SUBORDINADA_ID =\r\n REC.ENTIDADE_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VWORG\r\n ON VWORG.SUBORDINADA_ID =\r\n VW.SUPERIOR_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VWORG.INICIOVIGENCIA AND COALESCE(VWORG.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN CONTA C ON REC.CONTADERECEITA_ID = C.ID\r\n INNER JOIN exercicio ex ON c.exercicio_id = ex.ID\r\n where trunc(ALTORC.DATAEFETIVACAO) between TO_DATE(''01/01/'' || ex.ano, ''DD/MM/YYYY'') AND TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'')\r\n and ALTORC.STATUS in (''DEFERIDO'', ''ESTORNADA'')\r\n and ex.ano = $ANO\r\n\r\n UNION ALL\r\n SELECT C.ID AS CONTA_ID,\r\n C.CODIGO AS CONTA_COD,\r\n C.DESCRICAO AS CONTA_DESC,\r\n C.SUPERIOR_ID AS CONTA_SUPER,\r\n 0 as orcada_ini,\r\n case\r\n when ALT.operacaoreceita in\r\n (''DEDUCAO_RECEITA_RENUNCIA'',\r\n ''DEDUCAO_RECEITA_RESTITUICAO'',\r\n ''DEDUCAO_RECEITA_DESCONTO'',\r\n ''DEDUCAO_RECEITA_FUNDEB'',\r\n ''DEDUCAO_RECEITA_OUTRAS'')\r\n then\r\n (COALESCE(\r\n DECODE(\r\n ALT.TIPOALTERACAOORC,\r\n ''PREVISAO'',\r\n ALT.VALOR *\r\n (-1),\r\n ALT.VALOR),\r\n 0)) *\r\n -1\r\n else (COALESCE(\r\n DECODE(\r\n ALT.TIPOALTERACAOORC,\r\n ''PREVISAO'',\r\n ALT.VALOR *\r\n (-1),\r\n ALT.VALOR),\r\n 0)) end AS ORCADA_ATU,\r\n 0 AS ARRECADADO\r\n FROM RECEITALOA REC\r\n INNER JOIN RECEITAALTERACAOORC ALT ON REC.ID = ALT.RECEITALOA_ID\r\n INNER JOIN ALTERACAOORC ALTORC ON ALTORC.ID = ALT.ALTERACAOORC_ID\r\n INNER JOIN ESTORNOALTERACAOORC EST ON EST.ALTERACAOORC_ID = ALTORC.ID\r\n INNER join fontederecursos fr on alt.fontederecurso_id = fr.id\r\n INNER join contadedestinacao cd on cd.id = alt.contaDeDestinacao_id\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VW\r\n ON VW.SUBORDINADA_ID =\r\n REC.ENTIDADE_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VWORG\r\n ON VWORG.SUBORDINADA_ID =\r\n VW.SUPERIOR_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VWORG.INICIOVIGENCIA AND COALESCE(VWORG.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN CONTA C ON REC.CONTADERECEITA_ID = C.ID\r\n INNER JOIN exercicio ex ON c.exercicio_id = ex.ID\r\n where trunc(est.dataestorno) between TO_DATE(''01/01/'' || ex.ano, ''DD/MM/YYYY'') AND TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'')\r\n and ex.ano = $ANO\r\n\r\n UNION ALL\r\n SELECT C.ID AS CONTA_ID,\r\n C.CODIGO AS CONTA_COD,\r\n C.DESCRICAO AS CONTA_DESC,\r\n C.SUPERIOR_ID AS CONTA_SUPER,\r\n case\r\n when RECLOA.operacaoreceita in\r\n (''DEDUCAO_RECEITA_RENUNCIA'',\r\n ''DEDUCAO_RECEITA_RESTITUICAO'',\r\n ''DEDUCAO_RECEITA_DESCONTO'',\r\n ''DEDUCAO_RECEITA_FUNDEB'',\r\n ''DEDUCAO_RECEITA_OUTRAS'')\r\n then COALESCE(SUM(RECLOAFONTE.VALOR), 0) * -1\r\n else COALESCE(SUM(RECLOAFONTE.VALOR), 0) end as ORCADA_INI,\r\n 0 AS ORCADA_ATU,\r\n 0 AS ARRECADADO\r\n FROM RECEITALOA RECLOA\r\n INNER JOIN receitaloafonte RECLOAFONTE ON RECLOAFONTE.RECEITALOA_ID = RECLOA.ID\r\n INNER join contadedestinacao cd on RECLOAFONTE.destinacaoderecursos_id = cd.id\r\n INNER join fontederecursos fr on cd.fontederecursos_id = fr.id\r\n INNER JOIN LOA ON LOA.ID = RECLOA.LOA_ID\r\n INNER JOIN LDO ON LDO.ID = LOA.LDO_ID\r\n inner join exercicio ex on LDO.EXERCICIO_ID = ex.ID\r\n ';
 texto3 CLOB := 'INNER JOIN VWHIERARQUIAORCAMENTARIA VW\r\n ON VW.SUBORDINADA_ID =\r\n RECLOA.ENTIDADE_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VWORG\r\n ON VWORG.SUBORDINADA_ID =\r\n VW.SUPERIOR_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VWORG.INICIOVIGENCIA AND COALESCE(VWORG.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN CONTA C ON RECLOA.CONTADERECEITA_ID = C.ID\r\n WHERE ex.ano = $ANO\r\n\r\n GROUP BY C.ID, C.CODIGO,\r\n C.DESCRICAO,\r\n C.SUPERIOR_ID,\r\n vw.codigo,\r\n vw.descricao,\r\n vworg.codigo,\r\n vworg.descricao,\r\n c.categoria,\r\n RECLOA.operacaoreceita\r\n UNION ALL\r\n SELECT CONTA_ID,\r\n CONTA_COD,\r\n CONTA_DESC,\r\n CONTA_SUPER,\r\n 0 AS ORCADA_INI,\r\n 0 AS ORCADA_ATU,\r\n COALESCE(SUM(ARRECADADO), 0) AS ARRECADADO\r\n FROM (SELECT C.ID AS CONTA_ID,\r\n C.CODIGO AS CONTA_COD,\r\n C.DESCRICAO AS CONTA_DESC,\r\n C.SUPERIOR_ID AS CONTA_SUPER,\r\n\r\n case\r\n when lanc.operacaoreceitarealizada in\r\n (''DEDUCAO_RECEITA_RENUNCIA'',\r\n ''DEDUCAO_RECEITA_RESTITUICAO'',\r\n ''DEDUCAO_RECEITA_DESCONTO'',\r\n ''DEDUCAO_RECEITA_FUNDEB'',\r\n ''DEDUCAO_RECEITA_OUTRAS'')\r\n then COALESCE(LANCrec.VALOR, 0) * -1\r\n else COALESCE(LANCrec.VALOR, 0) end AS ARRECADADO\r\n FROM CONTA C\r\n INNER JOIN RECEITALOA RECLOA ON RECLOA.CONTADERECEITA_ID = C.ID\r\n INNER JOIN LANCAMENTORECEITAORC LANC ON LANC.RECEITALOA_ID = RECLOA.ID\r\n inner join lancReceitaFonte lancrec on lancrec.LANCRECEITAORC_ID = lanc.id\r\n INNER JOIN receitaloafonte RECLOAFONTE\r\n ON RECLOAFONTE.ID = lancrec.RECEITALOAFONTE_ID\r\n INNER join contadedestinacao cd on RECLOAFONTE.destinacaoderecursos_id = cd.id\r\n INNER join fontederecursos fr on cd.fontederecursos_id = fr.id\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VW\r\n ON VW.SUBORDINADA_ID =\r\n RECLOA.ENTIDADE_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VWORG\r\n ON VWORG.SUBORDINADA_ID =\r\n VW.SUPERIOR_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VWORG.INICIOVIGENCIA AND COALESCE(VWORG.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n where trunc(LANC.DATALANCAMENTO) between TO_DATE(''01/01/$ANO'', ''DD/MM/YYYY'') AND TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'')\r\n\r\n UNION ALL\r\n SELECT C.ID AS CONTA_ID,\r\n C.CODIGO AS CONTA_COD,\r\n C.DESCRICAO AS CONTA_DESC,\r\n C.SUPERIOR_ID AS CONTA_SUPER,\r\n case\r\n when lanc.operacaoreceitarealizada in\r\n (''DEDUCAO_RECEITA_RENUNCIA'',\r\n ''DEDUCAO_RECEITA_RESTITUICAO'',\r\n ''DEDUCAO_RECEITA_DESCONTO'',\r\n ''DEDUCAO_RECEITA_FUNDEB'',\r\n ''DEDUCAO_RECEITA_OUTRAS'')\r\n then (COALESCE(lancrecF.VALOR, 0) * -1) * -1\r\n else COALESCE(lancrecF.VALOR, 0) * -1 end AS ARRECADADO\r\n FROM CONTA C\r\n INNER JOIN RECEITALOA RECLOA ON RECLOA.CONTADERECEITA_ID = C.ID\r\n INNER JOIN RECEITAORCESTORNO LANC ON LANC.RECEITALOA_ID = RECLOA.ID\r\n INNER JOIN ReceitaORCFonteEstorno lancrecF\r\n ON lancrecf.receitaorcestorno_id = LANC.id\r\n INNER JOIN receitaloafonte RECLOAFONTE\r\n ON RECLOAFONTE.ID = lancrecF.RECEITALOAFONTE_ID\r\n INNER join contadedestinacao cd on RECLOAFONTE.destinacaoderecursos_id = cd.id\r\n INNER join fontederecursos fr on cd.fontederecursos_id = fr.id\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VW\r\n ON VW.SUBORDINADA_ID =\r\n RECLOA.ENTIDADE_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n INNER JOIN VWHIERARQUIAORCAMENTARIA VWORG\r\n ON VWORG.SUBORDINADA_ID =\r\n VW.SUPERIOR_ID AND\r\n TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'') BETWEEN VWORG.INICIOVIGENCIA AND COALESCE(VWORG.FIMVIGENCIA, TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY''))\r\n where trunc(LANC.DATAESTORNO) between TO_DATE(''01/01/$ANO'', ''DD/MM/YYYY'') AND TO_DATE(''31/12/$ANO'', ''DD/MM/YYYY'')) ARRECADADO_NO_MES\r\n GROUP BY CONTA_ID, CONTA_COD, CONTA_DESC, CONTA_SUPER) DADOS\r\n GROUP BY CONTA_ID, CONTA_COD, CONTA_DESC, CONTA_SUPER\r\n UNION ALL\r\n SELECT SUP.ID,\r\n SUP.CODIGO,\r\n SUP.DESCRICAO,\r\n SUP.SUPERIOR_ID,\r\n IT.ORCADA_INI,\r\n IT.ORCADA_ATU,\r\n IT.ARRECADADO\r\n FROM ITENS IT\r\n INNER JOIN CONTA SUP ON IT.SUPERIOR_ID = SUP.ID)\r\n SELECT id,\r\n codigo,\r\n descricao,\r\n COALESCE(SUM(ORCADA_INI), 0) AS orcadaInicial,\r\n COALESCE(SUM(ORCADA_INI), 0) + COALESCE(SUM(ORCADA_ATU), 0) AS orcadaAtual,\r\n COALESCE(SUM(ARRECADADO), 0) AS arrecadado,\r\n NIVELESTRUTURA(CODIGO, ''.'') as nivel\r\n FROM ITENS WHERE CODIGO is not null $WHERE\r\n GROUP BY id, CODIGO, DESCRICAO\r\n ORDER BY CODIGO, DESCRICAO\r\n )","totalRegistros":385,"fields":[{"posicao":1,"descricao":"ID","columnName":"ID","columnValue":"ID","tipoAlinhamento":"CENTRO","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":true},{"posicao":2,"descricao":"Código","columnName":"CODIGO","columnValue":"CODIGO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":3,"descricao":"Descrição","columnName":"DESCRICAO","columnValue":"DESCRICAO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":4,"descricao":"Orçada Inicial","columnName":"ORCADAINICIAL","columnValue":"ORCADAINICIAL","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":5,"descricao":"Orçada Atual","columnName":"ORCADAATUAL","columnValue":"ORCADAATUAL","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":6,"descricao":"Arrecadado","columnName":"ARRECADADO","columnValue":"ARRECADADO","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":7,"descricao":"NIVEL","columnName":"NIVEL","columnValue":"NIVELESTRUTURA(CODIGO, ''.'')","tipoAlinhamento":"CENTRO","totalizar":false,"link":null,"tipo":"INTEGER","tipoEnum":null,"valorPadrao":null,"escondido":true}],"pesquisaveis":[{"descricao":"Conta","columnName":"CODIGO","columnValue":null,"tipo":"MULTI_SELECT","operacaoPadrao":null,"tipoEnum":null,"valorPadrao":"","tipoMultiSelect":"NATUREZA_DA_RECEITA"},{"descricao":"NIVEL","columnName":"NIVELESTRUTURA(CODIGO, ''.'')","columnValue":"NIVEL","tipo":"INTEGER","operacaoPadrao":null,"tipoEnum":null,"valorPadrao":""}]}';
BEGIN
 dbms_lob.append(texto,texto2);
 dbms_lob.append(texto,texto3);
update PAGINAPREFEITURAPORTAL set CONTEUDO = texto where NOME = 'Arrecadação' and CHAVE = 'arrecadacao';
END;
