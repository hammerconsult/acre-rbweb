<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="RelatorioConciliacaoBancaria_subreport2" pageWidth="555" pageHeight="802" whenNoDataType="NoDataSection" columnWidth="555" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0">
	<property name="ireport.zoom" value="1.7715610000000022"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA[""]]></defaultValueExpression>
	</parameter>
	<parameter name="DATAREFERENCIA" class="java.lang.String"/>
	<parameter name="EXERCICIO" class="java.lang.Long"/>
	<parameter name="SQL" class="java.lang.String">
		<defaultValueExpression><![CDATA[" and 1 = 1 "]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[--Crédito
SELECT
       HISTORICO,
       TO_CHAR(DATA_MOVIMENTO, 'dd/MM/yyyy') AS DATA_MOVIMENTO,
       TO_CHAR(DATA_MOVIMENTO, 'MM/yyyy') AS MES_MOVIMENTO,
       SUM(COALESCE(CREDITO, 0)) AS CREDITO,
       COALESCE(NUMERO, '--') AS NUMERO,
       TIPO_MOVIMENTO
FROM (
--RECEITA REALIZADA ESTORNO
SELECT RRE.DATAESTORNO AS DATA_MOVIMENTO,
RRE.COMPLEMENTOHISTORICO AS HISTORICO,
COALESCE(RRE.VALOR, 0) AS CREDITO,
0 AS DEBITO,
COALESCE(RRE.NUMERO, '--') AS NUMERO,
'Est. de Rec. Realizada' AS TIPO_MOVIMENTO
FROM  RECEITAORCESTORNO RRE
INNER JOIN VWHIERARQUIAORCAMENTARIA VW ON RRE.UNIDADEORGANIZACIONALORC = VW.SUBORDINADA_ID
INNER JOIN LANCAMENTORECEITAORC RR ON RRE.LANCAMENTORECEITAORC_ID = RR.ID
INNER JOIN RECEITALOA RL ON RR.RECEITALOA_ID = RL.ID
INNER JOIN CONTARECEITA CR ON CR.ID = RL.CONTADERECEITA_ID
INNER JOIN RECEITALOAFONTE RLF ON RLF.RECEITALOA_ID = RL.ID
INNER JOIN CONTADEDESTINACAO CD ON CD.ID = RLF.DESTINACAODERECURSOS_ID
INNER JOIN FONTEDERECURSOS FONT ON CD.FONTEDERECURSOS_ID = FONT.ID
INNER JOIN SUBCONTA SUB ON RR.SUBCONTA_ID = SUB.ID
INNER JOIN CONTABANCARIAENTIDADE CONTBANC ON SUB.CONTABANCARIAENTIDADE_ID = CONTBANC.ID
inner join agencia agencia on contbanc.agencia_id = agencia.id
inner join banco banco on agencia.banco_id = banco.id
WHERE CR.TIPOSCREDITO = 'DEDUCAO_DA_RECEITA'
AND RRE.DATAESTORNO <= TO_DATE($P{DATAREFERENCIA}, 'DD/MM/YYYY')
AND RRE.DATAESTORNO BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, RRE.DATAESTORNO) $P!{SQL}
UNION ALL
--PAGAMENTO
SELECT PAG.DATAPAGAMENTO AS DATA_MOVIMENTO,
PAG.HISTORICORAZAO AS HISTORICO,
COALESCE(PAG.VALORFINAL, 0 ) AS CREDITO,
0 AS DEBITO,
COALESCE(PAG.NUMEROPAGAMENTO, '--') AS NUMERO,
'Pagamento' AS TIPO_MOVIMENTO
FROM PAGAMENTO PAG
INNER JOIN VWHIERARQUIAORCAMENTARIA VW ON VW.SUBORDINADA_ID = PAG.UNIDADEORGANIZACIONAL_ID
INNER JOIN LIQUIDACAO LIQ ON PAG.LIQUIDACAO_ID = LIQ.ID
INNER JOIN EMPENHO EMP ON LIQ.EMPENHO_ID = EMP.ID
INNER JOIN FONTEDESPESAORC FDO ON EMP.FONTEDESPESAORC_ID = FDO.ID
INNER JOIN PROVISAOPPAFONTE PROVISAO ON FDO.PROVISAOPPAFONTE_ID = PROVISAO.ID
INNER JOIN CONTADEDESTINACAO CDT ON PROVISAO.DESTINACAODERECURSOS_ID = CDT.ID
INNER JOIN FONTEDERECURSOS FONT ON CDT.FONTEDERECURSOS_ID = FONT.ID
INNER JOIN SUBCONTA SUB ON PAG.SUBCONTA_ID = SUB.ID
INNER JOIN CONTABANCARIAENTIDADE CONTBANC ON SUB.CONTABANCARIAENTIDADE_ID = CONTBANC.ID
inner join agencia agencia on contbanc.agencia_id = agencia.id
inner join banco banco on agencia.banco_id = banco.id
WHERE PAG.CATEGORIAORCAMENTARIA = 'NORMAL'
AND CAST(PAG.DATAPAGAMENTO AS DATE) <= TO_DATE($P{DATAREFERENCIA}, 'DD/MM/YYYY')
AND PAG.DATAPAGAMENTO BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, PAG.DATAPAGAMENTO) $P!{SQL}
UNION ALL

--PAGAMENTO DE RESTO
SELECT PAG.DATAPAGAMENTO AS DATA_MOVIMENTO,
PAG.HISTORICORAZAO AS HISTORICO,
COALESCE(PAG.VALORFINAL, 0 ) AS CREDITO,
0 AS DEBITO,
COALESCE(PAG.NUMEROPAGAMENTO, '--') AS NUMERO,
'Pagamento de Resto' AS TIPO_MOVIMENTO
FROM PAGAMENTO PAG
INNER JOIN VWHIERARQUIAORCAMENTARIA VW ON VW.SUBORDINADA_ID = PAG.UNIDADEORGANIZACIONAL_ID
INNER JOIN LIQUIDACAO LIQ ON PAG.LIQUIDACAO_ID = LIQ.ID
INNER JOIN EMPENHO EMP ON LIQ.EMPENHO_ID = EMP.ID
INNER JOIN FONTEDESPESAORC FDO ON EMP.FONTEDESPESAORC_ID = FDO.ID
INNER JOIN PROVISAOPPAFONTE PROVISAO ON FDO.PROVISAOPPAFONTE_ID = PROVISAO.ID
INNER JOIN CONTADEDESTINACAO CDT ON PROVISAO.DESTINACAODERECURSOS_ID = CDT.ID
INNER JOIN FONTEDERECURSOS FONT ON CDT.FONTEDERECURSOS_ID = FONT.ID
INNER JOIN SUBCONTA SUB ON PAG.SUBCONTA_ID = SUB.ID
INNER JOIN CONTABANCARIAENTIDADE CONTBANC ON SUB.CONTABANCARIAENTIDADE_ID = CONTBANC.ID
inner join agencia agencia on contbanc.agencia_id = agencia.id
inner join banco banco on agencia.banco_id = banco.id
WHERE PAG.CATEGORIAORCAMENTARIA = 'RESTO'
AND CAST(PAG.DATAPAGAMENTO AS DATE) <= TO_DATE($P{DATAREFERENCIA}, 'DD/MM/YYYY')
AND PAG.DATAPAGAMENTO BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, PAG.DATAPAGAMENTO) $P!{SQL}
UNION ALL

--TRANSFERENCIA FINANCEIRA (RETIRADA)
SELECT TRANSF.DATATRANSFERENCIA AS DATA_MOVIMENTO,
TRANSF.HISTORICO AS HISTORICO,
COALESCE(TRANSF.VALOR, 0 ) AS CREDITO,
0 AS DEBITO,
COALESCE(TRANSF.NUMERO, '--') AS NUMERO,
'Transferência Financeira' AS TIPO_MOVIMENTO
FROM TRANSFERENCIACONTAFINANC TRANSF
INNER JOIN VWHIERARQUIAORCAMENTARIA VW ON VW.SUBORDINADA_ID = TRANSF.UNIDADEORGANIZACIONAL_ID
INNER JOIN FONTEDERECURSOS FONT ON TRANSF.FONTEDERECURSOSRETIRADA_ID = FONT.ID
INNER JOIN SUBCONTA SUB ON TRANSF.SUBCONTARETIRADA_ID = SUB.ID
INNER JOIN CONTABANCARIAENTIDADE CONTBANC ON SUB.CONTABANCARIAENTIDADE_ID = CONTBANC.ID
inner join agencia agencia on contbanc.agencia_id = agencia.id
inner join banco banco on agencia.banco_id = banco.id
WHERE TRANSF.DATATRANSFERENCIA <= TO_DATE($P{DATAREFERENCIA}, 'DD/MM/YYYY')
AND TRANSF.DATATRANSFERENCIA BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, TRANSF.DATATRANSFERENCIA) $P!{SQL}
UNION ALL
--TRANSFERENCIA MESMA UNIDADE (RETIRADA)
SELECT TRANSF.DATATRANSFERENCIA AS DATA_MOVIMENTO,
TRANSF.HISTORICO AS HISTORICO,
COALESCE(TRANSF.VALOR, 0) AS CREDITO,
0 AS DEBITO,
COALESCE(TRANSF.NUMERO, '--') AS NUMERO,
'Transferência Financeira' AS TIPO_MOVIMENTO
FROM TRANSFERENCIAMESMAUNIDADE TRANSF
INNER JOIN VWHIERARQUIAORCAMENTARIA VW ON VW.SUBORDINADA_ID = TRANSF.UNIDADEORGANIZACIONAL_ID
INNER JOIN FONTEDERECURSOS FONT ON TRANSF.FONTEDERECURSOSRETIRADA_ID = FONT.ID
INNER JOIN SUBCONTA SUB ON TRANSF.SUBCONTARETIRADA_ID = SUB.ID
INNER JOIN CONTABANCARIAENTIDADE CONTBANC ON SUB.CONTABANCARIAENTIDADE_ID = CONTBANC.ID
inner join agencia agencia on contbanc.agencia_id = agencia.id
inner join banco banco on agencia.banco_id = banco.id
WHERE TRANSF.DATATRANSFERENCIA <= TO_DATE($P{DATAREFERENCIA}, 'DD/MM/YYYY')
AND TRANSF.DATATRANSFERENCIA BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, TRANSF.DATATRANSFERENCIA) $P!{SQL}
UNION ALL
--ESTORNO DA LIBERAÇÃO FINANCEIRA
SELECT EST.DATAESTORNO AS DATA_MOVIMENTO,
EST.HISTORICO AS HISTORICO,
COALESCE(EST.VALOR, 0) AS CREDITO,
0 AS DEBITO,
COALESCE(EST.NUMERO, '--') AS NUMERO,
'Est. de Liberação Financeira' AS TIPO_MOVIMENTO
FROM ESTORNOLIBCOTAFINANCEIRA EST
INNER JOIN VWHIERARQUIAORCAMENTARIA VW ON VW.SUBORDINADA_ID = EST.UNIDADEORGANIZACIONAL_ID
INNER JOIN LIBERACAOCOTAFINANCEIRA LIB ON EST.LIBERACAO_ID = LIB.ID
INNER JOIN FONTEDERECURSOS FONT ON LIB.FONTEDERECURSOS_ID = FONT.ID
INNER JOIN SOLICITACAOCOTAFINANCEIRA SO ON SO.ID = LIB.SOLICITACAOCOTAFINANCEIRA_ID
INNER JOIN SUBCONTA SUB ON SO.CONTAFINANCEIRA_ID = SUB.ID
INNER JOIN CONTABANCARIAENTIDADE CONTBANC ON SUB.CONTABANCARIAENTIDADE_ID = CONTBANC.ID
inner join agencia agencia on contbanc.agencia_id = agencia.id
inner join banco banco on agencia.banco_id = banco.id
WHERE EST.DATAESTORNO <= TO_DATE($P{DATAREFERENCIA}, 'DD/MM/YYYY')
AND EST.DATAESTORNO BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, EST.DATAESTORNO) $P!{SQL}
UNION ALL
--DESPESA EXTRA (PAGAMENTO EXTRA)
SELECT PAG.DATAPAGTO AS DATA_MOVIMENTO,
PAG.COMPLEMENTOHISTORICO AS HISTORICO,
COALESCE(PAG.VALOR, 0) AS CREDITO,
0 AS DEBITO,
COALESCE(PAG.NUMERO, '--') AS NUMERO,
'Despesa Extra' AS TIPO_MOVIMENTO
FROM PAGAMENTOEXTRA PAG
INNER JOIN VWHIERARQUIAORCAMENTARIA VW ON VW.SUBORDINADA_ID = PAG.UNIDADEORGANIZACIONAL_ID
INNER JOIN FONTEDERECURSOS FONT ON PAG.FONTEDERECURSOS_ID = FONT.ID
INNER JOIN SUBCONTA SUB ON PAG.SUBCONTA_ID = SUB.ID
INNER JOIN CONTABANCARIAENTIDADE CONTBANC ON SUB.CONTABANCARIAENTIDADE_ID = CONTBANC.ID
inner join agencia agencia on contbanc.agencia_id = agencia.id
inner join banco banco on agencia.banco_id = banco.id
WHERE PAG.DATAPAGTO <= TO_DATE($P{DATAREFERENCIA}, 'DD/MM/YYYY')
AND PAG.DATAPAGTO BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, PAG.DATAPAGTO) $P!{SQL}
UNION ALL
--AJUSTE ATIVO DISPONIVEL (DIMINUTIVO)
SELECT AJUSTE.DATAAJUSTE AS DATA_MOVIMENTO,
AJUSTE.HISTORICO AS HISTORICO,
COALESCE(AJUSTE.VALOR, 0) AS CREDITO,
0 AS DEBITO,
COALESCE(AJUSTE.NUMERO, '--') AS NUMERO,
'Ajt. Atv. Disp. Dim.' AS TIPO_MOVIMENTO
FROM AJUSTEATIVODISPONIVEL AJUSTE
INNER JOIN VWHIERARQUIAORCAMENTARIA VW ON VW.SUBORDINADA_ID = AJUSTE.UNIDADEORGANIZACIONAL_ID
INNER JOIN FONTEDERECURSOS FONT ON AJUSTE.FONTEDERECURSOS_ID = FONT.ID
INNER JOIN SUBCONTA SUB ON AJUSTE.CONTAFINANCEIRA_ID = SUB.ID
INNER JOIN CONTABANCARIAENTIDADE CONTBANC ON SUB.CONTABANCARIAENTIDADE_ID = CONTBANC.ID
inner join agencia agencia on contbanc.agencia_id = agencia.id
inner join banco banco on agencia.banco_id = banco.id
WHERE (AJUSTE.TIPOAJUSTEDISPONIVEL = 'DIMINUTIVO_CONTROLE_INTERNO'
OR AJUSTE.TIPOAJUSTEDISPONIVEL = 'DIMINUTIVO_CONTROLE_EXTERNO')
AND AJUSTE.DATAAJUSTE <= TO_DATE($P{DATAREFERENCIA}, 'DD/MM/YYYY')
AND AJUSTE.TIPOLANCAMENTO = 'NORMAL'
AND AJUSTE.DATAAJUSTE BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, AJUSTE.DATAAJUSTE) $P!{SQL}
UNION ALL
--ESTORNO AJUSTE ATIVO DISPONIVEL DIMINUTIVO
SELECT AJUSTE.DATAAJUSTE AS DATA_MOVIMENTO,
AJUSTE.HISTORICO AS HISTORICO,
COALESCE(AJUSTE.VALOR, 0) AS CREDITO,
0 AS DEBITO,
COALESCE(AJUSTE.NUMERO, '--') AS NUMERO,
'Est. de Ajt. Atv. Disp. Aum.' AS TIPO_MOVIMENTO
FROM AJUSTEATIVODISPONIVEL AJUSTE
INNER JOIN VWHIERARQUIAORCAMENTARIA VW ON VW.SUBORDINADA_ID = AJUSTE.UNIDADEORGANIZACIONAL_ID
INNER JOIN FONTEDERECURSOS FONT ON AJUSTE.FONTEDERECURSOS_ID = FONT.ID
INNER JOIN SUBCONTA SUB ON AJUSTE.CONTAFINANCEIRA_ID = SUB.ID
INNER JOIN CONTABANCARIAENTIDADE CONTBANC ON SUB.CONTABANCARIAENTIDADE_ID = CONTBANC.ID
inner join agencia agencia on contbanc.agencia_id = agencia.id
inner join banco banco on agencia.banco_id = banco.id
WHERE (AJUSTE.TIPOAJUSTEDISPONIVEL = 'AUMENTATIVO_CONTROLE_INTERNO'
OR AJUSTE.TIPOAJUSTEDISPONIVEL = 'AUMENTATIVO_CONTROLE_EXTERNO')
AND AJUSTE.DATAAJUSTE <= TO_DATE($P{DATAREFERENCIA}, 'DD/MM/YYYY')
AND AJUSTE.TIPOLANCAMENTO = 'ESTORNO'
AND AJUSTE.DATAAJUSTE BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA, AJUSTE.DATAAJUSTE) $P!{SQL}
UNION ALL
--ESTORNO TRANSFERENCIA FINANCEIRA MESMA UNIDADE (DEPOSITO)
SELECT EST.DATAESTORNO AS DATA_MOVIMENTO,
EST.HISTORICO AS HISTORICO,
COALESCE(EST.VALOR, 0) AS CREDITO,
0 AS DEBITO,
COALESCE(EST.NUMERO, '--') AS NUMERO,
'Est. de Transferência Fin.' AS TIPO_MOVIMENTO
FROM ESTORNOTRANSFMESMAUNIDADE EST
INNER JOIN VWHIERARQUIAORCAMENTARIA VW ON VW.SUBORDINADA_ID = EST.UNIDADEORGANIZACIONAL_ID
INNER JOIN TRANSFERENCIAMESMAUNIDADE TRANSF ON EST.TRANSFERENCIAMESMAUNIDADE_ID = TRANSF.ID
INNER JOIN FONTEDERECURSOS FONT ON TRANSF.FONTEDERECURSOSDEPOSITO_ID = FONT.ID
INNER JOIN SUBCONTA SUB ON TRANSF.SUBCONTADEPOSITO_ID = SUB.ID
INNER JOIN CONTABANCARIAENTIDADE CONTBANC ON SUB.CONTABANCARIAENTIDADE_ID = CONTBANC.ID
inner join agencia agencia on contbanc.agencia_id = agencia.id
inner join banco banco on agencia.banco_id = banco.id
WHERE EST.DATAESTORNO <= TO_DATE($P{DATAREFERENCIA}, 'DD/MM/YYYY')
AND EST.DATAESTORNO BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA,  EST.DATAESTORNO) $P!{SQL}
UNION ALL
--ESTORNO TRANSFERENCIA FINANCEIRA (DEPOSITO)
SELECT EST.DATAESTORNO AS DATA_MOVIMENTO,
EST.HISTORICO AS HISTORICO,
COALESCE(EST.VALOR, 0 ) AS CREDITO,
0 AS DEBITO,
COALESCE(EST.NUMERO, '--') AS NUMERO,
'Est. de Transferência Fin.' AS TIPO_MOVIMENTO
FROM ESTORNOTRANSFERENCIA EST
INNER JOIN VWHIERARQUIAORCAMENTARIA VW ON VW.SUBORDINADA_ID = EST.UNIDADEORGANIZACIONAL_ID
INNER JOIN TRANSFERENCIACONTAFINANC TRANSF ON EST.TRANSFERENCIA_ID = TRANSF.ID
INNER JOIN FONTEDERECURSOS FONT ON TRANSF.FONTEDERECURSOSDEPOSITO_ID = FONT.ID
INNER JOIN SUBCONTA SUB ON TRANSF.SUBCONTADEPOSITO_ID = SUB.ID
INNER JOIN CONTABANCARIAENTIDADE CONTBANC ON SUB.CONTABANCARIAENTIDADE_ID = CONTBANC.ID
inner join agencia agencia on contbanc.agencia_id = agencia.id
inner join banco banco on agencia.banco_id = banco.id
WHERE EST.DATAESTORNO <= TO_DATE($P{DATAREFERENCIA}, 'DD/MM/YYYY')
AND EST.DATAESTORNO BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA,  EST.DATAESTORNO) $P!{SQL}
UNION ALL
--ESTORNO RECEITA EXTRA
SELECT EST.DATAESTORNO AS DATA_MOVIMENTO,
EST.COMPLEMENTOHISTORICO AS HISTORICO,
COALESCE(EST.VALOR, 0 ) AS CREDITO,
0 AS DEBITO,
COALESCE(EST.NUMERO, '--') AS NUMERO,
'Est. de Rec. Extra' AS TIPO_MOVIMENTO
FROM RECEITAEXTRAESTORNO EST
INNER JOIN VWHIERARQUIAORCAMENTARIA VW ON VW.SUBORDINADA_ID = EST.UNIDADEORGANIZACIONAL_ID
INNER JOIN RECEITAEXTRA RECEXTRA ON EST.RECEITAEXTRA_ID = RECEXTRA.ID
INNER JOIN FONTEDERECURSOS FONT ON RECEXTRA.FONTEDERECURSOS_ID = FONT.ID
INNER JOIN SUBCONTA SUB ON RECEXTRA.SUBCONTA_ID = SUB.ID
INNER JOIN CONTABANCARIAENTIDADE CONTBANC ON SUB.CONTABANCARIAENTIDADE_ID = CONTBANC.ID
inner join agencia agencia on contbanc.agencia_id = agencia.id
inner join banco banco on agencia.banco_id = banco.id
inner join contaextraorcamentaria cextra on recextra.contaextraorcamentaria_id = cextra.id
WHERE CEXTRA.TIPOCONTAEXTRAORCAMENTARIA <> 'DEPOSITOS_CONSIGNACOES'
AND EST.DATAESTORNO <= TO_DATE($P{DATAREFERENCIA}, 'DD/MM/YYYY')
AND EST.DATAESTORNO BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA,  EST.DATAESTORNO) $P!{SQL}
UNION ALL
--LIBERACAO (REPASSE)
SELECT LIB.DATALIBERACAO AS DATA_MOVIMENTO,
LIB.OBSERVACOES AS HISTORICO,
COALESCE(LIB.VALOR, 0) AS CREDITO,
0 AS DEBITO,
COALESCE(LIB.NUMERO, '--') AS NUMERO,
'Liberação Fin. Repasse' AS TIPO_MOVIMENTO
FROM LIBERACAOCOTAFINANCEIRA LIB
INNER JOIN VWHIERARQUIAORCAMENTARIA VW ON VW.SUBORDINADA_ID = LIB.UNIDADEORGANIZACIONAL_ID
INNER JOIN FONTEDERECURSOS FONT ON LIB.FONTEDERECURSOS_ID = FONT.ID
INNER JOIN SUBCONTA SUB ON LIB.SUBCONTA_ID = SUB.ID
INNER JOIN CONTABANCARIAENTIDADE CONTBANC ON SUB.CONTABANCARIAENTIDADE_ID = CONTBANC.ID
inner join agencia agencia on contbanc.agencia_id = agencia.id
inner join banco banco on agencia.banco_id = banco.id
WHERE LIB.DATALIBERACAO <= TO_DATE($P{DATAREFERENCIA}, 'DD/MM/YYYY')
AND LIB.DATALIBERACAO BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA,  LIB.DATALIBERACAO) $P!{SQL}
UNION ALL
--ESTORNO RECEITA REALIZADA (TODOS TIPO MENOS DEDUCAO)
SELECT RRE.DATAESTORNO AS DATA_MOVIMENTO,
RRE.COMPLEMENTOHISTORICO AS HISTORICO,
COALESCE(RRE.VALOR, 0) AS CREDITO,
0 AS DEBITO,
COALESCE(RRE.NUMERO, '--') AS NUMERO,
'Est. Rec. Real.' AS TIPO_MOVIMENTO
FROM RECEITAORCESTORNO RRE
INNER JOIN VWHIERARQUIAORCAMENTARIA VW ON VW.SUBORDINADA_ID = RRE.UNIDADEORGANIZACIONALORC
INNER JOIN LANCAMENTORECEITAORC RR ON RR.ID = RRE.LANCAMENTORECEITAORC_ID
INNER JOIN RECEITALOA RL ON RL.ID = RR.RECEITALOA_ID
INNER JOIN CONTARECEITA CR ON CR.ID = RL.CONTADERECEITA_ID
INNER JOIN RECEITALOAFONTE RLF ON RLF.RECEITALOA_ID = RL.ID
INNER JOIN CONTADEDESTINACAO CD ON CD.ID = RLF.DESTINACAODERECURSOS_ID
INNER JOIN FONTEDERECURSOS FONT ON CD.FONTEDERECURSOS_ID = FONT.ID
INNER JOIN SUBCONTA SUB ON RR.SUBCONTA_ID = SUB.ID
INNER JOIN CONTABANCARIAENTIDADE CONTBANC ON SUB.CONTABANCARIAENTIDADE_ID = CONTBANC.ID
inner join agencia agencia on contbanc.agencia_id = agencia.id
inner join banco banco on agencia.banco_id = banco.id
WHERE CR.TIPOSCREDITO <> 'DEDUCAO_DA_RECEITA'
AND RRE.DATAESTORNO <= TO_DATE($P{DATAREFERENCIA}, 'DD/MM/YYYY')
AND RRE.DATAESTORNO BETWEEN VW.INICIOVIGENCIA AND COALESCE(VW.FIMVIGENCIA,  RRE.DATAESTORNO) $P!{SQL}
) DADOS
GROUP BY DATA_MOVIMENTO, HISTORICO, TIPO_MOVIMENTO, NUMERO
ORDER BY MES_MOVIMENTO, DATA_MOVIMENTO]]>
	</queryString>
	<field name="HISTORICO" class="java.lang.String"/>
	<field name="DATA_MOVIMENTO" class="java.lang.String"/>
	<field name="MES_MOVIMENTO" class="java.lang.String"/>
	<field name="CREDITO" class="java.math.BigDecimal"/>
	<field name="NUMERO" class="java.lang.String"/>
	<field name="TIPO_MOVIMENTO" class="java.lang.String"/>
	<variable name="CREDITO_1" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{CREDITO}]]></variableExpression>
	</variable>
	<columnHeader>
		<band height="12">
			<staticText>
				<reportElement x="0" y="0" width="312" height="12"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="7" isBold="false"/>
				</textElement>
				<text><![CDATA[CRÉDITO NO RAZÃO NÃO CONSIDERADO NO BANCO]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="8" splitType="Stretch">
			<textField>
				<reportElement x="3" y="0" width="24" height="8"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="6"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{NUMERO}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="29" y="0" width="88" height="8"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="6"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{TIPO_MOVIMENTO}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="119" y="0" width="227" height="8"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="6"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{HISTORICO}]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy">
				<reportElement x="348" y="0" width="38" height="8"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="6"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{DATA_MOVIMENTO}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement x="443" y="0" width="54" height="8"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial" size="6"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{CREDITO}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="11">
			<textField pattern="#,##0.00" isBlankWhenNull="true">
				<reportElement x="486" y="0" width="67" height="10"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{CREDITO_1}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="341" y="0" width="145" height="10"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Arial" size="7" isBold="false"/>
				</textElement>
				<text><![CDATA[SOMA:]]></text>
			</staticText>
			<line>
				<reportElement x="0" y="10" width="555" height="1"/>
			</line>
		</band>
	</summary>
	<noData>
		<band height="12">
			<staticText>
				<reportElement x="0" y="0" width="555" height="12"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="8" isBold="false"/>
				</textElement>
				<text><![CDATA[NENHUM DADO ENCONTRADO PARA CRÉDITO NO RAZÃO NÃO CONSIDERADO NO BANCO]]></text>
			</staticText>
		</band>
	</noData>
</jasperReport>
