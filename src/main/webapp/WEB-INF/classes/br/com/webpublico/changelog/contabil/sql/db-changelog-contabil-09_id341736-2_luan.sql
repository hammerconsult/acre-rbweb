DECLARE
texto CLOB := '{"consulta":"select fonte.codigo || '' - '' || fonte.descricao as fonte,\r\n       sum(empenhado) as empenhado,\r\n       sum(liquidado) as liquidado,\r\n       sum(pago) as pago,\r\n       sum(cancelado) as cancelado\r\nfrom (select proFonte.destinacaoDeRecursos_id   as idContaDeDestinacao,\r\n             emp.unidadeOrganizacional_id       as idUnidade,\r\n             emp.dataEmpenho                    as dataReferencia,\r\n             sum(coalesce(emp.valor, 0))        as empenhado,\r\n             0                                  as liquidado,\r\n             0                                  as pago,\r\n             0                                  as cancelado\r\n      from empenho emp\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where emp.categoriaorcamentaria = ''RESTO''\r\n      group by proFonte.destinacaoDeRecursos_id, emp.unidadeOrganizacional_id, emp.dataEmpenho\r\n\r\n      union all\r\n      select proFonte.destinacaoDeRecursos_id   as idContaDeDestinacao,\r\n             liq.unidadeOrganizacional_id       as idUnidade,\r\n             liq.dataLiquidacao                 as dataReferencia,\r\n             0                                  as empenhado,\r\n             sum(coalesce(liq.valor, 0))        as liquidado,\r\n             0                                  as pago,\r\n             0                                  as cancelado\r\n      from liquidacao liq\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where liq.categoriaorcamentaria = ''RESTO''\r\n      group by proFonte.destinacaoDeRecursos_id, liq.unidadeOrganizacional_id, liq.dataLiquidacao\r\n\r\n      union all\r\n      select proFonte.destinacaoDeRecursos_id   as idContaDeDestinacao,\r\n             est.unidadeOrganizacional_id       as idUnidade,\r\n             est.dataEstorno                    as dataReferencia,\r\n             0                                  as empenhado,\r\n             sum(coalesce(est.valor, 0)) * -1   as liquidado,\r\n             0                                  as pago,\r\n             0                                  as cancelado\r\n      from liquidacaoestorno est\r\n               inner join liquidacao liq on est.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where liq.categoriaorcamentaria = ''RESTO''\r\n      group by proFonte.destinacaoDeRecursos_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n\r\n      union all\r\n      select proFonte.destinacaoDeRecursos_id   as idContaDeDestinacao,\r\n             pag.unidadeOrganizacional_id       as idUnidade,\r\n             pag.dataPagamento                  as dataReferencia,\r\n             0                                  as empenhado,\r\n             0                                  as liquidado,\r\n             sum(coalesce(pag.valor, 0))        as pago,\r\n             0                                  as cancelado\r\n      from pagamento pag\r\n               inner join liquidacao liq on pag.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where pag.categoriaorcamentaria = ''RESTO''\r\n      group by proFonte.destinacaoDeRecursos_id, pag.unidadeOrganizacional_id, pag.dataPagamento\r\n\r\n      union all\r\n      select proFonte.destinacaoDeRecursos_id   as idContaDeDestinacao,\r\n             est.unidadeOrganizacional_id       as idUnidade,\r\n             est.dataEstorno                    as dataReferencia,\r\n             0                                  as empenhado,\r\n             0                                  as liquidado,\r\n             sum(coalesce(est.valor, 0)) * -1   as pago,\r\n             0                                  as cancelado\r\n      from pagamentoestorno est\r\n               inner join pagamento pag on est.pagamento_id = pag.id\r\n               inner join liquidacao liq on pag.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where pag.categoriaorcamentaria = ''RESTO''\r\n      group by proFonte.destinacaoDeRecursos_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n\r\n      union all\r\n      select proFonte.destinacaoDeRecursos_id   as idContaDeDestinacao,\r\n             est.unidadeOrganizacional_id       as idUnidade,\r\n             est.dataEstorno                    as dataReferencia,\r\n             0                                  as empenhado,\r\n             0                                  as liquidado,\r\n             0                                  as pago,\r\n             sum(coalesce(est.valor, 0))        as cancelado\r\n      from empenhoestorno est\r\n               inner join empenho emp on est.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where emp.categoriaorcamentaria = ''RESTO''\r\n      group by proFonte.destinacaoDeRecursos_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n      ) dados\r\n         inner join vwhierarquiaorcamentaria vw ON vw.subordinada_id = dados.idUnidade\r\n         inner join ContaDeDestinacao cdd ON dados.idContaDeDestinacao = cdd.id\r\n         inner join FonteDeRecursos fonte ON cdd.fonteDeRecursos_id = fonte.id\r\nwhere trunc(dados.dataReferencia) BETWEEN to_date(''01/01/$ANO'', ''dd/MM/yyyy'') AND to_date(''31/12/$ANO'', ''dd/MM/yyyy'')\r\n  and dados.idUnidade in (select UNIDADE_ID from UNIDADEPREFEITURAPORTAL where PREFEITURA_ID = $PREFEITURAPORTAL_ID)\r\n    $WHERE\r\ngroup by fonte.codigo || '' - '' || fonte.descricao\r\norder by fonte.codigo || '' - '' || fonte.descricao","count":"select count(1) from (\r\nselect fonte.codigo || '' - '' || fonte.descricao as fonte,\r\n       sum(empenhado) as empenhado,\r\n       sum(liquidado) as liquidado,\r\n       sum(pago) as pago,\r\n       sum(cancelado) as cancelado\r\nfrom (select proFonte.destinacaoDeRecursos_id   as idContaDeDestinacao,\r\n             emp.unidadeOrganizacional_id       as idUnidade,\r\n             emp.dataEmpenho                    as dataReferencia,\r\n             sum(coalesce(emp.valor, 0))        as empenhado,\r\n             0                                  as liquidado,\r\n             0                                  as pago,\r\n             0                                  as cancelado\r\n      from empenho emp\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where emp.categoriaorcamentaria = ''RESTO''\r\n      group by proFonte.destinacaoDeRecursos_id, emp.unidadeOrganizacional_id, emp.dataEmpenho\r\n\r\n      union all\r\n      select proFonte.destinacaoDeRecursos_id   as idContaDeDestinacao,\r\n             liq.unidadeOrganizacional_id       as idUnidade,\r\n             liq.dataLiquidacao                 as dataReferencia,\r\n             0                                  as empenhado,\r\n             sum(coalesce(liq.valor, 0))        as liquidado,\r\n             0                                  as pago,\r\n             0                                  as cancelado\r\n      from liquidacao liq\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where liq.categoriaorcamentaria = ''RESTO''\r\n      group by proFonte.destinacaoDeRecursos_id, liq.unidadeOrganizacional_id, liq.dataLiquidacao\r\n\r\n      union all\r\n      select proFonte.destinacaoDeRecursos_id   as idContaDeDestinacao,\r\n             est.unidadeOrganizacional_id       as idUnidade,\r\n             est.dataEstorno                    as dataReferencia,\r\n             0                                  as empenhado,\r\n             sum(coalesce(est.valor, 0)) * -1   as liquidado,\r\n             0                                  as pago,\r\n             0                                  as cancelado\r\n      from liquidacaoestorno est\r\n               inner join liquidacao liq on est.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where liq.categoriaorcamentaria = ''RESTO''\r\n      group by proFonte.destinacaoDeRecursos_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n\r\n      union all\r\n      select proFonte.destinacaoDeRecursos_id   as idContaDeDestinacao,\r\n             pag.unidadeOrganizacional_id       as idUnidade,\r\n             pag.dataPagamento                  as dataReferencia,\r\n             0                                  as empenhado,\r\n             0                                  as liquidado,\r\n             sum(coalesce(pag.valor, 0))        as pago,\r\n             0                                  as cancelado\r\n      from pagamento pag\r\n               inner join liquidacao liq on pag.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where pag.categoriaorcamentaria = ''RESTO''\r\n      group by proFonte.destinacaoDeRecursos_id, pag.unidadeOrganizacional_id, pag.dataPagamento\r\n\r\n      union all\r\n      select proFonte.destinacaoDeRecursos_id   as idContaDeDestinacao,\r\n             est.unidadeOrganizacional_id       as idUnidade,\r\n             est.dataEstorno                    as dataReferencia,\r\n             0                                  as empenhado,\r\n             0                                  as liquidado,\r\n             sum(coalesce(est.valor, 0)) * -1   as pago,\r\n             0                                  as cancelado\r\n      from pagamentoestorno est\r\n               inner join pagamento pag on est.pagamento_id = pag.id\r\n               inner join liquidacao liq on pag.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where pag.categoriaorcamentaria = ''RESTO''\r\n      group by proFonte.destinacaoDeRecursos_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n\r\n      union all\r\n      select proFonte.destinacaoDeRecursos_id   as idContaDeDestinacao,\r\n             est.unidadeOrganizacional_id       as idUnidade,\r\n             est.dataEstorno                    as dataReferencia,\r\n             0                                  as empenhado,\r\n             0                                  as liquidado,\r\n             0                                  as pago,\r\n             sum(coalesce(est.valor, 0))        as cancelado\r\n      from empenhoestorno est\r\n               inner join empenho emp on est.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where emp.categoriaorcamentaria = ''RESTO''\r\n      group by proFonte.destinacaoDeRecursos_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n      ) dados\r\n         inner join vwhierarquiaorcamentaria vw ON vw.subordinada_id = dados.idUnidade\r\n         inner join ContaDeDestinacao cdd ON dados.idContaDeDestinacao = cdd.id\r\n         inner join FonteDeRecursos fonte ON cdd.fonteDeRecursos_id = fonte.id\r\nwhere trunc(dados.dataReferencia) BETWEEN to_date(''01/01/$ANO'', ''dd/MM/yyyy'') AND to_date(''31/12/$ANO'', ''dd/MM/yyyy'')\r\n  and dados.idUnidade in (select UNIDADE_ID from UNIDADEPREFEITURAPORTAL where PREFEITURA_ID = $PREFEITURAPORTAL_ID)\r\n    $WHERE\r\ngroup by fonte.codigo || '' - '' || fonte.descricao\r\norder by fonte.codigo || '' - '' || fonte.descricao\r\n)","totalRegistros":11,"fields":[{"posicao":1,"descricao":"Fonte de Recurso","columnName":"FONTE","columnValue":"FONTE","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":2,"descricao":"Inscrito (R$)","columnName":"EMPENHADO","columnValue":"EMPENHADO","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":3,"descricao":"Liquidado (R$)","columnName":"LIQUIDADO","columnValue":"LIQUIDADO","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":4,"descricao":"Pago (R$)","columnName":"PAGO","columnValue":"PAGO","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":5,"descricao":"Cancelado (R$)","columnName":"CANCELADO","columnValue":"CANCELADO","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false}],"pesquisaveis":[{"descricao":"Fonte de Recurso.Código","columnName":"fonte.codigo","columnValue":null,"tipo":"STRING","operacaoPadrao":null,"tipoEnum":null,"valorPadrao":""},{"descricao":"Fonte de Recurso.Descrição","columnName":"fonte.descricao","columnValue":null,"tipo":"STRING","operacaoPadrao":null,"tipoEnum":null,"valorPadrao":""}]}';
BEGIN
update PAGINAPREFEITURAPORTAL set CONTEUDO = texto where NOME = 'Restos a Pagar por Fonte de Recurso';
END;
