<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:co="http://java.sun.com/jsf/composite/components/contabil"
      xmlns:p="http://primefaces.org/ui"
>
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">

        <script type="text/javascript">
            function posicionarDivInformacao(id) {
                var divInfo = document.getElementById(id);
                var left = parseInt(divInfo.offsetLeft);
                left += 180;
                divInfo.style.left = ''.concat(left, 'px');
            }
        </script>

        <h:form id="Formulario">
            <p:remoteCommand name="limparContaFinanceira"
                             process="@this"
                             update=":Formulario:completaContaFinanceria :Formulario:completaContaBanc">
                <f:setPropertyActionListener value="#{null}"
                                             target="#{lancamentoReceitaOrcControlador.contaBancariaEntidade}"/>

                <f:setPropertyActionListener value="#{null}"
                                             target="#{lancamentoReceitaOrcControlador.subConta}"/>
            </p:remoteCommand>

            <p:remoteCommand name="limparClasseCredor"
                             process="@this"
                             update=":Formulario:classeCredor">
                <f:setPropertyActionListener value="#{null}"
                                             target="#{lancamentoReceitaOrcControlador.selecionado.pessoa}"/>

                <f:setPropertyActionListener value="#{null}"
                                             target="#{lancamentoReceitaOrcControlador.classeCredor}"/>
            </p:remoteCommand>

            <p:remoteCommand name="limparPessoaClasse"
                             process="@this"
                             update=":Formulario:panelPessoa :Formulario:panelClasseCredor :Formulario:panelConvenio">
                <f:setPropertyActionListener value="#{null}"
                                             target="#{lancamentoReceitaOrcControlador.subConta}"/>

                <f:setPropertyActionListener value="#{null}"
                                             target="#{lancamentoReceitaOrcControlador.selecionado.pessoa}"/>

                <f:setPropertyActionListener value="#{null}"
                                             target="#{lancamentoReceitaOrcControlador.classeCredor}"/>

                <f:setPropertyActionListener value="#{null}"
                                             target="#{lancamentoReceitaOrcControlador.selecionado.convenioReceita}"/>

                <f:setPropertyActionListener value="#{null}"
                                             target="#{lancamentoReceitaOrcControlador.selecionado.dividaPublica}"/>
            </p:remoteCommand>


            <p:remoteCommand name="limparTipoContaEvento"
                             process="@this"
                             update=":Formulario:tipoContaReceita :Formulario:tipoContaReceita2 :Formulario:evento
                         :Formulario:btCalcular :formConjFontes :Formulario:completaContaFinanceria :Formulario:completaContaBanc">
                <f:setPropertyActionListener value="#{null}"
                                             target="#{lancamentoReceitaOrcControlador.tiposCredito}"/>

                <f:setPropertyActionListener value="#{null}"
                                             target="#{lancamentoReceitaOrcControlador.selecionado.eventoContabil}"/>

                <f:setPropertyActionListener value="#{null}"
                                             target="#{lancamentoReceitaOrcControlador.selecionado.receitaLOA}"/>

                <f:setPropertyActionListener value="#{null}"
                                             target="#{lancamentoReceitaOrcControlador.subConta}"/>

                <f:setPropertyActionListener value="#{null}"
                                             target="#{lancamentoReceitaOrcControlador.contaBancariaEntidade}"/>
            </p:remoteCommand>

            <fc:cabecalhoPretty controlador="#{lancamentoReceitaOrcControlador}"
                                origem="#{lancamentoReceitaOrcControlador.caminhoPadrao}listar/"/>

            <p:panel header="Receita Realizada">
                <h:panelGrid columns="2" id="panelGeral">
                    <h:outputText value="Número: "/>
                    <h:panelGroup>
                        <p:inputText title="Número do Receita Realizada"
                                     value="#{lancamentoReceitaOrcControlador.selecionado.numero}"
                                     id="numero"
                                     size="21"
                                     disabled="#{lancamentoReceitaOrcControlador.isOperacaoEditar()}"
                                     readonly="#{empenhoControlador.selecionado.id eq null ?'true':'false'}"
                        />
                        <p:watermark for="numero" value="Gerado Automaticamente"/>
                    </h:panelGroup>

                    <h:outputText for="dataLancamento" value="Data: "/>
                    <p:calendar title="Data gerada automaticamente pelo sistema"
                                value="#{lancamentoReceitaOrcControlador.selecionado.dataLancamento}"
                                id="dataLancamento"
                                onkeyup="mascara(this, mdata)"
                                size="21"
                                disabled="true"
                                navigator="true"
                                pattern="dd/MM/yyyy"
                                locale="pt_BR"/>

                    <h:outputText for="dataConciliacao" value="Data de Conciliação: "/>
                    <p:calendar title="Informe a Data de Conciliação"
                                value="#{lancamentoReceitaOrcControlador.selecionado.dataConciliacao}"
                                disabled="#{lancamentoReceitaOrcControlador.isOperacaoEditar()}"
                                id="dataConciliacao"
                                onkeyup="mascara(this, mdata)"
                                size="21"
                                navigator="true"
                                pattern="dd/MM/yyyy"
                                locale="pt_BR"/>

                    <h:outputText value="Unidade Organizacional: "/>
                    <fc:codigo-descricao-hierarquia tipoHierarquia="ORCAMENTARIA"
                                                    dataMovimento="#{lancamentoReceitaOrcControlador.selecionado.dataLancamento}"
                                                    unidadeOrganizacional="#{lancamentoReceitaOrcControlador.selecionado.unidadeOrganizacional}"/>
                    <h:outputText value="Lote: "/>
                    <p:inputText id="lote" value="#{lancamentoReceitaOrcControlador.selecionado.lote}"
                                 disabled="#{lancamentoReceitaOrcControlador.isOperacaoEditar()}"
                                 maxlength="10"
                                 size="21"
                                 title="Informe o número do lote."/>

                    <fc:outputLabelObrigatorio value="Operação: " for="operacao"/>
                    <h:selectOneMenu id="operacao"
                                     value="#{lancamentoReceitaOrcControlador.selecionado.operacaoReceitaRealizada}"
                                     disabled="#{lancamentoReceitaOrcControlador.isOperacaoEditar()}"
                                     title="Selecione uma operação.">
                        <p:ajax event="change"
                                update=":Formulario:evento :Formulario:tipoContaReceita :Formulario:receitaLOA"
                                process="@this"
                                onstart="aguarde.show()"
                                oncomplete="aguarde.hide()"
                                listener="#{lancamentoReceitaOrcControlador.definirEventoAndFiltroContaReceita()}"/>
                        <f:selectItems value="#{lancamentoReceitaOrcControlador.listaOperacoesReceitaRealizada}"/>
                    </h:selectOneMenu>

                    <fc:outputLabelObrigatorio for="receitaLOA" value="Conta de Receita: "/>
                    <h:panelGrid cellspacing="0" cellpadding="0" columns="4">
                        <p:autoComplete queryDelay="1000"
                                        title="Selecione uma conta de receita."
                                        id="receitaLOA"
                                        completeMethod="#{lancamentoReceitaOrcControlador.completarReceitaLOA}"
                                        converter="#{lancamentoReceitaOrcControlador.converterReceitaLOA}"
                                        value="#{lancamentoReceitaOrcControlador.selecionado.receitaLOA}"
                                        disabled="#{lancamentoReceitaOrcControlador.isOperacaoEditar() or lancamentoReceitaOrcControlador.selecionado.operacaoReceitaRealizada eq null}"
                                        var="rec"
                                        maxResults="10"
                                        itemLabel="#{rec.contaDeReceita}"
                                        itemValue="#{rec.id}"
                                        size="70"
                                        onkeyup="if(keyUpCampoVazio(this)){limparTipoContaEvento()}">
                            <p:ajax update=":Formulario:evento :Formulario:tipoContaReceita :Formulario:btCalcular :Formulario:btCalcular
                            :Formulario:tipoContaReceita2 :Formulario:botaoVisualizarDetalhesReceitaLoa :formConjFontes
                            :Formulario:completaContaFinanceria :Formulario:completaContaBanc :Formulario:fontesReceitaLoa
                            :Formulario:bt-info-fontes :Formulario:tabelaLancReceitaFontes"
                                    event="itemSelect"
                                    onstart="aguarde.show()"
                                    oncomplete="aguarde.hide()"
                                    listener="#{lancamentoReceitaOrcControlador.setaReceitaLOA}"/>
                        </p:autoComplete>
                        <p:watermark value="Filtra conta de receita por operação da receita" for="receitaLOA"/>

                        <p:outputPanel id="botaoVisualizarDetalhesReceitaLoa" styleClass="mlef05">
                            <p:commandButton icon="ui-icon-clipboard"
                                             title="Clique para visualizar Detalhes."
                                             onstart="aguarde.show()"
                                             oncomplete="detalhesReceitaLoa.show();aguarde.hide()"
                                             actionListener="#{lancamentoReceitaOrcControlador.recuperarReceitaLOA()}"
                                             disabled="#{lancamentoReceitaOrcControlador.selecionado.receitaLOA eq null}"
                                             update=":FormularioDetalhesReceitaLoa:panelDetalhesReceitaLoa"
                                             process="@this"/>
                        </p:outputPanel>

                        <p:commandButton process="@this"
                                         update="@none"
                                         oncomplete="painelInformacoes.show()"
                                         rendered="#{lancamentoReceitaOrcControlador.selecionado.id eq null}"
                                         disabled="#{lancamentoReceitaOrcControlador.selecionado.receitaLOA eq null}"
                                         styleClass="mlef05 mrig05"
                                         id="bt-info-fontes"
                                         title="Clique para visualizar as fontes da receita loa."
                                         icon="ui-icon-lista"/>

                        <p:overlayPanel for="bt-info-fontes"
                                        at="left top"
                                        my="right top"
                                        onShow="posicionarDivInformacao(this.id)"
                                        widgetVar="painelInformacoes"
                                        style="border : solid #497692 1px;"
                                        styleClass="semSombra">

                            <p:dataList id="fontesReceitaLoa"
                                        var="f"
                                        value="#{lancamentoReceitaOrcControlador.fonteRecursoPorConjuntoFontes}"
                                        styleClass="mtop03 mbot03 semBorda">
                                <f:facet name="header">
                                    <h:outputText value="Fonte de Recursos"/>
                                </f:facet>
                                <p:column style="text-align: left">
                                    <h:outputText value="#{f}"/>
                                </p:column>
                            </p:dataList>

                        </p:overlayPanel>

                    </h:panelGrid>

                    <p:outputPanel id="tipoContaReceita">
                        <h:outputText value="Tipo Conta de Receita: "
                                      rendered="#{lancamentoReceitaOrcControlador.selecionado.receitaLOA ne null}"/>
                    </p:outputPanel>

                    <p:outputPanel columns="2" id="tipoContaReceita2">
                        <h:outputText value="#{lancamentoReceitaOrcControlador.tiposCredito.descricao}"
                                      styleClass="negrito"
                                      rendered="#{lancamentoReceitaOrcControlador.selecionado.receitaLOA ne null}"/>
                    </p:outputPanel>

                    <h:outputText id="textEvento" value="Evento Contábil: "/>
                    <h:outputText id="evento"
                                  value="#{lancamentoReceitaOrcControlador.selecionado.eventoContabil.id eq null ? 'Nenhum evento encontrado.' : lancamentoReceitaOrcControlador.selecionado.eventoContabil}"
                                  styleClass="negrito"/>

                    <fc:outputLabelObrigatorio for="dataReferencia" value="Data de Referência: "/>
                    <p:calendar title="Informe a Data de Conciliação"
                                value="#{lancamentoReceitaOrcControlador.selecionado.dataReferencia}"
                                disabled="#{lancamentoReceitaOrcControlador.isOperacaoEditar()}"
                                id="dataReferencia"
                                onkeyup="mascara(this, mdata)"
                                size="21"
                                navigator="true"
                                pattern="dd/MM/yyyy"
                                locale="pt_BR"/>

                    <h:outputText value="Conta Bancária: "/>
                    <p:autoComplete queryDelay="1000"
                                    title="Selecione uma conta bancária."
                                    id="completaContaBanc"
                                    forceSelection="true"
                                    completeMethod="#{lancamentoReceitaOrcControlador.completaContaBancaria}"
                                    converter="#{lancamentoReceitaOrcControlador.converterContaBancaria}"
                                    value="#{lancamentoReceitaOrcControlador.contaBancariaEntidade}"
                                    disabled="#{lancamentoReceitaOrcControlador.isOperacaoEditar() or lancamentoReceitaOrcControlador.selecionado.receitaLOA eq null}"
                                    var="banc"
                                    maxResults="10"
                                    itemLabel="#{banc.toStringAutoCompleteContaBancaria()}"
                                    itemValue="#{banc.id}"
                                    size="70"
                                    onkeyup="if(keyUpCampoVazio(this)){(limparContaFinanceira());}">
                        <p:ajax update=":Formulario:completaContaFinanceria"
                                process="@this"
                                event="itemSelect"
                                onstart="aguarde.show()"
                                oncomplete="aguarde.hide();setaFoco('Formulario:completaContaFinanceria_input')"/>
                    </p:autoComplete>

                    <fc:outputLabelObrigatorio value="Conta Financeira: "/>
                    <h:panelGrid id="panelContaFinanceira" columns="4" cellpadding="0" cellspacing="0">
                        <p:autoComplete queryDelay="1000"
                                        id="completaContaFinanceria"
                                        size="70"
                                        title="Selecione uma conta financeira."
                                        disabled="#{lancamentoReceitaOrcControlador.isOperacaoEditar() or lancamentoReceitaOrcControlador.selecionado.receitaLOA eq null}"
                                        value="#{lancamentoReceitaOrcControlador.subConta}"
                                        completeMethod="#{lancamentoReceitaOrcControlador.completaContaFinanceira}"
                                        converter="#{lancamentoReceitaOrcControlador.converterContaFinanceira}"
                                        maxResults="10"
                                        forceSelection="true"
                                        onkeyup="if(keyUpCampoVazio(this)){(limparPessoaClasse());}"
                                        var="sub"
                                        itemValue="#{sub.id}"
                                        itemLabel="#{sub.toStringAutoCompleteContaFinanceira()}">
                            <p:ajax event="itemSelect"
                                    update=":Formulario:completaContaBanc :Formulario:panelClasseCredor
                            :Formulario:panelConvenio :Formulario:panelDivida :Formulario:panelPessoa
                            :Formulario:botaoVisualizarDetalhesContaFinanceira :Formulario:bt-info-fontes-sub :Formulario:fontesSubConta
                            :Formulario:contaDestinacao :Formulario:tabelaLancReceitaFontes"
                                    process="@this"
                                    onstart="aguarde.show()"
                                    oncomplete="aguarde.hide();panelFonteSubConta.show();setaFoco('Formulario:pessoa_input')"
                                    listener="#{lancamentoReceitaOrcControlador.atribuirContaBancariaEContaFinanceira()}"/>
                        </p:autoComplete>
                        <p:watermark value="Filtra por fontes da receita loa" for="completaContaFinanceria"/>

                        <p:outputPanel id="botaoVisualizarDetalhesContaFinanceira" styleClass="mlef05">
                            <p:commandButton icon="ui-icon-clipboard"
                                             title="Clique para visualizar detalhes Financeira."
                                             onstart="aguarde.show()"
                                             oncomplete="detalhesContaFinanceira.show();aguarde.hide()"
                                             disabled="#{lancamentoReceitaOrcControlador.subConta eq null}"
                                             update=":FormularioDetalhesContaFinanceira:panelDetalhesContaFinanceira"
                                             process="@this"/>
                        </p:outputPanel>

                        <p:commandButton process="@this"
                                         update="@none"
                                         oncomplete="panelFonteSubConta.show()"
                                         rendered="#{lancamentoReceitaOrcControlador.selecionado.id eq null}"
                                         disabled="#{lancamentoReceitaOrcControlador.subConta eq null}"
                                         styleClass="mlef05 mrig05"
                                         id="bt-info-fontes-sub"
                                         title="Clique para visualizar as fontes da conta financeira."
                                         icon="ui-icon-lista"/>

                        <p:overlayPanel for="bt-info-fontes-sub"
                                        at="left top"
                                        my="right top"
                                        onShow="posicionarDivInformacao(this.id)"
                                        widgetVar="panelFonteSubConta"
                                        style="border : solid #497692 1px;"
                                        styleClass="semSombra">

                            <p:dataList id="fontesSubConta"
                                        var="fr"
                                        value="#{lancamentoReceitaOrcControlador.contasDeDestinacao}"
                                        styleClass="mtop03 mbot03 semBorda">
                                <f:facet name="header">
                                    <h:outputText value="Conta de Destinação de Recurso"/>
                                </f:facet>
                                <p:column style="text-align: left">
                                    <h:outputText value="#{fr}"/>
                                </p:column>
                            </p:dataList>
                        </p:overlayPanel>
                    </h:panelGrid>
                </h:panelGrid>

                <h:panelGrid columns="2" width="100%">
                    <p:panel id="panelConvenio" visible="#{lancamentoReceitaOrcControlador.mostraPainelConvenio()}"
                             styleClass="mtop05">

                        <co:titulo-panel titulo="Convênio de Receita"/>
                        <h:panelGrid columns="2">
                            <h:outputText value="Convênio: "/>
                            <h:outputText
                                value="#{lancamentoReceitaOrcControlador.selecionado.convenioReceita.toString()}"
                                styleClass="negrito"/>

                            <h:outputText value="Valor: "/>
                            <h:outputText
                                value="#{lancamentoReceitaOrcControlador.selecionado.convenioReceita.valorConvenio}"
                                styleClass="negrito">
                                <f:convertNumber type="currency"/>
                            </h:outputText>
                        </h:panelGrid>
                    </p:panel>
                </h:panelGrid>


                <h:panelGrid columns="2">
                    <p:panel id="panelDivida" visible="#{lancamentoReceitaOrcControlador.mostrarPainelDivida()}"
                             styleClass="mtop05">

                        <co:titulo-panel titulo="Dívida Pública"/>
                        <h:panelGrid columns="2">
                            <h:outputText value="Dívida: "/>
                            <h:outputText
                                value="#{lancamentoReceitaOrcControlador.selecionado.dividaPublica.descricaoDivida}"
                                styleClass="negrito"/>

                            <fc:outputLabelObrigatorio value="Conta de Destinação de Recurso: "/>
                            <h:selectOneMenu value="#{lancamentoReceitaOrcControlador.selecionado.contaDeDestinacao}"
                                             id="contaDestinacao"
                                             disabled="#{lancamentoReceitaOrcControlador.isOperacaoEditar()}"
                                             converter="#{planoDeContasWizardControlador.converterConta}"
                                             title="Informe a Conta de Destinação de Recurso">
                                <f:selectItems value="#{lancamentoReceitaOrcControlador.buscarContasDeDestinacao()}"/>
                                <p:ajax event="change"
                                        listener="#{lancamentoReceitaOrcControlador.atualizarFonteDeRecursos()}"
                                        process="@this"
                                        update=":Formulario:saldo :Formulario:saldoCurtoPrazo :Formulario:saldoLongoPrazo"/>
                            </h:selectOneMenu>

                            <h:outputText value="Saldo de Curto Prazo: "/>
                            <h:outputText id="saldoCurtoPrazo"
                                          value="#{lancamentoReceitaOrcControlador.recuperarSaldoDividaPublicaCurtoPrazo()}"
                                          converter="moneyConverter" styleClass="negrito"/>

                            <h:outputText value="Saldo de Longo Prazo: "/>
                            <h:outputText id="saldoLongoPrazo"
                                          value="#{lancamentoReceitaOrcControlador.recuperarSaldoDividaPublicaLongoPrazo()}"
                                          converter="moneyConverter" styleClass="negrito"/>

                            <h:outputText value="Saldo Total: "/>
                            <h:outputText id="saldo"
                                          value="#{lancamentoReceitaOrcControlador.recuperarSaldoTotalDividaPublica()}"
                                          converter="moneyConverter" styleClass="negrito"/>
                        </h:panelGrid>
                    </p:panel>
                </h:panelGrid>

                <h:panelGrid columns="2">
                    <fc:outputLabelObrigatorio for="pessoa" value="Pessoa: "/>
                    <h:panelGrid columns="5" id="panelPessoa">
                        <p:autoComplete queryDelay="1000"
                                        title="Selecione uma Pessoa"
                                        id="pessoa"
                                        styleClass="mrig02"
                                        forceSelection="true"
                                        style="margin-left: 59px"
                                        completeMethod="#{lancamentoReceitaOrcControlador.completaPessoa}"
                                        converter="#{lancamentoReceitaOrcControlador.converterPessoa}"
                                        value="#{lancamentoReceitaOrcControlador.selecionado.pessoa}"
                                        disabled="#{lancamentoReceitaOrcControlador.isOperacaoEditar()}"
                                        var="p"
                                        maxResults="10"
                                        itemLabel="#{p.nomeAutoComplete}"
                                        itemValue="#{p.id}"
                                        size="70"
                                        onkeyup="if(keyUpCampoVazio(this)){limparClasseCredor();}">
                            <p:ajax update=":Formulario:classeCredor compCamposPessoa"
                                    event="itemSelect"
                                    onstart="aguarde.show()"
                                    oncomplete="aguarde.hide();setaFoco('Formulario:classeCredor_input')"
                                    listener="#{lancamentoReceitaOrcControlador.setaPessoa}"/>
                        </p:autoComplete>

                        <p:outputPanel id="compCamposPessoa">
                            <fc:visualizarCampos objeto="#{lancamentoReceitaOrcControlador.selecionado.pessoa}"/>
                        </p:outputPanel>

                        <p:commandButton icon="ui-icon-search"
                                         title="Clique para consultar as pessoas."
                                         onstart="aguarde.show()"
                                         oncomplete="DialogPesquisarPessoa.show();aguarde.hide()"
                                         disabled="#{lancamentoReceitaOrcControlador.isOperacaoEditar()}"
                                         update=":FormularioPesquisarPessoa"
                                         process=":FormularioPesquisarPessoa"/>
                    </h:panelGrid>

                    <fc:outputLabelObrigatorio for="classeCredor" value="Classe: "/>
                    <h:panelGrid id="panelClasseCredor">
                        <p:autoComplete queryDelay="1000"
                                        id="classeCredor"
                                        size="70"
                                        title="Informe a Classe"
                                        disabled="#{lancamentoReceitaOrcControlador.selecionado.pessoa eq null or lancamentoReceitaOrcControlador.isOperacaoEditar()}"
                                        value="#{lancamentoReceitaOrcControlador.classeCredor}"
                                        completeMethod="#{lancamentoReceitaOrcControlador.completaClasseCredor}"
                                        converter="#{lancamentoReceitaOrcControlador.converterClasseCredor}"
                                        maxResults="10"
                                        style="margin-left: 57px"
                                        forceSelection="true" var="classe" itemValue="#{classe.id}"
                                        itemLabel="#{classe}">
                            <p:ajax event="itemSelect" listener="#{lancamentoReceitaOrcControlador.setaClasseCredor}"/>
                        </p:autoComplete>
                    </h:panelGrid>

                    <fc:outputLabelObrigatorio value="Histórico: "/>
                    <h:panelGrid columns="2">
                        <p:inputTextarea title="Digite o histórico da Receita Realizada"
                                         value="#{lancamentoReceitaOrcControlador.selecionado.complemento}"
                                         id="complemento"
                                         style="margin-left: 57px"
                                         maxlength="3000" cols="70" rows="5"
                                         autoResize="true" counterTemplate="{0} Caracteres Restantes."
                                         counter="counter"/>
                        <h:outputText id="counter"/>
                    </h:panelGrid>

                    <fc:outputLabelObrigatorio for="valor" value="Valor: "/>
                    <p:outputPanel id="valor">
                        <fc:inputMoeda title="Digite o valor da receita."
                                       style="margin-left: 45px"
                                       disable="#{lancamentoReceitaOrcControlador.isOperacaoEditar() or lancamentoReceitaOrcControlador.desabilitarCampoValor()}"
                                       value="#{lancamentoReceitaOrcControlador.selecionado.valor}"
                                       process="@this"
                                       update="@this"/>
                    </p:outputPanel>

                    <h:outputText value="Saldo: " rendered="#{lancamentoReceitaOrcControlador.selecionado.id ne null}"/>
                    <h:outputText value="#{lancamentoReceitaOrcControlador.selecionado.saldo}"
                                  styleClass="negrito"
                                  style="margin-left: 45px"
                                  converter="moneyConverter"
                                  rendered="#{lancamentoReceitaOrcControlador.selecionado.id ne null}"/>
                </h:panelGrid>
                <br/>

                <h:panelGrid columns="3" id="btCalcular">
                    <p:commandButton value="Calcular Lançamentos"
                                     icon="ui-icon-calculator"
                                     styleClass="padrao"
                                     disabled="#{lancamentoReceitaOrcControlador.selecionado.receitaLOA eq null or lancamentoReceitaOrcControlador.isOperacaoEditar()}"
                                     onstart="aguarde.show()"
                                     oncomplete="aguarde.hide()"
                                     title="Clique para calcular os lançamentos."
                                     actionListener="#{lancamentoReceitaOrcControlador.geraLancamentos()}"
                                     update=":Formulario:tabelaLancReceitaFontes :Formulario:valor :Formulario:tabelaLancReceitaFontes:diferenca :Formulario:btRecalcular :Formulario:botaoVisualizarDetalhesReceitaLoa"
                                     process="@this :Formulario:tabelaLancReceitaFontes"/>

                    <p:commandButton value="Recalcular"
                                     id="btRecalcular"
                                     update=":Formulario:tabelaLancReceitaFontes :Formulario:valor :Formulario:tabelaLancReceitaFontes:diferenca :Formulario:btRecalcular :Formulario:botaoVisualizarDetalhesReceitaLoa"
                                     process="@this :Formulario:tabelaLancReceitaFontes"
                                     styleClass="padrao"
                                     onstart="aguarde.show()"
                                     oncomplete="aguarde.hide()"
                                     disabled="#{empty lancamentoReceitaOrcControlador.selecionado.lancReceitaFonte or lancamentoReceitaOrcControlador.isOperacaoEditar()}"
                                     title="Clique para recalcular os valores."
                                     icon="ui-icon-calculator"
                                     actionListener="#{lancamentoReceitaOrcControlador.recalcular()}"/>

                    <p:commandButton value="Alterar Conjunto de Fontes"
                                     icon="ui-icon-pencil"
                                     onstart="aguarde.show()"
                                     oncomplete="aguarde.hide();dialogConjFontes.show();painelInformacoes.hide()"
                                     actionListener="#{lancamentoReceitaOrcControlador.recuperarReceitaLOA()}"
                                     disabled="#{lancamentoReceitaOrcControlador.isOperacaoEditar()}"
                                     rendered="#{lancamentoReceitaOrcControlador.mostrarBotaoAlterarConjuntoFonte()}"
                                     styleClass="prioritario mtop02 padrao"
                                     process="@this"
                                     update=":formConjFontes"/>
                </h:panelGrid>

                <p:dataTable value="#{lancamentoReceitaOrcControlador.selecionado.lancReceitaFonte}"
                             id="tabelaLancReceitaFontes"
                             var="lancamentoReceita"
                             styleClass="mtop02"
                             rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                             paginator="true"
                             rows="10"
                             paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>RECEITAS FONTES&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                             emptyMessage="Não foram localizados registros para serem apresentados."
                             rowIndexVar="rowlx">

                    <p:column headerText="Ação" style="text-align: center; width: 5%">
                        <p:commandButton icon="ui-icon-trash"
                                         id="Remover"
                                         onstart="aguarde.show()"
                                         oncomplete="aguarde.hide()"
                                         disabled="#{lancamentoReceitaOrcControlador.isOperacaoEditar()}"
                                         process="@this"
                                         update=":Formulario:tabelaLancReceitaFontes :Formulario:valor :Formulario:btRecalcular"
                                         title="Clique para remover este registro."
                                         onclick="if (!confirm('Tem certeza que deseja remover este registro?')) {return false; } else {aguarde.show();}"
                                         actionListener="#{lancamentoReceitaOrcControlador.removeLancReceitasFontes(lancamentoReceita)}">
                        </p:commandButton>
                    </p:column>

                    <p:column headerText="Conjunto de Fontes"
                              style="width: 10%"
                              styleClass="alinhamentoCentralizado">
                        <h:outputText value="#{lancamentoReceita.receitaLoaFonte.item}"/>
                    </p:column>
                    <p:column headerText="Conta de Destinação" style="width: 40%" styleClass="alinhamentoEsquerda">
                        <h:outputText value="#{lancamentoReceita.receitaLoaFonte.destinacaoDeRecursos}"/>
                    </p:column>
                    <p:column headerText="Código CO"
                              styleClass="alinhamentoEsquerda"
                              rendered="#{lancamentoReceitaOrcControlador.selecionado.subConta ne null
                              and lancamentoReceitaOrcControlador.selecionado.subConta.obrigarCodigoCO}">
                        <p:autoComplete id="autoCodigoCo"
                                        queryDelay="1000"
                                        size="70"
                                        title="Informe o Código CO"
                                        value="#{lancamentoReceita.codigoCO}"
                                        completeMethod="#{lancamentoReceitaOrcControlador.completarCodigosCOs}"
                                        converter="#{codigoCOControlador.converterGenerico}"
                                        maxResults="10"
                                        forceSelection="true"
                                        var="cco"
                                        itemValue="#{cco.id}"
                                        itemLabel="#{cco}"/>
                    </p:column>
                    <p:column headerText="Valor (R$)" style="width: 10%" styleClass="alinhamentoDireita">
                        <h:outputText value="#{lancamentoReceita.valor}"
                                      converter="#{lancamentoReceitaOrcControlador.moneyConverter}"/>
                        <f:facet name="footer">
                            <h:outputText value="Total: " styleClass="negrito"/>
                            <h:outputText value="#{lancamentoReceitaOrcControlador.somaLancamentos()}"
                                          styleClass="negrito"
                                          converter="#{lancamentoReceitaOrcControlador.moneyConverter}"/>
                        </f:facet>
                    </p:column>
                    <f:facet name="footer">
                        <div align="right">
                            <h:outputText value="Diferença: "/>
                            <h:outputText id="diferenca" value="#{lancamentoReceitaOrcControlador.calculaDiferenca()}"
                                          converter="#{lancamentoReceitaOrcControlador.moneyConverter}"
                                          styleClass="negrito"/>
                        </div>
                    </f:facet>
                </p:dataTable>
            </p:panel>

            <h:panelGrid columns="2" cellpadding="0" cellspacing="0">
                <fc:rodapePretty id="rodapeEdita" controlador="#{lancamentoReceitaOrcControlador}"/>

                <co:rodape-conciliar controlador="#{lancamentoReceitaOrcControlador}"
                                     mostrarBtBaixar="#{lancamentoReceitaOrcControlador.mostrarBotaoBaixar()}"
                                     mostrarBtEstornoBaixa="#{lancamentoReceitaOrcControlador.mostrarBotaoEstornarBaixar()}"/>
            </h:panelGrid>
        </h:form>

        <p:dialog widgetVar="DialogPesquisarPessoa"
                  modal="true"
                  width="900"
                  height="500">
            <h:form id="FormularioPesquisarPessoa">
                <p:panel>
                    <p:outputPanel rendered="#{lancamentoReceitaOrcControlador.selecionado ne null}">
                        <fc:pesquisaGenerico
                            selecionar="#{lancamentoReceitaOrcControlador.setarPessoa}"
                            updateSelecionarTabela=":Formulario"
                            id="componentePesquisaGenerico"
                            nomeDaClasse="Pessoa"
                            guardarNaSessao="false"
                            actionSelecionar="#{lancamentoReceitaOrcControlador.caminhoVisualizar()}"
                            novo="#{pessoaTributarioControlador.novaPessoaFisica()}"
                            caminhoAtual="listatributario"
                            caminhoControlador="#{pessoaTributarioControlador.caminho}"
                            mostrarBotaoNovo="false"
                            mostrarBotaoImprimirRelatorioTabela="false"
                            mostrarHistorico="false"
                            utilizarTabelaPessoa="true"
                            pesquisaNoEnter="false"
                            mostrarOrdenacao="false"
                            iconmSelecionar="check-icon.png"
                            mostrarBotaoImprimirRelatorioUnicoRegistro="false"
                            pretty="true"
                            dialog="true"
                            mostrarBotaoEditarConfiguracaoRelatorio="false"
                            meuControlador="#{pessoaPesquisaGenerico}"/>
                    </p:outputPanel>
                </p:panel>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="detalhesReceitaLoa"
                  modal="true"
                  dynamic="true"
                  position="center">
            <h:form id="FormularioDetalhesReceitaLoa">
                <p:panel id="panelDetalhesReceitaLoa">
                    <h:panelGrid id="panelComp" columns="2">
                        <h:outputText value="Unidade Organizacional:"/>
                        <h:outputText value="#{lancamentoReceitaOrcControlador.selecionado.receitaLOA.entidade}"
                                      styleClass="negrito"/>

                        <h:outputText value="Conta de Receita: "/>
                        <h:outputText value="#{lancamentoReceitaOrcControlador.selecionado.receitaLOA.contaDeReceita}"
                                      styleClass="negrito"/>

                        <h:outputText value="Valor:"/>
                        <h:outputText value="#{lancamentoReceitaOrcControlador.selecionado.receitaLOA.valor}"
                                      converter="moneyConverter"
                                      styleClass="negrito"/>
                    </h:panelGrid>

                    <p:dataTable id="fontes"
                                 var="fonte"
                                 value="#{lancamentoReceitaOrcControlador.selecionado.receitaLOA.receitaLoaFontes}"
                                 rowKey="#{fonte.id}"
                                 rowStyleClass="#{fonte.item eq lancamentoReceitaOrcControlador.receitaLOAFonte.item ? 'fundo-amarelo-padrao' : empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                 paginator="true"
                                 rows="10"
                                 styleClass="mtop10"
                                 paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>FONTES DE RECURSOS&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                 emptyMessage="Não foram localizados registros para serem apresentados."
                                 rowIndexVar="rowlx">
                        <p:column headerText="Arred."
                                  style="text-align: center">
                            <h:outputText value="${fonte.rounding ? 'Sim' : 'Não'}"/>
                        </p:column>
                        <p:column headerText="Conjunto"
                                  style="text-align: center">
                            <h:outputText value="#{fonte.item}"/>
                        </p:column>
                        <p:column headerText="Fonte de Recurso"
                                  style="text-align: left">
                            <h:outputText value="${fonte.destinacaoDeRecursos}"/>
                        </p:column>
                        <p:column headerText="Percentual"
                                  style="text-align: right">
                            <h:outputText value="${fonte.percentual}"
                                          converter="#{receitaLOAWizardControlador.percentualConverter}"/>
                        </p:column>
                        <p:column headerText="Esfera Orçamentária" style="text-align: left">
                            <h:outputText value="${fonte.esferaOrcamentaria.descricao}"/>
                        </p:column>
                        <p:column headerText="Valor(R$)"
                                  style="text-align: right">
                            <h:outputText value="${fonte.valor}"
                                          converter="#{receitaLOAWizardControlador.moneyConverter}"/>
                        </p:column>
                    </p:dataTable>

                    <h:panelGrid columns="2"
                                 styleClass="mtop05"
                                 cellpadding="0" cellspacing="0"
                                 rendered="#{lancamentoReceitaOrcControlador.selecionado.id eq null}">
                        <p:commandButton style="width: 15px; height: 15px; background-color: #FBEC88 !important"
                                         icon="ui-icon-none"/>
                        <h:outputText value="Fontes de Recursos selecionadas para o lançamento de receita."/>
                    </h:panelGrid>
                </p:panel>
            </h:form>
        </p:dialog>


        <p:dialog widgetVar="detalhesContaFinanceira"
                  modal="true"
                  dynamic="true"
                  height="500"
                  position="center">
            <h:form id="FormularioDetalhesContaFinanceira">
                <p:panel id="panelDetalhesContaFinanceira">
                    <h:panelGrid id="panelComp" columns="2">
                        <h:outputText value="Conta Financeira: "/>
                        <h:outputText
                            value="#{lancamentoReceitaOrcControlador.selecionado.subConta.toStringAutoCompleteContaFinanceira()}"
                            styleClass="negrito"/>
                    </h:panelGrid>

                    <p:dataTable id="unidades"
                                 value="#{lancamentoReceitaOrcControlador.selecionado.subConta.unidadesOrganizacionais}"
                                 var="un"
                                 rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                 styleClass="mtop01"
                                 paginator="true"
                                 rows="10"
                                 paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>UNIDADES ORGANIZACIONAIS&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                 emptyMessage="Não foram localizados registros para serem apresentados."
                                 rowIndexVar="rowlx">

                        <p:column headerText="Unidade Organizacional" styleClass="alinhamentoEsquerda">
                            <h:outputText value="#{un.unidadeOrganizacional.descricao}"/>
                        </p:column>
                        <p:column headerText="Exercício" style="width: 20%" styleClass="alinhamentoDireita">
                            <h:outputText value="#{un.exercicio.ano}"/>
                        </p:column>
                    </p:dataTable>

                    <p:dataTable
                        id="fontes"
                        var="objetos"
                        value="#{lancamentoReceitaOrcControlador.selecionado.subConta.subContaFonteRecs}"
                        rowKey="#{objetos.id}"
                        rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                        paginator="true"
                        rows="10"
                        styleClass="mtop20"
                        paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>CONTAS DE DESTINAÇÃO DE RECURSOS&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                        currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                        emptyMessage="Não foram localizados registros para serem apresentados."
                        rowIndexVar="rowlx">
                        <p:column headerText="Conta de Destinação de Recurso" styleClass="alinhamentoEsquerda">
                            <h:outputText value="#{objetos.contaDeDestinacao}"/>
                        </p:column>
                        <p:column headerText="Exercício" style="width: 20%" styleClass="alinhamentoDireita">
                            <h:outputText value="#{objetos.contaDeDestinacao.exercicio.ano}"/>
                        </p:column>
                    </p:dataTable>
                </p:panel>
            </h:form>
        </p:dialog>


        <p:dialog widgetVar="dialogConjFontes"
                  modal="true"
                  closable="false"
                  resizable="false"
                  dynamic="true"
                  position="center">
            <h:form id="formConjFontes">
                <p:panel id="panelConjFontes">

                    <h:panelGrid columns="2">
                        <h:outputText value="Unidade Organizacional:"/>
                        <h:outputText value="#{lancamentoReceitaOrcControlador.selecionado.receitaLOA.entidade}"
                                      styleClass="negrito"/>

                        <h:outputText value="Conta de Receita: "/>
                        <h:outputText value="#{lancamentoReceitaOrcControlador.selecionado.receitaLOA.contaDeReceita}"
                                      styleClass="negrito"/>

                        <h:outputText value="Valor:"/>
                        <h:outputText value="#{lancamentoReceitaOrcControlador.selecionado.receitaLOA.valor}"
                                      converter="moneyConverter"
                                      styleClass="negrito"/>

                        <fc:outputLabelObrigatorio value="Conjunto de Fontes: "/>
                        <h:selectOneRadio id="conjFontes"
                                          styleClass="negrito"
                                          value="#{lancamentoReceitaOrcControlador.receitaLOAFonte.item}">
                            <f:selectItems value="#{lancamentoReceitaOrcControlador.conjuntoDeFontes}"/>
                            <p:ajax update="tableConjFontes"
                                    event="change"
                                    onstart="aguarde.show()"
                                    oncomplete="aguarde.hide()"/>
                        </h:selectOneRadio>
                    </h:panelGrid>

                    <p:dataTable id="tableConjFontes"
                                 var="fonteRec"
                                 value="#{lancamentoReceitaOrcControlador.fonteRecursoPorConjuntoFontes}"
                                 rowKey="#{fonteRec.id}"
                                 rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                 paginator="true"
                                 rows="10"
                                 styleClass="mtop05"
                                 paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>FONTES DE RECURSOS&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                 emptyMessage="Não foram localizados registros para serem apresentados."
                                 rowIndexVar="rowlx">
                        <p:column headerText="Fonte de Recurso"
                                  style="text-align: left">
                            <h:outputText value="#{fonteRec}"/>
                        </p:column>
                    </p:dataTable>
                </p:panel>

                <p:commandButton value="Confirmar"
                                 icon="ui-icon-check"
                                 styleClass="padrao mtop10 mrig05"
                                 disabled="#{lancamentoReceitaOrcControlador.isOperacaoEditar()}"
                                 onstart="aguarde.show()"
                                 oncomplete="aguarde.hide();dialogConjFontes.hide();painelInformacoes.show()"
                                 title="Clique para confirmar o conjunto de fonte selecionado."
                                 actionListener="#{lancamentoReceitaOrcControlador.armazenarConjuntoFonte()}"
                                 update="tableConjFontes :Formulario:completaContaFinanceria :Formulario:completaContaBanc :Formulario:fontesReceitaLoa :Formulario:tabelaLancReceitaFontes :Formulario:valor :Formulario:tabelaLancReceitaFontes:diferenca :Formulario:btRecalcular :Formulario:botaoVisualizarDetalhesReceitaLoa"
                                 process="@this"/>
            </h:form>
        </p:dialog>


    </ui:define>
</ui:composition>
</html>
