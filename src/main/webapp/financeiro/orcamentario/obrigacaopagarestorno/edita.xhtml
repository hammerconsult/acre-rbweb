<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:co="http://java.sun.com/jsf/composite/components/contabil"
      xmlns:p="http://primefaces.org/ui">
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">

        <h:form id="Formulario">
            <p:remoteCommand name="limparCampos"
                             process="@this"
                             actionListener="#{obrigacaoAPagarEstornoControlador.definirNullParaObrigacao()}"
                             update=":Formulario:panelDadosOP :Formulario:panelValor"/>

            <fc:cabecalhoPretty controlador="#{obrigacaoAPagarEstornoControlador}"
                                origem="#{obrigacaoAPagarEstornoControlador.caminhoPadrao}listar/"/>

            <p:panel header="Estorno de Obrigação a Pagar" id="panelGeral">
                <h:panelGrid columns="2">
                    <h:outputText value="Número: "/>
                    <h:outputText id="numero"
                                  value="#{obrigacaoAPagarEstornoControlador.selecionado.id eq null ? 'Gerado automaticamente' : obrigacaoAPagarEstornoControlador.selecionado.numero}"
                                  styleClass="negrito"/>

                    <h:outputText value="Data: "/>
                    <h:outputText value="#{obrigacaoAPagarEstornoControlador.selecionado.dataEstorno}"
                                  styleClass="negrito">
                        <f:convertDateTime type="date"/>
                    </h:outputText>

                    <h:outputText value="Unidade Organizacional: "/>
                    <fc:codigo-descricao-hierarquia
                        tipoHierarquia="ORCAMENTARIA"
                        unidadeOrganizacional="#{obrigacaoAPagarEstornoControlador.selecionado.unidadeOrganizacional}"
                        dataMovimento="#{obrigacaoAPagarEstornoControlador.selecionado.dataEstorno}"/>

                    <fc:outputLabelObrigatorio value="Obrigação a Pagar: "/>
                    <h:panelGroup>
                        <p:autoComplete queryDelay="1000"
                                        title="Selecione uma obrigação a pagar."
                                        id="obrigacao"
                                        disabled="#{obrigacaoAPagarEstornoControlador.isRegistroEditavel()}"
                                        value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar}"
                                        completeMethod="#{obrigacaoAPagarEstornoControlador.completarObrigacaoPagar}"
                                        converter="#{obrigacaoAPagarControlador.converterGenerico}"
                                        panelStyle="max-height: 250px;"
                                        dropdown="true"
                                        onkeyup="if(keyUpCampoVazio(this)){limparCampos()}"
                                        var="op"
                                        size="70"
                                        maxResults="50"
                                        itemValue="#{op.id}"
                                        itemLabel="#{op}">
                            <p:ajax event="itemSelect"
                                    process="@this"
                                    onstart="aguarde.show()"
                                    oncomplete="aguarde.hide()"
                                    update=":Formulario:panelGeral"
                                    listener="#{obrigacaoAPagarEstornoControlador.definirObrigacaoPagar()}"/>
                        </p:autoComplete>

                        <p:commandButton styleClass="mlef05"
                                         update=":Formulario-dialog:panelDialog"
                                         title="Clique para abrir a pesquisa avançada de obrigação a pagar."
                                         onstart="aguarde.show()"
                                         disabled="#{obrigacaoAPagarEstornoControlador.isRegistroEditavel()}"
                                         oncomplete="dialog.show();aguarde.hide()"
                                         icon="ui-icon-search"/>
                    </h:panelGroup>
                </h:panelGrid>

                <p:outputPanel id="panelDadosOP">
                    <p:panel rendered="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar ne null}"
                             header="Obrigação a Pagar"
                             styleClass="mtop05">

                        <h:panelGrid columns="2" cellpadding="2">
                            <h:outputText value="Número: "/>
                            <h:outputText
                                value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.numero}"
                                styleClass="negrito"/>

                            <h:outputText value="Data: "/>
                            <h:outputText
                                value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.dataLancamento}"
                                styleClass="negrito">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>

                            <h:outputText value="Unidade Organizacional: "/>
                            <fc:codigo-descricao-hierarquia
                                tipoHierarquia="ORCAMENTARIA"
                                unidadeOrganizacional="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.unidadeOrganizacional}"
                                dataMovimento="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.dataLancamento}"/>

                            <h:outputText value="Elemento de Despesa: "/>
                            <co:consultar-despesa-orcamentaria disabled="true"
                                                               value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.despesaORC}"/>

                            <h:outputText value="Tipo de Conta: "/>
                            <h:outputText
                                value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.tipoContaDespesa.descricao}"
                                styleClass="negrito"/>

                            <h:outputText value="Subtipo da Conta: "/>
                            <h:outputText
                                value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.subTipoDespesa.descricao}"
                                styleClass="negrito"/>

                            <h:outputText value="Fonte de Recursos: "/>
                            <h:outputText value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.fonteDespesaORC.descricaoFonteDeRecurso}"
                                          styleClass="negrito"/>

                            <h:outputText value="Conta de Destinação de Recurso: "/>
                            <h:outputText value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.fonteDespesaORC.descricaoContaDeDestinacao}"
                                          styleClass="negrito"/>

                            <h:outputText value="Pessoa: "/>
                            <h:outputText
                                value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.pessoa}"
                                styleClass="negrito"/>

                            <h:outputText value="Classe: "/>
                            <h:outputText
                                value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.classeCredor}"
                                styleClass="negrito"/>

                            <h:outputText value="Histórico: "/>
                            <h:outputText
                                value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.historico}"
                                styleClass="negrito"/>

                            <h:outputText value="Valor: "/>
                            <h:outputText value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.valor}"
                                          converter="moneyConverter" styleClass="negrito"/>

                            <h:outputText value="Saldo a Liquidar: "/>
                            <h:outputText styleClass="negrito" converter="moneyConverter"
                                          value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.saldo}"/>

                            <h:outputText value="Saldo a Empenhar: "/>
                            <h:outputText styleClass="negrito" converter="moneyConverter"
                                          value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.saldoEmpenho}"/>
                        </h:panelGrid>

                        <p:tabView id="tabViewObrigacao">
                            <p:tab title="Documentos Comprobatórios">
                                <p:dataTable id="tabelaContas"
                                             value="#{obrigacaoAPagarEstornoControlador.desdobramentosObrigacaoPagar}"
                                             var="desdOP"
                                             styleClass="mtop05"
                                             rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                             paginator="true"
                                             rows="10"
                                             paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10' maiuscula>DETALHAMENTOS&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                             emptyMessage="Não foram localizados registros para serem apresentados."
                                             rowIndexVar="rowlx">
                                    <p:column headerText="Conta de Despesa" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{desdOP.conta}"/>
                                    </p:column>
                                    <p:column headerText="Tipo de Conta de Despesa" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{desdOP.conta.tipoContaDespesa.descricao}"/>
                                    </p:column>
                                    <p:column headerText="Evento Contábil" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{desdOP.eventoContabil} "/>
                                    </p:column>
                                    <p:column headerText="Valor (R$)" style="text-align: right">
                                        <h:outputText value="#{desdOP.valor}" converter="moneyConverter"/>
                                        <f:facet name="footer">
                                            <div align="right">
                                                <h:outputText
                                                    value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.valorTotalDesdobramentos}"
                                                    converter="moneyConverter"/>
                                            </div>
                                        </f:facet>
                                    </p:column>
                                    <p:column headerText="Saldo (R$)" style="text-align: right">
                                        <h:outputText value="#{desdOP.saldo}" converter="moneyConverter"/>
                                        <f:facet name="footer">
                                            <div align="right">
                                                <h:outputText
                                                    value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.saldoTotalDesdobramentos}"
                                                    converter="moneyConverter"/>
                                            </div>
                                        </f:facet>
                                    </p:column>
                                </p:dataTable>
                            </p:tab>

                            <p:tab title="Detalhamento">
                                <p:dataTable id="tabelaDoctosOp"
                                             value="#{obrigacaoAPagarEstornoControlador.documentosFiscaisObrigacaoPagar}"
                                             var="docOp"
                                             styleClass="mtop05"
                                             rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                             paginator="true"
                                             rows="10"
                                             paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10' maiuscula>DOCUMENTOS COMPROBATÓRIOS&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                             emptyMessage="Não foram localizados registros para serem apresentados."
                                             rowIndexVar="rowlx">
                                    <p:column headerText="Tipo de Documento" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{docOp.documentoFiscal.tipoDocumentoFiscal}"/>
                                    </p:column>
                                    <p:column headerText="Data de Emissão" styleClass="alinhamentoCentralizado">
                                        <h:outputText value="#{docOp.documentoFiscal.dataDocto}">
                                            <f:convertDateTime type="date"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Número" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{docOp.documentoFiscal.numero} "/>
                                    </p:column>
                                    <p:column headerText="Série" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{docOp.documentoFiscal.serie} "/>
                                    </p:column>
                                    <p:column headerText="Estado" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{docOp.documentoFiscal.uf} "/>
                                    </p:column>
                                    <p:column headerText="Valor (R$)" style="text-align: right">
                                        <h:outputText value="#{docOp.valor}" converter="moneyConverter"/>
                                        <f:facet name="footer">
                                            <div align="right">
                                                <h:outputText
                                                    value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.valorTotalDocumentos}"
                                                    converter="moneyConverter"/>
                                            </div>
                                        </f:facet>
                                    </p:column>
                                    <p:column headerText="Saldo (R$)" style="text-align: right">
                                        <h:outputText value="#{docOp.saldo}" converter="moneyConverter"/>
                                        <f:facet name="footer">
                                            <div align="right">
                                                <h:outputText
                                                    value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.saldoTotalDocumentos}"
                                                    converter="moneyConverter"/>
                                            </div>
                                        </f:facet>
                                    </p:column>
                                </p:dataTable>
                            </p:tab>
                        </p:tabView>

                        <hr/>
                        <h:panelGrid columns="2" cellpadding="2"
                                     rendered="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.isObrigacaoPagarDepoisEmpenho()}">
                            <h:outputText value="Empenho: "/>
                            <h:outputText
                                value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.empenho}"
                                styleClass="negrito"/>

                            <h:outputText value="Tipo de Empenho: "/>
                            <h:outputText
                                value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.empenho.tipoEmpenho.descricao}"
                                styleClass="negrito"/>

                            <h:outputText value="Elemento de Despesa: "/>
                            <fc:funcionalProgramatica
                                idDespesaOrc="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.empenho.despesaORC}"
                                visivel="true"/>

                            <h:outputText value="Valor do Empenho: "/>
                            <h:outputText
                                value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.empenho.valor}"
                                converter="moneyConverter" styleClass="negrito"/>

                            <h:outputText value="Saldo do Empenho: "/>
                            <h:outputText styleClass="negrito" converter="moneyConverter"
                                          value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.empenho.saldo}"/>

                            <h:outputText value="Saldo de Obrigação Antes Empenho: "/>
                            <h:outputText styleClass="negrito"
                                          converter="moneyConverter"
                                          value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.empenho.saldoObrigacaoPagarAntesEmp}"/>

                            <h:outputText value="Saldo de Obrigação Depois Empenho: "/>
                            <h:outputText styleClass="negrito"
                                          converter="moneyConverter"
                                          value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.empenho.saldoObrigacaoPagarDepoisEmp}"/>

                            <h:outputText value="Saldo sem Obrigação a Pagar: "/>
                            <h:outputText styleClass="negrito"
                                          converter="moneyConverter"
                                          value="#{obrigacaoAPagarEstornoControlador.selecionado.obrigacaoAPagar.empenho.saldoDisponivelEmpenhoComObrigacao}"/>
                        </h:panelGrid>
                    </p:panel>


                    <p:tabView id="viewGeral" styleClass="mtop10">
                        <p:tab title="Documento/Detalhamento do Estorno">
                            <p:outputPanel id="panelDocumento">
                                <p:commandButton value="Novo"
                                                 icon="ui-icon-circle-plus"
                                                 actionListener="#{obrigacaoAPagarEstornoControlador.novoDocumentoFiscal()}"
                                                 rendered="#{obrigacaoAPagarEstornoControlador.documentoFiscal eq null}"
                                                 update=":Formulario:viewGeral:panelDocumento"
                                                 process="@this"
                                                 id="btnNovoDocumento"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 styleClass="mtop10 padrao"
                                                 disabled="#{obrigacaoAPagarEstornoControlador.isRegistroEditavel()}"
                                                 title="Clique para adicionar um novo desdobramento."/>

                                <h:panelGrid columns="2"
                                             rendered="#{obrigacaoAPagarEstornoControlador.documentoFiscal ne null}">
                                    <fc:outputLabelObrigatorio for="doctoFiscal" value="Documento Fiscal: "/>
                                    <h:panelGrid columns="2" cellpadding="0" cellspacing="0">
                                        <p:autoComplete queryDelay="1000"
                                                        id="doctoFiscal"
                                                        size="70"
                                                        title="Selecione um documento fiscal."
                                                        completeMethod="#{obrigacaoAPagarEstornoControlador.completarDocumentosFiscais}"
                                                        converter="#{obrigacaoAPagarEstornoControlador.converterDocumentoFiscal}"
                                                        value="#{obrigacaoAPagarEstornoControlador.documentoFiscal.documentoFiscal}"
                                                        var="cd"
                                                        styleClass="mrig03"
                                                        maxlength="50"
                                                        dropdown="true"
                                                        panelStyle="max-height: 250px"
                                                        itemValue="#{cd.id}"
                                                        itemLabel="#{cd}">
                                            <p:ajax event="itemSelect"
                                                    update="valorDocumento"
                                                    process="@this"
                                                    listener="#{obrigacaoAPagarEstornoControlador.definirSaldoDocumentoFiscal()}"/>
                                        </p:autoComplete>
                                    </h:panelGrid>

                                    <fc:outputLabelObrigatorio value="Valor: "/>
                                    <p:outputPanel id="valorDocumento">
                                        <fc:inputMoeda
                                            value="#{obrigacaoAPagarEstornoControlador.documentoFiscal.valor}"
                                            title="Informe o valor do documento."/>
                                    </p:outputPanel>
                                </h:panelGrid>

                                <p:commandButton id="btnAddDocumento"
                                                 icon="ui-icon-check"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 styleClass="mtop10 padrao"
                                                 rendered="#{obrigacaoAPagarEstornoControlador.documentoFiscal ne null}"
                                                 actionListener="#{obrigacaoAPagarEstornoControlador.adicionarDocumentoFiscal()}"
                                                 title="Clique para adicionar este registro."
                                                 update=":Formulario:viewGeral:panelDocumento"
                                                 process=":Formulario:viewGeral:panelDocumento @this"
                                                 value="Adicionar"/>

                                <p:commandButton value="Cancelar"
                                                 icon="ui-icon-cancel"
                                                 actionListener="#{obrigacaoAPagarEstornoControlador.cancelarDocumentoFiscal()}"
                                                 rendered="#{obrigacaoAPagarEstornoControlador.documentoFiscal ne null}"
                                                 update=":Formulario:viewGeral:panelDocumento"
                                                 process="@this"
                                                 id="btnCancelarDocto"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 styleClass="mlef05 mtop10 padrao"
                                                 title="Clique para cancelar esta operação."/>

                                <p:dataTable id="tabelaDocumentos"
                                             value="#{obrigacaoAPagarEstornoControlador.selecionado.documentosFiscais}"
                                             var="doctoEst"
                                             styleClass="mtop02"
                                             rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                             paginator="true"
                                             rows="10"
                                             paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>Documentos Comprobatórios&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                             emptyMessage="Não foram localizados registros para serem apresentados."
                                             rowIndexVar="rowlx">
                                    <p:column headerText="Ação" style="width: 8%;text-align: center">
                                        <p:commandButton icon="ui-icon-pencil"
                                                         onstart="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         styleClass="mrig05"
                                                         actionListener="#{obrigacaoAPagarEstornoControlador.editarDocumentoFiscal(doctoEst)}"
                                                         disabled="#{obrigacaoAPagarEstornoControlador.isRegistroEditavel()}"
                                                         title="Clique para alterar este registro."
                                                         id="btEditarDocto"
                                                         process="@this :Formulario:viewGeral:panelDocumento"
                                                         update=":Formulario:viewGeral:panelDocumento"/>

                                        <p:commandButton id="btnExcluirDocto"
                                                         update=":Formulario:viewGeral:tabelaDocumentos"
                                                         process="@this"
                                                         actionListener="#{obrigacaoAPagarEstornoControlador.removerDocumentoFiscal(doctoEst)}"
                                                         disabled="#{obrigacaoAPagarEstornoControlador.isRegistroEditavel()}"
                                                         title="Clique para remover este registro."
                                                         icon="ui-icon-trash"
                                                         onstart="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         onclick="if (!confirm('Tem certeza que deseja remover este registro?')) {return false; } else {aguarde.show();}"/>
                                    </p:column>
                                    <p:column headerText="Tipo de Documento" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{doctoEst.documentoFiscal.tipoDocumentoFiscal}"/>
                                    </p:column>
                                    <p:column headerText="Data de Emissão" styleClass="alinhamentoCentralizado">
                                        <h:outputText value="#{doctoEst.documentoFiscal.dataDocto}">
                                            <f:convertDateTime type="date"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Número" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{doctoEst.documentoFiscal.numero} "/>
                                    </p:column>
                                    <p:column headerText="Série" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{doctoEst.documentoFiscal.serie} "/>
                                    </p:column>
                                    <p:column headerText="Estado" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{doctoEst.documentoFiscal.uf} "/>
                                    </p:column>
                                    <p:column headerText="Valor (R$)" style="text-align: right">
                                        <h:outputText value="#{doctoEst.valor}" converter="moneyConverter"/>
                                        <f:facet name="footer">
                                            <div align="right">
                                                <h:outputText
                                                    value="#{obrigacaoAPagarEstornoControlador.selecionado.valorTotalDocumentos}"
                                                    converter="moneyConverter"/>
                                            </div>
                                        </f:facet>
                                    </p:column>
                                </p:dataTable>
                            </p:outputPanel>

                            <hr class="mtop20"/>

                            <p:outputPanel id="panelDetalhamento">
                                <p:commandButton value="Novo"
                                                 icon="ui-icon-circle-plus"
                                                 actionListener="#{obrigacaoAPagarEstornoControlador.novoDesdobramento()}"
                                                 rendered="#{obrigacaoAPagarEstornoControlador.desdobramento eq null}"
                                                 update=":Formulario:viewGeral:panelDetalhamento"
                                                 process="@this"
                                                 id="btnNovoDesdobramento"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 styleClass="mtop10 padrao"
                                                 disabled="#{obrigacaoAPagarEstornoControlador.isRegistroEditavel()}"
                                                 title="Clique para adicionar um novo desdobramento."/>

                                <h:panelGrid columns="2" id="panelGridDesdobramento"
                                             rendered="#{obrigacaoAPagarEstornoControlador.desdobramento ne null}">
                                    <fc:outputLabelObrigatorio for="contaDesdobramento" value="Conta de Despesa: "/>
                                    <h:panelGrid columns="2" cellpadding="0" cellspacing="0">
                                        <p:autoComplete queryDelay="1000"
                                                        id="contaDesdobramento"
                                                        size="70"
                                                        title="Selecione a conta de despesa desdobrada filtrando pelo tipo da conta de despesa selecionada no empenho."
                                                        completeMethod="#{obrigacaoAPagarEstornoControlador.completarDetalhamento}"
                                                        converter="#{planoDeContasWizardControlador.converterConta}"
                                                        value="#{obrigacaoAPagarEstornoControlador.desdobramento.conta}"
                                                        var="cd"
                                                        styleClass="mrig03"
                                                        maxlength="50"
                                                        dropdown="true"
                                                        panelStyle="max-height: 250px"
                                                        itemValue="#{cd.id}"
                                                        itemLabel="#{cd}">
                                            <p:ajax event="itemSelect"
                                                    update="valorConta"
                                                    process="@this"
                                                    listener="#{obrigacaoAPagarEstornoControlador.definirSaldoDetalhamento()}"/>
                                        </p:autoComplete>
                                    </h:panelGrid>

                                    <fc:outputLabelObrigatorio value="Valor: "/>
                                    <p:outputPanel id="valorConta">
                                        <fc:inputMoeda value="#{obrigacaoAPagarEstornoControlador.desdobramento.valor}"
                                                       title="Informe o Valor da Conta de Despesa"/>
                                    </p:outputPanel>
                                </h:panelGrid>

                                <p:commandButton id="btnAddConta"
                                                 icon="ui-icon-check"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 styleClass="mtop10 padrao"
                                                 rendered="#{obrigacaoAPagarEstornoControlador.desdobramento ne null}"
                                                 actionListener="#{obrigacaoAPagarEstornoControlador.adicionarDesdobramento()}"
                                                 title="Clique para adicionar este registro."
                                                 process=":Formulario:viewGeral:panelDetalhamento @this"
                                                 update=":Formulario:viewGeral:panelDetalhamento :Formulario:panelValor"
                                                 value="Adicionar"/>

                                <p:commandButton value="Cancelar"
                                                 icon="ui-icon-cancel"
                                                 actionListener="#{obrigacaoAPagarEstornoControlador.cancelarDesdobramento()}"
                                                 rendered="#{obrigacaoAPagarEstornoControlador.desdobramento ne null}"
                                                 update=":Formulario:viewGeral:panelDetalhamento"
                                                 process="@this"
                                                 id="btnCancelarDesdobramento"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 styleClass="mlef05 mtop10 padrao"
                                                 title="Clique para cancelar esta operação."/>

                                <p:dataTable id="tabelaDesdobramento"
                                             value="#{obrigacaoAPagarEstornoControlador.selecionado.desdobramentos}"
                                             var="des"
                                             styleClass="mtop02"
                                             rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                             paginator="true"
                                             rows="10"
                                             paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>DETALHAMENTOS&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                             emptyMessage="Não foram localizados registros para serem apresentados."
                                             rowIndexVar="rowlx">
                                    <p:column headerText="Ação" style="width: 8%;text-align: center">
                                        <p:commandButton icon="ui-icon-pencil"
                                                         onstart="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         styleClass="mrig05"
                                                         disabled="#{obrigacaoAPagarEstornoControlador.isRegistroEditavel()}"
                                                         actionListener="#{obrigacaoAPagarEstornoControlador.editarDesdobramento(des)}"
                                                         title="Clique para alterar este registro."
                                                         id="btEditarContaDesdobrada"
                                                         process="@this :Formulario:viewGeral:panelDetalhamento"
                                                         update=":Formulario:viewGeral:panelDetalhamento"/>

                                        <p:commandButton id="btnExcluirConta"
                                                         update=":Formulario:viewGeral:tabelaDesdobramento"
                                                         process="@this"
                                                         actionListener="#{obrigacaoAPagarEstornoControlador.removerDesdobramento(des)}"
                                                         disabled="#{obrigacaoAPagarEstornoControlador.isRegistroEditavel()}"
                                                         title="Clique para remover este registro."
                                                         icon="ui-icon-trash"
                                                         onstart="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         onclick="if (!confirm('Tem certeza que deseja remover este registro?')) {return false; } else {aguarde.show();}"/>
                                    </p:column>
                                    <p:column headerText="Conta de Despesa" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{des.conta}"/>
                                    </p:column>
                                    <p:column headerText="Tipo de Conta de Despesa" styleClass="alinhamentoEsquerda">
                                        <h:outputText
                                            value="#{des.conta.tipoContaDespesa.codigo} - #{des.conta.tipoContaDespesa.descricao}"/>
                                    </p:column>
                                    <p:column headerText="Evento Contábil" styleClass="alinhamentoEsquerda">
                                        <co:visualizarEventoContabil evento="#{des.eventoContabil}"
                                                                     parametroEvento="#{obrigacaoAPagarEstornoControlador.getParametroEvento(des)}"/>
                                    </p:column>
                                    <p:column headerText="Valor" styleClass="alinhamentoDireita">
                                        <h:outputText value="#{des.valor}">
                                            <f:convertNumber type="currency"/>
                                        </h:outputText>
                                        <f:facet name="footer">
                                            <div align="right">
                                                <h:outputText id="totalDesd"
                                                              value="#{obrigacaoAPagarEstornoControlador.selecionado.valorTotalDetalhamentos}"
                                                              converter="moneyConverter"/>
                                            </div>
                                        </f:facet>
                                    </p:column>
                                </p:dataTable>
                            </p:outputPanel>
                        </p:tab>
                    </p:tabView>
                </p:outputPanel>

                <p:outputPanel id="panelValor">
                    <co:historico-contabil historico="#{obrigacaoAPagarEstornoControlador.selecionado.historico}"
                                           disabled="#{obrigacaoAPagarEstornoControlador.isRegistroEditavel()}"
                                           style="margin-right: 30px"/>

                    <h:panelGrid columns="2">
                        <h:outputText value="Valor: " style="margin-right: 90px"/>
                        <h:outputText value="#{obrigacaoAPagarEstornoControlador.selecionado.valor}"
                                      styleClass="negrito">
                            <f:convertNumber type="currency"/>
                        </h:outputText>
                    </h:panelGrid>
                </p:outputPanel>
            </p:panel>

            <h:panelGrid columns="5">
                <fc:botaoTargetBlank label="Imprimir Nota"
                                     actionListener="#{obrigacaoAPagarEstornoControlador.gerarNotaOrcamentaria(false)}"
                                     rendered="#{obrigacaoAPagarEstornoControlador.isOperacaoEditar()}"
                                     imprimeNoDialog="true" update="@this"
                                     styleClass="mtop10 mrig05"
                                     style="height: 30px"
                                     icon="ui-icon-print"
                                     title="Clique para imprimir a nota de estorno de obrigação a pagar."/>

                <p:commandButton value="Download Nota"
                                 rendered="#{obrigacaoAPagarEstornoControlador.isOperacaoEditar()}"
                                 title="Clique para fazer o download da nota de estorno de obrigação a pagar."
                                 ajax="false"
                                 icon="ui-icon-arrowthick-1-s"
                                 styleClass="mtop10 mrig05">
                    <p:fileDownload value="#{obrigacaoAPagarEstornoControlador.gerarNotaOrcamentaria(true)}"/>
                </p:commandButton>

                <p:commandButton icon="ui-icon-disk"
                                 onstart="aguarde.show()"
                                 oncomplete="aguarde.hide()"
                                 value="Salvar"
                                 update="@none"
                                 styleClass="mrig05 operacao prioritario mtop10"
                                 actionListener="#{obrigacaoAPagarEstornoControlador.salvar()}"
                                 title="Clique para salvar este registro."
                                 process="@this :Formulario:panelValor"/>

                <fc:rodapePretty id="rodapePretty" controlador="#{obrigacaoAPagarEstornoControlador}"
                                 ocultarSalvar="true"/>
            </h:panelGrid>
        </h:form>

        <p:dialog widgetVar="dialog"
                  modal="true"
                  closable="true"
                  resizable="false"
                  position="center"
                  style="position: fixed !important;"
                  width="900" height="500">
            <h:form id="Formulario-dialog">
                <p:panel id="panelDialog" styleClass="mtop05">
                    <fc:pesquisaGenerico id="lista"
                                         caminhoAtual="edita"
                                         caminhoControlador="#{obrigacaoAPagarEstornoControlador.caminho}"
                                         nomeDaClasse="ObrigacaoAPagar"
                                         pretty="true"
                                         dialog="true"
                                         nomeDaTela="Obrigação a Pagar"
                                         iconmSelecionar="check-icon.png"
                                         novo="#{obrigacaoAPagarEstornoControlador.novo()}"
                                         selecionar="#{obrigacaoAPagarEstornoControlador.selecionarObrigacaoPagar}"
                                         mostrarHistorico="false"
                                         mostrarBotaoNovo="false"
                                         mostrarBotaoImprimirRelatorioTabela="false"
                                         mostrarBotaoImprimirRelatorioUnicoRegistro="false"
                                         meuControlador="#{obrigacaoAPagarEstornoPesquisaGenericaControlador}"
                                         mensagemFiltrosPadraoPesquisa="Filtrando por Unidade Logada"
                                         pesquisaNoEnter="false"
                                         updateSelecionarTabela=":Formulario:panelDadosOP :Formulario:panelValor"/>
                </p:panel>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>
