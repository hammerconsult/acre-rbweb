<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:co="http://java.sun.com/jsf/composite/components/contabil"
      xmlns:p="http://primefaces.org/ui">
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">
        <h:form id="Formulario">
            <fc:cabecalhoPretty auditavel="#{true}" controlador="#{pagamentoEstornoControlador}"
                                origem="#{pagamentoEstornoControlador.caminhoPadrao}ver/#{pagamentoEstornoControlador.id}/"/>

            <p:panel
                header="Detalhes do #{pagamentoEstornoControlador.tituloEstornoPagamento} - #{pagamentoEstornoControlador.selecionado.numero}">
                <p:tab title="#{pagamentoEstornoControlador.tituloEstornoPagamento}">

                    <h:panelGrid columns="2" cellpadding="2">
                        <h:outputText value="Número: " style="margin-right: 90px"/>
                        <h:outputText id="numero"
                                      styleClass="negrito"
                                      value="#{pagamentoEstornoControlador.selecionado.numero}"/>

                        <h:outputText value="Data: "/>
                        <h:outputText value="#{pagamentoEstornoControlador.selecionado.dataEstorno}"
                                      styleClass="negrito">
                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                        </h:outputText>

                        <h:outputText value="Data de Conciliação: "/>
                        <co:data-conciliacao
                            dataConciliacao="#{pagamentoEstornoControlador.selecionado.dataConciliacao}"/>

                        <h:outputText value="Unidade Organizacional: "/>
                        <h:outputText value="#{pagamentoEstornoControlador.selecionado.unidadeOrganizacional}"
                                      styleClass="negrito"/>

                        <h:outputText value="Evento Contábil: "/>
                        <h:outputText value="#{pagamentoEstornoControlador.selecionado.eventoContabil}"
                                      styleClass="negrito"/>
                    </h:panelGrid>

                    <p:panel id="panelInformacoes" styleClass="mtop05">
                        <co:titulo-panel titulo="#{pagamentoEstornoControlador.tituloPagamento}"
                                         actionListener="#{utilBeanContabil.redirecionarParaPagamento(pagamentoEstornoControlador.selecionado.pagamento)}"
                                         navegavel="true"/>
                        <h:panelGrid columns="2" cellpadding="2">
                            <h:outputText value="Número: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.numeroPagamento}"
                                          styleClass="negrito"/>

                            <h:outputText value="Previsto Para: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.previstoPara}"
                                          styleClass="negrito">
                                <f:convertDateTime type="date"/>
                            </h:outputText>

                            <h:outputText value="Data do Pagamento: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.dataPagamento}"
                                          styleClass="negrito">
                                <f:convertDateTime type="date"/>
                            </h:outputText>

                            <h:outputText value="Data de Conciliação: "/>
                            <co:data-conciliacao
                                dataConciliacao="#{pagamentoEstornoControlador.selecionado.pagamento.dataConciliacao}"/>

                            <h:outputText value="Situação: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.status.descricao}"
                                          styleClass="negrito"/>

                            <h:outputText value="Categoria Orçamentária: "/>
                            <h:outputText
                                value="#{pagamentoEstornoControlador.selecionado.pagamento.categoriaOrcamentaria.descricao}"
                                styleClass="negrito"/>

                            <h:outputText value="Empenho: "/>
                            <h:outputText
                                value="#{pagamentoEstornoControlador.selecionado.pagamento.liquidacao.empenho}"
                                styleClass="negrito"/>

                            <h:outputText value="Liquidação: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.liquidacao}"
                                          styleClass="negrito"/>

                            <h:outputText value="Fonte de Recursos: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.liquidacao.empenho.fonteDespesaORC.descricaoFonteDeRecurso}"
                                          styleClass="negrito"/>

                            <h:outputText value="Conta de Destinação de Recurso: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.liquidacao.empenho.fonteDespesaORC.descricaoContaDeDestinacao}"
                                          styleClass="negrito"/>

                            <h:outputText value="Sub-Tipo de Despesa: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.liquidacao.empenho.subTipoDespesa.descricao}"
                                          styleClass="negrito"/>

                            <h:outputText value="Funcional Programática: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.liquidacao.empenho.fonteDespesaORC.funcionalProgramatica}"
                                          styleClass="negrito"/>

                            <h:outputText value="Órgão: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.hoOrgao}"
                                          styleClass="negrito"/>

                            <h:outputText value="Unidade: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.hoUnidade}"
                                          styleClass="negrito"/>

                            <h:outputText value="Funcional: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.funionalStr}"
                                          styleClass="negrito"/>

                            <h:outputText value="Conta de Despesa: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.conta}"
                                          styleClass="negrito"/>

                            <h:outputText value="Tipo de Despesa: "/>
                            <h:outputText
                                value="#{pagamentoEstornoControlador.selecionado.pagamento.liquidacao.empenho.tipoContaDespesa.descricao}"
                                styleClass="negrito"/>

                            <h:outputText value="Histórico: "/>
                            <h:outputText
                                value="#{pagamentoEstornoControlador.selecionado.pagamento.complementoHistorico}"
                                styleClass="negrito"/>

                            <h:outputText value="Valor: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.valor}"
                                          converter="moneyConverter"
                                          styleClass="negrito"/>

                            <h:outputText value="Valor Final: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.valorFinal}"
                                          converter="moneyConverter"
                                          styleClass="negrito"/>

                            <h:outputText value="Saldo: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.saldoPagamento}"
                                          styleClass="negrito"
                                          converter="#{pagamentoEstornoControlador.moneyConverter}"/>

                            <h:outputText value="Saldo Final: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.saldoFinal}"
                                          styleClass="negrito"
                                          converter="#{pagamentoEstornoControlador.moneyConverter}"/>
                        </h:panelGrid>

                        <p:tabView styleClass="mtop05">
                            <p:tab title="Estornos de Retenções">
                                <p:dataTable id="tabelaRetencoes"
                                             var="est"
                                             value="#{pagamentoEstornoControlador.listaReceitaExtraEstornoNoPagamentoEstorno()}"
                                             rowIndexVar="rowIx"
                                             styleClass="mtop05"
                                             paginator="true"
                                             emptyMessage="Não foram localizados registros para serem apresentados"
                                             rows="10"
                                             paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>ESTORNOS DE RETENÇÕES&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                             rowsPerPageTemplate="10,25,50,100">

                                    <p:column headerText="Número" styleClass="alinhamentoDireita">
                                        <h:outputText value="#{est.numero}"/>
                                    </p:column>
                                    <p:column headerText="Data" styleClass="alinhamentoCentralizado">
                                        <h:outputText value="#{est.dataEstorno}">
                                            <f:convertDateTime type="date"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Conta Extraorçamentária" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{est.receitaExtra.contaExtraorcamentaria}"/>
                                    </p:column>
                                    <p:column headerText="Conta Financeira" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{est.receitaExtra.subConta}"/>
                                    </p:column>
                                    <p:column headerText="Fonte de Recursos" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{est.receitaExtra.fonteDeRecursos}"/>
                                    </p:column>
                                    <p:column headerText="Pessoa" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{est.receitaExtra.pessoa}"/>
                                    </p:column>
                                    <p:column headerText="Classe" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{est.receitaExtra.classeCredor}"/>
                                    </p:column>
                                    <p:column headerText="Valor (R$)" style="text-align: right">
                                        <h:outputText value="#{est.valor}"
                                                      converter="#{pagamentoEstornoControlador.moneyConverter}"/>
                                    </p:column>
                                    <f:facet name="footer">
                                        <div align="right">
                                            <h:outputText value="Total: "/>
                                            <p:spacer width="5"/>
                                            <h:outputText
                                                value="#{pagamentoEstornoControlador.somaReceitasExtraEstornadas}"
                                                id="estPagtos"
                                                converter="#{pagamentoEstornoControlador.moneyConverter}"/>
                                        </div>
                                    </f:facet>
                                </p:dataTable>
                            </p:tab>

                            <p:tab title="Retenções">
                                <p:dataTable id="tabelaRet"
                                             var="rec"
                                             value="#{pagamentoEstornoControlador.receitaExtraEstornadaNoPagamentoEstorno}"
                                             rowIndexVar="rowIx"
                                             styleClass="mtop05"
                                             paginator="true"
                                             emptyMessage="Não foram localizados registros para serem apresentados"
                                             rows="10"
                                             paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>RETENÇÕES&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                             rowsPerPageTemplate="10,25,50,100">
                                    <p:column headerText="Número" styleClass="alinhamentoDireita">
                                        <h:outputText value="#{rec.numero}"/>
                                    </p:column>
                                    <p:column headerText="Data" styleClass="alinhamentoCentralizado">
                                        <h:outputText value="#{rec.dataReceita}">
                                            <f:convertDateTime type="date"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Conta Extraorçamentária" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{rec.contaExtraorcamentaria}"/>
                                    </p:column>
                                    <p:column headerText="Conta Financeira" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{rec.subConta}"/>
                                    </p:column>
                                    <p:column headerText="Fonte de Recursos" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{rec.fonteDeRecursos}"/>
                                    </p:column>
                                    <p:column headerText="Pessoa" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{rec.pessoa}"/>
                                    </p:column>
                                    <p:column headerText="Classe" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{rec.classeCredor}"/>
                                    </p:column>
                                    <p:column headerText="Saldo (R$)" style="text-align: right">
                                        <h:outputText value="#{rec.saldo}"
                                                      converter="#{pagamentoEstornoControlador.moneyConverter}"/>
                                    </p:column>
                                    <p:column headerText="Valor (R$)" style="text-align: right">
                                        <h:outputText value="#{rec.valor}"
                                                      converter="#{pagamentoEstornoControlador.moneyConverter}"/>
                                    </p:column>
                                    <f:facet name="footer">
                                        <div align="right">
                                            <h:outputText value="Total: "/>
                                            <p:spacer width="5"/>
                                            <h:outputText
                                                value="#{pagamentoEstornoControlador.somaReceitasExtraEstornadas}"
                                                converter="#{pagamentoEstornoControlador.moneyConverter}"/>
                                        </div>
                                    </f:facet>
                                </p:dataTable>
                            </p:tab>
                        </p:tabView>

                    </p:panel>
                    <hr class="mtop05"/>

                    <p:dataTable id="tabelaDesdobramentos"
                                 value="#{pagamentoEstornoControlador.selecionado.desdobramentos}"
                                 var="des"
                                 styleClass="mtop03"
                                 rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                 paginator="true"
                                 rows="10"
                                 paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>DETALHAMENTOS&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                 emptyMessage="Não foram localizados registros para serem apresentados."
                                 rowIndexVar="rowlx">
                        <p:column headerText="Conta de Despesa" styleClass="alinhamentoEsquerda">
                            <h:outputText value="#{des.desdobramentoPagamento.toStringDesdobramento()}"/>
                        </p:column>
                        <p:column headerText="Tipo de Conta de Despesa" styleClass="alinhamentoEsquerda">
                            <h:outputText
                                value="#{des.desdobramentoPagamento.desdobramento.conta.tipoContaDespesa.toString()}"/>
                        </p:column>
                        <p:column headerText="Saldo em Pagamento(R$)" styleClass="alinhamentoDireita">
                            <h:outputText value="#{des.desdobramentoPagamento.saldo}">
                                <f:convertNumber type="currency"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Valor (R$)" styleClass="alinhamentoDireita">
                            <h:outputText value="#{des.valor}">
                                <f:convertNumber type="currency"/>
                            </h:outputText>
                            <f:facet name="footer">
                                <div align="right">
                                    <h:outputText id="totalDoctos"
                                                  value="#{pagamentoEstornoControlador.selecionado.totalDesdobramentos}"
                                                  converter="moneyConverter"
                                                  readonly="true"/>
                                </div>
                            </f:facet>
                        </p:column>
                    </p:dataTable>
                    <hr class="mtop05"/>

                    <h:panelGrid columns="2" styleClass="mtop10">
                        <h:outputText value="Histórico: " style="margin-right: 90px"/>
                        <h:outputText value="#{pagamentoEstornoControlador.selecionado.complementoHistorico}"
                                      styleClass="negrito"/>

                        <h:outputText value="Valor do Final: "/>
                        <h:outputText value="#{pagamentoEstornoControlador.selecionado.valorFinal}"
                                      styleClass="negrito"
                                      converter="moneyConverter"/>

                        <h:outputText value="Valor das Retenções: "/>
                        <h:outputText value="#{pagamentoEstornoControlador.valorRetencoes}"
                                      styleClass="negrito"
                                      converter="moneyConverter"/>

                        <h:outputText value="Valor: "/>
                        <h:outputText value="#{pagamentoEstornoControlador.selecionado.valor}"
                                      styleClass="negrito"
                                      converter="moneyConverter"/>
                    </h:panelGrid>
                </p:tab>
            </p:panel>

            <h:panelGrid id="rodapePretty" columns="4">

                <fc:rodapeVisualizarPretty controlador="#{pagamentoEstornoControlador}"
                                           mostrarExcluir="false"/>

                <fc:botaoTargetBlank label="Imprimir Nota"
                                     actionListener="#{pagamentoEstornoControlador.gerarNotaOrcamentaria(false)}"
                                     imprimeNoDialog="true" update="@this"
                                     styleClass="mtop10 mrig05"
                                     style="height: 30px"
                                     icon="ui-icon-print"
                                     title="Clique para imprimir a Nota de Estorno do Pagamento."/>

                <p:commandButton value="Download Nota"
                                 title="Clique para fazer o download da Nota de Estorno do Pagamento."
                                 ajax="false"
                                 icon="ui-icon-arrowthick-1-s"
                                 style="height: 30px"
                                 styleClass="mtop10">
                    <p:fileDownload value="#{pagamentoEstornoControlador.gerarNotaOrcamentaria(true)}"/>
                </p:commandButton>
            </h:panelGrid>

        </h:form>
    </ui:define>
</ui:composition>
</html>
