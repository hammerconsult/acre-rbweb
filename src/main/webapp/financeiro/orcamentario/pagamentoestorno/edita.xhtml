<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:co="http://java.sun.com/jsf/composite/components/contabil"
      xmlns:p="http://primefaces.org/ui"
>
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">

        <h:form id="Formulario">
            <p:remoteCommand update=":Formulario:viewGeral:panelInformacoes :Formulario:viewGeral:evento
                         :Formulario:viewGeral:valorFinal :Formulario:viewGeral:compHis"
                             name="renderizaPagamento"
                             process="@this">

                <f:setPropertyActionListener value="#{null}"
                                             target="#{pagamentoEstornoControlador.selecionado.pagamento}"/>

                <f:setPropertyActionListener value="#{null}"
                                             target="#{pagamentoEstornoControlador.selecionado.eventoContabil}"/>

                <f:setPropertyActionListener value="#{null}"
                                             target="#{pagamentoEstornoControlador.selecionado.valorFinal}"/>

                <f:setPropertyActionListener value="#{null}"
                                             target="#{pagamentoEstornoControlador.selecionado.complementoHistorico}"/>

            </p:remoteCommand>

            <fc:cabecalhoPretty controlador="#{pagamentoEstornoControlador}"
                                origem="#{pagamentoEstornoControlador.caminhoPadrao}listar/"/>

            <p:panel header="#{pagamentoEstornoControlador.tituloEstornoPagamento}">

                <p:tabView id="viewGeral" activeIndex="#{pagamentoEstornoControlador.indiceAba}" styleClass="mtop05">
                    <p:tab title="#{pagamentoEstornoControlador.tituloEstornoPagamento}">
                        <h:panelGrid columns="2">
                            <h:outputText value="Número: "/>
                            <p:inputText title="Número do Estorno gerado automaticamente ao salvar o registro."
                                         id="numero"
                                         size="21"
                                         disabled="true"
                                         value="#{pagamentoEstornoControlador.selecionado.numero}">
                                <p:watermark value="Gerado Automaticamente" for="numero"/>
                            </p:inputText>

                            <h:outputText value="Data: "/>
                            <p:calendar title="Informe a data do Estorno" id="dataEstorno"
                                        disabled="true"
                                        locale="pt_BR"
                                        pattern="dd/MM/yyyy"
                                        navigator="true" size="21"
                                        validator="#{pagamentoEstornoControlador.validaDataPagamentoEstorno}"
                                        value="#{pagamentoEstornoControlador.selecionado.dataEstorno}"
                                        onkeyup="mascara(this, mdata)">
                                <p:ajax event="dateSelect" update="@this"/>
                            </p:calendar>

                            <h:outputText value="Data de Conciliação: "/>
                            <co:data-conciliacao
                                dataConciliacao="#{pagamentoEstornoControlador.selecionado.dataConciliacao}"/>

                            <h:outputText value="Unidade Organizacional: "/>
                            <h:outputText value="#{pagamentoEstornoControlador.selecionado.unidadeOrganizacional}"
                                          styleClass="negrito"/>

                            <h:outputText value="Evento Contábil: "/>
                            <p:outputPanel id="evento">
                                <h:outputText value="#{pagamentoEstornoControlador.selecionado.eventoContabil}"
                                              styleClass="negrito"
                                              rendered="#{pagamentoEstornoControlador.selecionado.eventoContabil ne null}"/>
                                <h:outputText value="Nenhum Evento Encontrado"
                                              styleClass="negrito"
                                              rendered="#{pagamentoEstornoControlador.selecionado.eventoContabil eq null}"/>
                            </p:outputPanel>

                            <fc:outputLabelObrigatorio value="#{pagamentoEstornoControlador.tituloPagamento}: "/>
                            <h:panelGrid columns="2">
                                <p:autoComplete id="pagamento"
                                                title="Informe o #{pagamentoEstornoControlador.tituloPagamento}"
                                                size="70"
                                                completeMethod="#{pagamentoEstornoControlador.completaPagamento}"
                                                converter="#{pagamentoEstornoControlador.converterPagamento}"
                                                value="#{pagamentoEstornoControlador.selecionado.pagamento}"
                                                disabled="#{pagamentoEstornoControlador.verificaEdicao}"
                                                style="margin-left: -4px"
                                                styleClass="mrig02"
                                                var="pag"
                                                itemValue="#{pag.id}"
                                                itemLabel="#{pag}"
                                                onkeyup="if(keyUpCampoVazio(this)){renderizaPagamento()}">
                                    <p:ajax event="itemSelect" process="@this"
                                            listener="#{pagamentoEstornoControlador.buscaDados}"
                                            update=":Formulario:viewGeral:panelInformacoes :Formulario:viewGeral:panelInformacoes2 :Formulario:viewGeral:evento :Formulario:viewGeral:compHis
                            :Formulario:viewGeral:valorFinal :Formulario:viewGeral:tabelaRetencoes :Formulario:viewGeral:valor"
                                            onstart="aguarde.show()"
                                            oncomplete="aguarde.hide()"/>
                                </p:autoComplete>

                                <p:commandButton update=":Formulario-dialog:panelDialog"
                                                 onstart="aguarde.show()"
                                                 disabled="#{pagamentoEstornoControlador.verificaEdicao}"
                                                 oncomplete="dialog.show();aguarde.hide()"
                                                 icon="ui-icon-search"/>
                            </h:panelGrid>
                        </h:panelGrid>

                        <p:outputPanel id="panelInformacoes">
                            <p:panel rendered="#{pagamentoEstornoControlador.selecionado.pagamento ne null}"
                                     styleClass="mtop05">

                                <co:titulo-panel titulo="#{pagamentoEstornoControlador.tituloPagamento}"
                                                 actionListener="#{utilBeanContabil.redirecionarParaPagamento(pagamentoEstornoControlador.selecionado.pagamento)}"
                                                 navegavel="true"/>
                                <h:panelGrid columns="2" cellpadding="2">
                                    <h:outputText value="Número: "/>
                                    <h:outputText
                                        value="#{pagamentoEstornoControlador.selecionado.pagamento.numeroPagamento}"
                                        styleClass="negrito"/>

                                    <h:outputText value="Previsto Para: "/>
                                    <h:outputText
                                        value="#{pagamentoEstornoControlador.selecionado.pagamento.previstoPara}"
                                        styleClass="negrito">
                                        <f:convertDateTime type="date"/>
                                    </h:outputText>

                                    <h:outputText value="Data do Pagamento: "/>
                                    <h:outputText
                                        value="#{pagamentoEstornoControlador.selecionado.pagamento.dataPagamento}"
                                        styleClass="negrito">
                                        <f:convertDateTime type="date"/>
                                    </h:outputText>

                                    <h:outputText value="Data de Conciliação: "/>
                                    <co:data-conciliacao
                                        dataConciliacao="#{pagamentoEstornoControlador.selecionado.pagamento.dataConciliacao}"/>

                                    <h:outputText value="Situação: "/>
                                    <h:outputText
                                        value="#{pagamentoEstornoControlador.selecionado.pagamento.status.descricao}"
                                        styleClass="negrito"/>

                                    <h:outputText value="Categoria Orçamentária: "/>
                                    <h:outputText
                                        value="#{pagamentoEstornoControlador.selecionado.pagamento.categoriaOrcamentaria.descricao}"
                                        styleClass="negrito"/>

                                    <h:outputText value="Empenho: "/>
                                    <h:outputText
                                        value="#{pagamentoEstornoControlador.selecionado.pagamento.liquidacao.empenho}"
                                        styleClass="negrito"/>
                                    <h:outputText value="Liquidação: "/>
                                    <h:outputText
                                        value="#{pagamentoEstornoControlador.selecionado.pagamento.liquidacao}"
                                        styleClass="negrito"/>

                                    <h:outputText value="Fonte de Recursos: "/>
                                    <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.liquidacao.empenho.fonteDespesaORC.descricaoFonteDeRecurso}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Conta de Destinação de Recurso: "/>
                                    <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.liquidacao.empenho.fonteDespesaORC.descricaoContaDeDestinacao}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Sub-Tipo de Despesa: "/>
                                    <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.liquidacao.empenho.subTipoDespesa.descricao}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Funcional Programática: "/>
                                    <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.liquidacao.empenho.fonteDespesaORC.funcionalProgramatica}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Órgão: "/>
                                    <h:outputText value="#{pagamentoEstornoControlador.hoOrgao}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Unidade: "/>
                                    <h:outputText value="#{pagamentoEstornoControlador.hoUnidade}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Funcional: "/>
                                    <h:outputText value="#{pagamentoEstornoControlador.funionalStr}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Conta de Despesa: "/>
                                    <h:outputText value="#{pagamentoEstornoControlador.conta}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Tipo de Despesa: "/>
                                    <h:outputText
                                        value="#{pagamentoEstornoControlador.selecionado.pagamento.liquidacao.empenho.tipoContaDespesa.descricao}"
                                        styleClass="negrito"/>

                                    <h:outputText value="Histórico: "/>
                                    <h:outputText
                                        value="#{pagamentoEstornoControlador.selecionado.pagamento.complementoHistorico}"
                                        styleClass="negrito"/>

                                    <h:outputText value="Valor: "/>
                                    <h:outputText value="#{pagamentoEstornoControlador.selecionado.pagamento.valor}"
                                                  converter="moneyConverter"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Valor Final: "/>
                                    <h:outputText
                                        value="#{pagamentoEstornoControlador.selecionado.pagamento.valorFinal}"
                                        converter="moneyConverter"
                                        styleClass="negrito"/>

                                    <h:outputText value="Saldo: "/>
                                    <h:outputText value="#{pagamentoEstornoControlador.saldoPagamento}"
                                                  styleClass="negrito"
                                                  converter="#{pagamentoEstornoControlador.moneyConverter}"/>

                                    <h:outputText value="Saldo Final: "/>
                                    <h:outputText
                                        value="#{pagamentoEstornoControlador.selecionado.pagamento.saldoFinal}"
                                        styleClass="negrito"
                                        converter="#{pagamentoEstornoControlador.moneyConverter}"/>
                                </h:panelGrid>
                            </p:panel>
                        </p:outputPanel>

                        <p:outputPanel id="panelInformacoes2">
                            <p:panel id="panelDesdobramento"
                                     styleClass="semBorda mbot02"
                                     rendered="#{pagamentoEstornoControlador.selecionado.pagamento ne null}">
                                <co:titulo-panel titulo="Detalhamento"/>
                                <h:panelGrid columns="2" rendered="#{pagamentoEstornoControlador.isMostrarDesdobramento()}">

                                    <fc:outputLabelObrigatorio value="Detalhamento: " style="#{pagamentoEstornoControlador.alinhaCampos}"/>
                                    <h:panelGroup>
                                        <p:autoComplete queryDelay="1000"
                                                        id="contaDesdobramento"
                                                        size="70"
                                                        title="Informe a Conta de Despesa Desdobrada filtrando pelo pagamento selecionado."
                                                        completeMethod="#{pagamentoEstornoControlador.buscarDesdobramento}"
                                                        converter="#{pagamentoEstornoControlador.converterDesdobramentoPagamento}"
                                                        value="#{pagamentoEstornoControlador.desdobramento.desdobramentoPagamento}"
                                                        disabled="#{pagamentoEstornoControlador.verificaEdicao}"
                                                        var="contaDetalhamento"
                                                        panelStyle="max-height: 250px; max-width: 700px"
                                                        dropdown="true"
                                                        maxResults="10"
                                                        itemValue="#{contaDetalhamento.id}"
                                                        itemLabel="#{contaDetalhamento.toStringDesdobramento()}">
                                            <p:ajax event="itemSelect"
                                                    update=":Formulario:viewGeral:panelInformacoes2"
                                                    process=":Formulario:viewGeral:panelInformacoes2"
                                                    onstart="aguarde.show();"
                                                    oncomplete="aguarde.hide();"
                                                    listener="#{pagamentoEstornoControlador.atribuirValorSaldoDetalhamento}"/>
                                        </p:autoComplete>

                                        <p:outputPanel id="dadosDesdLiquidacao">
                                            <fc:visualizarCampos
                                                objeto="#{pagamentoEstornoControlador.desdobramento.desdobramentoPagamento}"
                                                rendered="#{pagamentoEstornoControlador.desdobramento.desdobramentoPagamento ne null}"/>
                                        </p:outputPanel>
                                    </h:panelGroup>

                                    <fc:outputLabelObrigatorio value="Valor: "/>
                                    <fc:inputMoeda value="#{pagamentoEstornoControlador.desdobramento.valor}"
                                                   disable="#{pagamentoEstornoControlador.verificaEdicao}"
                                                   title="Informe o Valor da Conta de Despesa"/>
                                </h:panelGrid>

                                <p:commandButton id="btnAddDetalhamento"
                                                 icon="ui-icon-check"
                                                 disabled="#{pagamentoEstornoControlador.verificaEdicao}"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 styleClass="mtop05 padrao"
                                                 actionListener="#{pagamentoEstornoControlador.adicionarDetalhamento()}"
                                                 rendered="#{pagamentoEstornoControlador.isMostrarDesdobramento()}"
                                                 title="Clique para adicionar uma Conta de Despesa Desdobrada"
                                                 update=":Formulario:viewGeral:panelInformacoes2 :Formulario:viewGeral:valorFinal :Formulario:viewGeral:tabelaRetencoes :Formulario:viewGeral:valor"
                                                 value="Confirmar"/>


                                <p:dataTable id="tabelaDesdobramentos"
                                             value="#{pagamentoEstornoControlador.selecionado.desdobramentos}"
                                             var="des"
                                             styleClass="mtop03"
                                             rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                             paginator="true"
                                             rows="10"
                                             paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>DETALHAMENTOS&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                             emptyMessage="Não foram localizados registros para serem apresentados."
                                             rowIndexVar="rowlx">
                                    <p:column headerText="Ação" style="width: 8%;text-align: center">
                                        <p:commandButton icon="ui-icon-pencil"
                                                         onstart="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         styleClass="mrig05"
                                                         disabled="#{pagamentoEstornoControlador.verificaEdicao}"
                                                         actionListener="#{pagamentoEstornoControlador.editarDetalhamento(des)}"
                                                         title="Clique para alterar este registro."
                                                         id="btEditarContaDesdobrada"
                                                         process="@this"
                                                         update=":Formulario:viewGeral:panelInformacoes2 :Formulario:viewGeral:valorFinal :Formulario:viewGeral:tabelaRetencoes :Formulario:viewGeral:valor"/>

                                        <p:commandButton id="btnExcluirConta"
                                                         update=":Formulario:viewGeral:panelInformacoes2 :Formulario:viewGeral:valorFinal :Formulario:viewGeral:tabelaRetencoes :Formulario:viewGeral:valor"
                                                         process="@this"
                                                         actionListener="#{pagamentoEstornoControlador.removerDetalhamento(des)}"
                                                         title="Clique para remover este registro."
                                                         icon="ui-icon-trash"
                                                         onstart="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         onclick="if (!confirm('Tem certeza que deseja remover este registro?')) {return false; } else {aguarde.show();}"
                                                         disabled="#{pagamentoEstornoControlador.verificaEdicao}"/>
                                    </p:column>
                                    <p:column headerText="Conta de Despesa" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{des.desdobramentoPagamento.toStringDesdobramento()}"/>
                                    </p:column>
                                    <p:column headerText="Tipo de Conta de Despesa" styleClass="alinhamentoEsquerda">
                                        <h:outputText
                                            value="#{des.desdobramentoPagamento.desdobramento.conta.tipoContaDespesa.toString()}"/>
                                    </p:column>
                                    <p:column headerText="Saldo em Pagamento(R$)" styleClass="alinhamentoDireita">
                                        <h:outputText value="#{des.desdobramentoPagamento.saldo}">
                                            <f:convertNumber type="currency"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Valor (R$)" styleClass="alinhamentoDireita">
                                        <h:outputText value="#{des.valor}">
                                            <f:convertNumber type="currency"/>
                                        </h:outputText>
                                        <f:facet name="footer">
                                            <div align="right">
                                                <h:outputText id="totalDoctos"
                                                              value="#{pagamentoEstornoControlador.selecionado.totalDesdobramentos}"
                                                              converter="moneyConverter"
                                                              readonly="true"/>
                                            </div>
                                        </f:facet>
                                    </p:column>
                                </p:dataTable>
                                <hr class="mtop05"/>
                            </p:panel>
                        </p:outputPanel>


                        <h:panelGrid columns="2" styleClass="mtop05">
                            <h:outputText value="Histórico Contábil: "
                                          style="#{pagamentoEstornoControlador.alinhaCampos}"/>
                            <h:panelGroup>
                                <p:autoComplete id="historicoContabil"
                                                size="70"
                                                title="Informe o Histórico Contábil"
                                                completeMethod="#{pagamentoEstornoControlador.completaHistoricoContabil}"
                                                converter="#{pagamentoEstornoControlador.converterHistoricoContabil}"
                                                readonly="#{pagamentoEstornoControlador.verificaEdicao}"
                                                value="#{pagamentoEstornoControlador.selecionado.historicoContabil}"
                                                var="hc"
                                                styleClass="mrig05"
                                                itemValue="#{hc.id}"
                                                itemLabel="Número: #{hc.toStringAutoComplete()}"
                                                maxResults="10">
                                    <p:ajax event="itemSelect" update="@this compHis"
                                            listener="#{pagamentoEstornoControlador.copiarHistoricoUsuario()}"/>

                                </p:autoComplete>

                                <fc:novoParente destino="#{historicoContabilControlador.caminhoPadrao}novo/"
                                                origem="#{pagamentoEstornoControlador.caminhoPadrao}novo/"
                                                disabled="#{pagamentoEstornoControlador.verificaEdicao}"
                                                selecionado="#{pagamentoEstornoControlador.selecionado}"/>
                            </h:panelGroup>

                            <fc:outputLabelObrigatorio value="Histórico: "/>
                            <h:panelGrid columns="2">
                                <p:inputTextarea id="compHis"
                                                 title="Informe o campo histórico."
                                                 value="#{pagamentoEstornoControlador.selecionado.complementoHistorico}"
                                                 style="margin-left: -4px"
                                                 cols="70"
                                                 rows="4"
                                                 maxlength="3000"
                                                 autoResize="true" counterTemplate="{0} Caracteres Restantes."
                                                 counter="counterObjt"/>
                                <h:outputText id="counterObjt"/>
                            </h:panelGrid>

                            <fc:outputLabelObrigatorio value="Valor Final: "/>
                            <p:outputPanel id="valorFinal" disabled="#{pagamentoEstornoControlador.verificaEdicao}">
                                <p:inputText title="Informe o campo valor final."
                                             styleClass="alinhamentoEsquerda"
                                             disabled="true"
                                             converter="#{pagamentoEstornoControlador.moneyConverter}"
                                             value="#{pagamentoEstornoControlador.selecionado.valorFinal}"/>
                            </p:outputPanel>

                            <h:outputText value="Valor da Retenção: "/>
                            <p:outputPanel id="valorRet">
                                <h:outputText id="valorRetencao"
                                              readonly="true"
                                              styleClass="negrito"
                                              converter="#{pagamentoEstornoControlador.moneyConverter}"
                                              value="#{pagamentoEstornoControlador.valorRetencoes}"/>
                            </p:outputPanel>

                            <h:outputText value="Valor: "/>
                            <p:outputPanel id="valor">
                                <h:outputText id="InputValor"
                                              styleClass="negrito"
                                              converter="#{pagamentoEstornoControlador.moneyConverter}"
                                              value="#{pagamentoEstornoControlador.selecionado.valor}"/>
                            </p:outputPanel>
                        </h:panelGrid>
                    </p:tab>

                    <p:tab title="Retenções">
                        <p:dataTable id="tabelaRetencoes"
                                     var="rt"
                                     value="#{pagamentoEstornoControlador.listaReceitas()}"
                                     rowKey="#{rt.id}"
                                     rowIndexVar="rowIx"
                                     styleClass="mtop10"
                                     paginator="true"
                                     emptyMessage="Não foram localizados registros para serem apresentados"
                                     rows="10"
                                     paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>RETENÇÕES&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                     rowsPerPageTemplate="10,25,50,100">


                            <p:column style="width: 2%;" styleClass="alinhamentoCentralizado"
                                      rendered="#{pagamentoEstornoControlador.renderizaSelecionarReceita()}">
                                <f:facet name="header">
                                    <p:column style="width: 3%;" styleClass="alinhamentoCentralizado">
                                        <p:commandButton icon="#{pagamentoEstornoControlador.iconeTodos()}"
                                                         update=":Formulario:viewGeral:tabelaRetencoes :Formulario:viewGeral:valorRet :Formulario:viewGeral:valor :Formulario:viewGeral:valorFinal"
                                                         process=":Formulario:viewGeral:tabelaRetencoes :Formulario:viewGeral:valorRet :Formulario:viewGeral:valor :Formulario:viewGeral:valorFinal"
                                                         onstart="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         style="width: 20px; height: 20px"
                                                         title="#{pagamentoEstornoControlador.titleTodos()}"
                                                         actionListener="#{pagamentoEstornoControlador.selecionarTodasReceitas()}"/>
                                    </p:column>
                                </f:facet>
                                <p:commandButton icon="#{pagamentoEstornoControlador.icone(rt)}"
                                                 update=":Formulario:viewGeral:tabelaRetencoes :Formulario:viewGeral:valorRet :Formulario:viewGeral:valor :Formulario:viewGeral:valorFinal"
                                                 process=":Formulario:viewGeral:tabelaRetencoes :Formulario:viewGeral:valorRet :Formulario:viewGeral:valor :Formulario:viewGeral:valorFinal"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 style="width: 20px; height: 20px"
                                                 title="#{pagamentoEstornoControlador.title(rt)}"
                                                 actionListener="#{pagamentoEstornoControlador.selecionarReceita(rt)}"/>
                            </p:column>

                            <p:column headerText="Número" styleClass="alinhamentoDireita">
                                <h:outputText value="#{rt.numero}"/>
                            </p:column>
                            <p:column headerText="Data" styleClass="alinhamentoCentralizado">
                                <h:outputText value="#{rt.dataReceita}">
                                    <f:convertDateTime type="date"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Conta Extraorçamentária" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{rt.contaExtraorcamentaria}"/>
                            </p:column>
                            <p:column headerText="Conta Financeira" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{rt.subConta}"/>
                            </p:column>
                            <p:column headerText="Fonte de Recursos" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{rt.fonteDeRecursos}"/>
                            </p:column>
                            <p:column headerText="Pessoa" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{rt.pessoa}"/>
                            </p:column>
                            <p:column headerText="Classe" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{rt.classeCredor}"/>
                            </p:column>
                            <p:column headerText="Saldo (R$)" style="text-align: right">
                                <h:outputText value="#{rt.saldo}"
                                              converter="#{pagamentoEstornoControlador.moneyConverter}"/>
                            </p:column>
                            <p:column headerText="Valor (R$)" style="text-align: right">
                                <h:outputText value="#{rt.valor}"
                                              converter="#{pagamentoEstornoControlador.moneyConverter}"/>
                                <f:facet name="footer">
                                    <div align="right">
                                        <h:outputText value="#{pagamentoEstornoControlador.somaReceitasExtras}"
                                                      styleClass="negrito"
                                                      converter="#{pagamentoEstornoControlador.moneyConverter}"/>
                                    </div>
                                </f:facet>
                            </p:column>
                            <f:facet name="footer">
                                <div align="right">
                                    <h:outputText value="Valor Total: "
                                                  rendered="#{pagamentoEstornoControlador.renderizaSelecionarReceita()}"/>
                                    <h:outputText value="#{pagamentoEstornoControlador.somaReceitasExtrasSelecionadas}"
                                                  rendered="#{pagamentoEstornoControlador.renderizaSelecionarReceita()}"
                                                  converter="#{pagamentoEstornoControlador.moneyConverter}"/>
                                </div>
                            </f:facet>
                        </p:dataTable>
                    </p:tab>

                    <p:tab title="Estornos de Retenções">
                        <p:dataTable id="tabelaEstRetencoes"
                                     var="est"
                                     value="#{pagamentoEstornoControlador.listaReceitaExtraEstornoNoPagamentoEstorno()}"
                                     rowIndexVar="rowIx"
                                     styleClass="mtop05"
                                     paginator="true"
                                     emptyMessage="Não foram localizados registros para serem apresentados"
                                     rows="10"
                                     paginatorTemplate="{CurrentPageReport}  &lt;span class='titulo-tabela mrig10'>ESTORNOS RETENÇÕES&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     currentPageReportTemplate="({startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages})"
                                     rowsPerPageTemplate="10,25,50,100">

                            <p:column headerText="Número" styleClass="alinhamentoDireita">
                                <h:outputText value="#{est.numero}"/>
                            </p:column>
                            <p:column headerText="Data" styleClass="alinhamentoCentralizado">
                                <h:outputText value="#{est.dataEstorno}">
                                    <f:convertDateTime type="date"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Conta Extraorçamentária" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{est.receitaExtra.contaExtraorcamentaria}"/>
                            </p:column>
                            <p:column headerText="Conta Financeira" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{est.receitaExtra.subConta}"/>
                            </p:column>
                            <p:column headerText="Fonte de Recursos" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{est.receitaExtra.fonteDeRecursos}"/>
                            </p:column>
                            <p:column headerText="Pessoa" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{est.receitaExtra.pessoa}"/>
                            </p:column>
                            <p:column headerText="Classe" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{est.receitaExtra.classeCredor}"/>
                            </p:column>
                            <p:column headerText="Valor (R$)" style="text-align: right">
                                <h:outputText value="#{est.valor}"
                                              converter="#{pagamentoEstornoControlador.moneyConverter}"/>
                            </p:column>
                            <f:facet name="footer">
                                <div align="right">
                                    <h:outputText value="Total: "/>
                                    <p:spacer width="5"/>
                                    <h:outputText value="#{pagamentoEstornoControlador.somaReceitasExtraEstornadas}"
                                                  id="estPagtos"
                                                  converter="#{pagamentoEstornoControlador.moneyConverter}"/>
                                </div>
                            </f:facet>
                        </p:dataTable>
                    </p:tab>

                </p:tabView>
            </p:panel>

            <h:panelGrid columns="2" cellspacing="0" cellpadding="0">
                <fc:rodapePretty controlador="#{pagamentoEstornoControlador}"/>
            </h:panelGrid>
        </h:form>

        <p:dialog widgetVar="dialogRetencao"
                  modal="true"
                  closable="false"
                  resizable="false"
                  dynamic="true"
                  showHeader="false"
                  position="center"
                  style="position: fixed !important;">

            <h:form id="formLancamentoDeRetencao">
                <center>
                    <p:panel id="panelRetencoes" header="Lançamento de Retenção" styleClass="mtop05 mbot05">

                        <br/>
                        <h:outputText
                            value="Este #{pagamentoEstornoControlador.tituloEstornoPagamento} possui Retenções, deseja estornar agora?"/>

                        <br/><br/><br/>
                        <h:panelGrid columns="2">
                            <p:commandButton id="botaoNota"
                                             value="SIM"
                                             onstart="aguarde.show()"
                                             oncomplete="aguarde.hide()"
                                             styleClass="padrao"
                                             icon="ui-icon-check"
                                             title="Clique para selecionar retenções na aba Retenção."
                                             update=":Formulario:viewGeral"
                                             actionListener="#{pagamentoEstornoControlador.setarFocoAbaRetencao()}"/>

                            <p:commandButton value="NÃO"
                                             icon="ui-icon-cancel"
                                             onstart="aguarde.show()"
                                             oncomplete="aguarde.hide()"
                                             styleClass="padrao mlef05"
                                             title="Clique para não selecionar retenções."
                                             actionListener="#{pagamentoEstornoControlador.setarTrueLancouRentecaoESalvar()}"/>
                        </h:panelGrid>
                    </p:panel>
                </center>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dialogImprimirNota"
                  modal="true"
                  closable="false"
                  resizable="false"
                  dynamic="true"
                  showHeader="false"
                  position="center"
                  style="position: fixed !important; border-radius: 0px">
            <h:form id="formImprimirNota">
                <center>
                    <p:panel id="panelImprimir" header="Nota de #{pagamentoEstornoControlador.tituloEstornoPagamento}"
                             styleClass="mtop05 mbot05">
                        <br/>
                        <h:outputText
                            value="Deseja Imprimir a Nota de #{pagamentoEstornoControlador.tituloEstornoPagamento}?"/>

                        <br/><br/><br/>
                        <h:panelGrid columns="2">
                            <fc:botaoTargetBlank label="SIM"
                                                 actionListener="#{pagamentoEstornoControlador.gerarNotaOrcamentaria(false)}"
                                                 imprimeNoDialog="true" update="@this"
                                                 styleClass="mtop10 mrig05"
                                                 style="height: 30px"
                                                 icon="ui-icon-print"
                                                 title="Clique para imprimir a Nota de #{pagamentoEstornoControlador.tituloEstornoPagamento}"/>

                            <p:commandButton value="NÃO"
                                             icon="ui-icon-cancel"
                                             title="Clique para cancelar a impressão."
                                             onstart="aguarde.show()"
                                             oncomplete="aguarde.hide()"
                                             styleClass="mtop10 mrig05"
                                             style="height: 30px"
                                             actionListener="#{pagamentoEstornoControlador.cancelaImprimirNota}"/>

                            <p:remoteCommand name="redirecionar"
                                             actionListener="#{pagamentoEstornoControlador.cancelaImprimirNota()}"
                                             onstart="dialogImprimirNota.hide()"/>
                        </h:panelGrid>
                    </p:panel>
                </center>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="dialog"
                  modal="true"
                  closable="true"
                  resizable="false"
                  position="center"
                  style="position: fixed !important;"
                  width="900"
                  height="500">
            <h:form id="Formulario-dialog">
                <p:panel id="panelDialog">
                    <fc:pesquisaGenerico id="lista"
                                         caminhoAtual="edita"
                                         caminhoControlador="#{pagamentoEstornoControlador.caminho}"
                                         nomeDaClasse="Pagamento"
                                         nomeDaTela="#{pagamentoEstornoControlador.tituloPagamento}"
                                         pretty="true"
                                         dialog="true"
                                         iconmSelecionar="check-icon.png"
                                         novo="#{pagamentoEstornoControlador.novo()}"
                                         selecionar="#{pagamentoEstornoControlador.selecionarPagamento}"
                                         mostrarHistorico="false"
                                         pesquisaNoEnter="false"
                                         mostrarBotaoNovo="false"
                                         mostrarBotaoImprimirRelatorioTabela="false"
                                         mostrarBotaoEditarConfiguracaoRelatorio="false"
                                         mostrarBotaoImprimirRelatorioUnicoRegistro="false"
                                         meuControlador="#{pagamentoEstornoPagamentoPesquisaGenerico}"
                                         updateSelecionarTabela="@form"/>
                </p:panel>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>
