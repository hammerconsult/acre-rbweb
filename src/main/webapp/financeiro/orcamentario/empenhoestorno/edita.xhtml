<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//PT"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fc="http://java.sun.com/jsf/composite/components"
      xmlns:co="http://java.sun.com/jsf/composite/components/contabil"
      xmlns:p="http://primefaces.org/ui"
>
<ui:composition template="/corpo.xhtml">
    <ui:define name="body">

        <h:form id="Formulario">

            <p:remoteCommand name="limparCampos"
                             process="@this"
                             actionListener="#{empenhoEstornoControlador.definirNullParaEmpenho()}"
                             update=":Formulario:tabGeral:panelHistorico :Formulario:tabGeral:dadosEmp :Formulario:tabGeral:eventoContabil :Formulario:tabGeral:panelDetalhamento"/>

            <fc:cabecalhoPretty controlador="#{empenhoEstornoControlador}"
                                origem="#{empenhoEstornoControlador.caminhoPadrao}listar/"/>


            <p:panel header="#{empenhoEstornoControlador.tituloEstornoEmpenho}">

                <p:tabView id="tabGeral" activeIndex="#{empenhoEstornoControlador.indiceAba}">
                    <p:tab title="Estorno">
                        <h:panelGrid columns="2">
                            <h:outputText value="Número: "/>
                            <h:outputText id="numero"
                                          value="#{empenhoEstornoControlador.selecionado.id eq null ? 'Gerado automaticamente' : empenhoEstornoControlador.selecionado.numero}"
                                          styleClass="negrito"/>

                            <h:outputText value="Data: "/>
                            <h:outputText value="#{empenhoEstornoControlador.selecionado.dataEstorno}"
                                          styleClass="negrito">
                                <f:convertDateTime type="date"/>
                            </h:outputText>

                            <h:outputText value="Unidade Organizacional: "/>
                            <fc:codigo-descricao-hierarquia
                                tipoHierarquia="ORCAMENTARIA"
                                unidadeOrganizacional="#{empenhoEstornoControlador.selecionado.unidadeOrganizacional}"
                                dataMovimento="#{empenhoEstornoControlador.selecionado.dataEstorno}"/>

                            <h:outputText value="Evento Contábil: "/>
                            <p:outputPanel id="eventoContabil">
                                <co:visualizarEventoContabil
                                    evento="#{empenhoEstornoControlador.selecionado.eventoContabil}"
                                    parametroEvento="#{empenhoEstornoControlador.parametroEvento}"/>
                            </p:outputPanel>

                            <fc:outputLabelObrigatorio value="Empenho: "/>
                            <h:panelGrid columns="2">
                                <p:autoComplete queryDelay="1000"
                                                title="Selecione um empenho."
                                                id="empenho"
                                                value="#{empenhoEstornoControlador.selecionado.empenho}"
                                                completeMethod="#{empenhoEstornoControlador.completarEmpenho}"
                                                converter="#{empenhoControlador.converterGenerico}"
                                                disabled="#{empenhoEstornoControlador.isRegistroEditavel()}"
                                                var="emp"
                                                size="70"
                                                itemValue="#{emp.id}"
                                                itemLabel="#{emp}"
                                                panelStyle="max-height:  250px; max-width: 900px"
                                                dropdown="true"
                                                onkeyup="if(keyUpCampoVazio(this)){limparCampos()}">
                                    <p:ajax event="itemSelect"
                                            process="@this"
                                            onstart="aguarde.show()"
                                            oncomplete="aguarde.hide()"
                                            update=":Formulario:tabGeral:panelHistorico :Formulario:tabGeral:dadosEmp :Formulario:tabGeral:eventoContabil
                                                    :Formulario:tabGeral:panelDetalhamento"
                                            listener="#{empenhoEstornoControlador.definirEmpenho}"/>
                                </p:autoComplete>

                                <p:commandButton styleClass="botao_azul icone_branco"
                                                 update=":Formulario-dialog:panelDialog"
                                                 disabled="#{empenhoEstornoControlador.isRegistroEditavel()}"
                                                 onstart="aguarde.show()"
                                                 oncomplete="dialog.show();aguarde.hide()"
                                                 icon="ui-icon-search"
                                                 process="@this"
                                                 title="Clique para abrir a pesquisa avançada de empenho."/>
                            </h:panelGrid>
                        </h:panelGrid>

                        <p:outputPanel id="dadosEmp">
                            <p:panel id="dadosEmpenho"
                                     header="#{empenhoEstornoControlador.tituloEmpenho}"
                                     rendered="#{empenhoEstornoControlador.selecionado.empenho ne null}">

                                <h:panelGrid id="gridEmpenho" columns="2" cellpadding="2">
                                    <h:outputText value="Número: "/>
                                    <h:outputText value="#{empenhoEstornoControlador.selecionado.empenho.numero}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Data: "/>
                                    <h:outputText value="#{empenhoEstornoControlador.selecionado.empenho.dataEmpenho}"
                                                  styleClass="negrito">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>

                                    <h:outputText value="Unidade Organizacional: "/>
                                    <fc:codigo-descricao-hierarquia
                                        tipoHierarquia="ORCAMENTARIA"
                                        unidadeOrganizacional="#{empenhoEstornoControlador.selecionado.empenho.unidadeOrganizacional}"
                                        dataMovimento="#{empenhoEstornoControlador.selecionado.empenho.dataEmpenho}"/>

                                    <h:outputText value="Modalidade: "/>
                                    <h:outputText
                                        value="#{empenhoEstornoControlador.selecionado.empenho.modalidadeLicitacao.descricao}"
                                        styleClass="negrito"/>

                                    <h:outputText value="Contrato: "
                                                  rendered="#{empenhoEstornoControlador.selecionado.empenho.contrato ne null}"/>
                                    <h:outputText value="#{empenhoEstornoControlador.selecionado.empenho.contrato}"
                                                  rendered="#{empenhoEstornoControlador.selecionado.empenho.contrato ne null}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Evento Contábil: "/>
                                    <h:outputText
                                        value="#{empenhoEstornoControlador.selecionado.empenho.eventoContabil}"
                                        styleClass="negrito"/>

                                    <h:outputText value="Categoria Orçamentária: "/>
                                    <h:outputText
                                        value="#{empenhoEstornoControlador.selecionado.empenho.categoriaOrcamentaria.descricao}"
                                        styleClass="negrito"/>

                                    <h:outputText value="Tipo de Empenho: "/>
                                    <h:outputText
                                        value="#{empenhoEstornoControlador.selecionado.empenho.tipoEmpenho.descricao}"
                                        styleClass="negrito"/>

                                    <h:outputText value="Tipo de Resto Processados: "
                                                  rendered="#{empenhoEstornoControlador.selecionado.isEmpenhoEstornoResto()}"/>
                                    <h:outputText
                                        value="#{empenhoEstornoControlador.selecionado.empenho.tipoRestosProcessados.descricao}"
                                        rendered="#{empenhoEstornoControlador.selecionado.isEmpenhoEstornoResto()}"
                                        styleClass="negrito"/>

                                    <h:outputText value="Tipo de Resto Inscritos: "
                                                  rendered="#{empenhoEstornoControlador.selecionado.isEmpenhoEstornoResto()}"/>
                                    <h:outputText
                                        value="#{empenhoEstornoControlador.selecionado.empenho.tipoRestosInscritos.descricao}"
                                        rendered="#{empenhoEstornoControlador.selecionado.isEmpenhoEstornoResto()}"
                                        styleClass="negrito"/>

                                    <h:outputText value="Código Reduzido: "/>
                                    <h:outputText
                                        value="#{empenhoEstornoControlador.selecionado.empenho.despesaORC.codigoReduzido}"
                                        styleClass="negrito"/>

                                    <h:outputText value="Elemento de Despesa: "/>
                                    <co:consultar-despesa-orcamentaria
                                        disabled="true"
                                        value="#{empenhoEstornoControlador.selecionado.empenho.despesaORC}"/>

                                    <h:outputText value="Tipo de Despesa: "/>
                                    <h:outputText
                                        value="#{empenhoEstornoControlador.selecionado.empenho.tipoContaDespesa.descricao}"
                                        styleClass="negrito"/>

                                    <h:outputText value="Fonte de Recursos: "/>
                                    <h:outputText value="#{empenhoEstornoControlador.selecionado.empenho.fonteDespesaORC.descricaoFonteDeRecurso}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Conta de Destinação de Recurso: "/>
                                    <h:outputText value="#{empenhoEstornoControlador.selecionado.empenho.fonteDespesaORC.descricaoContaDeDestinacao}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Funcional Programática: "/>
                                    <h:outputText value="#{empenhoEstornoControlador.selecionado.empenho.fonteDespesaORC.funcionalProgramatica}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Sub-Tipo de Despesa: "/>
                                    <h:outputText value="#{empenhoEstornoControlador.selecionado.empenho.subTipoDespesa.descricao}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Pessoa: "/>
                                    <h:outputText value="#{empenhoEstornoControlador.selecionado.empenho.fornecedor}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Classe: "/>
                                    <h:outputText value="#{empenhoEstornoControlador.selecionado.empenho.classeCredor}"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Histórico: "/>
                                    <p:inputTextarea
                                        value="#{empenhoEstornoControlador.selecionado.empenho.complementoHistorico}"
                                        cols="100"
                                        rows="4"
                                        readonly="true"
                                        style="box-shadow: none"
                                        styleClass="negrito"/>

                                    <h:outputText value="Valor: "/>
                                    <h:outputText value="#{empenhoEstornoControlador.selecionado.empenho.valor}"
                                                  converter="moneyConverter"
                                                  styleClass="negrito"/>

                                    <h:outputText value="Saldo Empenho: "/>
                                    <h:outputText
                                        value="#{empenhoEstornoControlador.selecionado.empenho.saldo}"
                                        converter="moneyConverter"
                                        styleClass="negrito"/>

                                    <h:outputText value="Saldo Obrigação Antes Empenho: "/>
                                    <h:outputText
                                        value="#{empenhoEstornoControlador.selecionado.empenho.saldoObrigacaoPagarAntesEmp}"
                                        converter="moneyConverter"
                                        styleClass="negrito"/>

                                    <h:outputText value="Saldo Obrigação Depois Empenho: "/>
                                    <h:outputText
                                        value="#{empenhoEstornoControlador.selecionado.empenho.saldoObrigacaoPagarDepoisEmp}"
                                        converter="moneyConverter"
                                        styleClass="negrito"/>

                                    <h:outputText value="Saldo sem Obrigação a Pagar: "/>
                                    <h:outputText
                                        value="#{empenhoEstornoControlador.selecionado.empenho.saldoDisponivelEmpenhoComObrigacao}"
                                        converter="moneyConverter"
                                        styleClass="negrito"/>
                                </h:panelGrid>

                                <p:dataTable id="tabelaContas"
                                             rendered="#{!empty empenhoEstornoControlador.desdobramentosEmpenho}"
                                             value="#{empenhoEstornoControlador.desdobramentosEmpenho}"
                                             var="desdEmp"
                                             styleClass="mtop05"
                                             rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                             paginator="true"
                                             rows="10"
                                             paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10' maiuscula>DETALHAMENTOS DE EMPENHO&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                             emptyMessage="Não foram localizados registros para serem apresentados."
                                             rowIndexVar="rowlx">
                                    <p:column headerText="Conta de Despesa" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{desdEmp.conta}"/>
                                    </p:column>
                                    <p:column headerText="Tipo de Conta de Despesa" styleClass="alinhamentoEsquerda">
                                        <h:outputText value="#{desdEmp.conta.tipoContaDespesa.toString()}"/>
                                    </p:column>
                                    <p:column headerText="Valor (R$)" style="text-align: right">
                                        <h:outputText value="#{desdEmp.valor}" converter="moneyConverter"/>
                                    </p:column>
                                    <p:column headerText="Saldo (R$)" style="text-align: right">
                                        <h:outputText value="#{desdEmp.saldo}" converter="moneyConverter"/>
                                    </p:column>
                                </p:dataTable>
                            </p:panel>
                        </p:outputPanel>

                        <p:outputPanel id="panelDetalhamento">
                            <p:panel rendered="#{empenhoEstornoControlador.selecionado.empenho ne null and !empty empenhoEstornoControlador.selecionado.empenho.desdobramentos}"
                                     styleClass="semBorda">

                                <p:tabView id="viewGeral" styleClass="mtop10">
                                    <p:tab title="Detalhamento Estorno de Empenho">

                                        <p:commandButton value="Novo"
                                                         icon="ui-icon-circle-plus"
                                                         actionListener="#{empenhoEstornoControlador.novoDesdobramento()}"
                                                         rendered="#{empenhoEstornoControlador.desdobramento eq null}"
                                                         update=":Formulario:tabGeral:panelDetalhamento"
                                                         process="@this"
                                                         id="btnNovoDesdobramento"
                                                         onstart="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         styleClass="mtop10 padrao"
                                                         disabled="#{empenhoEstornoControlador.isRegistroEditavel()}"
                                                         title="Clique para adicionar um novo desdobramento."/>

                                        <h:panelGrid columns="2" id="panelGridDesdobramento"
                                                     rendered="#{empenhoEstornoControlador.desdobramento ne null}">

                                            <fc:outputLabelObrigatorio for="contaDesdobramento"
                                                                       value="Conta de Despesa: "/>
                                            <h:panelGrid columns="2" cellpadding="0" cellspacing="0">
                                                <p:autoComplete queryDelay="1000"
                                                                id="desdobramentoOp"
                                                                size="70"
                                                                title="Informe a conta de despesa desdobrada filtrando por desdobramento da obrigações a pagar."
                                                                completeMethod="#{empenhoEstornoControlador.completarDetalhamento}"
                                                                converter="#{liquidacaoEstornoControlador.converterDesdobramentoObrigacao}"
                                                                value="#{empenhoEstornoControlador.desdobramentoObrigacaoPagar}"
                                                                var="desdObrigacao"
                                                                rendered="#{empenhoEstornoControlador.isEstornoEmpenhoComObrigacaoPagar()}"
                                                                panelStyle="max-height: 250px; max-width: 900px"
                                                                dropdown="true"
                                                                maxlength="50"
                                                                itemValue="#{desdObrigacao.id}"
                                                                itemLabel="#{desdObrigacao.toStringAutoComplete()}">
                                                    <p:ajax
                                                        update=":Formulario:tabGeral:panelDetalhamento dadosObrigacaoPagar"
                                                        process="@this"
                                                        listener="#{empenhoEstornoControlador.definirSaldoDetalhamento()}"
                                                        event="itemSelect"/>
                                                </p:autoComplete>

                                                <p:autoComplete queryDelay="1000"
                                                                id="desdobramentoEmp"
                                                                size="70"
                                                                title="Informe a conta de despesa desdobrada filtrando por desdobramento do empenho."
                                                                completeMethod="#{empenhoEstornoControlador.completarDetalhamentosEmpenho}"
                                                                converter="#{empenhoEstornoControlador.converterDesdobramentoEmpenho}"
                                                                value="#{empenhoEstornoControlador.desdobramentoEmpenho}"
                                                                var="desdEmp"
                                                                rendered="#{!empenhoEstornoControlador.isEstornoEmpenhoComObrigacaoPagar()}"
                                                                panelStyle="max-height: 250px; max-width: 900px"
                                                                dropdown="true"
                                                                maxlength="50"
                                                                itemValue="#{desdEmp.id}"
                                                                itemLabel="#{desdEmp.toStringAutoComplete()}">
                                                    <p:ajax
                                                        update=":Formulario:tabGeral:panelDetalhamento dadosObrigacaoPagar"
                                                        process="@this"
                                                        listener="#{empenhoEstornoControlador.definirSaldoDetalhamento()}"
                                                        event="itemSelect"/>
                                                </p:autoComplete>

                                                <p:outputPanel id="dadosObrigacaoPagar"
                                                               rendered="#{empenhoEstornoControlador.isEstornoEmpenhoComObrigacaoPagar()}">
                                                    <fc:visualizarCampos
                                                        styleClass="mlef05"
                                                        objeto="#{empenhoEstornoControlador.desdobramentoObrigacaoPagar.obrigacaoAPagar}"/>
                                                </p:outputPanel>
                                            </h:panelGrid>

                                            <fc:outputLabelObrigatorio value="Valor: "/>
                                            <p:outputPanel id="valorConta">
                                                <fc:inputMoeda value="#{empenhoEstornoControlador.desdobramento.valor}"
                                                               title="Informe o Valor da Conta de Despesa"/>
                                            </p:outputPanel>
                                        </h:panelGrid>

                                        <p:commandButton id="btnAddConta"
                                                         icon="ui-icon-check"
                                                         onstart="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         styleClass="mtop10 padrao"
                                                         rendered="#{empenhoEstornoControlador.desdobramento ne null}"
                                                         actionListener="#{empenhoEstornoControlador.adicionarDetalhamento()}"
                                                         title="Clique para adicionar este registro."
                                                         update=":Formulario:tabGeral:panelDetalhamento :Formulario:tabGeral:panelHistorico"
                                                         process=":Formulario:tabGeral:panelDetalhamento @this"
                                                         value="Adicionar"/>

                                        <p:commandButton value="Cancelar"
                                                         icon="ui-icon-cancel"
                                                         actionListener="#{empenhoEstornoControlador.cancelarDesdobramento()}"
                                                         rendered="#{empenhoEstornoControlador.desdobramento ne null}"
                                                         update=":Formulario:tabGeral:panelDetalhamento"
                                                         process="@this"
                                                         id="btnCancelarDesdobramento"
                                                         onstart="aguarde.show()"
                                                         oncomplete="aguarde.hide()"
                                                         styleClass="mlef05 mtop10 padrao"
                                                         title="Clique para cancelar esta operação."/>

                                        <p:dataTable id="tabelaDesdobramento"
                                                     value="#{empenhoEstornoControlador.selecionado.desdobramentos}"
                                                     var="desd"
                                                     styleClass="mtop02"
                                                     rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                                     paginator="true"
                                                     rows="10"
                                                     paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>DETALHAMENTOS&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                     currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                                     emptyMessage="Não foram localizados registros para serem apresentados."
                                                     rowIndexVar="rowlx">
                                            <p:column headerText="Ação" style="width: 8%;text-align: center">
                                                <p:commandButton icon="ui-icon-pencil"
                                                                 onstart="aguarde.show()"
                                                                 oncomplete="aguarde.hide()"
                                                                 styleClass="mrig05"
                                                                 disabled="#{empenhoEstornoControlador.isRegistroEditavel()}"
                                                                 actionListener="#{empenhoEstornoControlador.editarDesdobramento(desd)}"
                                                                 title="Clique para alterar este registro."
                                                                 id="btEditarContaDesdobrada"
                                                                 process="@this :Formulario:tabGeral:panelDetalhamento"
                                                                 update=":Formulario:tabGeral:panelDetalhamento"/>

                                                <p:commandButton id="btnExcluirConta"
                                                                 update="tabelaDesdobramento"
                                                                 process="@this"
                                                                 actionListener="#{empenhoEstornoControlador.removerDesdobramento(desd)}"
                                                                 disabled="#{empenhoEstornoControlador.isRegistroEditavel()}"
                                                                 title="Clique para remover este registro."
                                                                 icon="ui-icon-trash"
                                                                 onstart="aguarde.show()"
                                                                 oncomplete="aguarde.hide()"
                                                                 onclick="if (!confirm('Tem certeza que deseja remover este registro?')) {return false; } else {aguarde.show();}"/>
                                            </p:column>
                                            <p:column headerText="Conta de Despesa" styleClass="alinhamentoEsquerda">
                                                <h:outputText value="#{desd.conta}"/>
                                            </p:column>
                                            <p:column headerText="Tipo de Conta de Despesa"
                                                      styleClass="alinhamentoEsquerda">
                                                <h:outputText
                                                    value="#{desd.conta.tipoContaDespesa.toString()}"/>
                                            </p:column>
                                            <p:column headerText="Valor" styleClass="alinhamentoDireita">
                                                <h:outputText value="#{desd.valor}">
                                                    <f:convertNumber type="currency"/>
                                                </h:outputText>
                                                <f:facet name="footer">
                                                    <div align="right">
                                                        <h:outputText id="totalDesd"
                                                                      value="#{empenhoEstornoControlador.selecionado.valorTotalDetalhamento}"
                                                                      converter="moneyConverter"/>
                                                    </div>
                                                </f:facet>
                                            </p:column>
                                        </p:dataTable>
                                    </p:tab>
                                </p:tabView>
                            </p:panel>
                        </p:outputPanel>

                        <p:outputPanel id="panelHistorico">
                            <co:historico-contabil
                                historico="#{empenhoEstornoControlador.selecionado.complementoHistorico}"
                                style="margin-right: 30px"/>

                            <h:panelGrid columns="3">
                                <fc:outputLabelObrigatorio value="Valor: "/>
                                <fc:inputMoeda id="valorEstorno"
                                               style="margin-left: 63px"
                                               readonly="#{!empty empenhoEstornoControlador.selecionado.desdobramentos}"
                                               disable="#{empenhoEstornoControlador.isRegistroEditavel()}"
                                               value="#{empenhoEstornoControlador.selecionado.valor}"/>

                                <p:outputPanel
                                    rendered="#{empenhoEstornoControlador.isEstornoEmpenhoComObrigacaoPagar()}">
                                    <div class="alert alert-info">
                                        Quando o estorno de empenho possui obrigação a pagar. O campo valor do estorno refere-se aos valores dos detalhamentos
                                        <Strong> somado </Strong> com o valor do estorno do empenho, respectivamente.
                                    </div>
                                </p:outputPanel>
                            </h:panelGrid>
                        </p:outputPanel>
                    </p:tab>

                    <p:tab title="Solicitações">
                        <p:dataTable id="tableSolicPend"
                                     value="#{empenhoEstornoControlador.solicitacoesEmpenhoEstorno}"
                                     var="sp"
                                     rowStyleClass="#{empty rowlx or rowlx mod 2 ne 0 ? 'linha-selecionada' : 'trintaAltura'}"
                                     paginator="true"
                                     styleClass="mtop05"
                                     rows="10"
                                     paginatorTemplate="{CurrentPageReport} &lt;span class='titulo-tabela mrig10'>SOLICITAÇÕES PENDENTES&lt;/span> {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}, Página: {currentPage}/{totalPages}"
                                     emptyMessage="Não foram localizados registros para serem apresentados."
                                     rowIndexVar="rowlx">
                            <p:column headerText="Estornar" style="text-align: center; width: 5%">
                                <p:commandButton id="btnEstSol"
                                                 disabled="#{empenhoEstornoControlador.isRegistroEditavel()}"
                                                 actionListener="#{empenhoEstornoControlador.estornarSolicitacao(sp)}"
                                                 update=":Formulario"
                                                 process="@this"
                                                 onstart="aguarde.show()"
                                                 oncomplete="aguarde.hide()"
                                                 title="Clique para estornar a solicitação."
                                                 icon="ui-icon-blue-document-copy"/>
                            </p:column>
                            <p:column headerText="Data" styleClass="alinhamentoCentralizado">
                                <h:outputText value="#{sp.dataSolicitacao}">
                                    <f:convertDateTime locale="pt_BR" pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Empenho" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{sp.empenho.numero}"/>
                            </p:column>
                            <p:column headerText="Histórico" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{sp.historico}"/>
                            </p:column>
                            <p:column headerText="Fornecedor" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{sp.empenho.fornecedor.nome}"/>
                            </p:column>
                            <p:column headerText="Classe" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{sp.empenho.classeCredor}"/>
                            </p:column>
                            <p:column headerText="Despesa" styleClass="alinhamentoEsquerda">
                                <h:outputText value="#{sp.empenho.despesaORC}"/>
                            </p:column>
                            <p:column headerText="Unidade Organizacional" styleClass="alinhamentoEsquerda">
                                <fc:codigo-descricao-hierarquia tipoHierarquia="ORCAMENTARIA"
                                                                dataMovimento="#{sp.dataSolicitacao}"
                                                                unidadeOrganizacional="#{sp.empenho.unidadeOrganizacional}"
                                                                styleClass="default"/>
                            </p:column>
                            <p:column headerText="Valor (R$)" styleClass="alinhamentoDireita">
                                <h:outputText value="#{sp.valor}">
                                    <f:convertNumber pattern="###,##0.00"/>
                                </h:outputText>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                </p:tabView>


            </p:panel>

            <p:commandButton icon="ui-icon-disk"
                             onstart="aguarde.show()"
                             oncomplete="aguarde.hide()"
                             value="Salvar"
                             update="@none"
                             styleClass="mrig05 operacao prioritario mtop10"
                             actionListener="#{empenhoEstornoControlador.salvar()}"
                             title="Clique para salvar este registro."
                             process="@this :Formulario:tabGeral:panelHistorico"/>

            <fc:rodapePretty controlador="#{empenhoEstornoControlador}" ocultarSalvar="true"/>

            <fc:botaoTargetBlank label="Imprimir Nota"
                                 imprimeNoDialog="true" update="@this"
                                 styleClass="mtop10 mrig05"
                                 style="height: 30px"
                                 icon="ui-icon-print"
                                 rendered="#{empenhoEstornoControlador.isOperacaoEditar()}"
                                 actionListener="#{empenhoEstornoControlador.gerarNotaOrcamentaria(false)}"
                                 title="Clique para imprimir a Nota de Estorno de Empenho."/>

            <p:commandButton value="Download Nota"
                             title="Clique para fazer o download da Nota de Estorno de Empenho."
                             ajax="false"
                             icon="ui-icon-arrowthick-1-s"
                             styleClass="mtop10 mrig05"
                             rendered="#{empenhoEstornoControlador.isOperacaoEditar()}">
                <p:fileDownload value="#{empenhoEstornoControlador.gerarNotaOrcamentaria(true)}"/>
            </p:commandButton>
        </h:form>


        <p:dialog widgetVar="dialog"
                  modal="true"
                  closable="true"
                  resizable="false"
                  position="center"
                  style="position: fixed !important;"
                  width="900" height="500">
            <h:form id="Formulario-dialog">
                <p:panel id="panelDialog" styleClass="mtop05">
                    <fc:pesquisaGenerico id="lista"
                                         caminhoAtual="edita"
                                         caminhoControlador="#{empenhoEstornoControlador.caminho}"
                                         nomeDaClasse="Empenho"
                                         dialog="true"
                                         pretty="true"
                                         nomeDaTela="#{empenhoEstornoControlador.tituloEmpenho}"
                                         iconmSelecionar="check-icon.png"
                                         novo="#{empenhoEstornoControlador.novo()}"
                                         selecionar="#{empenhoEstornoControlador.selecionarEmpenho}"
                                         mostrarHistorico="false"
                                         mostrarBotaoImprimirRelatorioTabela="false"
                                         mostrarBotaoConsultasPersonalizadas="false"
                                         mostrarBotaoEditarConfiguracaoRelatorio="false"
                                         mostrarBotaoNovo="false"
                                         mostrarBotaoImprimirRelatorioUnicoRegistro="false"
                                         updateSelecionarTabela=":Formulario:tabGeral:valor :Formulario:tabGeral:dadosEmp :Formulario:tabGeral:eventoContabil"
                                         meuControlador="#{estornoEmpenhoPesquisaGenerica}"
                                         mensagemFiltrosPadraoPesquisa="Filtrando por Unidade Logada"
                                         pesquisaNoEnter="false"/>
                </p:panel>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>
