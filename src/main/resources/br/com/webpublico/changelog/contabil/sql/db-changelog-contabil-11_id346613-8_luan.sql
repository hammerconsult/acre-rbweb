DECLARE
texto CLOB := '{"consulta":"select ac.TIPOALTERACAOCONTRATUAL as TIPO,\r\n       c.numeroContrato || ''/'' || extract(year from c.datalancamento) || '' - '' ||  c.numeroTermo || ''/'' || exc.ano as contrato,\r\n       ac.SITUACAO,\r\n       ac.NUMERO,\r\n       ac.NUMEROTERMO || ''/'' || exac.ANO as NUMEROANOTERMO,\r\n       ac.DATALANCAMENTO,\r\n       ac.DATAAPROVACAO,\r\n       ac.DATADEFERIMENTO,\r\n       ac.TIPOTERMO,\r\n       ac.JUSTIFICATIVA\r\nfrom contrato c\r\n         inner join exercicio exc on exc.id = c.exerciciocontrato_id\r\n         inner join alteracaocontratual ac on ac.contrato_id = c.id\r\n         inner join exercicio exac on exac.id = ac.exercicio_id\r\n    $WHERE","count":"select count(ac.id)\r\nfrom contrato c\r\n         inner join exercicio exc on exc.id = c.exerciciocontrato_id\r\n         inner join alteracaocontratual ac on ac.contrato_id = c.id\r\n         inner join exercicio exac on exac.id = ac.exercicio_id\r\n    $WHERE","totalRegistros":4648,"fields":[{"posicao":1,"descricao":"Tipo","columnName":"TIPO","columnValue":"TIPO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":2,"descricao":"Contrato","columnName":"CONTRATO","columnValue":"CONTRATO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":3,"descricao":"Situação","columnName":"SITUACAO","columnValue":"SITUACAO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"ENUM","tipoEnum":"br.com.webpublico.enums.SituacaoContrato","valorPadrao":[null,"EM_ELABORACAO","APROVADO","RESCINDIDO","DEFERIDO"],"escondido":false},{"posicao":4,"descricao":"Número","columnName":"NUMERO","columnValue":"NUMERO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":5,"descricao":"Número do Termo","columnName":"NUMEROANOTERMO","columnValue":"NUMEROANOTERMO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":6,"descricao":"Data de Lançamento","columnName":"DATALANCAMENTO","columnValue":"DATALANCAMENTO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"DATE","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":7,"descricao":"Data da Aprovação","columnName":"DATAAPROVACAO","columnValue":"DATAAPROVACAO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"DATE","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":8,"descricao":"Data do Deferimento","columnName":"DATADEFERIMENTO","columnValue":"DATADEFERIMENTO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"DATE","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":9,"descricao":"Tipo de Termo","columnName":"TIPOTERMO","columnValue":"TIPOTERMO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"ENUM","tipoEnum":"br.com.webpublico.enums.TipoTermoAlteracaoContratual","valorPadrao":[null,"PRAZO","VALOR","PRAZO_VALOR","ALTERACAO_CADASTRAL","NAO_APLICAVEL"],"escondido":false},{"posicao":10,"descricao":"Justificativa","columnName":"JUSTIFICATIVA","columnValue":"JUSTIFICATIVA","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false}],"pesquisaveis":[],"tabs":[{"titulo":"Movimentos","subTitulo":"","consulta":"select OPERACAO,\r\n       FINALIDADE,\r\n       case when valorItem <> 0 then detalhesMovimento || ''R$'' || to_char(valorItem, ''FM999G999G999G999G990D90'') else detalhesMovimento end as DETALHES\r\nfrom (select ac.id as idAlteracao,\r\n             mov.OPERACAO,\r\n             mov.FINALIDADE,\r\n             case mov.OPERACAO\r\n                 when ''REDIMENSIONAMENTO_OBJETO''\r\n                     then desp.CODIGO || '' - '' || cdesp.CODIGO || '' - '' || cDest.CODIGO || '' - '' || cDest.DESCRICAO || '' - ''\r\n                 when ''TRANSFERENCIA_DOTACAO''\r\n                     then desp.CODIGO || '' - '' || cdesp.CODIGO || '' - '' || cDest.CODIGO || '' - '' || cDest.DESCRICAO\r\n                 when ''DILACAO_PRAZO''\r\n                     then ''Prazo de Vigência: '' || to_char(mov.INICIOVIGENCIA) || '' até '' || to_char(mov.TERMINOVIGENCIA) ||\r\n                          '' - Prazo de Execução: '' || to_char(mov.INICIOEXECUCAO) || '' até '' || to_char(mov.TERMINOEXECUCAO)\r\n                 when ''REDUCAO_PRAZO''\r\n                     then ''Prazo de Vigência: '' || to_char(mov.INICIOVIGENCIA) || '' até '' || to_char(mov.TERMINOVIGENCIA) ||\r\n                          '' - Prazo de Execução: '' || to_char(mov.INICIOEXECUCAO) || '' até '' || to_char(mov.TERMINOEXECUCAO)\r\n                 when ''TRANSFERENCIA_FORNECEDOR''\r\n                     then ''Fornecedor: '' || coalesce(pf.nome, pj.razaosocial) || '' - Responsável pelo Fornecedor: '' || pfRespForn.nome\r\n                 when ''TRANSFERENCIA_FORNECEDOR''\r\n                     then ''Unidade Administrativa: '' || vwAdm.codigo || '' - '' || vwAdm.descricao\r\n                 else '''' end as detalhesMovimento,\r\n             coalesce(sum(item.valortotal), 0) as valorItem\r\n      from alteracaocontratual ac\r\n               inner join movimentoalteracaocont mov on mov.alteracaocontratual_id = ac.id\r\n               left join movimentoalteracaocontitem item on item.movimentoalteracaocont_id = mov.id\r\n               left join fontedespesaorc fonte on fonte.id = mov.fontedespesaorc_id\r\n               left join provisaoppafonte provFonte on provFonte.id = fonte.provisaoppafonte_id\r\n               left join conta cDest on cDest.id = provFonte.destinacaoderecursos_id\r\n               left join despesaorc desp on desp.id = fonte.despesaorc_id\r\n               left join provisaoppadespesa provDesp on provDesp.id = desp.provisaoppadespesa_id\r\n               left join conta cDesp on cDesp.id = provDesp.contadedespesa_id\r\n               left join pessoafisica pf on pf.id = mov.fornecedor_id\r\n               left join pessoajuridica pj on pj.id = mov.fornecedor_id\r\n               left join pessoafisica pfRespForn on pf.id = mov.responsavelfornecedor_id\r\n               left join vwhierarquiaadministrativa vwAdm on vwAdm.subordinada_id = mov.unidadeorganizacional_id\r\n          and trunc(ac.datalancamento) between vwadm.iniciovigencia and coalesce(vwadm.fimvigencia, trunc(ac.datalancamento))\r\n          $WHERE\r\n      group by ac.id,\r\n               mov.OPERACAO,\r\n               mov.FINALIDADE,\r\n               case mov.OPERACAO\r\n                   when ''REDIMENSIONAMENTO_OBJETO''\r\n                       then desp.CODIGO || '' - '' || cdesp.CODIGO || '' - '' || cDest.CODIGO || '' - '' || cDest.DESCRICAO || '' - ''\r\n                   when ''TRANSFERENCIA_DOTACAO''\r\n                       then desp.CODIGO || '' - '' || cdesp.CODIGO || '' - '' || cDest.CODIGO || '' - '' || cDest.DESCRICAO\r\n                   when ''DILACAO_PRAZO''\r\n                       then ''Prazo de Vigência: '' || to_char(mov.INICIOVIGENCIA) || '' até '' || to_char(mov.TERMINOVIGENCIA) ||\r\n                            '' - Prazo de Execução: '' || to_char(mov.INICIOEXECUCAO) || '' até '' || to_char(mov.TERMINOEXECUCAO)\r\n                   when ''REDUCAO_PRAZO''\r\n                       then ''Prazo de Vigência: '' || to_char(mov.INICIOVIGENCIA) || '' até '' || to_char(mov.TERMINOVIGENCIA) ||\r\n                            '' - Prazo de Execução: '' || to_char(mov.INICIOEXECUCAO) || '' até '' || to_char(mov.TERMINOEXECUCAO)\r\n                   when ''TRANSFERENCIA_FORNECEDOR''\r\n                       then ''Fornecedor: '' || coalesce(pf.nome, pj.razaosocial) || '' - Responsável pelo Fornecedor: '' || pfRespForn.nome\r\n                   when ''TRANSFERENCIA_FORNECEDOR''\r\n                       then ''Unidade Administrativa: '' || vwAdm.codigo || '' - '' || vwAdm.descricao\r\n                   else '''' end)","count":"select count(mov.id)\r\n      from alteracaocontratual ac\r\n               inner join movimentoalteracaocont mov on mov.alteracaocontratual_id = ac.id\r\n               left join movimentoalteracaocontitem item on item.movimentoalteracaocont_id = mov.id\r\n               left join fontedespesaorc fonte on fonte.id = mov.fontedespesaorc_id\r\n               left join provisaoppafonte provFonte on provFonte.id = fonte.provisaoppafonte_id\r\n               left join conta cDest on cDest.id = provFonte.destinacaoderecursos_id\r\n               left join despesaorc desp on desp.id = fonte.despesaorc_id\r\n               left join provisaoppadespesa provDesp on provDesp.id = desp.provisaoppadespesa_id\r\n               left join conta cDesp on cDesp.id = provDesp.contadedespesa_id\r\n               left join pessoafisica pf on pf.id = mov.fornecedor_id\r\n               left join pessoajuridica pj on pj.id = mov.fornecedor_id\r\n               left join pessoafisica pfRespForn on pf.id = mov.responsavelfornecedor_id\r\n               left join vwhierarquiaadministrativa vwAdm on vwAdm.subordinada_id = mov.unidadeorganizacional_id\r\n          and trunc(ac.datalancamento) between vwadm.iniciovigencia and coalesce(vwadm.fimvigencia, trunc(ac.datalancamento))\r\n          $WHERE","totalRegistros":null,"ordem":1,"pesquisaveis":[],"fields":[{"posicao":1,"descricao":"Operação","columnName":"OPERACAO","columnValue":"OPERACAO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"ENUM","tipoEnum":"br.com.webpublico.enums.OperacaoMovimentoAlteracaoContratual","valorPadrao":[null,"REDIMENSIONAMENTO_OBJETO","REAJUSTE_POS_EXECUCAO","REAJUSTE_PRE_EXECUCAO","REEQUILIBRIO_POS_EXECUCAO","REEQUILIBRIO_PRE_EXECUCAO","DILACAO_PRAZO","REDUCAO_PRAZO","TRANSFERENCIA_FORNECEDOR","TRANSFERENCIA_DOTACAO","TRANSFERENCIA_UNIDADE","OUTRO"],"escondido":false},{"posicao":2,"descricao":"Finalidade","columnName":"FINALIDADE","columnValue":"FINALIDADE","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"ENUM","tipoEnum":"br.com.webpublico.enums.FinalidadeMovimentoAlteracaoContratual","valorPadrao":[null,"SUPRESSAO","ACRESCIMO","NAO_SE_APLICA"],"escondido":false},{"posicao":3,"descricao":"Detalhes","columnName":"DETALHES","columnValue":"DETALHES","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false}]},{"titulo":"Itens","subTitulo":"","consulta":"select mov.OPERACAO,\r\n       mov.FINALIDADE,\r\n       obj.codigo || '' - '' || obj.descricao as objetoCompra,\r\n       um.sigla,\r\n       movItem.quantidade,\r\n       movItem.VALORUNITARIO,\r\n       movItem.valortotal\r\nfrom alteracaocontratual ac\r\n         inner join movimentoalteracaocont mov on mov.alteracaocontratual_id = ac.id\r\n         inner join movimentoalteracaocontitem movItem on movItem.movimentoalteracaocont_id = mov.id\r\n         inner join itemcontrato ic on ic.id = movItem.itemcontrato_id\r\n         left join itemcontratoitempropfornec icpf on ic.id = icpf.itemcontrato_id\r\n         left join itemcontratoitemirp iirp on iirp.itemcontrato_id = ic.id\r\n         left join itemcontratoadesaoataint iata on iata.itemcontrato_id = ic.id\r\n         left join itempropfornec ipf on coalesce(icpf.itempropostafornecedor_id, iirp.itempropostafornecedor_id, iata.itempropostafornecedor_id) = ipf.id\r\n         left join itemcontratoitempropdisp icpd on ic.id = icpd.itemcontrato_id\r\n         left join itempropostafornedisp ipfd on icpd.itempropfornecdispensa_id = ipfd.id\r\n         left join itemprocessodecompra ipc on coalesce(ipf.itemprocessodecompra_id, ipfd.itemprocessodecompra_id) = ipc.id\r\n         left join itemsolicitacao its on ipc.itemsolicitacaomaterial_id = its.id\r\n         left join itemcontratoitemsolext icse on ic.id = icse.itemcontrato_id\r\n         left join itemsolicitacaoexterno ise on icse.itemsolicitacaoexterno_id = ise.id\r\n         left join itemcontratovigente icv on ic.id = icv.itemcontrato_id\r\n         left join itemcotacao itcot on itcot.id = icv.itemcotacao_id\r\n         inner join objetocompra obj on obj.id = coalesce(ic.objetocompracontrato_id, its.objetocompra_id, ise.objetocompra_id, itcot.objetocompra_id)\r\n         inner join unidademedida um on um.id = obj.unidademedida_id\r\n$WHERE\r\norder by mov.operacao, mov.finalidade, to_number(obj.codigo)","count":"select count(movItem .id)\r\nfrom alteracaocontratual ac\r\n         inner join movimentoalteracaocont mov on mov.alteracaocontratual_id = ac.id\r\n         inner join movimentoalteracaocontitem movItem on movItem.movimentoalteracaocont_id = mov.id\r\n         inner join itemcontrato ic on ic.id = movItem.itemcontrato_id\r\n         left join itemcontratoitempropfornec icpf on ic.id = icpf.itemcontrato_id\r\n         left join itemcontratoitemirp iirp on iirp.itemcontrato_id = ic.id\r\n         left join itemcontratoadesaoataint iata on iata.itemcontrato_id = ic.id\r\n         left join itempropfornec ipf on coalesce(icpf.itempropostafornecedor_id, iirp.itempropostafornecedor_id, iata.itempropostafornecedor_id) = ipf.id\r\n         left join itemcontratoitempropdisp icpd on ic.id = icpd.itemcontrato_id\r\n         left join itempropostafornedisp ipfd on icpd.itempropfornecdispensa_id = ipfd.id\r\n         left join itemprocessodecompra ipc on coalesce(ipf.itemprocessodecompra_id, ipfd.itemprocessodecompra_id) = ipc.id\r\n         left join itemsolicitacao its on ipc.itemsolicitacaomaterial_id = its.id\r\n         left join itemcontratoitemsolext icse on ic.id = icse.itemcontrato_id\r\n         left join itemsolicitacaoexterno ise on icse.itemsolicitacaoexterno_id = ise.id\r\n         left join itemcontratovigente icv on ic.id = icv.itemcontrato_id\r\n         left join itemcotacao itcot on itcot.id = icv.itemcotacao_id\r\n         inner join objetocompra obj on obj.id = coalesce(ic.objetocompracontrato_id, its.objetocompra_id, ise.objetocompra_id, itcot.objetocompra_id)\r\n         inner join unidademedida um on um.id = obj.unidademedida_id\r\n$WHERE","totalRegistros":null,"ordem":2,"pesquisaveis":[],"fields":[{"posicao":1,"descricao":"Operação","columnName":"OPERACAO","columnValue":"OPERACAO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"ENUM","tipoEnum":"br.com.webpublico.enums.OperacaoMovimentoAlteracaoContratual","valorPadrao":[null,"REDIMENSIONAMENTO_OBJETO","REAJUSTE_POS_EXECUCAO","REAJUSTE_PRE_EXECUCAO","REEQUILIBRIO_POS_EXECUCAO","REEQUILIBRIO_PRE_EXECUCAO","DILACAO_PRAZO","REDUCAO_PRAZO","TRANSFERENCIA_FORNECEDOR","TRANSFERENCIA_DOTACAO","TRANSFERENCIA_UNIDADE","OUTRO"],"escondido":false},{"posicao":2,"descricao":"Finalidade","columnName":"FINALIDADE","columnValue":"FINALIDADE","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"ENUM","tipoEnum":"br.com.webpublico.enums.FinalidadeMovimentoAlteracaoContratual","valorPadrao":[null,"SUPRESSAO","ACRESCIMO","NAO_SE_APLICA"],"escondido":false},{"posicao":3,"descricao":"Item","columnName":"OBJETOCOMPRA","columnValue":"OBJETOCOMPRA","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":4,"descricao":"Sigla","columnName":"SIGLA","columnValue":"SIGLA","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":5,"descricao":"Quantidade","columnName":"QUANTIDADE","columnValue":"QUANTIDADE","tipoAlinhamento":"DIREITA","totalizar":false,"link":null,"tipo":"DECIMAL","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":6,"descricao":"Valor Unitário","columnName":"VALORUNITARIO","columnValue":"VALORUNITARIO","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":7,"descricao":"Valor Total","columnName":"VALORTOTAL","columnValue":"VALORTOTAL","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false}]},{"titulo":"Publicações","subTitulo":"","consulta":"select\r\n    pac.datapublicacao,\r\n    vp.nome as veiculodepublicacao,\r\n    pac.numero,\r\n    pac.pagina\r\nfrom alteracaocontratual ac\r\n         inner join PUBLICACAOALTERACAOCONT pac on pac.alteracaocontratual_id = ac.id\r\n         inner join veiculodepublicacao vp on vp.id = pac.veiculodepublicacao_id\r\n$WHERE","count":"select count(pac.id)\r\nfrom alteracaocontratual ac\r\n         inner join PUBLICACAOALTERACAOCONT pac on pac.alteracaocontratual_id = ac.id\r\n         inner join veiculodepublicacao vp on vp.id = pac.veiculodepublicacao_id\r\n$WHERE","totalRegistros":null,"ordem":3,"pesquisaveis":[],"fields":[{"posicao":1,"descricao":"Data da Publicação","columnName":"DATAPUBLICACAO","columnValue":"DATAPUBLICACAO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"DATE","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":2,"descricao":"Veículo de Publicação","columnName":"VEICULODEPUBLICACAO","columnValue":"VEICULODEPUBLICACAO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":3,"descricao":"Número","columnName":"NUMERO","columnValue":"NUMERO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"INTEGER","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":4,"descricao":"Página","columnName":"PAGINA","columnValue":"PAGINA","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"INTEGER","tipoEnum":null,"valorPadrao":null,"escondido":false}]}],"paineis":[]}';
BEGIN
update PAGINAPREFEITURAPORTAL set CONTEUDO = texto where NOME = 'Detalhes da Alteração Contratual' and CHAVE = 'alteracao-contratual-ver';
END;
