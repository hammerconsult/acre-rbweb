DECLARE
texto CLOB := '{"consulta":"select pca.numero,\r\n       ex.ano,\r\n       pca.inicioelaboracao,\r\n       pca.fimelaboracao,\r\n       vw.codigo || '' - '' || vw.descricao as unidade,\r\n       case\r\n           when ato.id is not null then ato.numero || '' - '' || ato.nome || '' Data de Publicação: '' ||\r\n                                        to_char(ato.datapublicacao, ''dd/MM/yyyy'')\r\n           else '''' end                    as ato\r\nfrom planocontratacaoanual pca\r\n         inner join exercicio ex on ex.id = pca.exercicio_id\r\n         inner join vwhierarquiaadministrativa vw on vw.subordinada_id = pca.unidadeorganizacional_id\r\n         left join atolegal ato on ato.id = pca.atolegal_id\r\nwhere trunc(coalesce(pca.fimelaboracao, pca.inicioelaboracao)) between trunc(vw.inicioVigencia) and coalesce(\r\n        trunc(vw.fimvigencia), trunc(coalesce(pca.fimelaboracao, pca.inicioelaboracao)))\r\n        $WHERE","count":"select count(pca.id)\r\nfrom planocontratacaoanual pca\r\n         inner join exercicio ex on ex.id = pca.exercicio_id\r\n         inner join vwhierarquiaadministrativa vw on vw.subordinada_id = pca.unidadeorganizacional_id\r\n         left join atolegal ato on ato.id = pca.atolegal_id\r\nwhere trunc(coalesce(pca.fimelaboracao, pca.inicioelaboracao)) between trunc(vw.inicioVigencia) and coalesce(\r\n        trunc(vw.fimvigencia), trunc(coalesce(pca.fimelaboracao, pca.inicioelaboracao)))\r\n        $WHERE","totalRegistros":1,"fields":[{"posicao":1,"descricao":"Número","columnName":"NUMERO","columnValue":"NUMERO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"INTEGER","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":2,"descricao":"Ano","columnName":"ANO","columnValue":"ANO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"INTEGER","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":3,"descricao":"Início da Elaboração","columnName":"INICIOELABORACAO","columnValue":"INICIOELABORACAO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"DATE","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":4,"descricao":"Fim da Elaboração","columnName":"FIMELABORACAO","columnValue":"FIMELABORACAO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"DATE","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":5,"descricao":"Unidade","columnName":"UNIDADE","columnValue":"UNIDADE","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":6,"descricao":"Ato","columnName":"ATO","columnValue":"ATO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false}],"pesquisaveis":[],"tabs":[{"titulo":"Objetos de Compras","subTitulo":"","consulta":"select pcaoc.numero,\r\n       oc.codigo || '' - '' || oc.descricao   as objetoCompra,\r\n       goc.codigo || '' - '' || goc.descricao as grupo,\r\n       pcaoc.dataDesejada,\r\n       pcaoc.quantidade,\r\n       pcaoc.valorUnitario,\r\n       pcaoc.valorTotal\r\nfrom planocontratacaoanual pca\r\n         inner join exercicio ex on ex.id = pca.exercicio_id\r\n         inner join vwhierarquiaadministrativa vw on vw.subordinada_id = pca.unidadeorganizacional_id\r\n         inner join planocontratanualgrupo pcagoc on pcagoc.planocontratacaoanual_id = pca.id\r\n         inner join grupoobjetocompra goc on goc.id = pcagoc.grupoobjetocompra_id\r\n         left join planocontratanualobjcomp pcaoc on pcaoc.planocontratacaoanualgrupo_id = pcagoc.id\r\n         left join objetocompra oc on oc.id = pcaoc.objetocompra_id\r\n         left join atolegal ato on ato.id = pca.atolegal_id\r\nwhere trunc(coalesce(pca.fimelaboracao, pca.inicioelaboracao)) between trunc(vw.inicioVigencia) and coalesce(\r\n        trunc(vw.fimvigencia), trunc(coalesce(pca.fimelaboracao, pca.inicioelaboracao)))\r\n$WHERE\r\norder by pcaoc.numero","count":"select count(pcaoc.id)\r\nfrom planocontratacaoanual pca\r\n         inner join exercicio ex on ex.id = pca.exercicio_id\r\n         inner join vwhierarquiaadministrativa vw on vw.subordinada_id = pca.unidadeorganizacional_id\r\n         inner join planocontratanualgrupo pcagoc on pcagoc.planocontratacaoanual_id = pca.id\r\n         inner join grupoobjetocompra goc on goc.id = pcagoc.grupoobjetocompra_id\r\n         left join planocontratanualobjcomp pcaoc on pcaoc.planocontratacaoanualgrupo_id = pcagoc.id\r\n         left join objetocompra oc on oc.id = pcaoc.objetocompra_id\r\n         left join atolegal ato on ato.id = pca.atolegal_id\r\nwhere trunc(coalesce(pca.fimelaboracao, pca.inicioelaboracao)) between trunc(vw.inicioVigencia) and coalesce(\r\n        trunc(vw.fimvigencia), trunc(coalesce(pca.fimelaboracao, pca.inicioelaboracao)))\r\n$WHERE","totalRegistros":null,"ordem":1,"pesquisaveis":[],"fields":[{"posicao":1,"descricao":"Número","columnName":"NUMERO","columnValue":"NUMERO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"INTEGER","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":2,"descricao":"Objeto de Compra","columnName":"OBJETOCOMPRA","columnValue":"OBJETOCOMPRA","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":3,"descricao":"Grupo","columnName":"GRUPO","columnValue":"GRUPO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":4,"descricao":"Data Desejada","columnName":"DATADESEJADA","columnValue":"DATADESEJADA","tipoAlinhamento":"CENTRO","totalizar":false,"link":null,"tipo":"DATE","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":5,"descricao":"Quantidade","columnName":"QUANTIDADE","columnValue":"QUANTIDADE","tipoAlinhamento":"DIREITA","totalizar":false,"link":null,"tipo":"DECIMAL","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":6,"descricao":"Valor Unitário (R$)","columnName":"VALORUNITARIO","columnValue":"VALORUNITARIO","tipoAlinhamento":"DIREITA","totalizar":false,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":7,"descricao":"Valor Total (R$)","columnName":"VALORTOTAL","columnValue":"VALORTOTAL","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false}]}],"paineis":[]}';
BEGIN
update PAGINAPREFEITURAPORTAL set CONTEUDO = texto where NOME = 'Detalhes do Plano de Contratações Anual (PCA)' and CHAVE = 'pca-ver';
END;
