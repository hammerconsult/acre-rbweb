DECLARE
texto CLOB := '{"consulta":"select distinct unidade,\r\n                tipo,\r\n                objetoFrota,\r\n                case when tipo = ''EQUIPAMENTO''\r\n                         then (case when sum(litros) <> 0 and horasUsoFinal <> 0 and horasUsoFinal > horasUsoInicial then sum(litros) / (horasUsoFinal - horasUsoInicial) else 0 end)\r\n                     else (case when sum(litros) <> 0 and kmFinal <> 0 and kmFinal > kminicial then (kmFinal - kminicial) / sum(litros) else 0 end)\r\n                    end as mediaConsumo\r\nfrom (select vw.codigo || '' - '' || vw.descricao as unidade,\r\n             obj.tipoobjetofrota as tipo,\r\n             case\r\n                 when obj.TIPOAQUISICAOOBJETOFROTA = ''PROPRIO''\r\n                     then b.IDENTIFICACAO ||\r\n                          (case when b.REGISTROANTERIOR is null then '''' else '' - '' || b.REGISTROANTERIOR end) ||\r\n                          '' - '' ||\r\n                          b.DESCRICAO\r\n                 else obj.DESCRICAO end         as objetoFrota,\r\n             coalesce(abastec.km, 0)            as kminicial,\r\n             coalesce(abastec.horasuso, 0)      as horasUsoInicial,\r\n             0                                  as kmFinal,\r\n             0                                  as horasUsoFinal,\r\n             0                                  as litros\r\n      from objetofrota obj\r\n               inner join abastecimentoobjetofrota abastec on abastec.objetofrota_id = obj.id\r\n               left join bem b on b.ID = obj.bem_id\r\n               left join unidadeobjetofrota ubf on ubf.objetofrota_id = obj.id\r\n          and sysdate between trunc(ubf.inicioVigencia) and coalesce(trunc(ubf.fimVigencia), sysdate)\r\n               left join vwhierarquiaadministrativa vw on vw.subordinada_id = ubf.unidadeorganizacional_id\r\n          and sysdate between trunc(vw.inicioVigencia) and coalesce(trunc(vw.fimVigencia), sysdate)\r\n      where abastec.id = (select id\r\n                          from (select s_abastecimento.id\r\n                                from abastecimentoobjetofrota s_abastecimento\r\n                                where s_abastecimento.dataabastecimento between to_date(''01/01/$ANO'', ''dd/MM/yyyy'') and to_date(''31/12/$ANO'', ''dd/MM/yyyy'')\r\n                                order by s_abastecimento.dataabastecimento asc, s_abastecimento.id asc)\r\n                          where rownum = 1)\r\n      $WHERE\r\n\r\n      union all\r\n      select vw.codigo || '' - '' || vw.descricao as unidade,\r\n             obj.tipoobjetofrota as tipo,\r\n             case\r\n                 when obj.TIPOAQUISICAOOBJETOFROTA = ''PROPRIO''\r\n                     then b.IDENTIFICACAO ||\r\n                          (case when b.REGISTROANTERIOR is null then '''' else '' - '' || b.REGISTROANTERIOR end) ||\r\n                          '' - '' ||\r\n                          b.DESCRICAO\r\n                 else obj.DESCRICAO end         as objetoFrota,\r\n             0                                  as kminicial,\r\n             0                                  as horasUsoInicial,\r\n             coalesce(abastec.km, 0)            as kmFinal,\r\n             coalesce(abastec.horasuso, 0)      as horasUsoFinal,\r\n             0                                  as litros\r\n      from objetofrota obj\r\n               inner join abastecimentoobjetofrota abastec on abastec.objetofrota_id = obj.id\r\n               left join bem b on b.ID = obj.bem_id\r\n               left join unidadeobjetofrota ubf on ubf.objetofrota_id = obj.id\r\n          and sysdate between trunc(ubf.inicioVigencia) and coalesce(trunc(ubf.fimVigencia), sysdate)\r\n               left join vwhierarquiaadministrativa vw on vw.subordinada_id = ubf.unidadeorganizacional_id\r\n          and sysdate between trunc(vw.inicioVigencia) and coalesce(trunc(vw.fimVigencia), sysdate)\r\n      where abastec.id = (select id\r\n                          from (select s_abastecimento.id\r\n                                from abastecimentoobjetofrota s_abastecimento\r\n                                where s_abastecimento.dataabastecimento between to_date(''01/01/$ANO'', ''dd/MM/yyyy'') and to_date(''31/12/$ANO'', ''dd/MM/yyyy'')\r\n                                order by s_abastecimento.dataabastecimento desc, s_abastecimento.id desc)\r\n                          where rownum = 1)\r\n          $WHERE\r\n\r\n      union all\r\n      select vw.codigo || '' - '' || vw.descricao as unidade,\r\n             obj.tipoobjetofrota as tipo,\r\n             case\r\n                 when obj.TIPOAQUISICAOOBJETOFROTA = ''PROPRIO''\r\n                     then b.IDENTIFICACAO ||\r\n                          (case when b.REGISTROANTERIOR is null then '''' else '' - '' || b.REGISTROANTERIOR end) ||\r\n                          '' - '' ||\r\n                          b.DESCRICAO\r\n                 else obj.DESCRICAO end         as objetoFrota,\r\n             0                                  as kminicial,\r\n             0                                  as horasUsoInicial,\r\n             0                                  as kmFinal,\r\n             0                                  as horasUsoFinal,\r\n             coalesce(item.quantidade, 0)       as litros\r\n      from objetofrota obj\r\n               left join bem b on b.ID = obj.bem_id\r\n               inner join abastecimentoobjetofrota abastec on abastec.objetofrota_id = obj.id\r\n               inner join itemabastecobjetofrota item on item.abastecimentoobjetofrota_id = abastec.id\r\n               left join unidadeobjetofrota ubf on ubf.objetofrota_id = obj.id\r\n          and sysdate between trunc(ubf.inicioVigencia) and coalesce(trunc(ubf.fimVigencia), sysdate)\r\n               left join vwhierarquiaadministrativa vw on vw.subordinada_id = ubf.unidadeorganizacional_id\r\n          and sysdate between trunc(vw.inicioVigencia) and coalesce(trunc(vw.fimVigencia), sysdate)\r\n      where abastec.dataabastecimento between to_date(''01/01/$ANO'', ''dd/MM/yyyy'') and to_date(''31/12/$ANO'', ''dd/MM/yyyy'')\r\n        and abastec.id <> (select id\r\n                           from (select s_abastecimento.id\r\n                                 from objetofrota s_obj\r\n                                          inner join abastecimentoobjetofrota s_abastecimento\r\n                                                     on s_abastecimento.objetofrota_id = s_obj.id\r\n                                 where s_abastecimento.dataabastecimento between to_date(''01/01/$ANO'', ''dd/MM/yyyy'') and to_date(''31/12/$ANO'', ''dd/MM/yyyy'')\r\n                                 order by s_abastecimento.dataabastecimento desc, s_abastecimento.id desc)\r\n                           where rownum = 1)\r\n          $WHERE)\r\ngroup by unidade, tipo, objetoFrota, kminicial, kmFinal, horasUsoInicial, horasUsoFinal","count":"select distinct count(objetoFrota)\r\nfrom (select vw.codigo || '' - '' || vw.descricao as unidade,\r\n             obj.tipoobjetofrota as tipo,\r\n             case\r\n                 when obj.TIPOAQUISICAOOBJETOFROTA = ''PROPRIO''\r\n                     then b.IDENTIFICACAO ||\r\n                          (case when b.REGISTROANTERIOR is null then '''' else '' - '' || b.REGISTROANTERIOR end) ||\r\n                          '' - '' ||\r\n                          b.DESCRICAO\r\n                 else obj.DESCRICAO end         as objetoFrota,\r\n             coalesce(abastec.km, 0)            as kminicial,\r\n             coalesce(abastec.horasuso, 0)      as horasUsoInicial,\r\n             0                                  as kmFinal,\r\n             0                                  as horasUsoFinal,\r\n             0                                  as litros\r\n      from objetofrota obj\r\n               inner join abastecimentoobjetofrota abastec on abastec.objetofrota_id = obj.id\r\n               left join bem b on b.ID = obj.bem_id\r\n               left join unidadeobjetofrota ubf on ubf.objetofrota_id = obj.id\r\n          and sysdate between trunc(ubf.inicioVigencia) and coalesce(trunc(ubf.fimVigencia), sysdate)\r\n               left join vwhierarquiaadministrativa vw on vw.subordinada_id = ubf.unidadeorganizacional_id\r\n          and sysdate between trunc(vw.inicioVigencia) and coalesce(trunc(vw.fimVigencia), sysdate)\r\n      where abastec.id = (select id\r\n                          from (select s_abastecimento.id\r\n                                from abastecimentoobjetofrota s_abastecimento\r\n                                where s_abastecimento.dataabastecimento between to_date(''01/01/$ANO'', ''dd/MM/yyyy'') and to_date(''31/12/$ANO'', ''dd/MM/yyyy'')\r\n                                order by s_abastecimento.dataabastecimento asc, s_abastecimento.id asc)\r\n                          where rownum = 1)\r\n      $WHERE\r\n\r\n      union all\r\n      select vw.codigo || '' - '' || vw.descricao as unidade,\r\n             obj.tipoobjetofrota as tipo,\r\n             case\r\n                 when obj.TIPOAQUISICAOOBJETOFROTA = ''PROPRIO''\r\n                     then b.IDENTIFICACAO ||\r\n                          (case when b.REGISTROANTERIOR is null then '''' else '' - '' || b.REGISTROANTERIOR end) ||\r\n                          '' - '' ||\r\n                          b.DESCRICAO\r\n                 else obj.DESCRICAO end         as objetoFrota,\r\n             0                                  as kminicial,\r\n             0                                  as horasUsoInicial,\r\n             coalesce(abastec.km, 0)            as kmFinal,\r\n             coalesce(abastec.horasuso, 0)      as horasUsoFinal,\r\n             0                                  as litros\r\n      from objetofrota obj\r\n               inner join abastecimentoobjetofrota abastec on abastec.objetofrota_id = obj.id\r\n               left join bem b on b.ID = obj.bem_id\r\n               left join unidadeobjetofrota ubf on ubf.objetofrota_id = obj.id\r\n          and sysdate between trunc(ubf.inicioVigencia) and coalesce(trunc(ubf.fimVigencia), sysdate)\r\n               left join vwhierarquiaadministrativa vw on vw.subordinada_id = ubf.unidadeorganizacional_id\r\n          and sysdate between trunc(vw.inicioVigencia) and coalesce(trunc(vw.fimVigencia), sysdate)\r\n      where abastec.id = (select id\r\n                          from (select s_abastecimento.id\r\n                                from abastecimentoobjetofrota s_abastecimento\r\n                                where s_abastecimento.dataabastecimento between to_date(''01/01/$ANO'', ''dd/MM/yyyy'') and to_date(''31/12/$ANO'', ''dd/MM/yyyy'')\r\n                                order by s_abastecimento.dataabastecimento desc, s_abastecimento.id desc)\r\n                          where rownum = 1)\r\n          $WHERE\r\n\r\n      union all\r\n      select vw.codigo || '' - '' || vw.descricao as unidade,\r\n             obj.tipoobjetofrota as tipo,\r\n             case\r\n                 when obj.TIPOAQUISICAOOBJETOFROTA = ''PROPRIO''\r\n                     then b.IDENTIFICACAO ||\r\n                          (case when b.REGISTROANTERIOR is null then '''' else '' - '' || b.REGISTROANTERIOR end) ||\r\n                          '' - '' ||\r\n                          b.DESCRICAO\r\n                 else obj.DESCRICAO end         as objetoFrota,\r\n             0                                  as kminicial,\r\n             0                                  as horasUsoInicial,\r\n             0                                  as kmFinal,\r\n             0                                  as horasUsoFinal,\r\n             coalesce(item.quantidade, 0)       as litros\r\n      from objetofrota obj\r\n               left join bem b on b.ID = obj.bem_id\r\n               inner join abastecimentoobjetofrota abastec on abastec.objetofrota_id = obj.id\r\n               inner join itemabastecobjetofrota item on item.abastecimentoobjetofrota_id = abastec.id\r\n               left join unidadeobjetofrota ubf on ubf.objetofrota_id = obj.id\r\n          and sysdate between trunc(ubf.inicioVigencia) and coalesce(trunc(ubf.fimVigencia), sysdate)\r\n               left join vwhierarquiaadministrativa vw on vw.subordinada_id = ubf.unidadeorganizacional_id\r\n          and sysdate between trunc(vw.inicioVigencia) and coalesce(trunc(vw.fimVigencia), sysdate)\r\n      where abastec.dataabastecimento between to_date(''01/01/$ANO'', ''dd/MM/yyyy'') and to_date(''31/12/$ANO'', ''dd/MM/yyyy'')\r\n        and abastec.id <> (select id\r\n                           from (select s_abastecimento.id\r\n                                 from objetofrota s_obj\r\n                                          inner join abastecimentoobjetofrota s_abastecimento\r\n                                                     on s_abastecimento.objetofrota_id = s_obj.id\r\n                                 where s_abastecimento.dataabastecimento between to_date(''01/01/$ANO'', ''dd/MM/yyyy'') and to_date(''31/12/$ANO'', ''dd/MM/yyyy'')\r\n                                 order by s_abastecimento.dataabastecimento desc, s_abastecimento.id desc)\r\n                           where rownum = 1)\r\n          $WHERE)\r\n          group by unidade, tipo, objetoFrota, kminicial, kmFinal, horasUsoInicial, horasUsoFinal","totalRegistros":1,"fields":[{"posicao":1,"descricao":"Unidade","columnName":"UNIDADE","columnValue":"UNIDADE","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false,"agrupador":false},{"posicao":2,"descricao":"Tipo","columnName":"TIPO","columnValue":"TIPO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"ENUM","tipoEnum":"br.com.webpublico.enums.TipoObjetoFrota","valorPadrao":[null,"VEICULO","EQUIPAMENTO"],"escondido":false,"agrupador":false},{"posicao":3,"descricao":"Objeto Frota","columnName":"OBJETOFROTA","columnValue":"OBJETOFROTA","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false,"agrupador":false},{"posicao":4,"descricao":"Média de Consumo","columnName":"MEDIACONSUMO","columnValue":"MEDIACONSUMO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"DECIMAL","tipoEnum":null,"valorPadrao":null,"escondido":false,"agrupador":false}],"pesquisaveis":[],"tabs":[],"paineis":[]}';
BEGIN
update PAGINAPREFEITURAPORTAL
set CONTEUDO = texto
where NOME = 'Manutenção de Veículos'
  and CHAVE = 'manutencao-veiculo';
END;
