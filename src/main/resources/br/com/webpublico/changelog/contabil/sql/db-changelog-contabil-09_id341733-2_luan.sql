DECLARE
texto CLOB := '{"consulta":"select tac.codigo || ac.codigo || '' - '' || ac.descricao as acao,\r\n       sum(empenhado) as empenhado,\r\n       sum(liquidado) as liquidado,\r\n       sum(pago) as pago, sum(cancelado)\r\nfrom (select prov.subacaoppa_id                 as idSubAcaoPPA,\r\n             emp.unidadeOrganizacional_id       as idUnidade,\r\n             emp.dataEmpenho                    as dataReferencia,\r\n             sum(coalesce(emp.valor, 0))        as empenhado,\r\n             0                                  as liquidado,\r\n             0                                  as pago,\r\n             0                                  as cancelado\r\n      from empenho emp\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where emp.categoriaorcamentaria = ''RESTO''\r\n      group by prov.subacaoppa_id, emp.unidadeOrganizacional_id, emp.dataEmpenho\r\n\r\n      union all\r\n      select prov.subacaoppa_id                 as idSubAcaoPPA,\r\n             liq.unidadeOrganizacional_id       as idUnidade,\r\n             liq.dataLiquidacao                 as dataReferencia,\r\n             0                                  as empenhado,\r\n             sum(coalesce(liq.valor, 0))        as liquidado,\r\n             0                                  as pago,\r\n             0                                  as cancelado\r\n      from liquidacao liq\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where liq.categoriaorcamentaria = ''RESTO''\r\n      group by prov.subacaoppa_id, liq.unidadeOrganizacional_id, liq.dataLiquidacao\r\n\r\n      union all\r\n      select prov.subacaoppa_id                 as idSubAcaoPPA,\r\n             est.unidadeOrganizacional_id       as idUnidade,\r\n             est.dataEstorno                    as dataReferencia,\r\n             0                                  as empenhado,\r\n             sum(coalesce(est.valor, 0)) * -1   as liquidado,\r\n             0                                  as pago,\r\n             0                                  as cancelado\r\n      from liquidacaoestorno est\r\n               inner join liquidacao liq on est.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where liq.categoriaorcamentaria = ''RESTO''\r\n      group by prov.subacaoppa_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n\r\n      union all\r\n      select prov.subacaoppa_id                 as idSubAcaoPPA,\r\n             pag.unidadeOrganizacional_id       as idUnidade,\r\n             pag.dataPagamento                  as dataReferencia,\r\n             0                                  as empenhado,\r\n             0                                  as liquidado,\r\n             sum(coalesce(pag.valor, 0))        as pago,\r\n             0                                  as cancelado\r\n      from pagamento pag\r\n               inner join liquidacao liq on pag.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where pag.categoriaorcamentaria = ''RESTO''\r\n      group by prov.subacaoppa_id, pag.unidadeOrganizacional_id, pag.dataPagamento\r\n\r\n      union all\r\n      select prov.subacaoppa_id                 as idSubAcaoPPA,\r\n             est.unidadeOrganizacional_id       as idUnidade,\r\n             est.dataEstorno                    as dataReferencia,\r\n             0                                  as empenhado,\r\n             0                                  as liquidado,\r\n             sum(coalesce(est.valor, 0)) * -1   as pago,\r\n             0                                  as cancelado\r\n      from pagamentoestorno est\r\n               inner join pagamento pag on est.pagamento_id = pag.id\r\n               inner join liquidacao liq on pag.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where pag.categoriaorcamentaria = ''RESTO''\r\n      group by prov.subacaoppa_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n\r\n      union all\r\n      select prov.subacaoppa_id                 as idSubAcaoPPA,\r\n             est.unidadeOrganizacional_id       as idUnidade,\r\n             est.dataEstorno                    as dataReferencia,\r\n             0                                  as empenhado,\r\n             0                                  as liquidado,\r\n             0                                  as pago,\r\n             sum(coalesce(est.valor, 0))        as cancelado\r\n      from empenhoestorno est\r\n               inner join empenho emp on est.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where emp.categoriaorcamentaria = ''RESTO''\r\n      group by prov.subacaoppa_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n      ) dados\r\n         inner join subacaoppa sub ON sub.id = dados.idSubAcaoPPA\r\n         inner join acaoppa ac ON ac.id = sub.acaoppa_id\r\n         inner join tipoAcaoPPA tac ON tac.id = ac.tipoAcaoPPA_id\r\n         left join programappa prog ON prog.id = ac.programa_id\r\n         inner join vwhierarquiaorcamentaria vw ON dados.idUnidade = vw.subordinada_id\r\nwhere trunc(dados.dataReferencia) BETWEEN to_date(''01/01/$ANO'', ''dd/MM/yyyy'') AND to_date(''31/12/$ANO'', ''dd/MM/yyyy'')\r\n  and trunc(dados.dataReferencia) between vw.iniciovigencia and coalesce(vw.fimvigencia, trunc(dados.dataReferencia))\r\n  and dados.idUnidade in (select UNIDADE_ID from UNIDADEPREFEITURAPORTAL where PREFEITURA_ID = $PREFEITURAPORTAL_ID)\r\n  $WHERE\r\ngroup by tac.codigo || ac.codigo || '' - '' || ac.descricao\r\norder by tac.codigo || ac.codigo || '' - '' || ac.descricao","count":"select count(1) from (\r\nselect tac.codigo || ac.codigo || '' - '' || ac.descricao as acao,\r\n       sum(empenhado) as empenhado,\r\n       sum(liquidado) as liquidado,\r\n       sum(pago) as pago, sum(cancelado)\r\nfrom (select prov.subacaoppa_id                 as idSubAcaoPPA,\r\n             emp.unidadeOrganizacional_id       as idUnidade,\r\n             emp.dataEmpenho                    as dataReferencia,\r\n             sum(coalesce(emp.valor, 0))        as empenhado,\r\n             0                                  as liquidado,\r\n             0                                  as pago,\r\n             0                                  as cancelado\r\n      from empenho emp\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where emp.categoriaorcamentaria = ''RESTO''\r\n      group by prov.subacaoppa_id, emp.unidadeOrganizacional_id, emp.dataEmpenho\r\n\r\n      union all\r\n      select prov.subacaoppa_id                 as idSubAcaoPPA,\r\n             liq.unidadeOrganizacional_id       as idUnidade,\r\n             liq.dataLiquidacao                 as dataReferencia,\r\n             0                                  as empenhado,\r\n             sum(coalesce(liq.valor, 0))        as liquidado,\r\n             0                                  as pago,\r\n             0                                  as cancelado\r\n      from liquidacao liq\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where liq.categoriaorcamentaria = ''RESTO''\r\n      group by prov.subacaoppa_id, liq.unidadeOrganizacional_id, liq.dataLiquidacao\r\n\r\n      union all\r\n      select prov.subacaoppa_id                 as idSubAcaoPPA,\r\n             est.unidadeOrganizacional_id       as idUnidade,\r\n             est.dataEstorno                    as dataReferencia,\r\n             0                                  as empenhado,\r\n             sum(coalesce(est.valor, 0)) * -1   as liquidado,\r\n             0                                  as pago,\r\n             0                                  as cancelado\r\n      from liquidacaoestorno est\r\n               inner join liquidacao liq on est.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where liq.categoriaorcamentaria = ''RESTO''\r\n      group by prov.subacaoppa_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n\r\n      union all\r\n      select prov.subacaoppa_id                 as idSubAcaoPPA,\r\n             pag.unidadeOrganizacional_id       as idUnidade,\r\n             pag.dataPagamento                  as dataReferencia,\r\n             0                                  as empenhado,\r\n             0                                  as liquidado,\r\n             sum(coalesce(pag.valor, 0))        as pago,\r\n             0                                  as cancelado\r\n      from pagamento pag\r\n               inner join liquidacao liq on pag.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where pag.categoriaorcamentaria = ''RESTO''\r\n      group by prov.subacaoppa_id, pag.unidadeOrganizacional_id, pag.dataPagamento\r\n\r\n      union all\r\n      select prov.subacaoppa_id                 as idSubAcaoPPA,\r\n             est.unidadeOrganizacional_id       as idUnidade,\r\n             est.dataEstorno                    as dataReferencia,\r\n             0                                  as empenhado,\r\n             0                                  as liquidado,\r\n             sum(coalesce(est.valor, 0)) * -1   as pago,\r\n             0                                  as cancelado\r\n      from pagamentoestorno est\r\n               inner join pagamento pag on est.pagamento_id = pag.id\r\n               inner join liquidacao liq on pag.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where pag.categoriaorcamentaria = ''RESTO''\r\n      group by prov.subacaoppa_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n\r\n      union all\r\n      select prov.subacaoppa_id                 as idSubAcaoPPA,\r\n             est.unidadeOrganizacional_id       as idUnidade,\r\n             est.dataEstorno                    as dataReferencia,\r\n             0                                  as empenhado,\r\n             0                                  as liquidado,\r\n             0                                  as pago,\r\n             sum(coalesce(est.valor, 0))        as cancelado\r\n      from empenhoestorno est\r\n               inner join empenho emp on est.empenho_id = emp.id\r\n               inner join fonteDespesaORC fdOrc on emp.fonteDespesaORC_id = fdOrc.id\r\n               inner join provisaoPPAFonte proFonte on fdOrc.provisaoPPAFonte_id = proFonte.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n      where emp.categoriaorcamentaria = ''RESTO''\r\n      group by prov.subacaoppa_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n      ) dados\r\n         inner join subacaoppa sub ON sub.id = dados.idSubAcaoPPA\r\n         inner join acaoppa ac ON ac.id = sub.acaoppa_id\r\n         inner join tipoAcaoPPA tac ON tac.id = ac.tipoAcaoPPA_id\r\n         left join programappa prog ON prog.id = ac.programa_id\r\n         inner join vwhierarquiaorcamentaria vw ON dados.idUnidade = vw.subordinada_id\r\nwhere trunc(dados.dataReferencia) BETWEEN to_date(''01/01/$ANO'', ''dd/MM/yyyy'') AND to_date(''31/12/$ANO'', ''dd/MM/yyyy'')\r\n  and trunc(dados.dataReferencia) between vw.iniciovigencia and coalesce(vw.fimvigencia, trunc(dados.dataReferencia))\r\n  and dados.idUnidade in (select UNIDADE_ID from UNIDADEPREFEITURAPORTAL where PREFEITURA_ID = $PREFEITURAPORTAL_ID)\r\n  $WHERE\r\ngroup by tac.codigo || ac.codigo || '' - '' || ac.descricao\r\norder by tac.codigo || ac.codigo || '' - '' || ac.descricao\r\n)","totalRegistros":101,"fields":[{"posicao":1,"descricao":"Ação","columnName":"ACAO","columnValue":"ACAO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":2,"descricao":"Inscrito (R$)","columnName":"EMPENHADO","columnValue":"EMPENHADO","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":3,"descricao":"Liquidado (R$)","columnName":"LIQUIDADO","columnValue":"LIQUIDADO","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":4,"descricao":"Pago (R$)","columnName":"PAGO","columnValue":"PAGO","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":5,"descricao":"Cancelado (R$)","columnName":"SUM(CANCELADO)","columnValue":"SUM(CANCELADO)","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false}],"pesquisaveis":[{"descricao":"Unidade","columnName":"vw.subordinada_id","columnValue":null,"tipo":"MULTI_SELECT","operacaoPadrao":null,"tipoEnum":null,"valorPadrao":"","tipoMultiSelect":"UNIDADE_ORCAMENTARIA"},{"descricao":"Programa","columnName":"prog.codigo","columnValue":null,"tipo":"MULTI_SELECT","operacaoPadrao":null,"tipoEnum":null,"valorPadrao":"","tipoMultiSelect":"PROGRAMA_PPA"},{"descricao":"Ação","columnName":"ac.codigo","columnValue":null,"tipo":"MULTI_SELECT","operacaoPadrao":null,"tipoEnum":null,"valorPadrao":"","tipoMultiSelect":"ACAO_PPA"}],"tabs":[]}';
BEGIN
update PAGINAPREFEITURAPORTAL set CONTEUDO = texto where NOME = 'Restos a Pagar por Ação';
END;
