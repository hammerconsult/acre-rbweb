DECLARE
texto CLOB := '{"consulta":"select * from dual $WHERE","count":"select COUNT(1) from dual $WHERE","totalRegistros":null,"fields":[],"pesquisaveis":[],"tabs":[],"paineis":[{"descricao":"Arrecadação/Despesa empenhada","metadeDaTela":true,"tipoPainelPortal":"GRAFICO","tipoGrafico":"line","tipoValorGrafico":"monetario","consulta":"select type, mes as nome, sum(valor) as valor\r\nfrom (\r\n         select ''Receita'' as type,\r\n                case when exe.ano = $ANO then (case when conta.codigo like ''9.%'' then sum(lf.valor * -1) else sum(lf.valor) end) else 0 end as valor,\r\n                extract(month from lan.dataLancamento) as mesNumero,\r\n                to_char(lan.dataLancamento,''Month'') as mes\r\n         from LancReceitaFonte lf\r\n                  inner join receitaloafonte rlf on lf.receitaloafonte_id = rlf.id\r\n                  inner join lancamentoreceitaorc lan on lf.lancReceitaOrc_id = lan.id\r\n                  inner join receitaloa rl on lan.receitaloa_id = rl.id\r\n                  inner join conta on rl.contaDeReceita_id = conta.id\r\n                  inner join exercicio exe on lan.exercicio_id = exe.id\r\n         group by exe.ano, conta.codigo, extract(month from lan.dataLancamento) , to_char(lan.dataLancamento,''Month'')\r\n\r\n         union all\r\n         select ''Despesa Empenhada'' as type,\r\n                case when ex.ano = $ANO then coalesce(sum(emp.valor), 0) else 0 end as valor,\r\n                extract(month from emp.dataEmpenho) as mesNumero,\r\n                to_char(emp.dataEmpenho,''Month'') as mes\r\n         from empenho emp\r\n                  inner join exercicio ex on emp.EXERCICIO_ID = ex.id\r\n                  inner join despesaorc desp on emp.DESPESAORC_ID = desp.id\r\n                  inner join provisaoppadespesa provDesp on desp.PROVISAOPPADESPESA_ID = provDesp.id\r\n                  inner join conta c on provDesp.CONTADEDESPESA_ID = c.id\r\n         where emp.CATEGORIAORCAMENTARIA = ''NORMAL''\r\n         group by ex.ano, extract(month from emp.dataEmpenho), to_char(emp.dataEmpenho,''Month'')\r\n\r\n         union all\r\n         select ''Despesa Empenhada'' as type,\r\n                case when ex.ano = $ANO then coalesce(sum(est.valor * -1), 0) else 0 end as valor,\r\n                extract(month from emp.dataEmpenho) as mesNumero,\r\n                to_char(emp.dataEmpenho,''Month'') as mes\r\n         from empenhoestorno est\r\n                  inner join exercicio ex on est.EXERCICIO_ID = ex.id\r\n                  inner join empenho emp on est.empenho_id = emp.id\r\n                  inner join despesaorc desp on emp.DESPESAORC_ID = desp.id\r\n                  inner join provisaoppadespesa provDesp on desp.PROVISAOPPADESPESA_ID = provDesp.id\r\n                  inner join conta c on provDesp.CONTADEDESPESA_ID = c.id\r\n         where est.CATEGORIAORCAMENTARIA = ''NORMAL''\r\n         group by ex.ano, extract(month from emp.dataEmpenho), to_char(emp.dataEmpenho,''Month'')\r\n     )\r\ngroup by mes, mesNumero, type\r\norder by type, mesNumero"},{"descricao":"Detalhes","metadeDaTela":true,"tipoPainelPortal":"LISTA_HORIZONTAL","tipoGrafico":null,"tipoValorGrafico":null,"consulta":"select nome, type, link, style, icon, sum(valor) as valor\r\nfrom (\r\n         select\r\n             ''Despesa Empenhada'' as nome,\r\n             ''label-danger'' as type,\r\n             ''despesa-por-empenho'' as link,\r\n             ''color: #a94442'' as style,\r\n             ''fa fa-arrow-down'' as icon,\r\n             count(emp.id) as valor,\r\n             1 as ordem\r\n         from empenho emp\r\n                  inner join exercicio ex on ex.id = emp.exercicio_id\r\n                  INNER JOIN DESPESAORC DESP  ON emp.DESPESAORC_ID = DESP.ID\r\n                  INNER JOIN PROVISAOPPADESPESA PROV  ON DESP.PROVISAOPPADESPESA_ID = PROV.ID\r\n                  inner join SubAcaoPPA  sub on PROV.SUBACAOPPA_ID = sub.id\r\n                  inner join acaoppa acao on sub.acaoppa_id = acao.id\r\n         where emp.categoriaOrcamentaria = ''NORMAL''\r\n           and ex.ano = $ANO\r\n           and PROV.unidadeOrganizacional_id in (select UNIDADE_ID from UNIDADEPREFEITURAPORTAL where PREFEITURA_ID = $PREFEITURAPORTAL_ID)\r\n\r\n         union all\r\n         select\r\n             ''Receita'' as nome,\r\n             ''label-success'' as type,\r\n             ''receita-por-unidade'' as link,\r\n             ''color: #3c763d'' as style,\r\n             ''fa fa-arrow-up'' as icon,\r\n             count(conta.codigo) as valor,\r\n             2 as ordem\r\n         from LancReceitaFonte lf\r\n             inner join receitaloafonte rlf on lf.receitaloafonte_id = rlf.id\r\n             inner join LancamentoReceitaOrc lan on lf.lancReceitaOrc_id = lan.id\r\n             inner join receitaloa rl on lan.receitaloa_id = rl.id\r\n             inner join conta on rl.contaDeReceita_id = conta.id\r\n             inner join exercicio ex on lan.exercicio_id = ex.id\r\n         where ex.ano = $ANO\r\n           and lan.unidadeOrganizacional_id in (select UNIDADE_ID from UNIDADEPREFEITURAPORTAL where PREFEITURA_ID = $PREFEITURAPORTAL_ID)\r\n\r\n         union all\r\n         select\r\n             ''Atos Legais'' as nome,\r\n             ''label-info'' as type,\r\n             ''ato-legal'' as link,\r\n             ''color: #31708f'' as style,\r\n             ''fa fa-file-text-o'' as icon,\r\n             count(ato.id) as valor,\r\n             3 as ordem\r\n         from atolegal ato\r\n             inner join exercicio ex on ex.id = ato.exercicio_id\r\n         where ex.ano = $ANO\r\n\r\n         union all\r\n         select\r\n             ''Licitações'' as nome,\r\n             ''label-warning'' as type,\r\n             ''licitacao'' as link,\r\n             ''color: #8a6d3b'' as style,\r\n             ''fa fa-tasks'' as icon,\r\n             count(lic.id) as valor,\r\n             4 as ordem\r\n         from licitacao lic\r\n             inner join exercicio ex on ex.id = lic.exercicio_id\r\n         where ex.ano = $ANO\r\n\r\n         union all\r\n         select\r\n             ''Licitações'' as nome,\r\n             ''label-warning'' as type,\r\n             ''licitacao'' as link,\r\n             ''color: #8a6d3b'' as style,\r\n             ''fa fa-tasks'' as icon,\r\n             count(disp.id) as valor,\r\n             4 as ordem\r\n         from dispensadelicitacao disp\r\n             inner join exercicio ex on ex.id = disp.exercicioDaDispensa_id\r\n         where ex.ano = $ANO\r\n\r\n         union all\r\n         select\r\n             ''Licitações'' as nome,\r\n             ''label-warning'' as type,\r\n             ''licitacao'' as link,\r\n             ''color: #8a6d3b'' as style,\r\n             ''fa fa-tasks'' as icon,\r\n             count(regExt.id) as valor,\r\n             4 as ordem\r\n         from REGISTROSOLMATEXT regExt\r\n             inner join exercicio ex on ex.id = regExt.exercicioRegistro_id\r\n         where ex.ano = $ANO\r\n\r\n         union all\r\n         select\r\n             ''Obras'' as nome,\r\n             ''label-default'' as type,\r\n             ''obra'' as link,\r\n             ''color: #777'' as style,\r\n             ''fa fa-building'' as icon,\r\n             count(obra.id) as valor,\r\n             5 as ordem\r\n         from obra\r\n\r\n         union all\r\n         select\r\n             ''Diárias'' as nome,\r\n             ''label-primary'' as type,\r\n             ''diaria'' as link,\r\n             ''color: #23527c'' as style,\r\n             ''fa fa-plane'' as icon,\r\n             count(diaria.id) as valor,\r\n             6 as ordem\r\n         from propostaconcessaodiaria diaria\r\n             inner join empenho e on diaria.id = e.propostaconcessaodiaria_id\r\n             inner join liquidacao l on e.id = l.empenho_id\r\n             inner join pagamento p on l.id = p.liquidacao_id\r\n             inner join exercicio ex on p.EXERCICIO_ID = ex.id\r\n         where p.CATEGORIAORCAMENTARIA = ''NORMAL''\r\n           and p.STATUS <> ''ABERTO''\r\n           and diaria.tipoProposta <> ''SUPRIMENTO_FUNDO''\r\n           and e.id not in (select est.empenho_id from empenhoestorno est)\r\n           and ex.ano = $ANO\r\n           and p.unidadeOrganizacional_id in (select UNIDADE_ID from UNIDADEPREFEITURAPORTAL where PREFEITURA_ID = $PREFEITURAPORTAL_ID)\r\n     ) dados\r\ngroup by nome, type, link, style, icon, ordem\r\norder by ordem"},{"descricao":"Porcentagem Despesa Empenhada/Receita","metadeDaTela":true,"tipoPainelPortal":"LISTA_VERTICAL","tipoGrafico":null,"tipoValorGrafico":null,"consulta":"select\r\n    nome,\r\n    sum(valor) as valor,\r\n    case when nome = ''Orçamento'' then sum(valor) end as valorTotalPorcentagem\r\nfrom (select ''Orçamento''                      as nome,\r\n             1 as ordem,\r\n             coalesce(sum(preFonte.valor), 0) as valor\r\n      from ProvisaoPPAFonte preFonte\r\n               inner join ProvisaoPPADespesa pre on pre.id = preFonte.provisaoPPADespesa_id\r\n               inner join subAcaoPPA sap on sap.id = pre.subAcaoPPA_id\r\n               inner join acaoppa ap on ap.id = sap.acaoppa_id\r\n               inner join exercicio ex on ex.id = sap.exercicio_id\r\n      where ex.ano = $ANO\r\n\r\n      union all\r\n      select ''Receita''                               as nome,\r\n             2 as ordem,\r\n             case when ex.ano = $ANO then (case when conta.codigo like ''9.%'' then coalesce(sum(lf.valor * -1), 0) else coalesce(sum(lf.valor), 0) end) else 0 end as valor\r\n      from LancReceitaFonte lf\r\n               inner join receitaloafonte rlf on lf.receitaloafonte_id = rlf.id\r\n               inner join lancamentoreceitaorc lan on lf.lancReceitaOrc_id = lan.id\r\n               inner join receitaloa rl on lan.receitaloa_id = rl.id\r\n               inner join conta on rl.contaDeReceita_id = conta.id\r\n               inner join exercicio ex on lan.exercicio_id = ex.id\r\n            group by conta.codigo, ex.ano\r\n\r\n      union all\r\n      select ''Despesa Empenhada''         as nome,\r\n             3 as ordem,\r\n             case when ex.ano = $ANO then coalesce(sum(emp.valor), 0) else 0 end as valor\r\n      from empenho emp\r\n               inner join exercicio ex on emp.EXERCICIO_ID = ex.id\r\n               inner join despesaorc desp on emp.DESPESAORC_ID = desp.id\r\n               inner join provisaoppadespesa provDesp on desp.PROVISAOPPADESPESA_ID = provDesp.id\r\n               inner join conta c on provDesp.CONTADEDESPESA_ID = c.id\r\n      where emp.CATEGORIAORCAMENTARIA = ''NORMAL''\r\n     group by ex.ano\r\n\r\n      union all\r\n      select ''Despesa Empenhada''              as nome,\r\n             3 as ordem,\r\n             case when ex.ano = $ANO then coalesce(sum(est.valor * -1), 0) else 0 end as valor\r\n      from empenhoestorno est\r\n               inner join exercicio ex on est.EXERCICIO_ID = ex.id\r\n               inner join empenho emp on est.empenho_id = emp.id\r\n               inner join despesaorc desp on emp.DESPESAORC_ID = desp.id\r\n               inner join provisaoppadespesa provDesp on desp.PROVISAOPPADESPESA_ID = provDesp.id\r\n               inner join conta c on provDesp.CONTADEDESPESA_ID = c.id\r\n      where est.CATEGORIAORCAMENTARIA = ''NORMAL''\r\n     group by ex.ano\r\n     )\r\ngroup by nome, ordem\r\norder by ordem"},{"descricao":"Licitações por modalidade","metadeDaTela":true,"tipoPainelPortal":"GRAFICO","tipoGrafico":"bar","tipoValorGrafico":"quantidade","consulta":"select\r\n    case modalidadeLicitacao\r\n        when ''CONVITE'' then ''Convite''\r\n        when ''TOMADA_PRECO'' then ''Tomada de Preço''\r\n        when ''CONCORRENCIA_PUBLICA'' then ''Concorrência''\r\n        when ''CONCURSO'' then ''Concurso''\r\n        when ''PREGAO'' then ''Pregão''\r\n        when ''DISPENSA_LICITACAO'' then ''Dispensa''\r\n        when ''INEXIGIBILIDADE'' then ''Inexigibilidade''\r\n        when ''RDC'' then ''RDC''\r\n    end as nome,\r\n    sum(valor) as valor\r\nfrom (\r\n         select lic.modalidadeLicitacao as modalidadeLicitacao,\r\n                case when ex.ano = $ANO then count(lic.id) else 0 end as valor\r\n         from licitacao lic\r\n                  inner join exercicio ex on ex.id = lic.exercicio_id\r\n         group by lic.modalidadeLicitacao, ex.ano\r\n\r\n         union all\r\n         select disp.modalidade as modalidadeLicitacao,\r\n                case when ex.ano = $ANO then count(disp.id) else 0 end as valor\r\n         from dispensadelicitacao disp\r\n                  inner join exercicio ex on ex.id = disp.exercicioDaDispensa_id\r\n         group by disp.modalidade, ex.ano\r\n\r\n         union all\r\n         select regExt.modalidadeCarona as modalidadeLicitacao,\r\n             case when ex.ano = $ANO then count(regExt.id) else 0 end as valor\r\n         from REGISTROSOLMATEXT regExt\r\n                  inner join exercicio ex on ex.id = regExt.exercicioRegistro_id\r\n         group by regExt.modalidadeCarona, ex.ano\r\n     )\r\ngroup by modalidadeLicitacao"},{"descricao":"Despesas Empenhadas com Educação/Saúde/Pessoal","metadeDaTela":false,"tipoPainelPortal":"GRAFICO","tipoGrafico":"line","tipoValorGrafico":"monetario","consulta":"select type, mes as nome, sum(valor) as valor\r\nfrom (select ''Educação''                                                          as type,\r\n             extract(month from emp.dataEmpenho)                                 as mesNumero,\r\n             to_char(emp.dataEmpenho, ''Month'')                                   as mes,\r\n             case when ex.ano = $ANO then coalesce(sum(emp.valor), 0) else 0 end as valor\r\n      from empenho emp\r\n               inner join exercicio ex on emp.EXERCICIO_ID = ex.id\r\n               inner join despesaorc desp on emp.DESPESAORC_ID = desp.id\r\n               inner join provisaoppadespesa provDesp on desp.PROVISAOPPADESPESA_ID = provDesp.id\r\n               inner join subAcaoPPA sap on sap.id = provDesp.subAcaoPPA_id\r\n               inner join acaoppa ap on ap.id = sap.acaoppa_id\r\n               inner join funcao func on func.id = ap.funcao_id\r\n               inner join conta c on provDesp.CONTADEDESPESA_ID = c.id\r\n      where emp.CATEGORIAORCAMENTARIA = ''NORMAL''\r\n        and func.codigo = ''12''\r\n      group by ex.ano, extract(month from emp.dataEmpenho), to_char(emp.dataEmpenho, ''Month'')\r\n\r\n      union all\r\n      select ''Educação''                                                               as type,\r\n             extract(month from emp.dataEmpenho)                                      as mesNumero,\r\n             to_char(emp.dataEmpenho, ''Month'')                                        as mes,\r\n             case when ex.ano = $ANO then coalesce(sum(est.valor * -1), 0) else 0 end as valor\r\n      from empenhoestorno est\r\n               inner join exercicio ex on est.EXERCICIO_ID = ex.id\r\n               inner join empenho emp on est.empenho_id = emp.id\r\n               inner join despesaorc desp on emp.DESPESAORC_ID = desp.id\r\n               inner join provisaoppadespesa provDesp on desp.PROVISAOPPADESPESA_ID = provDesp.id\r\n               inner join subAcaoPPA sap on sap.id = provDesp.subAcaoPPA_id\r\n               inner join acaoppa ap on ap.id = sap.acaoppa_id\r\n               inner join funcao func on func.id = ap.funcao_id\r\n               inner join conta c on provDesp.CONTADEDESPESA_ID = c.id\r\n      where est.CATEGORIAORCAMENTARIA = ''NORMAL''\r\n        and func.codigo = ''12''\r\n      group by ex.ano, extract(month from emp.dataEmpenho), to_char(emp.dataEmpenho, ''Month'')\r\n\r\n      union all\r\n      select ''Saúde''                                                             as type,\r\n             extract(month from emp.dataEmpenho)                                 as mesNumero,\r\n             to_char(emp.dataEmpenho, ''Month'')                                   as mes,\r\n             case when ex.ano = $ANO then coalesce(sum(emp.valor), 0) else 0 end as valor\r\n      from empenho emp\r\n               inner join exercicio ex on emp.EXERCICIO_ID = ex.id\r\n               inner join despesaorc desp on emp.DESPESAORC_ID = desp.id\r\n               inner join provisaoppadespesa provDesp on desp.PROVISAOPPADESPESA_ID = provDesp.id\r\n               inner join subAcaoPPA sap on sap.id = provDesp.subAcaoPPA_id\r\n               inner join acaoppa ap on ap.id = sap.acaoppa_id\r\n               inner join funcao func on func.id = ap.funcao_id\r\n               inner join conta c on provDesp.CONTADEDESPESA_ID = c.id\r\n      where emp.CATEGORIAORCAMENTARIA = ''NORMAL''\r\n        and func.codigo = ''10''\r\n      group by ex.ano, extract(month from emp.dataEmpenho), to_char(emp.dataEmpenho, ''Month'')\r\n\r\n      union all\r\n      select ''Saúde''                                                                  as type,\r\n             extract(month from emp.dataEmpenho)                                      as mesNumero,\r\n             to_char(emp.dataEmpenho, ''Month'')                                        as mes,\r\n             case when ex.ano = $ANO then coalesce(sum(est.valor * -1), 0) else 0 end as valor\r\n      from empenhoestorno est\r\n               inner join exercicio ex on est.EXERCICIO_ID = ex.id\r\n               inner join empenho emp on est.empenho_id = emp.id\r\n               inner join despesaorc desp on emp.DESPESAORC_ID = desp.id\r\n               inner join provisaoppadespesa provDesp on desp.PROVISAOPPADESPESA_ID = provDesp.id\r\n               inner join subAcaoPPA sap on sap.id = provDesp.subAcaoPPA_id\r\n               inner join acaoppa ap on ap.id = sap.acaoppa_id\r\n               inner join funcao func on func.id = ap.funcao_id\r\n               inner join conta c on provDesp.CONTADEDESPESA_ID = c.id\r\n      where est.CATEGORIAORCAMENTARIA = ''NORMAL''\r\n        and func.codigo = ''10''\r\n      group by ex.ano, extract(month from emp.dataEmpenho), to_char(emp.dataEmpenho, ''Month'')\r\n\r\n      union all\r\n      select ''Pessoal''                                                           as type,\r\n             extract(month from emp.dataEmpenho)                                 as mesNumero,\r\n             to_char(emp.dataEmpenho, ''Month'')                                   as mes,\r\n             case when ex.ano = $ANO then coalesce(sum(emp.valor), 0) else 0 end as valor\r\n      from empenho emp\r\n               inner join exercicio ex on emp.EXERCICIO_ID = ex.id\r\n               inner join despesaorc desp on emp.DESPESAORC_ID = desp.id\r\n               inner join provisaoppadespesa provDesp on desp.PROVISAOPPADESPESA_ID = provDesp.id\r\n               inner join conta c on provDesp.CONTADEDESPESA_ID = c.id\r\n      where emp.CATEGORIAORCAMENTARIA = ''NORMAL''\r\n        and c.codigo like ''3.1%''\r\n      group by ex.ano, extract(month from emp.dataEmpenho), to_char(emp.dataEmpenho, ''Month'')\r\n\r\n      union all\r\n      select ''Pessoal''                                                                as type,\r\n             extract(month from emp.dataEmpenho)                                      as mesNumero,\r\n             to_char(emp.dataEmpenho, ''Month'')                                        as mes,\r\n             case when ex.ano = $ANO then coalesce(sum(est.valor * -1), 0) else 0 end as valor\r\n      from empenhoestorno est\r\n               inner join exercicio ex on est.EXERCICIO_ID = ex.id\r\n               inner join empenho emp on est.empenho_id = emp.id\r\n               inner join despesaorc desp on emp.DESPESAORC_ID = desp.id\r\n               inner join provisaoppadespesa provDesp on desp.PROVISAOPPADESPESA_ID = provDesp.id\r\n               inner join conta c on provDesp.CONTADEDESPESA_ID = c.id\r\n      where est.CATEGORIAORCAMENTARIA = ''NORMAL''\r\n        and c.codigo like ''3.1%''\r\n      group by ex.ano, extract(month from emp.dataEmpenho), to_char(emp.dataEmpenho, ''Month'')\r\n     )\r\ngroup by type, mes, mesNumero\r\norder by type, mesNumero"}]}';
BEGIN
update PAGINAPREFEITURAPORTAL set CONTEUDO = texto where NOME = 'Resumo Geral' and CHAVE = 'resumo-geral';
END;
