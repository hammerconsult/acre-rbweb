DECLARE
texto CLOB := '{"consulta":"select coalesce(pf.nome, pj.razaosocial) as pessoa,\r\n       sum(empenhado) as empenhado,\r\n       sum(liquidado) as liquidado,\r\n       sum(pago) as pago\r\n\r\nfrom (select emp.fornecedor_id as idFornecedor,\r\n             emp.unidadeOrganizacional_id as idUnidade,\r\n             emp.dataEmpenho as dataReferencia,\r\n             sum(emp.valor) as empenhado,\r\n             0 as liquidado,\r\n             0 as pago\r\n      from empenho emp\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n               inner join conta c ON prov.contadedespesa_id = c.id\r\n               inner join subacaoppa sub ON sub.id = prov.subacaoppa_id\r\n               inner join acaoppa a ON a.id = sub.acaoppa_id\r\n               inner join programappa prog ON prog.id = a.programa_id\r\n      where emp.categoriaorcamentaria = ''NORMAL''\r\n      group by emp.fornecedor_id, emp.unidadeOrganizacional_id, emp.dataEmpenho\r\n\r\n      union all\r\n      select emp.fornecedor_id as idFornecedor,\r\n             est.unidadeOrganizacional_id as idUnidade,\r\n             est.dataEstorno as dataReferencia,\r\n             sum(est.valor *-1) as empenhado,\r\n             0 as liquidado,\r\n             0 as pago\r\n      from empenhoestorno est\r\n               inner join empenho emp on est.empenho_id = emp.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n               inner join conta c ON prov.contadedespesa_id = c.id\r\n               inner join subacaoppa sub ON sub.id = prov.subacaoppa_id\r\n               inner join acaoppa a ON a.id = sub.acaoppa_id\r\n               inner join programappa prog ON prog.id = a.programa_id\r\n      where emp.categoriaorcamentaria = ''NORMAL''\r\n      group by emp.fornecedor_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n\r\n      union all\r\n      select emp.fornecedor_id as idFornecedor,\r\n             liq.unidadeOrganizacional_id as idUnidade,\r\n             liq.dataLiquidacao as dataReferencia,\r\n             0 as empenhado,\r\n             sum(liq.valor) as liquidado,\r\n             0 as pago\r\n      from liquidacao liq\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n               inner join conta c ON prov.contadedespesa_id = c.id\r\n               inner join subacaoppa sub ON sub.id = prov.subacaoppa_id\r\n               inner join acaoppa a ON a.id = sub.acaoppa_id\r\n               inner join programappa prog ON prog.id = a.programa_id\r\n      where liq.categoriaorcamentaria = ''NORMAL''\r\n      group by emp.fornecedor_id, liq.unidadeOrganizacional_id, liq.dataLiquidacao\r\n\r\n      union all\r\n      select emp.fornecedor_id as idFornecedor,\r\n             est.unidadeOrganizacional_id as idUnidade,\r\n             est.dataEstorno as dataReferencia,\r\n             0 as empenhado,\r\n             sum(est.valor *-1) as liquidado,\r\n             0 as pago\r\n      from liquidacaoestorno est\r\n               inner join liquidacao liq on est.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n               inner join conta c ON prov.contadedespesa_id = c.id\r\n               inner join subacaoppa sub ON sub.id = prov.subacaoppa_id\r\n               inner join acaoppa a ON a.id = sub.acaoppa_id\r\n               inner join programappa prog ON prog.id = a.programa_id\r\n      where liq.categoriaorcamentaria = ''NORMAL''\r\n      group by emp.fornecedor_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n\r\n      union all\r\n      select emp.fornecedor_id as idFornecedor,\r\n             pag.unidadeOrganizacional_id as idUnidade,\r\n             pag.dataPagamento as dataReferencia,\r\n             0 as empenhado,\r\n             0 as liquidado,\r\n             sum(pag.valor) as pago\r\n      from pagamento pag\r\n               inner join liquidacao liq on pag.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n               inner join conta c ON prov.contadedespesa_id = c.id\r\n               inner join subacaoppa sub ON sub.id = prov.subacaoppa_id\r\n               inner join acaoppa a ON a.id = sub.acaoppa_id\r\n               inner join programappa prog ON prog.id = a.programa_id\r\n      where pag.categoriaorcamentaria = ''NORMAL''\r\n      group by emp.fornecedor_id, pag.unidadeOrganizacional_id, pag.dataPagamento\r\n\r\n      union all\r\n      select emp.fornecedor_id as idFornecedor,\r\n             est.unidadeOrganizacional_id as idUnidade,\r\n             est.dataEstorno as dataReferencia,\r\n             0 as empenhado,\r\n             0 as liquidado,\r\n             sum(est.valor *-1) as pago\r\n      from pagamentoestorno est\r\n               inner join pagamento pag on est.pagamento_id = pag.id\r\n               inner join liquidacao liq on pag.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n               inner join conta c ON prov.contadedespesa_id = c.id\r\n               inner join subacaoppa sub ON sub.id = prov.subacaoppa_id\r\n               inner join acaoppa a ON a.id = sub.acaoppa_id\r\n               inner join programappa prog ON prog.id = a.programa_id\r\n      where pag.categoriaorcamentaria = ''NORMAL''\r\n      group by emp.fornecedor_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n     ) dados\r\ninner join pessoa p on dados.idFornecedor = p.id\r\nleft join pessoafisica pf on pf.id = p.id\r\nleft join pessoajuridica pj on pj.id = p.id\r\nwhere trunc(dados.dataReferencia) BETWEEN to_date(''01/01/$ANO'', ''dd/MM/yyyy'') AND to_date(''31/12/$ANO'', ''dd/MM/yyyy'')\r\n  and dados.idUnidade in (select UNIDADE_ID from UNIDADEPREFEITURAPORTAL where PREFEITURA_ID = $PREFEITURAPORTAL_ID)\r\n  $WHERE\r\ngroup by coalesce(pf.nome, pj.razaosocial)\r\norder by coalesce(pf.nome, pj.razaosocial)","count":"select count(1) from (select emp.fornecedor_id as idFornecedor,\r\n             emp.unidadeOrganizacional_id as idUnidade,\r\n             emp.dataEmpenho as dataReferencia,\r\n             sum(emp.valor) as empenhado,\r\n             0 as liquidado,\r\n             0 as pago\r\n      from empenho emp\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n               inner join conta c ON prov.contadedespesa_id = c.id\r\n               inner join subacaoppa sub ON sub.id = prov.subacaoppa_id\r\n               inner join acaoppa a ON a.id = sub.acaoppa_id\r\n               inner join programappa prog ON prog.id = a.programa_id\r\n      where emp.categoriaorcamentaria = ''NORMAL''\r\n      group by emp.fornecedor_id, emp.unidadeOrganizacional_id, emp.dataEmpenho\r\n\r\n      union all\r\n      select emp.fornecedor_id as idFornecedor,\r\n             est.unidadeOrganizacional_id as idUnidade,\r\n             est.dataEstorno as dataReferencia,\r\n             sum(est.valor *-1) as empenhado,\r\n             0 as liquidado,\r\n             0 as pago\r\n      from empenhoestorno est\r\n               inner join empenho emp on est.empenho_id = emp.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n               inner join conta c ON prov.contadedespesa_id = c.id\r\n               inner join subacaoppa sub ON sub.id = prov.subacaoppa_id\r\n               inner join acaoppa a ON a.id = sub.acaoppa_id\r\n               inner join programappa prog ON prog.id = a.programa_id\r\n      where emp.categoriaorcamentaria = ''NORMAL''\r\n      group by emp.fornecedor_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n\r\n      union all\r\n      select emp.fornecedor_id as idFornecedor,\r\n             liq.unidadeOrganizacional_id as idUnidade,\r\n             liq.dataLiquidacao as dataReferencia,\r\n             0 as empenhado,\r\n             sum(liq.valor) as liquidado,\r\n             0 as pago\r\n      from liquidacao liq\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n               inner join conta c ON prov.contadedespesa_id = c.id\r\n               inner join subacaoppa sub ON sub.id = prov.subacaoppa_id\r\n               inner join acaoppa a ON a.id = sub.acaoppa_id\r\n               inner join programappa prog ON prog.id = a.programa_id\r\n      where liq.categoriaorcamentaria = ''NORMAL''\r\n      group by emp.fornecedor_id, liq.unidadeOrganizacional_id, liq.dataLiquidacao\r\n\r\n      union all\r\n      select emp.fornecedor_id as idFornecedor,\r\n             est.unidadeOrganizacional_id as idUnidade,\r\n             est.dataEstorno as dataReferencia,\r\n             0 as empenhado,\r\n             sum(est.valor *-1) as liquidado,\r\n             0 as pago\r\n      from liquidacaoestorno est\r\n               inner join liquidacao liq on est.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n               inner join conta c ON prov.contadedespesa_id = c.id\r\n               inner join subacaoppa sub ON sub.id = prov.subacaoppa_id\r\n               inner join acaoppa a ON a.id = sub.acaoppa_id\r\n               inner join programappa prog ON prog.id = a.programa_id\r\n      where liq.categoriaorcamentaria = ''NORMAL''\r\n      group by emp.fornecedor_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n\r\n      union all\r\n      select emp.fornecedor_id as idFornecedor,\r\n             pag.unidadeOrganizacional_id as idUnidade,\r\n             pag.dataPagamento as dataReferencia,\r\n             0 as empenhado,\r\n             0 as liquidado,\r\n             sum(pag.valor) as pago\r\n      from pagamento pag\r\n               inner join liquidacao liq on pag.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n               inner join conta c ON prov.contadedespesa_id = c.id\r\n               inner join subacaoppa sub ON sub.id = prov.subacaoppa_id\r\n               inner join acaoppa a ON a.id = sub.acaoppa_id\r\n               inner join programappa prog ON prog.id = a.programa_id\r\n      where pag.categoriaorcamentaria = ''NORMAL''\r\n      group by emp.fornecedor_id, pag.unidadeOrganizacional_id, pag.dataPagamento\r\n\r\n      union all\r\n      select emp.fornecedor_id as idFornecedor,\r\n             est.unidadeOrganizacional_id as idUnidade,\r\n             est.dataEstorno as dataReferencia,\r\n             0 as empenhado,\r\n             0 as liquidado,\r\n             sum(est.valor *-1) as pago\r\n      from pagamentoestorno est\r\n               inner join pagamento pag on est.pagamento_id = pag.id\r\n               inner join liquidacao liq on pag.liquidacao_id = liq.id\r\n               inner join empenho emp on liq.empenho_id = emp.id\r\n               inner join despesaorc desp ON emp.despesaorc_id = desp.id\r\n               inner join provisaoppadespesa prov ON desp.provisaoppadespesa_id = prov.id\r\n               inner join conta c ON prov.contadedespesa_id = c.id\r\n               inner join subacaoppa sub ON sub.id = prov.subacaoppa_id\r\n               inner join acaoppa a ON a.id = sub.acaoppa_id\r\n               inner join programappa prog ON prog.id = a.programa_id\r\n      where pag.categoriaorcamentaria = ''NORMAL''\r\n      group by emp.fornecedor_id, est.unidadeOrganizacional_id, est.dataEstorno\r\n     ) dados\r\ninner join pessoa p on dados.idFornecedor = p.id\r\nleft join pessoafisica pf on pf.id = p.id\r\nleft join pessoajuridica pj on pj.id = p.id\r\nwhere trunc(dados.dataReferencia) BETWEEN to_date(''01/01/$ANO'', ''dd/MM/yyyy'') AND to_date(''31/12/$ANO'', ''dd/MM/yyyy'')\r\n  and dados.idUnidade in (select UNIDADE_ID from UNIDADEPREFEITURAPORTAL where PREFEITURA_ID = $PREFEITURAPORTAL_ID)\r\n  $WHERE","totalRegistros":6340,"fields":[{"posicao":1,"descricao":"Credor","columnName":"PESSOA","columnValue":"PESSOA","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":{"chaveDestino":"pessoa-ver","columnOrigem":"PESSOA","columnDestino":"coalesce(pf.nome, pj.razaosocial)"},"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":2,"descricao":"Empenhado (R$)","columnName":"EMPENHADO","columnValue":"EMPENHADO","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":3,"descricao":"Liquidado (R$)","columnName":"LIQUIDADO","columnValue":"LIQUIDADO","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":4,"descricao":"Pago (R$)","columnName":"PAGO","columnValue":"PAGO","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false}],"pesquisaveis":[{"descricao":"Credor","columnName":"dados.idFornecedor","columnValue":null,"tipo":"MULTI_SELECT","operacaoPadrao":null,"tipoEnum":null,"valorPadrao":"","tipoMultiSelect":"PESSOA_EMPENHO"},{"descricao":"Período","columnName":"dados.dataReferencia","columnValue":null,"tipo":"PERIODO","operacaoPadrao":null,"tipoEnum":null,"valorPadrao":"","tipoMultiSelect":null}],"tabs":[]}';
BEGIN
update PAGINAPREFEITURAPORTAL set CONTEUDO = texto where NOME = 'Despesa por Credor';
END;
