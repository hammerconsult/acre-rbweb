DECLARE
texto CLOB := '{"consulta":"select\r\n    vwAdm.codigo || '' - '' || vwAdm.descricao as secretaria,\r\n    c.numeroContrato as numeroContrato,\r\n    publicacao.datapublicacao as dataPublicacao,\r\n    c.numeroProcesso as numeroProcesso,\r\n    case\r\n        when disp.modalidade is not null then disp.modalidade\r\n        when regExt.modalidadeCarona is not null then regExt.modalidadeCarona\r\n        when lic.modalidadeLicitacao is not null then lic.modalidadeLicitacao\r\n        when cv.modalidade is not null then cv.modalidade\r\n        end as modalidade,\r\n    coalesce(pf.nome, pj.razaosocial) as fornecedor,\r\n    formatacpfcnpj(coalesce(pf.cpf, pj.cnpj)) as cpfCnpj,\r\n    c.objeto as objeto,\r\n    c.observacoes as funcamentoLegal,\r\n    trunc(c.terminoVigenciaAtual) as prazoVigencia,\r\n    c.valorTotal as valor,\r\n    c.situacaoContrato as situacao,\r\n    vwAdm.id as idUnidade,\r\n    c.id as idcontrato,\r\n    to_char(rtrim(xmlagg(xmlelement(e, ''<a target=\"_blank\" href=\"/public/pagina/alteracao-contratual-ver?ac.id='' || ac.id || ''\">'' || ac.numero || (case when publicacaoAlteracao.datapublicacao is not null then '' - '' || to_char(publicacaoAlteracao.datapublicacao, ''dd/MM/yyyy'') else '''' end) || ''</a>'', '', '').extract(''//text()'') order by ac.numero).getclobval(), '', '')) as aditivos\r\nfrom contrato c\r\n         inner join exercicio ex on ex.id = c.exercicioContrato_id\r\n         inner join pessoa p on p.id = c.contratado_id\r\n         left join unidadecontrato uc on uc.contrato_id = c.id\r\n    and trunc(terminoVigencia) between trunc(uc.iniciovigencia) and coalesce(trunc(uc.fimvigencia), trunc(terminoVigencia))\r\n         left join UnidadeOrganizacional uo on uo.id = uc.unidadeAdministrativa_id\r\n         left join entidade ent on ent.id = uo.entidade_id\r\n         left join vwhierarquiaadministrativa vwAdm on vwAdm.subordinada_id = uo.id\r\n    and trunc(terminoVigencia) between trunc(vwAdm.iniciovigencia) and coalesce(trunc(vwAdm.fimvigencia), trunc(terminoVigencia))\r\n         left join pessoafisica pf on p.id = pf.id\r\n         left join pessoajuridica pj on p.id = pj.id\r\n         left join conlicitacao conlic on c.id = conlic.contrato_id\r\n         left join licitacao lic on conlic.licitacao_id = lic.id\r\n         left join exercicio exLic on exLic.id = lic.exercicio_id\r\n         left join condispensalicitacao conDisp on condisp.contrato_id = c.id\r\n         left join dispensadelicitacao disp on disp.id = condisp.dispensadelicitacao_id\r\n         left join exercicio exDisp on exDisp.id = disp.exercicioDaDispensa_id\r\n         left join CONREGPRECOEXTERNO conReg on conreg.contrato_id = c.id\r\n         left join REGISTROSOLMATEXT regExt on regExt.id = conreg.regsolmatext_id\r\n         left join exercicio exRegExt on exRegExt.id = regExt.exercicioRegistro_id\r\n         left join ContratosVigente cv on cv.contrato_id = c.id\r\n         left join (select max(pc.datapublicacao) as datapublicacao, pc.contrato_id as idContrato\r\n                    from publicacaocontrato pc\r\n                             inner join veiculodepublicacao vp on vp.id = pc.veiculodepublicacao_id\r\n                    where lower(vp.nome) like ''%diário oficial do estado do acre%''\r\n                      and rownum = 1\r\n                    group by pc.contrato_id\r\n                    order by max(pc.datapublicacao) desc) publicacao on publicacao.idContrato = c.id\r\n         left join alteracaocontratual ac on ac.contrato_id = c.id and ac.tipoalteracaocontratual = ''ADITIVO''\r\n         left join (select distinct max(pac.datapublicacao) as datapublicacao, pac.alteracaocontratual_id as idAlteracao\r\n                    from publicacaoalteracaocont pac\r\n                             inner join veiculodepublicacao vp on vp.id = pac.veiculodepublicacao_id\r\n                    where lower(vp.nome) like ''%diário oficial do estado do acre%''\r\n                      and rownum = 1\r\n                    group by pac.alteracaocontratual_id\r\n                    order by max(pac.datapublicacao) desc) publicacaoAlteracao on publicacaoAlteracao.idAlteracao = ac.id\r\nwhere ex.ano is not null $WHERE\r\ngroup by c.id, vwAdm.codigo || '' - '' || vwAdm.descricao, c.numeroContrato, publicacao.datapublicacao, ex.ano, c.numeroProcesso,\r\n         coalesce(pf.nome, pj.razaosocial), formatacpfcnpj(coalesce(pf.cpf, pj.cnpj)), vwAdm.id,\r\n         c.objeto, c.observacoes, trunc(c.terminoVigenciaAtual), c.valorTotal, c.situacaoContrato,\r\n         case\r\n             when disp.modalidade is not null then disp.modalidade\r\n             when regExt.modalidadeCarona is not null then regExt.modalidadeCarona\r\n             when lic.modalidadeLicitacao is not null then lic.modalidadeLicitacao\r\n             when cv.modalidade is not null then cv.modalidade\r\n             end\r\norder by ex.ano desc, to_number(c.numerocontrato), to_number(c.numeroProcesso)","count":"select count (1)\r\nfrom contrato c\r\n         inner join exercicio ex on ex.id = c.exercicioContrato_id\r\n         inner join pessoa p on p.id = c.contratado_id\r\n         left join unidadecontrato uc on uc.contrato_id = c.id\r\n    and trunc(terminoVigencia) between trunc(uc.iniciovigencia) and coalesce(trunc(uc.fimvigencia), trunc(terminoVigencia))\r\n         left join UnidadeOrganizacional uo on uo.id = uc.unidadeAdministrativa_id\r\n         left join entidade ent on ent.id = uo.entidade_id\r\n         left join vwhierarquiaadministrativa vwAdm on vwAdm.subordinada_id = uo.id\r\n    and trunc(terminoVigencia) between trunc(vwAdm.iniciovigencia) and coalesce(trunc(vwAdm.fimvigencia), trunc(terminoVigencia))\r\n         left join pessoafisica pf on p.id = pf.id\r\n         left join pessoajuridica pj on p.id = pj.id\r\n         left join conlicitacao conlic on c.id = conlic.contrato_id\r\n         left join licitacao lic on conlic.licitacao_id = lic.id\r\n         left join exercicio exLic on exLic.id = lic.exercicio_id\r\n         left join condispensalicitacao conDisp on condisp.contrato_id = c.id\r\n         left join dispensadelicitacao disp on disp.id = condisp.dispensadelicitacao_id\r\n         left join exercicio exDisp on exDisp.id = disp.exercicioDaDispensa_id\r\n         left join CONREGPRECOEXTERNO conReg on conreg.contrato_id = c.id\r\n         left join REGISTROSOLMATEXT regExt on regExt.id = conreg.regsolmatext_id\r\n         left join exercicio exRegExt on exRegExt.id = regExt.exercicioRegistro_id\r\n         left join ContratosVigente cv on cv.contrato_id = c.id\r\nwhere ex.ano is not null $WHERE","totalRegistros":1463,"fields":[{"posicao":1,"descricao":"Órgão","columnName":"SECRETARIA","columnValue":"SECRETARIA","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":{"chaveDestino":"unidade-ver","columnOrigem":"IDUNIDADE","columnDestino":"ho.id"},"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":2,"descricao":"Número do Coantrato","columnName":"NUMEROCONTRATO","columnValue":"NUMEROCONTRATO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":{"chaveDestino":"contrato-ver","columnOrigem":"IDCONTRATO","columnDestino":"c.id"},"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":3,"descricao":"Data da Publicação","columnName":"DATAPUBLICACAO","columnValue":"DATAPUBLICACAO","tipoAlinhamento":"CENTRO","totalizar":false,"link":null,"tipo":"DATE","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":4,"descricao":"Número do Processo","columnName":"NUMEROPROCESSO","columnValue":"NUMEROPROCESSO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":5,"descricao":"Modalidade","columnName":"MODALIDADE","columnValue":"MODALIDADE","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"ENUM","tipoEnum":"br.com.webpublico.enums.ModalidadeLicitacao","valorPadrao":[null,"CONVITE","TOMADA_PRECO","CONCORRENCIA","CONCURSO","PREGAO","DISPENSA_LICITACAO","INEXIGIBILIDADE","RDC","LEILAO","MANIFESTACAO_INTERESSE","PRE_QUALIFICACAO","CREDENCIAMENTO","DIALOGO_COMPETITIVO"],"escondido":false},{"posicao":6,"descricao":"Nome do Contratado","columnName":"FORNECEDOR","columnValue":"FORNECEDOR","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":6,"descricao":"CPF/CNPJ","columnName":"CPFCNPJ","columnValue":"CPFCNPJ","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":7,"descricao":"Objeto","columnName":"OBJETO","columnValue":"OBJETO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":8,"descricao":"Fundamento Legal","columnName":"FUNCAMENTOLEGAL","columnValue":"FUNCAMENTOLEGAL","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":9,"descricao":"Prazo de Vigência","columnName":"PRAZOVIGENCIA","columnValue":"PRAZOVIGENCIA","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"DATE","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":10,"descricao":"Valor","columnName":"VALOR","columnValue":"VALOR","tipoAlinhamento":"DIREITA","totalizar":true,"link":null,"tipo":"MONETARIO","tipoEnum":null,"valorPadrao":null,"escondido":false},{"posicao":11,"descricao":"Situação","columnName":"SITUACAO","columnValue":"SITUACAO","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"ENUM","tipoEnum":"br.com.webpublico.enums.SituacaoContrato","valorPadrao":[null,"EM_ELABORACAO","APROVADO","RESCINDIDO","DEFERIDO"],"escondido":false},{"posicao":12,"descricao":"IDUNIDADE","columnName":"IDUNIDADE","columnValue":"IDUNIDADE","tipoAlinhamento":"CENTRO","totalizar":false,"link":null,"tipo":"INTEGER","tipoEnum":null,"valorPadrao":null,"escondido":true},{"posicao":14,"descricao":"IDCONTRATO","columnName":"IDCONTRATO","columnValue":"IDCONTRATO","tipoAlinhamento":"CENTRO","totalizar":false,"link":null,"tipo":"INTEGER","tipoEnum":null,"valorPadrao":null,"escondido":true},{"posicao":15,"descricao":"Aditivos","columnName":"ADITIVOS","columnValue":"ADITIVOS","tipoAlinhamento":"ESQUERDA","totalizar":false,"link":null,"tipo":"STRING","tipoEnum":null,"valorPadrao":null,"escondido":false}],"pesquisaveis":[{"descricao":"Modalidade","columnName":"(case         when disp.modalidade is not null then disp.modalidade         when regExt.modalidadeCarona is not null then regExt.modalidadeCarona         when lic.modalidadeLicitacao is not null then lic.modalidadeLicitacao         when cv.modalidade is not null then cv.modalidade     end)","columnValue":null,"tipo":"ENUM","operacaoPadrao":null,"tipoEnum":"br.com.webpublico.enums.ModalidadeLicitacao","valorPadrao":[null,"CONVITE","TOMADA_PRECO","CONCORRENCIA_PUBLICA","CONCURSO","PREGAO","DISPENSA_LICITACAO","INEXIGIBILIDADE","RDC"],"tipoMultiSelect":null},{"descricao":"Secretaria","columnName":"vwAdm.codigo","columnValue":null,"tipo":"MULTI_SELECT","operacaoPadrao":"LIKE","tipoEnum":null,"valorPadrao":"","tipoMultiSelect":"UNIDADE_ADMINISTRATIVA_NIVEL2"},{"descricao":"Objeto","columnName":"c.objeto","columnValue":null,"tipo":"STRING","operacaoPadrao":null,"tipoEnum":null,"valorPadrao":"","tipoMultiSelect":null},{"descricao":"Exercício","columnName":"ex.ano","columnValue":null,"tipo":"INTEGER","operacaoPadrao":"IGUAL","tipoEnum":null,"valorPadrao":"","tipoMultiSelect":null}],"tabs":[],"paineis":[]}';
BEGIN
update PAGINAPREFEITURAPORTAL set CONTEUDO = texto where NOME = 'Contratos' and CHAVE = 'contrato';
END;
